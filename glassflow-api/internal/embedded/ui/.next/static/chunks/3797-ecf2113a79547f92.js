"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3797],{3797:(e,t,n)=>{n.d(t,{LJ:()=>m,RU:()=>d,Yi:()=>y,_1:()=>s,dm:()=>p,filterUserMappableColumns:()=>u,generateApiConfig:()=>c,ry:()=>_,xR:()=>S});var i=n(6456),o=n(8387),l=n(119).hp,r=n(9543);let a=e=>e?l.from(e).toString("base64"):void 0,s=e=>{let t=e.default_type||e.default_kind||"";return!!(e.default_expression||"DEFAULT"===t)},u=e=>e.filter(e=>!(e=>{let t=e.default_type||e.default_kind||"";return"ALIAS"===t||"MATERIALIZED"===t})(e)),c=e=>{let{pipelineId:t,pipelineName:n,setPipelineId:l,clickhouseConnection:s,clickhouseDestination:u,selectedTopics:c,getMappingType:d,joinStore:p,kafkaStore:m,deduplicationStore:v}=e;try{var _,y,S,b,h,I,g,A,k,T,E,L,U,P,N,w,C,D,F,j,R;let e=t;e||(e=(0,i.A)(),l(e));let G=(null==u?void 0:u.mapping)||[],M=c.map((e,t)=>{var n,i,l;let r={};e.events&&e.selectedEvent&&e.selectedEvent.event&&(r={...(null==e||null==(l=e.selectedEvent)?void 0:l.event)||{}},"object"==typeof r&&null!==r&&"_metadata"in r&&delete r._metadata);let a=(null==v||null==(n=v.getDeduplication)?void 0:n.call(v,t))||null;return{consumer_group_initial_offset:e.initialOffset,name:e.name,id:e.name,replicas:e.replicas,schema:{type:"json",fields:(0,o.B$)(r).map(e=>{let t=d(e,G),n=f(r,e);return{name:e,type:t||n}})},deduplication:a&&a.enabled&&a.key?{enabled:!0,id_field:a.key,id_field_type:a.keyType,time_window:a.window?"".concat(a.window).concat((null==(i=a.unit)?void 0:i.charAt(0))||"h"):"1h"}:{enabled:!1}}}),x=(null==u?void 0:u.mapping)?u.mapping.filter(e=>e.eventField).filter(e=>!e.eventField.startsWith("_metadata")).map(e=>{var t,n;let i=e.sourceTopic||(null==(t=c[0])?void 0:t.name);if(!e.sourceTopic){for(let t of c)if(t.events&&t.selectedEvent&&t.selectedEvent.event){let o=(null==t||null==(n=t.selectedEvent)?void 0:n.event)||{};if(e.eventField in o){i=t.name;break}}}if(p.streams&&p.streams.length>0){for(let t of p.streams)if(t.joinKey===e.eventField){i=t.topicName||t.streamId;break}}return{source_id:i,field_name:e.eventField,column_name:e.name,column_type:e.type.replace(/Nullable\((.*)\)/,"$1")}}):[],B=(0,o.y)(),K=(null==B?void 0:B.NEXT_PUBLIC_IN_DOCKER)==="true"||"true"===r.env.NEXT_PUBLIC_IN_DOCKER,O={pipeline_id:e,name:n,source:{type:"kafka",provider:"custom",connection_params:{brokers:((null==m||null==(_=m.bootstrapServers)?void 0:_.split(","))||[]).map(e=>(e=>{if(!e)return e;let[t,n]=e.split(":");return K&&("localhost"===t||"127.0.0.1"===t||"[::1]"===t)?"host.docker.internal".concat(n?":".concat(n):""):e})(e.trim())),protocol:(null==m?void 0:m.securityProtocol)||"PLAINTEXT",skip_auth:(null==m?void 0:m.skipAuth)||!1},topics:M},...M.length>1?{join:{enabled:p.enabled,type:p.type||"temporal",sources:p.streams.length>0?p.streams.map(e=>({source_id:e.topicName,join_key:e.joinKey,time_window:"".concat(e.joinTimeWindowValue).concat(e.joinTimeWindowUnit.charAt(0)),orientation:e.orientation})):M.map((e,t)=>{var n;let i=(null==v||null==(n=v.getDeduplication)?void 0:n.call(v,t))||null,o=(null==i?void 0:i.key)||"";return{source_id:e.name,join_key:o,time_window:"1h",orientation:0===t?"left":"right"}})}}:{},sink:{type:"clickhouse",provider:"custom",...(null==s?void 0:s.connectionType)==="direct"?{host:null==(y=s.directConnection)?void 0:y.host,port:(null==(b=s.directConnection)||null==(S=b.nativePort)?void 0:S.toString())||"9000",http_port:(null==(I=s.directConnection)||null==(h=I.httpPort)?void 0:h.toString())||void 0,database:null==u?void 0:u.database,username:null==(g=s.directConnection)?void 0:g.username,password:a(null==(A=s.directConnection)?void 0:A.password),secure:(null==(k=s.directConnection)?void 0:k.useSSL)||!1,skip_certificate_verification:(null==(T=s.directConnection)?void 0:T.skipCertificateVerification)||!1,max_batch_size:(null==u?void 0:u.maxBatchSize)||1e3,max_delay_time:(()=>{let e=(null==u?void 0:u.maxDelayTime)||1,t=(null==u?void 0:u.maxDelayTimeUnit)||"m",n=t;return"seconds"===t?n="s":"minutes"===t?n="m":"hours"===t?n="h":"days"===t&&(n="d"),"".concat(e).concat(n)})()}:{},table:null==u?void 0:u.table,table_mapping:x}};if((null==m?void 0:m.securityProtocol)==="SASL_PLAINTEXT"||(null==m?void 0:m.securityProtocol)==="SASL_SSL"){let e=null==(E=m.authMethod)?void 0:E.toLowerCase();if(null==e?void 0:e.includes("plain")){if(O.source.connection_params={...O.source.connection_params,mechanism:"PLAIN",username:null==(L=m.saslPlain)?void 0:L.username,password:null==(U=m.saslPlain)?void 0:U.password},(null==m?void 0:m.securityProtocol)==="SASL_SSL"||(null==m?void 0:m.securityProtocol)==="SSL"){let e=null==(N=m.saslPlain)||null==(P=N.truststore)?void 0:P.certificates;e&&(O.source.connection_params={...O.source.connection_params,root_ca:a(e)})}}else if(null==e?void 0:e.includes("scram")){let t=e.includes("256")?"SCRAM-SHA-256":"SCRAM-SHA-512",n=e.includes("256")?m.saslScram256:m.saslScram512;if(O.source.connection_params={...O.source.connection_params,mechanism:t,username:null==n?void 0:n.username,password:null==n?void 0:n.password},(null==m?void 0:m.securityProtocol)==="SASL_SSL"||(null==m?void 0:m.securityProtocol)==="SSL"){let e=null==n||null==(w=n.truststore)?void 0:w.certificates;e&&(O.source.connection_params={...O.source.connection_params,root_ca:a(e)})}}else(null==e?void 0:e.includes("oauth"))&&(O.source.connection_params={...O.source.connection_params,mechanism:"OAUTHBEARER",oauthBearerToken:null==(C=m.saslOauthbearer)?void 0:C.oauthBearerToken})}if((null==m?void 0:m.authMethod)==="SASL/GSSAPI"&&(O.source.connection_params={...O.source.connection_params,mechanism:"GSSAPI",principal:m.saslGssapi.kerberosPrincipal,username:m.saslGssapi.kerberosPrincipal,kerberosKeytab:m.saslGssapi.kerberosKeytab,kerberosRealm:m.saslGssapi.kerberosRealm,kdc:m.saslGssapi.kdc,serviceName:m.saslGssapi.serviceName,krb5Config:m.saslGssapi.krb5Config},(null==m?void 0:m.securityProtocol)==="SASL_SSL"||(null==m?void 0:m.securityProtocol)==="SSL")){let e=null==(F=m.saslGssapi)||null==(D=F.truststore)?void 0:D.certificates;e&&(O.source.connection_params={...O.source.connection_params,root_ca:a(e)})}if((null==m?void 0:m.authMethod)==="NO_AUTH"&&((null==m?void 0:m.securityProtocol)==="SSL"||(null==m?void 0:m.securityProtocol)==="SASL_SSL")){let e=null==(R=m.noAuth)||null==(j=R.truststore)?void 0:j.certificates;e&&(O.source.connection_params={...O.source.connection_params,root_ca:a(e)})}return O}catch(e){return console.error("Error generating API config:",e),{error:"Failed to generate API configuration"}}};function d(e){if(null===e)return"null";if(void 0===e)return"undefined";let t=typeof e;if("number"===t)if(Number.isInteger(e))if(e>=0)return e<=255?"uint8":e<=65535?"uint16":e<=0xffffffff?"uint32":e<=Number.MAX_SAFE_INTEGER?"uint64":"string";else return e>=-128&&e<=127?"int8":e>=-32768&&e<=32767?"int16":e>=-0x80000000&&e<=0x7fffffff?"int32":e>=Number.MIN_SAFE_INTEGER&&e<=Number.MAX_SAFE_INTEGER?"int64":"string";else{let t=Math.abs(e);return t<34e37&&t>12e-39?"float32":"float64"}return"boolean"===t?"bool":"string"===t?(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)||/^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|[+-]\d{2}:\d{2})?)?$/.test(e),"string"):Array.isArray(e)?"array":"object"}let p=(e,t)=>{let n=e=>e.toLowerCase().replace(/[_\.]/g,""),i=n(e),o=t.find(e=>n(e)===i);if(o)return o;let l=t.find(e=>n(e.split(".").pop()||"")===i);return l||t.find(e=>{let t=e.split(".").pop()||"";return n(t).includes(i)||i.includes(n(t))})},m=(e,t)=>{if(!e||!t)return;let n=t.split("."),i=e;for(let e of n){if(null==i||"object"!=typeof i||"object"!=typeof i||null===i)return;i=i[e]}return i},f=(e,t)=>{let n=m(e,t);return null==n?"string":d(n)},v={string:["String","FixedString","DateTime","DateTime64","UUID","Enum8","Enum16","Decimal","Bool","UInt8","UInt16","UInt32","UInt64","UInt128","Date","Date32"],int8:["Int8"],int16:["Int16"],int32:["Int32"],int64:["Int64","DateTime","DateTime64"],float32:["Float32"],float64:["Float64","DateTime","DateTime64"],bool:["Bool"],bytes:["String"],int:["Int8","Int16","Int32","Int64"],float:["Float32","Float64"],uint8:["UInt8"],uint16:["UInt16"],uint32:["UInt32"],uint64:["UInt64"],uint:["UInt8","UInt16","UInt32","UInt64"],number:["Int8","Int16","Int32","Int64","UInt8","UInt16","UInt32","UInt64","Float32","Float64","Decimal","DateTime","DateTime64"],boolean:["Bool"],object:["String"],array:["Array","String"],null:["Nullable"],undefined:["Nullable"]};function _(e,t){if(!e||!t)return!1;if(t.startsWith("Nullable("))return _(e,t.substring(9,t.length-1));if(t.startsWith("Array(")){let n=t.substring(6,t.length-1);return"array"===e||_(e,n)}let n=v[e.toLowerCase()];return!!n&&n.some(e=>t.includes(e))}function y(e){let t=[],n=[],i=[];return e.forEach(e=>{if(e.eventField){if(!e.jsonType)return void i.push({...e,reason:"Missing type: Field ".concat(e.eventField," is mapped to column ").concat(e.name," but has no inferred type")});_(e.jsonType,e.type)?t.push(e):n.push({...e,reason:"Incompatible type: ".concat(e.jsonType," cannot be mapped to ").concat(e.type)})}}),{validMappings:t,invalidMappings:n,missingTypeMappings:i}}let S=(e,t)=>{let n=t.find(t=>t.eventField===e);return n?n.jsonType:"string"}}}]);