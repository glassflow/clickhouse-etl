"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6091],{386:(e,t,n)=>{n.d(t,{A:()=>p});var a=n(1929),s=n(2477),i=n(1869),o=n(8387),r=n(5855),l=n(9596);let c={primary:"btn-primary",secondary:"btn-secondary",tertiary:"btn-tertiary",destructive:"btn-destructive"},d=function(e){let{children:t,isSuccess:n=!1,isLoading:s=!1,isFailed:d=!1,disabled:u=!1,onClick:p,successText:m="Success",failedText:f="Failed",loadingText:h="Loading...",regularText:v="Continue",className:g,actionType:x="primary",showLoadingIcon:S=!1}=e;return(0,a.jsxs)(i.$,{className:(0,o.cn)(g,{[c[x]]:!0,"btn-text":!0,"opacity-50":s}),type:"button",variant:"secondary"===x?"secondary":"gradient",size:"custom",onClick:p||(()=>{}),disabled:u,children:[s&&S&&(0,a.jsx)(l.default,{src:r.A,alt:"Loading",width:16,height:16,className:"animate-spin"}),s?h||"Loading...":void 0!==d&&d?f||"Continue":void 0!==n&&n?m||"Continue":v||t]})},u=e=>{let{editMode:t,toggleEditMode:n,onSubmit:i,onDiscard:o,isLoading:r,isSuccess:l,disabled:c,successText:u,loadingText:p,regularText:m,actionType:f,showLoadingIcon:h,pipelineActionState:v,onClose:g}=e,[x,S]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=setTimeout(()=>S(!0),100);return()=>clearTimeout(e)},[]);let b=(null==v?void 0:v.isLoading)&&((null==v?void 0:v.lastAction)==="stop"||(null==v?void 0:v.lastAction)==="edit"),y=async()=>{await i()};return(0,a.jsx)("div",{className:"overflow-hidden pt-2",children:(0,a.jsxs)("div",{className:"flex gap-3 transition-all duration-500 ease-out ".concat(x?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"),children:[!t&&g&&(0,a.jsx)("div",{className:"animate-in fade-in slide-in-from-top-2 duration-500 delay-100",children:(0,a.jsx)(d,{actionType:"primary",onClick:g,regularText:"Close",disabled:b})}),t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-in fade-in slide-in-from-top-2 duration-500 delay-100",children:(0,a.jsx)(d,{onClick:y,regularText:"Save changes",isLoading:r,isSuccess:l,disabled:c||r,successText:u,loadingText:p,actionType:f,showLoadingIcon:h})}),(0,a.jsx)("div",{className:"animate-in fade-in slide-in-from-top-2 duration-500 delay-100",children:(0,a.jsx)(d,{actionType:"secondary",onClick:()=>{o(),null==g||g()},regularText:"Discard",disabled:r})})]}):(0,a.jsx)("div",{className:"animate-in fade-in slide-in-from-top-2 duration-500 delay-100",children:(0,a.jsx)(d,{actionType:"primary",onClick:n,regularText:"Edit",disabled:b})})]})})},p=function(e){let{onSubmit:t,onDiscard:n,toggleEditMode:s,standalone:i,readOnly:o,disabled:r,isLoading:l,isSuccess:c,successText:p,loadingText:m,regularText:f,actionType:h,showLoadingIcon:v,pipelineActionState:g,onClose:x}=e;return(0,a.jsxs)("div",{className:"flex gap-4",children:[i&&s&&(0,a.jsx)(u,{editMode:!o,onSubmit:t,onDiscard:n||(()=>{}),toggleEditMode:s,isLoading:l,isSuccess:c,disabled:r,successText:p,loadingText:m,regularText:f,actionType:h,showLoadingIcon:v,pipelineActionState:g,onClose:x}),(!i||!s)&&(0,a.jsx)(d,{onClick:t,isLoading:l,isSuccess:c,disabled:r,successText:p,loadingText:m,regularText:f,actionType:h,showLoadingIcon:v})]})}},669:(e,t,n)=>{n.d(t,{w:()=>b});var a=n(1929),s=n(2477),i=n(8090),o=n(3511),r=n(8821),l=n(44),c=n(1511),d=n(3062),u=n(2511);let p={directConnectionForm:{fields:{host:{name:"directConnection.host",label:"Host",placeholder:"Enter host, e.g. clickhouse.mycompany.com without http:// or https://",required:"Host is required",type:"text"},httpPort:{name:"directConnection.httpPort",label:"HTTP(S) Port",placeholder:"Enter HTTP(S) port, e.g. 8443",required:"HTTP(S) Port is required",type:"text"},username:{name:"directConnection.username",label:"Username",placeholder:"Enter username",required:"Username is required",type:"text"},password:{name:"directConnection.password",label:"Password",placeholder:"Enter password",required:"Password is required",type:"password"},nativePort:{name:"directConnection.nativePort",label:"Native Port",placeholder:"Enter native port, e.g. 9440",required:"Native port is required",type:"text"},useSSL:{name:"directConnection.useSSL",label:"Use SSL",type:"boolean",defaultValue:!0,placeholder:"Use SSL"},skipCertificateVerification:{name:"directConnection.skipCertificateVerification",label:"Skip Certificate Verification",type:"boolean",defaultValue:!0,placeholder:"Skip Certificate Verification"}}},proxyConnectionForm:{fields:{proxyUrl:{name:"proxyConnection.proxyUrl",label:"Proxy URL",placeholder:"Enter proxy URL",required:"Proxy URL is required",type:"text"},proxyUsername:{name:"proxyConnection.proxyUsername",label:"Proxy Username",placeholder:"Enter proxy username",required:"Proxy username is required",type:"text"},proxyPassword:{name:"proxyConnection.proxyPassword",label:"Proxy Password",placeholder:"Enter proxy password",required:"Proxy password is required",type:"password"}}},connectionStringConnectionForm:{fields:{connectionString:{name:"connectionStringConnection.connectionString",label:"Connection String",placeholder:"Enter connection string",required:"Connection string is required",type:"text"}}}},m=e=>{var t,n;let{errors:i,readOnly:o,isLoading:r}=e,{register:l}=(0,c.xW)(),[m,f]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=setTimeout(()=>f(!0),100);return()=>clearTimeout(e)},[]);let{directConnectionForm:h}=p;return(0,a.jsxs)(d.gE,{className:"space-y-4 transition-all duration-700 ease-out ".concat(m?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"),children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,a.jsx)("div",{className:"space-y-2",children:(0,u.bl)({field:{...h.fields.host,readOnly:r},register:l,errors:i,readOnly:o})}),(0,a.jsx)("div",{className:"space-y-2",children:(0,u.bl)({field:{...h.fields.httpPort,readOnly:r},register:l,errors:i,readOnly:o})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,a.jsx)("div",{className:"space-y-2",children:(0,u.bl)({field:{...h.fields.username,readOnly:r},register:l,errors:i,readOnly:o})}),(0,a.jsx)("div",{className:"space-y-2",children:(0,u.bl)({field:{...h.fields.password,readOnly:r},register:l,errors:i,readOnly:o})})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:(0,a.jsx)("div",{className:"space-y-2",children:(0,u.bl)({field:{...h.fields.nativePort,readOnly:r},register:l,errors:i,readOnly:o})})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,a.jsx)("div",{className:"space-y-2",children:(0,u.bl)({field:{...h.fields.useSSL,readOnly:r,defaultValue:null==(t=h.fields.useSSL.defaultValue)?void 0:t.toString()},register:l,errors:i,readOnly:o})}),(0,a.jsx)("div",{className:"space-y-2",children:(0,u.bl)({field:{...h.fields.skipCertificateVerification,readOnly:r,defaultValue:null==(n=h.fields.skipCertificateVerification.defaultValue)?void 0:n.toString()},register:l,errors:i,readOnly:o})})]})]})},f=e=>{let{errors:t,readOnly:n,isLoading:i}=e,[o,r]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=setTimeout(()=>r(!0),200);return()=>clearTimeout(e)},[]),(0,a.jsx)("div",{className:"space-y-4 md:space-y-6 transition-all duration-700 ease-out ".concat(o?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"),children:(0,a.jsx)(m,{errors:t,readOnly:n,isLoading:i})})};var h=n(1528),v=n(386);let g=e=>{let{onTestConnection:t,onDiscardConnectionChange:n,isConnecting:i,connectionResult:o,readOnly:r,standalone:d,initialValues:u,host:p,httpPort:m,username:g,password:x,nativePort:S,useSSL:b,skipCertificateVerification:y,toggleEditMode:w,pipelineActionState:j,onClose:C}=e,N=(0,s.useRef)(u),[k,T]=(0,s.useState)(!0),[A,E]=(0,s.useState)(!1),L=(0,s.useRef)(!1),O=!!p,P=(0,c.mN)({resolver:(0,l.u)(h.g7),defaultValues:u,mode:"onBlur",criteriaMode:"firstError",shouldFocusError:!1}),{watch:I,setValue:F,trigger:_,handleSubmit:D}=P,{errors:M,isValid:R,isDirty:U,touchedFields:q}=P.formState;I("directConnection.host"),I("directConnection.httpPort"),I("directConnection.username"),I("directConnection.password"),I("directConnection.nativePort"),I("directConnection.useSSL"),I("directConnection.skipCertificateVerification"),(0,s.useEffect)(()=>{N.current=u},[u]),(0,s.useEffect)(()=>(O&&!L.current&&(p&&F("directConnection.host",p),m&&F("directConnection.httpPort",m),g&&F("directConnection.username",g),x&&F("directConnection.password",x),S&&F("directConnection.nativePort",S),void 0!==b&&F("directConnection.useSSL",b),void 0!==y&&F("directConnection.skipCertificateVerification",y),L.current=!0),()=>{k&&T(!1)}),[p,m,g,x,S,b,y,F,k,O]),(0,s.useEffect)(()=>{O||(F("directConnection.useSSL",!0),F("directConnection.skipCertificateVerification",!0))},[F,O]);let K=A||O&&!k&&Object.keys(q).length>0,V=async()=>{let e=P.getValues();if(E(!0),!await P.trigger())return void console.log("Form has validation errors",P.formState.errors);if(d){t&&await t(e);return}t&&await t(e)};return(0,a.jsx)(c.Op,{...P,children:(0,a.jsxs)("form",{onSubmit:D(()=>{}),className:"space-y-6",onChange:()=>{A||E(!0)},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},children:[(0,a.jsx)(f,{errors:K?M:{},readOnly:r,isLoading:i}),(0,a.jsx)(v.A,{standalone:d,onSubmit:V,onDiscard:()=>{P.reset(N.current),E(!1),L.current=!1,p&&P.setValue("directConnection.host",p),m&&P.setValue("directConnection.httpPort",m),g&&P.setValue("directConnection.username",g),x&&P.setValue("directConnection.password",x),S&&P.setValue("directConnection.nativePort",S),void 0!==b&&P.setValue("directConnection.useSSL",b),void 0!==y&&P.setValue("directConnection.skipCertificateVerification",y),n()},toggleEditMode:w,readOnly:r,isLoading:i||(null==j?void 0:j.isLoading)&&((null==j?void 0:j.lastAction)==="stop"||(null==j?void 0:j.lastAction)==="edit"),isSuccess:null==o?void 0:o.success,disabled:i||(null==j?void 0:j.isLoading)&&((null==j?void 0:j.lastAction)==="stop"||(null==j?void 0:j.lastAction)==="edit"),successText:"Continue",loadingText:(null==j?void 0:j.isLoading)&&(null==j?void 0:j.lastAction)==="stop"?"Stopping pipeline for editing...":(null==j?void 0:j.isLoading)&&(null==j?void 0:j.lastAction)==="edit"?"Saving configuration...":"Testing...",regularText:"Continue",actionType:"primary",showLoadingIcon:!0,pipelineActionState:j,onClose:C})]})})};var x=n(4775),S=n(8967);function b(e){var t,n,l,c;let{onCompleteStep:d,onCompleteStandaloneEditing:u,standalone:p,readOnly:m=!1,toggleEditMode:f,pipelineActionState:h}=e,[v,b]=(0,s.useState)(!1),{clickhouseConnectionStore:y}=(0,i.useStore)(),w=(0,x.U)(),{clickhouseConnection:j,setClickhouseConnection:C}=y,{directConnection:N}=j,[k,T]=(0,s.useState)(!1),[A,E]=(0,s.useState)(null),{isLoading:L,connectionStatus:O,connectionError:P,testConnection:I}=(0,o.E)(),F={connectionType:"direct",directConnection:{host:(null==N?void 0:N.host)||"",httpPort:(null==N?void 0:N.httpPort)||"",username:(null==N?void 0:N.username)||"",password:(null==N?void 0:N.password)||"",nativePort:(null==N?void 0:N.nativePort)||"",useSSL:null==(t=null==N?void 0:N.useSSL)||t,skipCertificateVerification:null==(n=null==N?void 0:N.skipCertificateVerification)||n}};(0,s.useEffect)(()=>{k||(w.page.setupClickhouseConnection({isReturningVisit:!!(null==N?void 0:N.host)}),T(!0))},[k,w.page,null==N?void 0:N.host]),(0,s.useEffect)(()=>{"success"===O?w.clickhouse.success({host:null==A?void 0:A.directConnection.host,useSSL:null==A?void 0:A.directConnection.useSSL}):"error"===O&&w.clickhouse.failed({error:P||"Unknown connection error",host:null==A?void 0:A.directConnection.host})},[O,P,A,w.clickhouse]);let _=async e=>{var t;w.clickhouse.started({host:e.directConnection.host,useSSL:e.directConnection.useSSL}),E(e);let n=await I({host:e.directConnection.host,httpPort:e.directConnection.httpPort,username:e.directConnection.username,password:e.directConnection.password,nativePort:e.directConnection.nativePort,useSSL:e.directConnection.useSSL,skipCertificateVerification:e.directConnection.skipCertificateVerification});(null==n?void 0:n.success)&&(null==(t=n.databases)?void 0:t.length)>0&&(e=>{if(C({...j,directConnection:{host:e.directConnection.host,httpPort:e.directConnection.httpPort,username:e.directConnection.username,password:e.directConnection.password,nativePort:e.directConnection.nativePort,useSSL:e.directConnection.useSSL,skipCertificateVerification:e.directConnection.skipCertificateVerification},connectionStatus:"success",connectionError:null}),p&&f){let{coreStore:e}=i.useStore.getState();e.markAsDirty(),console.log("[ClickhouseConnection] Configuration marked as dirty - changes will be saved on Resume")}!p&&d?d(r.Fn.CLICKHOUSE_CONNECTION):p&&u&&u()})(e)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g,{onTestConnection:_,onDiscardConnectionChange:()=>{C({...j,connectionStatus:"idle",connectionError:null}),b(!0)},isConnecting:L,connectionResult:"success"===O?{success:!0,message:"Successfully connected to ClickHouse!"}:"error"===O?{success:!1,message:P||"Connection failed"}:null,readOnly:m,standalone:p,initialValues:F,host:(null==N?void 0:N.host)||"",httpPort:(null==N?void 0:N.httpPort)||"",username:(null==N?void 0:N.username)||"",password:(null==N?void 0:N.password)||"",nativePort:(null==N?void 0:N.nativePort)||"",useSSL:null==(l=null==N?void 0:N.useSSL)||l,skipCertificateVerification:null==(c=null==N?void 0:N.skipCertificateVerification)||c,toggleEditMode:f,pipelineActionState:h,onClose:u}),"success"===O&&!v&&(0,a.jsx)(S.A,{message:"Successfully connected to ClickHouse!",success:!0}),"error"===O&&!v&&(0,a.jsx)(S.A,{message:P||"Connection failed",success:!1})]})}},827:(e,t,n)=>{n.d(t,{g:()=>R});var a=n(1929),s=n(2477),i=n(7161),o=n(4914),r=n(9985),l=n(5735),c=n(4122),d=n(1611),u=n(1869),p=n(3165),m=n(8387),f=n(4400);function h(e){let{primaryOptions:t,secondaryOptions:n,selectedOption:i,onSelect:o,placeholder:r="Select an option",className:l,disabled:c=!1,clearable:h=!0,primaryLabel:v="Primary Fields",secondaryLabel:g="Secondary Fields",sourceTopic:x,open:S,onOpenChange:b}=e,[y,w]=(0,s.useState)(!1),[j,C]=(0,s.useState)(""),[N,k]=(0,s.useState)({list:"primary",index:0}),T=(0,s.useRef)(null),A=(0,s.useRef)(null),E=(0,s.useRef)(null),L=(0,s.useRef)(null),O=void 0!==S,P=O?S:y,I=e=>{O?null==b||b(e):w(e),e||B(null)},[F,_]=(0,s.useState)([]),[D,M]=(0,s.useState)([]),[R,U]=(0,s.useState)("below"),[q,K]=(0,s.useState)(null),[V,B]=(0,s.useState)(null);return(0,s.useEffect)(()=>{i?C(i):C("")},[i]),(0,s.useEffect)(()=>{let e=t.filter(e=>e.toLowerCase().includes(j.toLowerCase())),a=n.filter(e=>e.toLowerCase().includes(j.toLowerCase()));_(e),M(a),e.length>0?k({list:"primary",index:0}):a.length>0&&k({list:"secondary",index:0})},[j,t,n]),(0,s.useEffect)(()=>{if(!P||!A.current)return;let e=()=>{var e;let t,n=null==(e=A.current)?void 0:e.getBoundingClientRect();if(!n)return;F.length,D.length;let a=Math.max(Math.min(32*F.length+32,300),Math.min(32*D.length+32,300))+40+16,s=window.innerHeight-n.bottom,i=n.top;null===V?B(t=s<376&&i>=376?"above":"below"):t=V,U(t),K({top:"above"===t?n.top-a-8:n.bottom+4,left:n.left,width:n.width})};return e(),window.addEventListener("scroll",e,!0),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e,!0),window.removeEventListener("resize",e)}},[P,F.length,D.length]),(0,a.jsxs)("div",{ref:A,className:(0,m.cn)("relative w-full",l),onKeyDown:e=>{if(!P){("ArrowDown"===e.key||"ArrowUp"===e.key)&&(e.preventDefault(),I(!0));return}let t=N.list,n="primary"===t?F:D,a="primary"===t?"secondary":"primary",s="primary"===a?F:D;switch(e.key){case"ArrowDown":e.preventDefault(),N.index<n.length-1?k({...N,index:N.index+1}):s.length>0&&k({list:a,index:0});break;case"ArrowUp":e.preventDefault(),N.index>0?k({...N,index:N.index-1}):s.length>0&&k({list:a,index:s.length-1});break;case"Enter":e.preventDefault();let i=N.list,r="primary"===i?F:D;N.index>=0&&N.index<r.length&&(o(r[N.index],i),I(!1));break;case"Escape":e.preventDefault(),I(!1)}},children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(d.p,{ref:T,type:"text",placeholder:r,value:j,onChange:e=>{let t=e.target.value;C(t),I(!0),""===t&&B(null)},onClick:()=>!c&&I(!0),className:(0,m.cn)("w-full pr-10 input-regular input-border-regular text-content",c&&"opacity-60 cursor-not-allowed"),disabled:c}),(0,a.jsxs)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center space-x-1",children:[h&&i&&(0,a.jsxs)(u.$,{type:"button",variant:"ghost",size:"icon",className:"h-5 w-5 opacity-70 hover:opacity-100",onClick:()=>{C(""),o(null,"primary")},disabled:c,children:[(0,a.jsx)("span",{className:"sr-only",children:"Clear"}),(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[(0,a.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,a.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})]}),(0,a.jsx)(p.A,{className:(0,m.cn)("h-4 w-4 opacity-50",c&&"cursor-not-allowed"),onClick:()=>!c&&I(!P)})]})]}),P&&!c&&q&&(0,f.createPortal)((0,a.jsxs)("div",{className:"fixed z-50 shadow-md rounded-md overflow-hidden bg-[#1e1e1f] flex",style:{top:q.top+"px",left:q.left+"px",width:Math.max(500,q.width)+"px"},children:[(0,a.jsxs)("div",{className:"flex-1 p-4",children:[(0,a.jsx)("div",{children:"Left Topic"}),(0,a.jsx)("div",{className:"max-h-[300px] overflow-auto p-1",ref:E,children:0===F.length?(0,a.jsx)("div",{className:"py-2 px-2 text-sm text-muted-foreground",children:"No options found."}):(0,a.jsx)("div",{className:"space-y-1",children:F.map((e,t)=>(0,a.jsx)("div",{className:(0,m.cn)("flex w-full items-center px-2 py-1.5 text-sm outline-none cursor-pointer transition-all duration-150 text-content","hover:bg-accent hover:text-accent-foreground",i===e&&"bg-accent/50","primary"===N.list&&N.index===t&&"bg-primary/20"),onClick:()=>{o(e,"primary"),I(!1)},onMouseEnter:()=>k({list:"primary",index:t}),children:(0,a.jsx)("span",{className:"flex-1",children:e})},e))})})]}),(0,a.jsx)("div",{className:"w-px bg-white/10 my-4"}),(0,a.jsxs)("div",{className:"flex-1 p-4",children:[(0,a.jsx)("div",{children:"Right Topic"}),(0,a.jsx)("div",{className:"max-h-[300px] overflow-auto p-1",ref:L,children:0===D.length?(0,a.jsx)("div",{className:"py-2 px-2 text-sm text-muted-foreground",children:"No options found."}):(0,a.jsx)("div",{className:"space-y-1",children:D.map((e,t)=>(0,a.jsx)("div",{className:(0,m.cn)("flex w-full items-center px-2 py-1.5 text-sm outline-none cursor-pointer transition-all duration-150 text-content","hover:bg-accent hover:text-accent-foreground",i===e&&"bg-accent/50","secondary"===N.list&&N.index===t&&"bg-primary/20"),onClick:()=>{o(e,"secondary"),I(!1)},onMouseEnter:()=>k({list:"secondary",index:t}),children:(0,a.jsx)("span",{className:"flex-1",children:e})},e))})})]})]}),document.body)]})}var v=n(4049),g=n(8821),x=n(3797),S=n(9596),b=n(4775),y=n(6718);let w={src:"/_next/static/media/left-topic.c5c95726.svg",height:20,width:20,blurWidth:0,blurHeight:0},j={src:"/_next/static/media/right-topic.6002b49f.svg",height:20,width:20,blurWidth:0,blurHeight:0},C={src:"/_next/static/media/move-right.96866002.svg",height:24,width:24,blurWidth:0,blurHeight:0};function N(e){let{eventFields:t,mappedColumns:n,updateColumnMapping:i,mapEventFieldToColumn:o,primaryEventFields:r=[],secondaryEventFields:d=[],primaryTopicName:u="Primary Topic",secondaryTopicName:p="Secondary Topic",isJoinMapping:m=!1,readOnly:f,unmappedNonNullableColumns:N=[],unmappedDefaultColumns:k=[],onRefreshTableSchema:T,selectedDatabase:A,selectedTable:E}=e,[L,O]=(0,s.useState)(null),P=(0,b.U)(),I=(e,t)=>{O(t?e:null)};return(0,s.useEffect)(()=>{P.destination.columnsShowed({count:(null==t?void 0:t.length)||0})},[t]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4 mt-8",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium text-content",children:["Map incoming event fields to ClickHouse table columns.",f&&(0,a.jsx)("span",{className:"text-sm text-gray-500 ml-2",children:"(Read-only)"})]}),(0,a.jsx)(y.Q,{type:"tableSchema",database:A,table:E,onRefresh:async()=>T(),size:"sm",variant:"outline",disabled:f})]}),(0,a.jsxs)(l.XI,{className:"[&_tr]:border-0 [&_td]:border-0 [&_th]:border-0 [&_thead]:border-0 [&_tbody]:border-0 border-0 table-fixed w-full ".concat(f?"opacity-75":""),children:[(0,a.jsx)(l.A0,{className:"[&_tr]:border-b-0",children:(0,a.jsxs)(l.Hj,{className:"border-0",children:[(0,a.jsx)(l.nd,{className:"text-content border-0 w-[40%]",children:"Fields in incoming event"}),(0,a.jsx)(l.nd,{className:"text-content border-0 w-[25%]",children:"Data Type (incoming)"}),(0,a.jsx)(l.nd,{className:"text-content text-center border-0 w-[5%]",children:"Topic"}),(0,a.jsx)(l.nd,{className:"text-content border-0 w-[40%]",children:"Destination column"})]})}),(0,a.jsx)(l.BF,{className:"border-0",children:n.map((e,n)=>{let s=N.includes(e.name)&&!e.eventField,b=k.includes(e.name)&&!e.eventField,y=e.eventField&&e.jsonType&&!(0,x.ry)(e.jsonType,e.type),T=s||y||b;return(0,a.jsxs)(l.Hj,{className:"border-0 ".concat(f?"":"hover:bg-[var(--color-background-neutral-faded)]"),style:{transition:"background-color 0.2s ease-in-out"},children:[(0,a.jsx)(l.nA,{className:"w-[30%]",children:(0,a.jsxs)("div",{children:[m?(0,a.jsx)(h,{primaryOptions:r,secondaryOptions:d,selectedOption:e.eventField,onSelect:(e,t)=>o(n,e||"",t),placeholder:"Select event field",className:"w-full ".concat(s?"[&_input]:border-red-500 [&_input]:border-2":b?"[&_input]:border-orange-500 [&_input]:border-2":""),primaryLabel:u,secondaryLabel:p,open:L===n,onOpenChange:e=>I(n,e),disabled:f}):(0,a.jsx)(c.Z,{availableOptions:t,selectedOption:e.eventField,onSelect:e=>o(n,e||""),placeholder:"Select event field",className:"w-full ".concat(s?"[&_input]:border-red-500 [&_input]:border-2":b?"[&_input]:border-orange-500 [&_input]:border-2":""),open:L===n,onOpenChange:e=>I(n,e),disabled:f,readOnly:f}),T&&(0,a.jsx)("div",{className:"text-xs font-medium leading-tight overflow-hidden mt-1",children:s?(0,a.jsx)("span",{className:"text-red-600",children:"This field is not nullable, enter a value"}):b?(0,a.jsx)("span",{className:"text-orange-500",children:"Has default value - will be auto-populated if unmapped"}):(0,a.jsx)("span",{className:"text-transparent",children:"Placeholder for alignment"})})]})}),(0,a.jsx)(l.nA,{className:"w-[25%]",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)(v.l6,{value:e.jsonType||"",onValueChange:e=>i(n,"jsonType",e),disabled:f,children:[(0,a.jsx)(v.bq,{className:"w-full bg-[var(--color-gray-dark-900)] border-[var(--color-border-neutral)] hover:bg-[var(--color-gray-dark-950)] transition-colors text-content select-content-custom ".concat(f?"opacity-50 cursor-not-allowed":""," ").concat(y?"border-red-500 border-2":""),children:(0,a.jsx)(v.yv,{placeholder:"Select type"})}),(0,a.jsx)(v.gC,{className:"bg-[var(--color-background-neutral-faded)] border-[var(--color-border-neutral)] shadow-md text-content select-content-custom",children:g.Qu.map(e=>(0,a.jsx)(v.eb,{value:e,className:"text-content select-item-custom",children:e},e))})]}),T&&(0,a.jsx)("div",{className:"text-xs font-medium leading-tight overflow-hidden mt-1",children:y?(0,a.jsxs)("span",{className:"text-red-600",children:["Type ",e.jsonType," is incompatible with ",e.type]}):(0,a.jsx)("span",{className:"text-transparent",children:"Placeholder for alignment"})})]})}),(0,a.jsxs)(l.nA,{className:"text-content w-[5%] align-left",children:[(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(e=>{if(m)if(e.sourceTopic===u)return(0,a.jsx)(S.default,{src:w,alt:"Primary Topic",height:20,width:20});else return e.sourceTopic===p?(0,a.jsx)(S.default,{src:j,alt:"Secondary Topic",height:20,width:20}):(console.warn('⚠️ Column "'.concat(e.name,'" missing sourceTopic in join mode. Using primary icon as fallback.')),(0,a.jsx)(S.default,{src:w,alt:"Primary Topic (Fallback)",height:20,width:20}));return(0,a.jsx)(S.default,{src:C,alt:"Topic",height:20,width:20})})(e)}),T&&(0,a.jsx)("div",{className:"text-xs font-medium leading-tight overflow-hidden mt-1",children:(0,a.jsx)("span",{className:"text-transparent",children:"Placeholder for alignment"})})]}),(0,a.jsxs)(l.nA,{className:"text-content w-[40%]",children:[(0,a.jsxs)("div",{className:"flex justify-between bg-[#212121] my-1 rounded-sm p-3",children:[(0,a.jsx)("span",{children:e.name}),(0,a.jsx)("span",{className:"text-xs text-content-secondary",children:e.type||"Unknown"})]}),T&&(0,a.jsx)("div",{className:"text-xs font-medium leading-tight overflow-hidden mt-1",children:(0,a.jsx)("span",{className:"text-transparent",children:"Placeholder for alignment"})})]})]},e.name)})})]})]})}var k=n(3233);function T(e){let{availableDatabases:t,selectedDatabase:n,setSelectedDatabase:s,isLoading:i,onRefresh:o,readOnly:r}=e;return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)(k.J,{htmlFor:"database",className:"text-content transform transition-all duration-300 ease-in-out translate-y-4 opacity-0 animate-[fadeIn_0.3s_ease-in-out_forwards]",children:"Database"})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[t.length>0||i?(0,a.jsxs)(v.l6,{value:n,onValueChange:s,disabled:r||i,children:[(0,a.jsx)(v.bq,{id:"database",className:"w-full text-content select-content-custom transform transition-all duration-300 ease-in-out translate-y-4 opacity-0 animate-[fadeIn_0.3s_ease-in-out_forwards]",children:(0,a.jsx)(v.yv,{placeholder:i?"Loading databases...":"Select database"})}),(0,a.jsx)(v.gC,{className:"text-content bg-background-neutral-faded select-content-custom",children:t.map(e=>(0,a.jsx)(v.eb,{value:e,className:"text-content select-item-custom",children:e},e))})]}):(0,a.jsx)("div",{className:"flex gap-4 items-center transform transition-all duration-300 ease-in-out translate-y-4 opacity-0 animate-[fadeIn_0.3s_ease-in-out_forwards]",children:(0,a.jsx)(d.p,{id:"database",placeholder:"Enter database name",value:n,onChange:e=>s(e.target.value),className:"flex-1 text-content",disabled:r})}),o&&(0,a.jsx)("div",{className:"flex items-center justify-end ml-2",children:(0,a.jsx)(y.Q,{disabled:r,type:"databases",onRefresh:o,size:"sm",variant:"ghost",className:"transform transition-all duration-300 ease-in-out translate-y-4 opacity-0 animate-[fadeIn_0.3s_ease-in-out_forwards]"})})]})]})}function A(e){let{selectedDatabase:t,availableTables:n,selectedTable:s,setSelectedTable:i,isLoading:o,onOpenChange:r,open:l,onRefresh:c,readOnly:u}=e;return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)(k.J,{htmlFor:"table",className:"text-content transform transition-all duration-300 ease-in-out translate-y-4 opacity-0 animate-[fadeIn_0.3s_ease-in-out_forwards]",children:"Table"})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[n.length>0||o?(0,a.jsxs)(v.l6,{value:s,onValueChange:i,open:l,onOpenChange:r,disabled:u||o,children:[(0,a.jsx)(v.bq,{id:"table",className:"w-full text-content select-content-custom transform transition-all duration-300 ease-in-out translate-y-4 opacity-0 animate-[fadeIn_0.3s_ease-in-out_forwards]",children:(0,a.jsx)(v.yv,{placeholder:o?"Loading tables...":"Select table"})}),(0,a.jsx)(v.gC,{className:"text-content bg-background-neutral-faded select-content-custom",children:n.map(e=>(0,a.jsx)(v.eb,{value:e,className:"text-content select-item-custom",children:e},e))})]}):(0,a.jsx)("div",{className:"flex gap-4 items-center transform transition-all duration-300 ease-in-out translate-y-4 opacity-0 animate-[fadeIn_0.3s_ease-in-out_forwards]",children:(0,a.jsx)(d.p,{id:"table",placeholder:"Enter table name",value:s,onChange:e=>i(e.target.value),className:"flex-1 text-content",disabled:u})}),c&&(0,a.jsx)("div",{className:"flex items-center justify-end ml-2",children:(0,a.jsx)(y.Q,{disabled:u,type:"tables",database:t,onRefresh:c,size:"sm",variant:"ghost",className:"transform transition-all duration-300 ease-in-out translate-y-4 opacity-0 animate-[fadeIn_0.3s_ease-in-out_forwards]"})})]})]})}function E(e){let{availableDatabases:t,selectedDatabase:n,setSelectedDatabase:s,testDatabaseAccess:i,isLoading:o,getConnectionConfig:r,availableTables:l,selectedTable:c,setSelectedTable:d,testTableAccess:u,onRefreshDatabases:p,onRefreshTables:m,readOnly:f}=e;return(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 lg:gap-8 mb-8",children:[(0,a.jsx)("div",{className:"w-full lg:w-1/2",children:(0,a.jsx)(T,{availableDatabases:t,selectedDatabase:n,setSelectedDatabase:s,testDatabaseAccess:i,isLoading:o,getConnectionConfig:r,onRefresh:p,readOnly:f})}),n&&(0,a.jsx)("div",{className:"w-full lg:w-1/2",children:(0,a.jsx)(A,{selectedDatabase:n,availableTables:l,selectedTable:c,setSelectedTable:d,testTableAccess:u,isLoading:o,getConnectionConfig:r,onRefresh:m,readOnly:f})})]})}function L(e){let{value:t,onChange:n,className:i,disabled:o}=e,[r,l]=(0,s.useState)(!1);return(0,a.jsxs)(v.l6,{value:t,onValueChange:n,disabled:o,children:[(0,a.jsx)(v.bq,{className:(0,m.cn)("w-full","input-regular","input-border-regular","transition-all duration-200 ease-in-out","text-content",i),onFocus:()=>l(!0),onBlur:()=>{document.querySelector('[data-state="open"]')||l(!1)},children:(0,a.jsx)(v.yv,{placeholder:"Select type",className:"text-content"})}),(0,a.jsx)(v.gC,{className:"select-content-custom animate-fadeIn text-content",children:g.ny.map(e=>{let[t,n]=e;return(0,a.jsx)(v.eb,{value:n.value,className:"select-item-custom text-content",children:n.label},t)})})]})}function O(e){let{maxBatchSize:t,maxDelayTime:n,maxDelayTimeUnit:i,onMaxBatchSizeChange:o,onMaxDelayTimeChange:r,onMaxDelayTimeUnitChange:l,readOnly:c}=e,[u,p]=(0,s.useState)(t),[m,f]=(0,s.useState)(n),[h,v]=(0,s.useState)(i);return(0,s.useEffect)(()=>{p(t)},[t]),(0,s.useEffect)(()=>{f(n)},[n]),(0,s.useEffect)(()=>{v(i)},[i]),(0,s.useEffect)(()=>{o(u||0)},[u,o]),(0,s.useEffect)(()=>{r(m||0)},[m,r]),(0,s.useEffect)(()=>{l(h)},[h,l]),(0,a.jsxs)("div",{className:"flex gap-4 w-2/3 mb-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-1/3",children:[(0,a.jsx)(k.J,{className:"text-sm font-medium text-muted-foreground text-content",children:"Max Batch Size (No. of events)"}),(0,a.jsx)(d.p,{type:"text",placeholder:"Max Batch Size",value:(null==u?void 0:u.toString())||"",onChange:e=>{let t=e.target.value;if(""===t)p(null);else{let e=parseInt(t);isNaN(e)||p(e)}},className:"text-sm text-content input-regular input-border-regular",disabled:c})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-1/3",children:[(0,a.jsx)(k.J,{className:"text-sm font-medium text-muted-foreground text-content",children:"Max Delay Time"}),(0,a.jsx)(d.p,{type:"text",placeholder:"Max Delay Time",value:(null==m?void 0:m.toString())||"",onChange:e=>{let t=e.target.value;if(""===t)f(null);else{let e=parseInt(t);isNaN(e)||f(e)}},className:"text-sm text-content input-regular input-border-regular",disabled:c})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-1/3",children:[(0,a.jsx)(k.J,{className:"text-sm font-medium text-muted-foreground text-content",children:"Max Delay Time Unit"}),(0,a.jsx)(L,{value:h,onChange:e=>{v(e)},className:"text-sm text-content input-regular input-border-regular",disabled:c})]})]})}var P=n(386),I=n(1475),F=n(8090),_=n(3511),D=n(9543);let M="true"===(0,m.y)().NEXT_PUBLIC_PREVIEW_MODE||"true"===D.env.NEXT_PUBLIC_PREVIEW_MODE;function R(e){var t,n,l,c,d,u,p,f;let{onCompleteStep:h,standalone:v,readOnly:S,toggleEditMode:y,pipelineActionState:w,onCompleteStandaloneEditing:j}=e,C=(0,i.useRouter)(),{clickhouseConnectionStore:k,clickhouseDestinationStore:T,kafkaStore:A,joinStore:L,topicsStore:D,coreStore:R,deduplicationStore:U}=(0,F.useStore)(),q=(0,b.U)(),{clickhouseConnection:K,getDatabases:V,getTables:B,getTableSchema:G,updateDatabases:W,getConnectionId:Y}=k,{clickhouseDestination:z,setClickhouseDestination:J}=T,{connectionStatus:H,connectionError:$,connectionType:X}=K,{getTopic:Z}=D,{setApiConfig:Q,setPipelineId:ee,setOperationsSelected:et,pipelineId:en,pipelineName:ea,setPipelineName:es,operationsSelected:ei}=R,eo=ei.operation===g.Oz.JOINING||ei.operation===g.Oz.DEDUPLICATION_JOINING?"join":"single",er="single"===eo?Z(0):null,el="single"!==eo?D.getTopic(0):null,ec="single"!==eo?D.getTopic(1):null,ed=null==er?void 0:er.selectedEvent,eu=null==er?void 0:er.events,ep=null==er?void 0:er.name,[em,ef]=(0,s.useState)(!1),[eh,ev]=(0,s.useState)(!1),[eg,ex]=(0,s.useState)(!1),[eS,eb]=(0,s.useState)(!1),[ey,ew]=(0,s.useState)(0),[ej,eC]=(0,s.useState)((null==z?void 0:z.database)||""),[eN,ek]=(0,s.useState)((null==z?void 0:z.table)||""),[eT,eA]=(0,s.useState)({columns:(null==z?void 0:z.destinationColumns)||[]}),[eE,eL]=(0,s.useState)((null==z?void 0:z.mapping)||[]),[eO,eP]=(0,s.useState)((null==z?void 0:z.maxBatchSize)||1e3),[eI,eF]=(0,s.useState)((null==z?void 0:z.maxDelayTime)||1),[e_,eD]=(0,s.useState)((null==z?void 0:z.maxDelayTimeUnit)||"m"),[eM,eR]=(0,s.useState)(!1),eU=(0,s.useRef)(eI),eq=(0,s.useRef)(e_),eK=(0,s.useRef)(eO);(0,s.useEffect)(()=>{eU.current=eI},[eI]),(0,s.useEffect)(()=>{eq.current=e_},[e_]),(0,s.useEffect)(()=>{eK.current=eO},[eO]);let[eV,eB]=(0,s.useState)(null),[eG,eW]=(0,s.useState)(null),[eY,ez]=(0,s.useState)([]),[eJ,eH]=(0,s.useState)((null==ed?void 0:ed.event)||null),[e$,eX]=(0,s.useState)((null==el||null==(n=el.selectedEvent)||null==(t=n.event)?void 0:t.event)||null),[eZ,eQ]=(0,s.useState)([]),[e0,e1]=(0,s.useState)([]),[e2,e5]=(0,s.useState)({unmappedNullableColumns:[],unmappedNonNullableColumns:[],unmappedDefaultColumns:[],extraEventFields:[],incompatibleTypeMappings:[],missingTypeMappings:[]}),[e4,e3]=(0,s.useState)("none"),e6=(0,s.useMemo)(()=>"single"===eo?er?[er]:[]:[el,ec].filter(Boolean),[eo,er,el,ec]),[e8,e9]=(0,s.useState)({visible:!1,message:"",title:"",okButtonText:"Yes",cancelButtonText:"No",type:"info"}),e7=(0,s.useRef)("");(0,s.useRef)(!1);let{databases:te,isLoading:tt,error:tn,fetchDatabases:ta}=(()=>{let{clickhouseConnectionStore:e,clickhouseDestinationStore:t}=(0,F.useStore)(),{clickhouseConnection:n,clickhouseMetadata:a,updateDatabases:i,getDatabases:o,getConnectionId:r}=e,[l,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(null),p=(0,b.U)(),m=(0,s.useCallback)(async()=>{if(n.directConnection.host&&n.directConnection.httpPort){c(!0),u(null);try{let e={host:n.directConnection.host,httpPort:n.directConnection.httpPort,username:n.directConnection.username,password:n.directConnection.password,database:"",useSSL:n.directConnection.useSSL,skipCertificateVerification:n.directConnection.skipCertificateVerification,connectionType:"direct"},t=await fetch("/ui-api/clickhouse/databases",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();if(a.success){let e=a.databases||[],t="".concat(n.directConnection.host,":").concat(n.directConnection.httpPort);i(e,t),p.destination.databasesFetched({count:e.length})}else throw Error(a.error||"Failed to fetch databases")}catch(t){let e=t instanceof Error?t.message:"Failed to fetch databases";u(e),p.destination.databaseFetchedError({error:e})}finally{c(!1)}}},[n,i,p]);return{databases:o(),isLoading:l,error:d,fetchDatabases:m,hasData:!!a,connectionId:r()}})(),{tables:ts,isLoading:ti,error:to,fetchTables:tr}=(e=>{var t;let{clickhouseConnectionStore:n,clickhouseDestinationStore:a}=(0,F.useStore)(),{clickhouseConnection:i,clickhouseMetadata:o,updateTables:r,getTables:l,getConnectionId:c}=n,[d,u]=(0,s.useState)(!1),[p,m]=(0,s.useState)(null),f=(0,b.U)(),h=(0,s.useCallback)(async()=>{if(i.directConnection.host&&i.directConnection.httpPort&&e){u(!0),m(null);try{let t={host:i.directConnection.host,httpPort:i.directConnection.httpPort,username:i.directConnection.username,password:i.directConnection.password,database:e,useSSL:i.directConnection.useSSL,skipCertificateVerification:i.directConnection.skipCertificateVerification,connectionType:"direct",nativePort:i.directConnection.nativePort?Number(i.directConnection.nativePort):void 0},n=await fetch("/ui-api/clickhouse/tables",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await n.json();if(a.success){let t=a.tables||[],n="".concat(i.directConnection.host,":").concat(i.directConnection.httpPort);r(e,t,n),f.destination.tablesFetched({database:e,count:t.length})}else throw Error(a.error||"Failed to fetch tables")}catch(n){let t=n instanceof Error?n.message:"Failed to fetch tables";m(t),f.destination.tableFetchedError({database:e,error:t})}finally{u(!1)}}},[i,e,r,f]),v=l(e),g=c();return{tables:v,isLoading:d,error:p,fetchTables:h,hasData:!!(null==o||null==(t=o.tables)?void 0:t[e]),connectionId:g}})(ej),{fetchTableSchema:tl,schema:tc,isLoading:td,error:tu}=((e,t)=>{var n;let{clickhouseConnectionStore:a,clickhouseDestinationStore:i}=(0,F.useStore)(),{clickhouseConnection:o,clickhouseMetadata:r,updateTableSchema:l,getTableSchema:c,getConnectionId:d}=a,[u,p]=(0,s.useState)(!1),[m,f]=(0,s.useState)(null),h=(0,b.U)(),v=(0,s.useCallback)(async()=>{if(o.directConnection.host&&o.directConnection.httpPort&&e&&t){p(!0),f(null);try{let n={host:o.directConnection.host,httpPort:o.directConnection.httpPort,username:o.directConnection.username,password:o.directConnection.password,database:e,table:t,useSSL:o.directConnection.useSSL,skipCertificateVerification:o.directConnection.skipCertificateVerification,connectionType:"direct"},a=await fetch("/ui-api/clickhouse/schema",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),s=await a.json();if(s.success){let n=s.columns||[],a="".concat(o.directConnection.host,":").concat(o.directConnection.httpPort);l(e,t,n,a),h.destination.columnsShowed({database:e,table:t,count:n.length})}else throw Error(s.error||"Failed to fetch table schema")}catch(a){let n=a instanceof Error?a.message:"Failed to fetch table schema";f(n),h.destination.tableFetchedError({database:e,table:t,error:n})}finally{p(!1)}}},[o,e,t,l,h]),g=c(e,t),x=d();return{schema:g,isLoading:u,error:m,fetchTableSchema:v,hasData:!!(null==r||null==(n=r.tableSchemas)?void 0:n["".concat(e,":").concat(t)]),connectionId:x}})(ej,eN);(0,s.useEffect)(()=>{let e="".concat(K.directConnection.host,":").concat(K.directConnection.httpPort,":").concat(K.directConnection.username);e7.current&&e7.current!==e&&(eC(""),ek(""),eA({columns:[]}),eL([])),e7.current=e},[K,ep,0,null==el?void 0:el.name,null==ec?void 0:ec.name]),(0,s.useEffect)(()=>{em||(q.page.selectDestination({}),ef(!0))},[em,q.page]);let{testDatabaseAccess:tp,testTableAccess:tm}=(0,_.E)(),tf=async e=>{if(!e.database)return{success:!1,error:"No database specified"};let t=await tp({host:e.host,httpPort:e.httpPort,username:e.username,password:e.password,database:e.database,useSSL:e.useSSL,connectionType:e.connectionType});return{success:t.success,error:t.error}},th=async e=>{if(!e.database||!eN)return{success:!1,error:"No database or table specified"};let t=await tm({host:e.host,httpPort:e.httpPort,username:e.username,password:e.password,database:e.database,table:eN,useSSL:e.useSSL,connectionType:e.connectionType});return{success:t.success,error:t.error}},tv=(0,s.useCallback)(e=>{eC(e),ek(""),eA({columns:[]}),eL([]),eh&&(null==z?void 0:z.database)===e||(q.destination.databaseSelected({database:e,topicName:"single"===eo?ep:"".concat(null==el?void 0:el.name," + ").concat(null==ec?void 0:ec.name),topicIndex:0,isChange:!!(null==z?void 0:z.database)&&z.database!==e}),ev(!0))},[eh,z,q.destination,ep,0,eo,null==el?void 0:el.name,null==ec?void 0:ec.name]),tg=(0,s.useCallback)(e=>{eN!==e&&(ek(e),eA({columns:[]}),eL([]),eg&&(null==z?void 0:z.table)===e||(q.destination.tableSelected({database:ej,table:e,topicName:"single"===eo?ep:"".concat(null==el?void 0:el.name," + ").concat(null==ec?void 0:ec.name),topicIndex:0,isChange:!!(null==z?void 0:z.table)&&z.table!==e}),ex(!0)))},[eg,z,ej,q.destination,ep,0,eo,null==el?void 0:el.name,null==ec?void 0:ec.name]);(0,s.useEffect)(()=>{if(tc&&tc.length>0){let e=(0,x.filterUserMappableColumns)(tc);if(!(eT.columns.length!==e.length||!eT.columns.every((t,n)=>{var a,s,i,o;return t.name===(null==(a=e[n])?void 0:a.name)&&(t.type===(null==(s=e[n])?void 0:s.type)||t.type===(null==(i=e[n])?void 0:i.column_type))&&t.isNullable===(null==(o=e[n])?void 0:o.isNullable)})))return;let t=eE.some(e=>e.eventField)&&eE.length>0?e.map((e,t)=>{let n=eE.find(t=>t.name===e.name);return n?{...e,jsonType:n.jsonType||"",isNullable:n.isNullable||!1,isKey:n.isKey||!1,eventField:n.eventField||"",...n.sourceTopic&&{sourceTopic:n.sourceTopic}}:{...e,jsonType:"",isNullable:!1,isKey:!1,eventField:""}}):e.map(e=>({...e,jsonType:"",isNullable:!1,isKey:!1,eventField:""}));eA({columns:e}),eL(t)}},[tc,eT.columns,eE]),(0,s.useEffect)(()=>{z&&!eM&&(eC(z.database||""),ek(z.table||""),eA({columns:z.destinationColumns||[]}),eL(z.mapping||[]),eP(z.maxBatchSize||1e3),eF(z.maxDelayTime||1),eD(z.maxDelayTimeUnit||"m"),eR(!0))},[eM]),(0,s.useEffect)(()=>{if(ej&&eN){var e;if(!(G(ej,eN).length>0))(null==z||null==(e=z.destinationColumns)?void 0:e.length)>0&&z.database===ej&&z.table===eN||(console.log("[ClickhouseMapper] Fetching table schema:",ej,eN),tl())}},[ej,eN]),(0,s.useEffect)(()=>{if("single"===eo&&ed&&eu&&eu.length>0){let t=null==ed?void 0:ed.event;if(t){var e;eH(t);let n=(0,m.B$)(t);if(ez(n),(null==z||null==(e=z.mapping)?void 0:e.length)>0)return;if(eE.length>0&&n.length>0){let e=[...eE];e.forEach((a,s)=>{let i=(0,x.dm)(a.name,n);i?e[s]={...a,eventField:i,jsonType:(0,x.RU)((0,x.LJ)(t,i))}:console.log('No match found for column "'.concat(a.name,'"'))}),eL(e),J({...z,mapping:e}),e.filter(e=>e.eventField).length}}else console.log("No event data found")}},[ed,eu,z,eE,J,eo]),(0,s.useEffect)(()=>{if("single"!==eo&&e$){let e=(0,m.B$)(e$);eQ(e),ez([...e])}},[e$,eo]),(0,s.useEffect)(()=>{var e;if("single"!==eo&&(null==ec||null==(e=ec.selectedEvent)?void 0:e.event)){let e=(0,m.B$)(ec.selectedEvent.event);e1(e),ez(t=>[...t,...e])}},[null==ec||null==(c=ec.selectedEvent)||null==(l=c.event)?void 0:l.event,eo]),(0,s.useEffect)(()=>{var e;if("single"===eo||0===eZ.length||0===e0.length||0===eE.length||(null==z||null==(e=z.mapping)?void 0:e.length)>0)return;let t=[...eE],n=!1;if(t.forEach((e,a)=>{if(e.eventField)return;let s=(0,x.dm)(e.name,eZ),i="primary",o=e$;if(!s){var r;s=(0,x.dm)(e.name,e0),i="secondary",o=null==ec||null==(r=ec.selectedEvent)?void 0:r.event}if(s&&o){let r="primary"===i?null==el?void 0:el.name:null==ec?void 0:ec.name;t[a]={...e,eventField:s,jsonType:(0,x.RU)((0,x.LJ)(o,s)),sourceTopic:r},n=!0,console.log('Auto-mapped column "'.concat(e.name,'" to field "').concat(s,'" from ').concat(i," topic (").concat(r,")"))}else console.log('No match found for column "'.concat(e.name,'" in either topic'))}),n){eL(t),J({...z,mapping:t});let e=t.filter(e=>e.eventField).length;console.log("Auto-mapped ".concat(e," fields in join mode with left topic preference"))}},[eZ,e0,eE,z,e$,null==ec||null==(d=ec.selectedEvent)?void 0:d.event,null==el?void 0:el.name,null==ec?void 0:ec.name,J,eo]),(0,s.useEffect)(()=>{var e;"single"!==eo&&(null==el||null==(e=el.selectedEvent)?void 0:e.event)&&eX(el.selectedEvent.event)},[null==el||null==(u=el.selectedEvent)?void 0:u.event,eo]),(0,s.useEffect)(()=>{let e=eE.filter(e=>e.eventField).length;if(e>0&&e!==ey){var t;ew(e),!(ey>0)&&(null==z||null==(t=z.mapping)?void 0:t.length)||eb(!0)}},[eE,ey,q.destination,ep,0,z]),(0,s.useEffect)(()=>{if(0===eT.columns.length||0===eE.length)return;let e={unmappedNullableColumns:[],unmappedNonNullableColumns:[],unmappedDefaultColumns:[],extraEventFields:[],incompatibleTypeMappings:[],missingTypeMappings:[]};eT.columns.forEach(t=>{let n=eE.find(e=>e.name===t.name);if(!n||!n.eventField){var a;let n=(null==t||null==(a=t.type)?void 0:a.includes("Nullable"))||!0===t.isNullable;(0,x._1)(t)?e.unmappedDefaultColumns.push(t.name):n?e.unmappedNullableColumns.push(t.name):e.unmappedNonNullableColumns.push(t.name)}}),e.extraEventFields=("single"===eo?eY:[...eZ,...e0]).filter(e=>!eE.some(t=>t.eventField===e));let{invalidMappings:t,missingTypeMappings:n}=(0,x.Yi)(eE);e.incompatibleTypeMappings=t,e.missingTypeMappings=n,e5(e)},[eT.columns,eE,eY,eZ,e0,eo]),(0,s.useEffect)(()=>{if(te.length>0)return;let e=K.directConnection.host&&K.directConnection.httpPort;("success"===H||e&&!tt)&&(console.log("[ClickhouseMapper] Fetching databases"),ta())},[H,te.length,K.directConnection.host,K.directConnection.httpPort,tt]),(0,s.useEffect)(()=>{ej&&(console.log("[ClickhouseMapper] Fetching tables for database:",ej),tr())},[ej]),(0,s.useCallback)(()=>{if("single"===eo||0===eZ.length||0===e0.length||0===eE.length)return!1;let e=[...eE],t=!1;if(e.forEach((n,a)=>{if(n.eventField)return;let s=(0,x.dm)(n.name,eZ),i="primary",o=e$;if(!s){var r;s=(0,x.dm)(n.name,e0),i="secondary",o=null==ec||null==(r=ec.selectedEvent)?void 0:r.event}if(s&&o){let r="primary"===i?null==el?void 0:el.name:null==ec?void 0:ec.name;e[a]={...n,eventField:s,jsonType:(0,x.RU)((0,x.LJ)(o,s)),sourceTopic:r},t=!0,console.log('Auto-mapped column "'.concat(n.name,'" to field "').concat(s,'" from ').concat(i," topic (").concat(r,")"))}}),t){eL(e),J({...z,mapping:e});let t=e.filter(e=>e.eventField).length;console.log("Auto-mapped ".concat(t," fields in join mode with left topic preference"))}return t},[eo,eZ,e0,eE,e$,null==ec||null==(p=ec.selectedEvent)?void 0:p.event,null==el?void 0:el.name,null==ec?void 0:ec.name,z,J]);let tx=(0,s.useCallback)(()=>{let e=eE.filter(e=>e.eventField).length,t=eT.columns.length;if(e2.incompatibleTypeMappings.length>0){let e=e2.incompatibleTypeMappings.map(e=>"".concat(e.name," (").concat(e.jsonType," → ").concat(e.type,")")).join(", ");return{type:"error",canProceed:!1,title:"Error: Type Incompatibility",message:"Some event fields are mapped to incompatible ClickHouse column types. Please review and fix these mappings:\n        ".concat(e),okButtonText:"OK",cancelButtonText:"Cancel"}}if(e2.missingTypeMappings.length>0){let e=e2.missingTypeMappings.map(e=>"".concat(e.name," (mapped to ").concat(e.eventField,")")).join(", ");return{type:"error",canProceed:!1,title:"Error: Missing Type Information",message:"Some mapped fields have no type information. This might happen when the field path exists but the value is undefined or null. Please review these mappings:\n        ".concat(e),okButtonText:"OK",cancelButtonText:"Cancel"}}if(e2.unmappedNonNullableColumns.length>0)return{type:"error",canProceed:!1,title:"Error: Null Constraint Violation",message:"Target table has NOT NULL constraints. Either modify table to allow nulls, provide values for all required fields, or set database defaults.\n        Required columns: ".concat(e2.unmappedNonNullableColumns.join(", ")),okButtonText:"OK",cancelButtonText:"Cancel"};if(e2.unmappedDefaultColumns.length>0)return{type:"warning",canProceed:!0,title:"Default Values Will Be Used",message:"The following columns have DEFAULT expressions and are not mapped. They will be automatically populated by ClickHouse during insert:\n        ".concat(e2.unmappedDefaultColumns.join(", "),"\n        \n        Do you want to continue?"),okButtonText:"Continue",cancelButtonText:"Cancel"};if(e<t&&e2.unmappedNullableColumns.length>0)return{type:"warning",canProceed:!0,title:"Field Count Mismatch",message:"Are you sure you want to deploy this pipeline while event field count (".concat(e,") is less than table columns (").concat(t,")? Some columns may not receive data.\n        The following columns will be set to NULL: ").concat(e2.unmappedNullableColumns.join(", ")),okButtonText:"Continue",cancelButtonText:"Cancel"};else if(e2.extraEventFields.length>0)return{type:"warning",canProceed:!0,title:"Extra Fields Detected",message:"Some incoming event fields will not be mapped to table columns. Unmapped fields will be dropped during processing. Do you want to continue with deployment?\n        Unmapped fields: ".concat(e2.extraEventFields.join(", ")),okButtonText:"Continue",cancelButtonText:"Cancel"};return null},[e2,eE,eT.columns]),tS=(0,s.useCallback)(()=>{e3("save"),q.destination.columnsSelected({count:eE.length});let e=tx();e?e9({visible:!0,title:e.title,message:e.message,okButtonText:e.okButtonText,cancelButtonText:e.cancelButtonText,type:e.type}):ty()},[tx]),tb=(0,s.useCallback)(()=>{R.discardSection("clickhouse-destination")},[R]),ty=(0,s.useCallback)(()=>{let{invalidMappings:e,missingTypeMappings:t}=(0,x.Yi)(eE);if(e.length>0){let t=e.map(e=>"".concat(e.name," (").concat(e.jsonType," → ").concat(e.type,")")).join(", ");eB("Type compatibility issues remain: ".concat(t,". Please fix these before continuing."));return}if(t.length>0){let e=t.map(e=>"".concat(e.name," (mapped to ").concat(e.eventField,")")).join(", ");eB("Some mapped fields are missing type information: ".concat(e,". Please review these mappings."));return}let n=eT.columns.length,a=Math.round(eE.filter(e=>e.eventField).length/n*100);q.destination.mappingCompleted({count:eE.length,totalColumns:n,mappingPercentage:a,batchSize:eO,delayTime:eI,delayUnit:e_});let s=eU.current,i=eq.current,o=eK.current,r={...z,database:ej,table:eN,mapping:eE,destinationColumns:eT.columns,maxBatchSize:o,maxDelayTime:s,maxDelayTimeUnit:i},l=(0,x.generateApiConfig)({pipelineId:en,pipelineName:ea,setPipelineId:ee,clickhouseConnection:K,clickhouseDestination:r,selectedTopics:e6,getMappingType:x.xR,joinStore:L,kafkaStore:A,deduplicationStore:U});if(J(r),Q(l),eW("Destination configuration saved successfully!"),setTimeout(()=>eW(null),3e3),v&&y){R.markAsDirty(),console.log("[ClickhouseMapper] Configuration marked as dirty - changes will be saved on Resume"),j&&j();return}M?h(g.Fn.CLICKHOUSE_MAPPER):tw(l)},[z,ej,eN,eE,eT.columns,eO,eI,e_,en,ee,K,e6,L,A,J,Q,C,q.destination,eo,null==el?void 0:el.name,null==ec?void 0:ec.name,v,y,R,j,U,ea,h]),tw=(0,s.useCallback)(async e=>{try{await (0,I.pZ)(e);let t=(null==e?void 0:e.pipeline_id)||"";ee(t),C.push("/pipelines/".concat(t,"?deployment=progress"))}catch(e){console.error("deployPipelineAndNavigate: Failed to deploy pipeline:",e),eB("Failed to deploy pipeline: ".concat(e.message))}},[ee,C]);(0,s.useEffect)(()=>()=>{e9(e=>({...e,visible:!1}))},[]);let tj=tt||ti||td,tC=eV||tn||to||tu,tN=async()=>{await ta(),ej&&!te.includes(ej)&&(eC(""),ek(""),eA({columns:[]}),eL([]))},tk=async()=>{await tr(),eN&&!ts.includes(eN)&&(ek(""),eA({columns:[]}),eL([]))},tT=async()=>{await tl()};return(0,s.useEffect)(()=>{if("single"===eo){if(!eJ||0===eE.length)return;let e=!1,t=eE.map(t=>{if(t.eventField&&(!t.jsonType||""===t.jsonType)){let n=(0,x.LJ)(eJ,t.eventField),a=(0,x.RU)(n);if(a)return e=!0,{...t,jsonType:a}}return t});e&&(eL(t),J({...z,mapping:t}))}else{var e;let t=null==ec||null==(e=ec.selectedEvent)?void 0:e.event;if(!e$&&!t||0===eE.length)return;let n=!1,a=eE.map(e=>{if(e.eventField&&(!e.jsonType||""===e.jsonType)){let a=null;e.sourceTopic&&((null==el?void 0:el.name)&&e.sourceTopic===el.name?a=e$:(null==ec?void 0:ec.name)&&e.sourceTopic===ec.name&&(a=t)),a||(a=e$||t);let s=a?(0,x.LJ)(a,e.eventField):void 0,i=(0,x.RU)(s);if(i)return n=!0,{...e,jsonType:i}}return e});n&&(eL(a),J({...z,mapping:a}))}},[eo,eJ,e$,null==ec||null==(f=ec.selectedEvent)?void 0:f.event,eE,null==el?void 0:el.name,null==ec?void 0:ec.name]),(0,a.jsxs)("div",{className:"flex flex-col gap-8 mb-4",children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(E,{availableDatabases:te,selectedDatabase:ej,setSelectedDatabase:tv,testDatabaseAccess:tf,isLoading:tj,getConnectionConfig:()=>({...K.directConnection,connectionType:"direct"}),availableTables:ts,selectedTable:eN,setSelectedTable:tg,testTableAccess:th,onRefreshDatabases:tN,onRefreshTables:tk,readOnly:S}),eN&&(eT.columns.length>0||(null==tc?void 0:tc.length)>0)&&!td&&(0,a.jsxs)("div",{className:"transform transition-all duration-300 ease-in-out translate-y-4 opacity-0 animate-[fadeIn_0.3s_ease-in-out_forwards]",children:[(0,a.jsx)(O,{maxBatchSize:eO,maxDelayTime:eI,maxDelayTimeUnit:e_,onMaxBatchSizeChange:eP,onMaxDelayTimeChange:eF,onMaxDelayTimeUnitChange:eD,readOnly:S}),(0,a.jsx)(N,{eventFields:"single"===eo?eY:[...eZ,...e0],mappedColumns:eE,updateColumnMapping:(e,t,n)=>{let a=[...eE];a[e]={...a[e],[t]:n},eL(a),J({...z,mapping:a})},mapEventFieldToColumn:(e,t,n)=>{let a,s=[...eE];if("single"===eo)a=t?(0,x.LJ)(eJ,t):void 0;else{var i,o,r,l;let e="secondary"===n?null==ec||null==(o=ec.selectedEvent)||null==(i=o.event)?void 0:i.event:null==el||null==(l=el.selectedEvent)||null==(r=l.event)?void 0:r.event;a=e?(0,x.LJ)(e,t):void 0}let c=t?(0,x.RU)(a):s[e].jsonType;!c&&t&&(c="string");let d="single"!==eo&&n?"secondary"===n?null==ec?void 0:ec.name:null==el?void 0:el.name:void 0;s[e]={...s[e],eventField:t,jsonType:c,...d&&{sourceTopic:d}},(0,x.ry)(c,s[e].type||"string"),eL(s)},primaryEventFields:"single"!==eo?eZ:void 0,secondaryEventFields:"single"!==eo?e0:void 0,primaryTopicName:"single"!==eo?null==el?void 0:el.name:void 0,secondaryTopicName:"single"!==eo?null==ec?void 0:ec.name:void 0,isJoinMapping:"single"!==eo,readOnly:S,unmappedNonNullableColumns:e2.unmappedNonNullableColumns,unmappedDefaultColumns:e2.unmappedDefaultColumns,onRefreshTableSchema:tT,selectedDatabase:ej,selectedTable:eN}),(0,a.jsx)("div",{className:"flex gap-2 mt-4",children:(0,a.jsx)(P.A,{standalone:v,onSubmit:tS,onDiscard:tb,isLoading:tj,isSuccess:!!eG,disabled:tj,successText:"Continue",actionType:"primary",showLoadingIcon:!1,regularText:"Continue",loadingText:"Saving...",readOnly:S,toggleEditMode:y,pipelineActionState:w,onClose:j})})]}),tC&&(0,a.jsxs)("div",{className:"p-3 bg-background-neutral-faded text-red-700 rounded-md flex items-center border border-[var(--color-border-neutral)]",children:[(0,a.jsx)(o.A,{className:"h-5 w-5 mr-2"}),(0,a.jsx)("span",{children:tC})]})]}),(0,a.jsx)(r.W,{visible:e8.visible,title:e8.title,description:e8.message,okButtonText:e8.okButtonText,cancelButtonText:e8.cancelButtonText,onComplete:e=>{e9(e=>({...e,visible:!1})),e===r.R.YES&&("error"===e8.type?eB("Please fix the validation errors before proceeding."):ty()),e3("none")},pendingOperation:e4})]})}},1409:(e,t,n)=>{n.d(t,{D:()=>r});let a={nodes:{deduplication:{id:"deduplication",type:"operation",dependencies:["kafka-connection"],dependents:["topic-selection","deduplication-configurator","clickhouse-connection","clickhouse-mapper"],resetMethod:"resetOperationState"},joining:{id:"joining",type:"operation",dependencies:["kafka-connection"],dependents:["topic-selection","join-configurator","clickhouse-connection","clickhouse-mapper"],resetMethod:"resetOperationState"},"deduplication-joining":{id:"deduplication-joining",type:"operation",dependencies:["kafka-connection"],dependents:["topic-selection","deduplication-configurator","join-configurator","clickhouse-connection","clickhouse-mapper"],resetMethod:"resetOperationState"},"ingest-only":{id:"ingest-only",type:"operation",dependencies:["kafka-connection"],dependents:["clickhouse-connection","clickhouse-mapper"],resetMethod:"resetOperationState"},"kafka-connection":{id:"kafka-connection",type:"step",dependencies:[],dependents:["topic-selection","deduplication-configurator","join-configurator","clickhouse-mapper"],resetMethod:"resetKafkaConnection"},"topic-selection":{id:"topic-selection",type:"step",dependencies:["kafka-connection"],dependents:["join-configurator","clickhouse-mapper"],resetMethod:"resetTopicSelection"},"deduplication-configurator":{id:"deduplication-configurator",type:"step",dependencies:[],dependents:[],resetMethod:"resetDeduplicationConfig"},"join-configurator":{id:"join-configurator",type:"step",dependencies:[],dependents:["clickhouse-mapper"],resetMethod:"resetJoinConfig"},"clickhouse-connection":{id:"clickhouse-connection",type:"step",dependencies:["kafka-connection","topic-selection","deduplication-configurator","join-configurator"],dependents:["clickhouse-mapper"],resetMethod:"resetClickhouseConnection"},"clickhouse-mapper":{id:"clickhouse-mapper",type:"step",dependencies:["clickhouse-connection"],dependents:[],resetMethod:"resetClickhouseMapper"},kafkaStore:{id:"kafkaStore",type:"slice",dependencies:[],dependents:["topicsStore","clickhouseStore"],resetMethod:"resetKafkaStore"},topicsStore:{id:"topicsStore",type:"slice",dependencies:["kafkaStore"],dependents:["joinStore","clickhouseStore"],resetMethod:"resetTopicsStore"},joinStore:{id:"joinStore",type:"slice",dependencies:["topicsStore"],dependents:["clickhouseStore"],resetMethod:"resetJoinStore"},clickhouseStore:{id:"clickhouseStore",type:"slice",dependencies:["kafkaStore"],dependents:[],resetMethod:"resetClickhouseStore"},stepsStore:{id:"stepsStore",type:"slice",dependencies:[],dependents:[],resetMethod:"resetStepsStore"}},edges:[{from:"kafkaStore",to:"topicsStore"},{from:"kafkaStore",to:"clickhouseStore"},{from:"kafkaStore",to:"joinStore"},{from:"topicsStore",to:"joinStore"},{from:"topicsStore",to:"clickhouseStore"},{from:"joinStore",to:"clickhouseStore"},{from:"stepsStore",to:"kafkaStore"},{from:"stepsStore",to:"topicsStore"},{from:"stepsStore",to:"joinStore"},{from:"stepsStore",to:"clickhouseStore"}]};var s=n(8821),i=n(8090);class o{onSectionConfigured(e){let t=this.getStoreSliceForSection(e);t&&t.length>0&&t.forEach(e=>{(null==e?void 0:e.markAsValid)&&e.markAsValid()}),this.findDependentSections(e).forEach(t=>{let n=this.getStoreSliceForSection(t);n&&n.length>0&&n.forEach(t=>{(null==t?void 0:t.markAsInvalidated)&&t.markAsInvalidated(e)})})}onSectionReset(e){let t=this.getStoreSliceForSection(e);t&&t.length>0&&t.forEach(e=>{(null==e?void 0:e.markAsNotConfigured)&&e.markAsNotConfigured()}),this.findDependentSections(e).forEach(e=>{let t=this.getStoreSliceForSection(e);t&&t.length>0&&t.forEach(e=>{(null==e?void 0:e.markAsNotConfigured)&&e.markAsNotConfigured()})})}invalidateSection(e,t){let n=this.getStoreSliceForSection(e);n&&n.length>0&&n.forEach(e=>{(null==e?void 0:e.markAsInvalidated)&&e.markAsInvalidated(t)})}markSectionAsValid(e){let t=this.getStoreSliceForSection(e);t&&t.length>0&&t.forEach(e=>{(null==e?void 0:e.markAsValid)&&e.markAsValid()})}getSectionValidation(e){let t=this.getStoreSliceForSection(e);return t&&t.length>0?t.map(e=>(null==e?void 0:e.validation)||{status:"not-configured"}):{status:"not-configured"}}resetAllValidations(){Object.values(s.Fn).forEach(e=>{let t=this.getStoreSliceForSection(e);t&&t.length>0&&t.forEach(e=>{(null==e?void 0:e.resetValidation)&&e.resetValidation()})})}findDependentSections(e){let t=this.getSectionNodeMapping()[e];if(!t)return[];let n=this.dependencyGraph.nodes[t];return n?n.dependents.map(e=>this.getNodeSectionMapping()[e]).filter(Boolean):[]}getStoreSliceForSection(e){return({[s.Fn.KAFKA_CONNECTION]:[this.store.kafkaStore],[s.Fn.TOPIC_SELECTION_1]:[this.store.topicsStore],[s.Fn.TOPIC_SELECTION_2]:[this.store.topicsStore],[s.Fn.DEDUPLICATION_CONFIGURATOR]:[this.store.deduplicationStore],[s.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_1]:[this.store.deduplicationStore,this.store.topicsStore],[s.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_2]:[this.store.deduplicationStore,this.store.topicsStore],[s.Fn.JOIN_CONFIGURATOR]:[this.store.joinStore],[s.Fn.CLICKHOUSE_CONNECTION]:[this.store.clickhouseConnectionStore],[s.Fn.CLICKHOUSE_MAPPER]:[this.store.clickhouseDestinationStore],[s.Fn.REVIEW_CONFIGURATION]:[this.store.coreStore],[s.Fn.DEPLOY_PIPELINE]:[this.store.coreStore]})[e]}getSectionNodeMapping(){return{[s.Fn.KAFKA_CONNECTION]:"kafka-connection",[s.Fn.TOPIC_SELECTION_1]:"topic-selection",[s.Fn.TOPIC_SELECTION_2]:"topic-selection",[s.Fn.DEDUPLICATION_CONFIGURATOR]:"deduplication-configurator",[s.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_1]:"deduplication-configurator",[s.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_2]:"deduplication-configurator",[s.Fn.JOIN_CONFIGURATOR]:"join-configurator",[s.Fn.CLICKHOUSE_CONNECTION]:"clickhouse-connection",[s.Fn.CLICKHOUSE_MAPPER]:"clickhouse-mapper",[s.Fn.REVIEW_CONFIGURATION]:"review-configuration",[s.Fn.DEPLOY_PIPELINE]:"deploy-pipeline"}}getNodeSectionMapping(){return{"kafka-connection":s.Fn.KAFKA_CONNECTION,"topic-selection":s.Fn.TOPIC_SELECTION_1,"deduplication-configurator":s.Fn.DEDUPLICATION_CONFIGURATOR,"join-configurator":s.Fn.JOIN_CONFIGURATOR,"clickhouse-connection":s.Fn.CLICKHOUSE_CONNECTION,"clickhouse-mapper":s.Fn.CLICKHOUSE_MAPPER}}constructor(e,t){this.store=e,this.dependencyGraph=t||a}}let r=()=>new o((0,i.useStore)())},1528:(e,t,n)=>{n.d(t,{g7:()=>i});var a=n(5509);let s=a.Ik({host:a.Yj().min(1,"Host is required"),httpPort:a.Yj().min(1,"HTTP(S) Port is required"),username:a.Yj().min(1,"Username is required"),password:a.Yj().min(1,"Password is required"),database:a.Yj().optional(),useSSL:a.zM().optional(),nativePort:a.Yj().min(1,"Native Port is required"),skipCertificateVerification:a.zM().optional()}),i=a.Ik({connectionType:a.eu("direct"),directConnection:s,connectionStatus:a.k5(["idle","loading","success","error"]).optional(),connectionError:a.Yj().nullable().optional()}),o=a.Ik({name:a.Yj(),type:a.Yj(),jsonType:a.Yj().optional(),isNullable:a.zM().optional(),isKey:a.zM().optional(),eventField:a.Yj().optional(),sourceTopic:a.Yj().optional()});a.Ik({scheme:a.Yj().min(1,"Scheme is required"),database:a.Yj().min(1,"Database is required"),table:a.Yj().min(1,"Table is required"),mapping:a.YO(o),destinationColumns:a.YO(o),maxBatchSize:a.ai().min(1,"Max Batch Size is required"),maxDelayTime:a.ai().min(1,"Max Delay Time is required")})},2205:(e,t,n)=>{n.d(t,{d:()=>r});var a=n(1929),s=n(2477),i=n(7689),o=n(8387);let r=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,a.jsx)(i.bL,{className:(0,o.cn)("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","data-[state=unchecked]:bg-muted dark:data-[state=unchecked]:bg-slate-700","data-[state=checked]:bg-primary","dark:border-slate-600",n),...s,ref:t,children:(0,a.jsx)(i.zi,{className:(0,o.cn)("pointer-events-none block h-4 w-4 rounded-full shadow-lg ring-0 transition-transform","bg-white dark:bg-slate-200","data-[state=unchecked]:translate-x-0","data-[state=checked]:translate-x-4")})})});r.displayName=i.bL.displayName},2246:(e,t,n)=>{n.d(t,{ZI:()=>c,k$:()=>l,m_:()=>r});var a=n(1929);n(2477);var s=n(442),i=n(8387);function o(e){let{delayDuration:t=0,...n}=e;return(0,a.jsx)(s.Kq,{"data-slot":"tooltip-provider",delayDuration:t,...n})}function r(e){let{...t}=e;return(0,a.jsx)(o,{children:(0,a.jsx)(s.bL,{"data-slot":"tooltip",...t})})}function l(e){let{...t}=e;return(0,a.jsx)(s.l9,{"data-slot":"tooltip-trigger",...t})}function c(e){let{className:t,sideOffset:n=0,children:o,...r}=e;return(0,a.jsx)(s.ZL,{children:(0,a.jsx)(s.UC,{"data-slot":"tooltip-content",sideOffset:n,className:(0,i.cn)("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",t),...r,children:o})})}},2272:(e,t,n)=>{n.d(t,{z:()=>o});var a=n(2477),s=n(1475),i=n(5555);let o=e=>{let[t,n]=(0,a.useState)({isLoading:!1,error:null,lastAction:null});return{actionState:t,executeAction:async(t,a)=>{n({isLoading:!0,error:null,lastAction:t});try{let i;switch(t){case"stop":await (0,s.JP)(e.pipeline_id),i=void 0;break;case"resume":await (0,s.WQ)(e.pipeline_id),i=void 0;break;case"terminate":(null==a?void 0:a.graceful)?await (0,s.JP)(e.pipeline_id):await (0,s.sw)(e.pipeline_id),i=void 0;break;case"delete":await (0,s.gP)(e.pipeline_id),i=void 0;break;case"rename":if(!(null==a?void 0:a.name))throw Error("New name is required for rename action");i=await (0,s.lY)(e.pipeline_id,a.name);break;case"edit":if(!a)throw Error("Pipeline configuration is required for edit action");i=await (0,s.Xs)(e.pipeline_id,a);break;default:throw Error("Unsupported action: ".concat(t))}return n({isLoading:!1,error:null,lastAction:t}),i}catch(e){throw n({isLoading:!1,error:e.message||"Failed to ".concat(t," pipeline"),lastAction:t}),e}},clearError:()=>{n(e=>({...e,error:null}))},getActionConfiguration:t=>(0,i.zg)(t,e.status),getButtonText:t=>(0,i.QU)(t,e.status),getAvailableActionsForPipeline:()=>(0,i.tE)(e.status),isActionDisabled:n=>(0,i.zg)(n,e.status).isDisabled||t.isLoading,shouldShowModal:t=>(0,i.zg)(t,e.status).showModal}}},2401:(e,t,n)=>{n.d(t,{Xi:()=>l,av:()=>c,j7:()=>r,tU:()=>o});var a=n(1929);n(2477);var s=n(8882),i=n(8387);function o(e){let{className:t,...n}=e;return(0,a.jsx)(s.bL,{"data-slot":"tabs",className:(0,i.cn)("flex flex-col gap-2",t),...n})}function r(e){let{className:t,...n}=e;return(0,a.jsx)(s.B8,{"data-slot":"tabs-list",className:(0,i.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...n})}function l(e){let{className:t,...n}=e;return(0,a.jsx)(s.l9,{"data-slot":"tabs-trigger",className:(0,i.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n})}function c(e){let{className:t,...n}=e;return(0,a.jsx)(s.UC,{"data-slot":"tabs-content",className:(0,i.cn)("flex-1 outline-none",t),...n})}},2511:(e,t,n)=>{n.d(t,{$C:()=>j,bl:()=>C,gE:()=>S});var a=n(1929),s=n(2477),i=n(7282),o=n(1511),r=n(8387),l=n(3233),c=n(1611),d=n(4811),u=n(4049),p=n(2205);let m=s.createContext({}),f=()=>{let e=s.useContext(m),t=s.useContext(h),{getFieldState:n}=(0,o.xW)(),a=(0,o.lN)({name:e.name}),i=n(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:r}=t;return{id:r,name:e.name,formItemId:"".concat(r,"-form-item"),formDescriptionId:"".concat(r,"-form-item-description"),formMessageId:"".concat(r,"-form-item-message"),...i}},h=s.createContext({});function v(e){let{className:t,...n}=e,{error:s,formItemId:i}=f();return(0,a.jsx)(l.J,{"data-slot":"form-label","data-error":!!s,className:(0,r.cn)("data-[error=true]:text-destructive-foreground",t),htmlFor:i,...n})}function g(e){let{...t}=e,{error:n,formItemId:s,formDescriptionId:o,formMessageId:r}=f();return(0,a.jsx)(i.DX,{"data-slot":"form-control",id:s,"aria-describedby":n?"".concat(o," ").concat(r):"".concat(o),"aria-invalid":!!n,...t})}function x(e){var t;let{className:n,...s}=e,{error:i,formMessageId:o}=f(),l=i?String(null!=(t=null==i?void 0:i.message)?t:""):s.children;return l?(0,a.jsx)("p",{"data-slot":"form-message",id:o,className:(0,r.cn)("text-destructive-foreground text-sm",n),...s,children:l}):null}function S(e){let{className:t,...n}=e;return(0,a.jsx)("div",{className:(0,r.cn)("grid gap-2",t),...n})}let b=e=>{let{name:t,id:n,label:i,placeholder:o,register:l,required:d,error:u,type:p="text",readOnly:m,className:f,noLabel:h,defaultValue:S}=e,[b,y]=(0,s.useState)(!1);return(0,a.jsxs)("div",{className:(0,r.cn)("grid gap-2 transition-all duration-200 ease-in-out",f),children:[!h&&(0,a.jsx)(v,{className:"transition-colors duration-200 text-content",children:i}),(0,a.jsx)(g,{children:(0,a.jsx)(c.p,{id:n,type:p,placeholder:o,...l(t,{required:d}),readOnly:m,className:(0,r.cn)("w-full","input-regular","input-border-regular","transition-all duration-200 ease-in-out","text-content",u&&"input-border-error",b&&"input-active scale-[1.01]",m&&"opacity-50 cursor-not-allowed"),onFocus:()=>!m&&y(!0),onBlur:()=>{document.querySelector('[data-state="open"]')||y(!1)},defaultValue:S})}),u&&(0,a.jsx)(x,{className:"animate-slideDown transition-opacity duration-200 ease-in-out text-content",children:u})]})},y={text:b,textarea:function(e){let{name:t,className:n,required:i,label:o,placeholder:l,register:c,error:u,noLabel:p,readOnly:m,...f}=e,[h,S]=(0,s.useState)(!1);return(0,a.jsxs)("div",{className:(0,r.cn)("grid gap-2 transition-all duration-200 ease-in-out",n),...f,children:[!p&&(0,a.jsx)(v,{className:"transition-colors duration-200 text-content",children:o}),(0,a.jsx)(g,{children:(0,a.jsx)(d.T,{...c(t,{required:i}),placeholder:l,readOnly:m,...f,className:(0,r.cn)("w-full","input-regular","input-border-regular","transition-all duration-200 ease-in-out","text-content",u&&"input-border-error",h&&"input-active scale-[1.01]",m&&"opacity-50 cursor-not-allowed"),onFocus:()=>!m&&S(!0),onBlur:()=>{document.querySelector('[data-state="open"]')||S(!1)}})}),u&&(0,a.jsx)(x,{className:"animate-slideDown transition-opacity duration-200 ease-in-out text-content",children:u})]})},select:function(e){let{name:t,className:n,required:i,label:l,placeholder:c,register:d,error:p,type:m,options:f,defaultValue:h,noLabel:S,readOnly:b,...y}=e,[w,j]=(0,s.useState)(!1),{control:C,getValues:N}=(0,o.xW)(),k=N(t)||h||"";return(0,a.jsxs)("div",{className:(0,r.cn)("space-y-2 w-full min-w-[200px] transition-all duration-200 ease-in-out",n),...y,children:[!S&&(0,a.jsx)(v,{className:"transition-colors duration-200 text-content",children:l}),(0,a.jsx)(g,{children:(0,a.jsx)(o.xI,{name:t,control:C,defaultValue:k,render:e=>{let{field:n}=e;return(0,a.jsxs)(u.l6,{value:n.value,defaultValue:n.value,onValueChange:e=>{b||(n.onChange(e),n.onBlur())},onOpenChange:e=>{b||j(e)},disabled:b,children:[(0,a.jsx)(u.bq,{className:(0,r.cn)("w-full","input-regular","input-border-regular","transition-all duration-200 ease-in-out","text-content",p&&"input-border-error",w&&"input-active scale-[1.01]",b&&"opacity-50 cursor-not-allowed"),onFocus:()=>!b&&j(!0),onBlur:()=>{document.querySelector('[data-state="open"]')||(j(!1),n.onBlur())},disabled:b,children:(0,a.jsx)(u.yv,{placeholder:c})}),(0,a.jsx)(u.gC,{className:"select-content-custom animate-fadeIn",children:0===f.length?(0,a.jsx)("div",{className:"p-2 animate-pulse",children:"No options found"}):f.map(e=>(0,a.jsx)(u.eb,{value:e.value,className:"select-item-custom transition-colors duration-150 hover:scale-[1.02] transition-transform text-content",children:e.label},"".concat(t,"-").concat(e.value)))})]})}})}),p&&(0,a.jsx)(x,{className:"animate-slideDown transition-opacity duration-200 ease-in-out",children:p})]})},number:b,boolean:function(e){let{name:t,className:n,label:i,register:l,error:c,noLabel:d,readOnly:u,...m}=e,[f,h]=(0,s.useState)(!1),{control:S}=(0,o.xW)();return(0,a.jsxs)("div",{className:(0,r.cn)("grid gap-2 transition-all duration-200 ease-in-out",n),...m,children:[!d&&(0,a.jsx)(v,{className:"transition-colors duration-200 text-content",children:i}),(0,a.jsx)(g,{children:(0,a.jsx)(o.xI,{name:t,control:S,defaultValue:!1,render:e=>{let{field:t}=e;return(0,a.jsx)(p.d,{checked:t.value,onCheckedChange:e=>{u||(t.onChange(e),h(e))},disabled:u,className:(0,r.cn)("data-[state=checked]:bg-[var(--primary)]","data-[state=unchecked]:bg-[var(--background)]","transition-colors duration-200 ease-in-out",u&&"opacity-50 cursor-not-allowed")})}})}),c&&(0,a.jsx)(x,{className:"animate-slideDown transition-opacity duration-200 ease-in-out text-content",children:c})]})}};function w(e,t){if(!e||!t)return;let n=null==t?void 0:t.split("."),a=e;for(let e of n){if(!a[e])return;a=a[e]}return a.message?a.message:void 0}function j(e){let{formConfig:t,formGroupName:n,register:i,errors:r,dynamicOptions:l,key:c,values:d,hiddenFields:u,readOnly:p}=e,{control:m,getValues:f}=(0,o.xW)(),h=Object.values(t[n].fields),v=s.useRef(!0);return s.useEffect(()=>{v.current&&(v.current=!1)},[l,h]),(0,a.jsx)("div",{className:"space-y-6",children:h.map((e,t)=>{if(null==u?void 0:u.includes(e.name))return null;let{name:n,label:s,placeholder:o,required:c,type:m,options:f,defaultValue:h,noLabel:v}=e,g=y[m]||b,x=l&&l[n]&&l[n].length>0?l[n]:f||[],S=(null==d?void 0:d[n])!==void 0?d[n]:h||"";return(0,a.jsx)("div",{className:"transition-all duration-300 ease-in-out",style:{animationDelay:"".concat(50*t,"ms"),opacity:0,animation:"fadeIn 0.3s forwards"},children:(0,a.jsx)(g,{name:n,id:n,label:s,placeholder:o,register:i,required:c||"",error:w(r,n)||"",type:m||"text",options:x,defaultValue:S,noLabel:v,readOnly:p})},"".concat(n,"-").concat(x.length,"-").concat(S,"-").concat(t))})},c||"".concat(n,"-").concat(Object.keys(l||{}).length))}function C(e){let{field:t,register:n,errors:s,dynamicOptions:i,values:o,control:r,onChange:l,readOnly:c}=e,{name:d,label:u,placeholder:p,required:m,type:f="text",options:h,defaultValue:v,noLabel:g}=t,x=y[f]||b,S=i&&i[d]&&i[d].length>0?i[d]:h||[],j=(null==o?void 0:o[d])!==void 0?o[d]:v||"",C=w(s,d)||"";return"text"===f?(0,a.jsx)(b,{name:d,id:d,label:u,placeholder:p,register:n,required:m||"",error:C,type:f,readOnly:t.readOnly||c,className:t.className,noLabel:g}):(0,a.jsx)("div",{className:"transition-all duration-300 ease-in-out",style:{opacity:0,animation:"fadeIn 0.3s forwards"},children:(0,a.jsx)(x,{name:d,id:d,label:u,placeholder:p,register:n,required:m||"",error:C,type:f,options:S,defaultValue:j,noLabel:g,readOnly:t.readOnly||c})})}},2627:(e,t,n)=>{n.d(t,{Y:()=>s});class a{buildAuthHeaders(e){let t={servers:e.bootstrapServers,securityProtocol:e.securityProtocol,authMethod:e.authMethod};if("SASL_SSL"===e.securityProtocol||"SSL"===e.securityProtocol){var n,a,s,i,o,r,l,c,d,u;switch(e.authMethod){case"NO_AUTH":(null==(a=e.noAuth)||null==(n=a.truststore)?void 0:n.certificates)&&(t.certificate=e.noAuth.truststore.certificates);break;case"SASL/PLAIN":(null==(i=e.saslPlain)||null==(s=i.truststore)?void 0:s.certificates)&&(t.certificate=e.saslPlain.truststore.certificates);break;case"SASL/GSSAPI":(null==(r=e.saslGssapi)||null==(o=r.truststore)?void 0:o.certificates)&&(t.certificate=e.saslGssapi.truststore.certificates);break;case"SASL/SCRAM-256":(null==(c=e.saslScram256)||null==(l=c.truststore)?void 0:l.certificates)&&(t.certificate=e.saslScram256.truststore.certificates);break;case"SASL/SCRAM-512":(null==(u=e.saslScram512)||null==(d=u.truststore)?void 0:d.certificates)&&(t.certificate=e.saslScram512.truststore.certificates)}}switch(e.authMethod){case"NO_AUTH":break;case"SASL/PLAIN":t.username=e.saslPlain.username,t.password=e.saslPlain.password,t.consumerGroup=e.saslPlain.consumerGroup;break;case"SASL/JAAS":t.jaasConfig=e.saslJaas.jaasConfig;break;case"SASL/GSSAPI":t.kerberosPrincipal=e.saslGssapi.kerberosPrincipal,t.kerberosKeytab=e.saslGssapi.kerberosKeytab,t.kerberosRealm=e.saslGssapi.kerberosRealm,t.kdc=e.saslGssapi.kdc,t.serviceName=e.saslGssapi.serviceName,t.krb5Config=e.saslGssapi.krb5Config;break;case"SASL/OAUTHBEARER":t.oauthBearerToken=e.saslOauthbearer.oauthBearerToken;break;case"SASL/SCRAM-256":case"SASL/SCRAM-512":let p="SASL/SCRAM-256"===e.authMethod?e.saslScram256:e.saslScram512;t.username=p.username,t.password=p.password,t.consumerGroup=p.consumerGroup;break;case"AWS_MSK_IAM":t.awsRegion=e.awsIam.awsRegion,t.awsIAMRoleArn=e.awsIam.awsIAMRoleArn,t.awsAccessKey=e.awsIam.awsAccessKey,t.awsAccessKeySecret=e.awsIam.awsAccessKeySecret;break;case"Delegation tokens":t.delegationToken=e.delegationTokens.delegationToken;break;case"SASL/LDAP":t.ldapServerUrl=e.ldap.ldapServerUrl,t.ldapServerPort=e.ldap.ldapServerPort,t.ldapBindDn=e.ldap.ldapBindDn,t.ldapBindPassword=e.ldap.ldapBindPassword,t.ldapUserSearchFilter=e.ldap.ldapUserSearchFilter,t.ldapBaseDn=e.ldap.ldapBaseDn;break;case"mTLS":t.clientCert=e.mtls.clientCert,t.clientKey=e.mtls.clientKey,t.password=e.mtls.password}return t}async fetchTopics(e){if(!e.bootstrapServers)return{success:!1,error:"Kafka connection details are missing"};try{let t=this.buildAuthHeaders(e),n=await fetch("/ui-api/kafka/topics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await n.json();if(a.success)return{success:!0,topics:a.topics};return{success:!1,error:a.error||"Failed to fetch topics"}}catch(e){return{success:!1,error:"Error connecting to Kafka"}}}async fetchTopicDetails(e){if(!e.bootstrapServers)return{success:!1,error:"Kafka connection details are missing"};try{let t=this.buildAuthHeaders(e),n=await fetch("/ui-api/kafka/topic-details",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await n.json();if(a.success)return{success:!0,topicDetails:a.topicDetails};return{success:!1,error:a.error||"Failed to fetch topic details"}}catch(e){return{success:!1,error:"Error connecting to Kafka"}}}async fetchEvent(e,t){if(!e.bootstrapServers||!t.topic)return{success:!1,error:"Missing required parameters: bootstrapServers or topic"};let n=this.buildAuthHeaders(e),a={servers:n.servers,securityProtocol:n.securityProtocol,authMethod:n.authMethod,...n,...t};try{let e=await fetch("/ui-api/kafka/events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!e.ok){let t=await e.text();return{success:!1,error:"HTTP ".concat(e.status,": ").concat(t)}}let t=await e.json();return{success:!0,data:t,event:t.event,offset:t.offset,position:t.position}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error occurred"}}}}let s=new a},3062:(e,t,n)=>{n.d(t,{gE:()=>a.gE}),n(1929),n(2477),n(8387),(0,n(5596).F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-background text-foreground",destructive:"text-destructive-foreground [&>svg]:text-current *:data-[slot=alert-description]:text-destructive-foreground/80"}},defaultVariants:{variant:"default"}}),n(1869),n(4903),n(9313),n(3621);var a=n(2511);n(1611),n(3233),n(4049),n(2205),n(5735),n(2401),n(4811)},3132:(e,t,n)=>{n.d(t,{B:()=>T});var a=n(1929),s=n(2477),i=n(8090),o=n(8821),r=n(2627),l=n(8387),c=n(9596),d=n(5855),u=n(4122),p=n(6718);function m(e){let{value:t,onChange:n,onBlur:i,onOpenChange:o,error:r,placeholder:c,options:d,readOnly:m,standalone:f,label:h,onRefresh:v}=e,[g,x]=(0,s.useState)(!1),S=(0,s.useMemo)(()=>d.reduce((e,t)=>(e[t.value]=t.label,e),{}),[d]),b=(0,s.useMemo)(()=>d.map(e=>e.label),[d]),y=t?S[t]:"";return(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("div",{className:"relative w-full",children:(0,a.jsx)(u.Z,{availableOptions:b,selectedOption:y,onSelect:e=>{if(!e){n(""),i();return}let t=d.find(t=>t.label===e);t&&(n(t.value),i())},placeholder:c,disabled:m,clearable:!0,open:g,onOpenChange:e=>{x(e),o(e)},readOnly:m,className:(0,l.cn)("w-full",r&&"[&_input]:border-red-500 [&_input]:border-2"),label:h})}),v&&(0,a.jsx)("div",{className:"flex-shrink-0 mb-1.5",children:(0,a.jsx)(p.Q,{disabled:m,type:"topics",onRefresh:v,size:"sm",variant:"ghost",className:"transform transition-all duration-300 ease-in-out translate-y-4 opacity-0 animate-[fadeIn_0.3s_ease-in-out_forwards]"})})]})}var f=n(4049);function h(e){let{value:t,onChange:n,onBlur:i,onOpenChange:o,error:r,placeholder:c,options:d,readOnly:u,standalone:p,label:m}=e,[h,v]=(0,s.useState)(!1);return(0,a.jsxs)("div",{className:"relative w-full",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2",children:m&&(0,a.jsx)("span",{className:"text-sm text-content",children:m})}),(0,a.jsxs)(f.l6,{disabled:u,value:t,defaultValue:t,onValueChange:e=>{n(e),i()},onOpenChange:e=>{v(e)},children:[(0,a.jsx)(f.bq,{className:(0,l.cn)("w-full","input-regular","input-border-regular","transition-all duration-200 ease-in-out","text-content",r&&"input-border-error",h&&"input-active scale-[1.01]"),onFocus:()=>v(!0),onBlur:()=>{document.querySelector('[data-state="open"]')||(v(!1),i())},children:(0,a.jsx)(f.yv,{placeholder:c})}),(0,a.jsx)(f.gC,{className:"select-content-custom animate-fadeIn",children:0===d.length?(0,a.jsx)("div",{className:"p-2 animate-pulse",children:"No options found"}):d.map(e=>(0,a.jsx)(f.eb,{value:e.value,className:"select-item-custom transition-colors duration-150 hover:scale-[1.02] transition-transform text-content",children:e.label},"".concat(e.value)))})]})]})}function v(e){let{topicValue:t,isLoadingEvent:n,offsetValue:o,onTopicChange:r,onOffsetChange:l,onBlur:c,onOpenChange:d,topicError:u,offsetError:p,topicPlaceholder:f,offsetPlaceholder:v,topicOptions:g,offsetOptions:x,index:S,readOnly:b,disableTopicChange:y,onRefreshTopics:w}=e,[j,C]=(0,s.useState)(!1),{topicsStore:N}=(0,i.useStore)(),{updateTopic:k}=N,T=(0,s.useCallback)(e=>{r(e),e!==t&&k({index:S,name:e,initialOffset:o,events:[],selectedEvent:{topicIndex:S,position:o,event:void 0}})},[t,o,S,r,k]),A=(0,s.useCallback)(e=>{l(e),e!==o&&(k({index:S,name:t,initialOffset:e,events:[],selectedEvent:{topicIndex:S,position:e,event:void 0}}),t&&k({index:S,name:t,initialOffset:e,events:[],selectedEvent:{topicIndex:S,position:e,event:void 0}}))},[t,o,S,l,k]);return(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsx)(m,{value:t,onChange:T,onBlur:c,onOpenChange:d,error:u,placeholder:f,options:g,readOnly:y||b,label:"Source Topic",onRefresh:w,...y&&!b?{title:"Topic cannot be changed when editing a pipeline. To use a different topic, create a new pipeline."}:{}}),t&&(0,a.jsx)(h,{value:o,onChange:A,onBlur:c,onOpenChange:d,error:p,placeholder:v,options:x,readOnly:b||n,label:"Initial Offset"})]})}var g=n(4281);let x=function(e){let{topicName:t,topicIndex:n,initialOffset:i,initialEvent:o,onEventLoading:r,onEventLoaded:c,onEventError:d,onEmptyTopic:u,onManualEventChange:p,isEditingEnabled:m,readOnly:f,fetchNewestEvent:h,fetchOldestEvent:v,fetchNextEvent:x,fetchPreviousEvent:S,refreshEvent:b,currentOffset:y,earliestOffset:w,latestOffset:j,isAtLatest:C,isAtEarliest:N,isLoading:k}=e,[T,A]=(0,s.useState)(()=>o?{event:o,position:i,kafkaOffset:y||0,isAtEarliest:N||!1,isAtLatest:C||!1,topicIndex:n}:null),[E,L]=(0,s.useState)(t),[O,P]=(0,s.useState)(!1),I=k||!1;(0,s.useEffect)(()=>{if(o){let e={event:o,position:i,kafkaOffset:y||0,isAtEarliest:N||!1,isAtLatest:C||!1,topicIndex:n};A(e),L(t),P(!1),null==c||c(e)}},[o,i,y,N,C,t,n,c]),(0,s.useEffect)(()=>{t!==E&&(L(t),A(null),P(!1))},[t,E]);let F=!I&&!(null==T?void 0:T.event),_=F?"This topic has no events. Please enter the event schema manually.":"";return(0,a.jsx)("div",{className:"flex flex-col h-full w-full min-h-[400px] overflow-auto",children:((null==T?void 0:T.event)||F||I)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,a.jsx)("h3",{className:(0,l.cn)("text-md font-medium step-description",I&&"opacity-50 pointer-events-none transition-opacity duration-200"),children:"Sample event"})}),(0,a.jsx)(g.E,{event:(0,l.$c)(null==T?void 0:T.event),topic:t,isLoadingEvent:I,eventError:_,isEmptyTopic:F,onManualEventChange:p,isEditingEnabled:m,readOnly:f})]})})};var S=n(7904),b=n(2246);function y(e){let{partitionCount:t,replicas:n,onReplicaCountChange:i,index:o,readOnly:r,isLoading:l}=e,[d,u]=(0,s.useState)(n);(0,s.useEffect)(()=>{t>0&&(u(n>0?n:t),0===n&&i&&i(t))},[t,n,i]);let p=e=>{u(e),null==i||i(e)};return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{htmlFor:"partition-input-".concat(o),className:"block text-sm font-medium text-content",children:"Replica Count"}),(0,a.jsxs)(b.m_,{children:[(0,a.jsx)(b.k$,{asChild:!0,children:(0,a.jsx)(c.default,{src:S.A,alt:"Info",className:"w-4 h-4"})}),(0,a.jsx)(b.ZI,{side:"right",align:"start",className:"max-w-[300px] bg-gray-800 text-gray-100 border border-gray-700 rounded-lg p-3 shadow-lg",children:(0,a.jsx)("p",{className:"text-sm leading-relaxed",children:"Decreasing the number of replicas will result in slower performance, but it will reduce resource usage"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{id:"partition-input-".concat(o),type:"number",min:"1",max:t||1,value:d,onChange:e=>{let n=parseInt(e.target.value);!isNaN(n)&&n>=1&&n<=(t||1)&&p(n)},onBlur:e=>{let n=parseInt(e.target.value);isNaN(n)||n<1?p(1):n>(t||1)&&p(t||1)},onKeyDown:e=>{("e"===e.key||"E"===e.key||"+"===e.key||"-"===e.key)&&e.preventDefault()},disabled:r||l||0===t,className:"px-3 py-2 input-regular input-border-regular rounded-md text-sm focus:outline-none focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed w-24",placeholder:"1"}),(0,a.jsx)("span",{className:"text-sm text-content",children:t>0?"(Must be between 1 and ".concat(t,")"):"(Loading partition details...)"})]})]})}function w(e){var t;let{index:n,existingTopic:i,onTopicChange:r,onOffsetChange:u,onManualEventChange:p,availableTopics:m,initialOffset:f=o.Kr.LATEST,additionalContent:h,isEditingEnabled:g,readOnly:S,disableTopicChange:b,topicName:w,offset:j,event:C,isLoading:N,error:k,currentOffset:T,earliestOffset:A,latestOffset:E,isAtLatest:L,isAtEarliest:O,fetchNewestEvent:P,fetchOldestEvent:I,fetchNextEvent:F,fetchPreviousEvent:_,refreshEvent:D,partitionCount:M=1,replicas:R=1,onReplicaCountChange:U,onRefreshTopics:q}=e,K=w||(null==i?void 0:i.name)||"",V=j||(null==i?void 0:i.initialOffset)||f,B=C||(null==i||null==(t=i.selectedEvent)?void 0:t.event)||null,G=N||!1,W=(0,s.useCallback)(async e=>{""!==e&&r&&e&&r(e,B)},[r,B]),Y=(0,s.useCallback)(e=>{u&&u(e,B)},[u,B]),z=(0,s.useCallback)(e=>{p&&p(e)},[p]),J=(0,s.useCallback)(e=>{U&&U(e)},[U]);return(0,a.jsxs)("div",{className:"flex flex-row gap-6",children:[(0,a.jsxs)("div",{className:(0,l.cn)("w-[40%] space-y-4",G&&"opacity-50 pointer-events-none transition-opacity duration-200"),children:[(0,a.jsx)("h3",{className:"text-md font-medium step-description",children:"This Kafka topic will be used as the data source of your pipeline."}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 pt-8",children:[(0,a.jsx)(v,{index:n,topicValue:K,isLoadingEvent:G,offsetValue:V,onTopicChange:W,onOffsetChange:Y,onBlur:()=>{},onOpenChange:()=>{},topicError:k||"",offsetError:"",topicPlaceholder:"Select a topic",offsetPlaceholder:"Select initial offset",topicOptions:m.map(e=>({label:e,value:e})),offsetOptions:Object.entries(o.Kr).map(e=>{let[t,n]=e;return{label:n,value:n}}),readOnly:S,disableTopicChange:b,onRefreshTopics:q}),K&&(0,a.jsx)(y,{partitionCount:M,replicas:R,onReplicaCountChange:J,index:n,readOnly:S,isLoading:G}),G&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-content",children:[(0,a.jsx)(c.default,{src:d.A,alt:"Loading",width:16,height:16,className:"animate-spin"}),(0,a.jsx)("span",{children:"Fetching the event schema..."})]}),h]})]}),(0,a.jsx)("div",{className:"w-[60%] min-h-[450px] h-full",children:(0,a.jsx)(x,{topicName:K,initialOffset:V,topicIndex:n,initialEvent:B,isEditingEnabled:g,onEventLoading:()=>{},onEventLoaded:e=>{},onEventError:e=>{},onEmptyTopic:()=>{},onManualEventChange:z,readOnly:S,isLoading:G,currentOffset:T,earliestOffset:A,latestOffset:E,isAtLatest:L,isAtEarliest:O,fetchNewestEvent:P,fetchOldestEvent:I,fetchNextEvent:F,fetchPreviousEvent:_,refreshEvent:D})})]})}var j=n(386),C=n(5156),N=n(1409),k=n(4775);function T(e){var t,n;let{steps:c,onCompleteStep:d,validate:u,currentStep:p,readOnly:m,standalone:f,toggleEditMode:h,enableDeduplication:v=!1,onDeduplicationChange:g,initialDeduplicationConfig:x,pipelineActionState:S,onCompleteStandaloneEditing:b}=e,{topicsStore:y,kafkaStore:T,coreStore:A}=(0,i.useStore)(),E=(0,N.D)(),{topics:L,topicDetails:O,isLoadingTopics:P,topicsError:I,fetchTopics:F,getPartitionCount:_}=(e=>{let{kafka:t}=e,[n,a]=(0,s.useState)([]),[i,o]=(0,s.useState)([]),[l,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(null),[p,m]=(0,s.useState)(0),f=(0,s.useCallback)(async()=>{if(!t.bootstrapServers)return void u("Kafka connection details are missing");c(!0),u(null);try{let e=await r.Y.fetchTopics(t),n=await r.Y.fetchTopicDetails(t);e.success&&e.topics?(a((null==e?void 0:e.topics)||[]),m(0)):(u(e.error||"Failed to fetch topics"),p<3&&m(e=>e+1)),n.success&&n.topicDetails&&o(n.topicDetails||[])}catch(e){u(e instanceof Error?e.message:"Unknown error occurred")}finally{c(!1)}},[t,p,3]),h=(0,s.useCallback)(e=>{let t=i.find(t=>t.name===e);return(null==t?void 0:t.partitionCount)||0},[i]);return{topics:n,topicDetails:i,isLoadingTopics:l,topicsError:d,fetchTopics:f,getPartitionCount:h}})({kafka:T}),D=(n=p||"",(0,s.useCallback)(()=>{if(!n)return 0;if(n===o.Fn.TOPIC_SELECTION_1||n===o.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_1);else if(n===o.Fn.TOPIC_SELECTION_2||n===o.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_2)return 1;return 0},[n])),{availableTopics:M,setAvailableTopics:R,topics:U,topicCount:q,updateTopic:K,invalidateTopicDependentState:V}=y,B=D(),G=U[B],[W,Y]=(0,s.useState)(0),[z,J]=(0,s.useState)(!0),{topicName:H,offset:$,event:X,isLoading:Z,isEmptyTopic:Q,error:ee,deduplicationConfig:et,deduplicationConfigured:en,canContinue:ea,manualEvent:es,isManualEventValid:ei,replicas:eo,partitionCount:er,selectTopic:el,selectOffset:ec,selectReplicaCount:ed,updatePartitionCount:eu,configureDeduplication:ep,handleManualEventChange:em,submit:ef,currentOffset:eh,earliestOffset:ev,latestOffset:eg,isAtLatest:ex,isAtEarliest:eS,fetchNewestEvent:eb,fetchOldestEvent:ey,fetchNextEvent:ew,fetchPreviousEvent:ej,refreshEvent:eC}=function(e){var t,n;let{index:a,enableDeduplication:c=!1,onDeduplicationChange:d,initialDeduplicationConfig:u,currentStep:p}=e,{topicsStore:m,deduplicationStore:f,kafkaStore:h,joinStore:v}=(0,i.useStore)(),g=(0,k.U)(),x=(0,N.D)(),S=(0,s.useMemo)(()=>h,[h]),b=(0,s.useRef)(null),y=(0,s.useRef)(null),[w,j]=(0,s.useState)(""),[C,T]=(0,s.useState)("latest"),[A,E]=(0,s.useState)(1),L=m.topics[a];null==L||L.name,null==L||null==(t=L.selectedEvent)||t.event,(null==L?void 0:L.initialOffset)||o.Kr.LATEST,null==L||L.replicas,null==L||L.partitionCount;let O=null==L?void 0:L.name,P=null==L||null==(n=L.selectedEvent)?void 0:n.event,I=(null==L?void 0:L.initialOffset)||o.Kr.LATEST,F=(null==L?void 0:L.replicas)||1,_=(null==L?void 0:L.partitionCount)||0,D=f.getDeduplication(a),[M,R]=(0,s.useState)({key:(null==u?void 0:u.key)||(null==D?void 0:D.key)||"",keyType:(null==u?void 0:u.keyType)||(null==D?void 0:D.keyType)||"string",window:(null==u?void 0:u.window)||(null==D?void 0:D.window)||1,unit:(null==u?void 0:u.unit)||(null==D?void 0:D.unit)||"hours"}),[U,q]=(0,s.useState)(!!((null==u?void 0:u.key)||(null==D?void 0:D.key)&&(null==D?void 0:D.window))),[K,V]=(0,s.useState)(!1),[B,G]=(0,s.useState)(""),{fetchEvent:W,event:Y,isLoadingEvent:z,eventError:J,resetEventState:H}=((e,t)=>{let[n,a]=(0,s.useState)(!1),[i,o]=(0,s.useState)(null),[l,c]=(0,s.useState)(),[d,u]=(0,s.useState)(null),[p,m]=(0,s.useState)(!0),[f,h]=(0,s.useState)(!1);return{fetchEvent:async function(s){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2?arguments[2]:void 0;if(!s)return void o("No topic specified");if((null==l?void 0:l.direction)==="previous"&&null===d)return void o("Already at the first event");if(i&&!p)return void o("No more events available");a(!0),o(null);let f=setTimeout(()=>{n&&(a(!1),o("Request timed out. Using sample data instead."),c(null),u(null))},3e4);try{(null==l?void 0:l.position)==="latest"?(m(!1),h(!0)):(null==l?void 0:l.position)==="earliest"&&(m(!0),h(!1));let n=await r.Y.fetchEvent(e,{topic:s,format:t,runConsumerFirst:!0,getNext:i,currentOffset:(null==d?void 0:d.toString())||null,position:null==l?void 0:l.position,direction:null==l?void 0:l.direction,currentPosition:d});if(clearTimeout(f),!n.success)throw Error(n.error||"Failed to fetch event");let p=n.data;if(p&&p.success){var v;c(p.event),a(!1);let e=p.offset?parseInt(p.offset,10):null;null!==e&&(u(e),(null==l?void 0:l.position)||(p.metadata&&void 0!==p.metadata.hasOlderEvents?h(p.metadata.hasOlderEvents):(null==l?void 0:l.position)!=="earliest"&&h(!0),!1===p.hasMoreEvents?m(!1):(null==l?void 0:l.position)!=="latest"&&m(!0))),p.isMock||(null==(v=p.event)?void 0:v._mock)?i?(m(!1),o("No more events available")):o("Note: Using sample data because actual data could not be fetched"):o(null)}else n.error&&(n.error.includes("end of topic")||n.error.includes("no more events"))?(m(!1),o("No more events available")):n.error&&n.error.includes("Timeout waiting for message")?i?(m(!1),o("No more events available")):(null==l?void 0:l.direction)==="previous"?(h(!1),o("No previous events available")):o(n.error||"Failed to fetch event"):o(n.error||"Failed to fetch event")}catch(t){clearTimeout(f),console.error("Error fetching event:",t);let e=t instanceof Error?t.message:"Unknown error";e.includes("Timeout waiting for message")?i?(m(!1),o("No more events available")):(null==l?void 0:l.direction)==="previous"?(h(!1),o("No previous events available")):o("Error: ".concat(e)):o("Error: ".concat(e))}finally{n&&a(!1)}},event:l,isLoadingEvent:n,eventError:i,hasMoreEvents:p,hasOlderEvents:f,resetEventState:()=>{c(""),o(null),u(null),m(!0),h(!1)},currentOffset:d}})(S,"JSON"),[$,X]=(0,s.useState)({event:null,currentOffset:null,earliestOffset:null,latestOffset:null,isAtLatest:!1,isLoading:!1,error:null,isEmptyTopic:!1});(0,s.useEffect)(()=>{O&&O!==w&&j(O),I&&I!==C&&T(I),F&&F!==A&&E(F),P&&!$.event&&(console.log("[Topic Init] Loading existing event from store into state"),X(e=>({...e,event:P}))),O&&P&&!y.current&&(y.current={name:O,event:P},console.log("[Topic Init] Captured original topic state for comparison:",O))},[O,I,F,P,w,C,A,$.event]),(0,s.useEffect)(()=>{if(B)try{JSON.parse(B),V(!0)}catch(e){V(!1)}else V(!1)},[B]),(0,s.useEffect)(()=>{p===o.Fn.TOPIC_SELECTION_2||p===o.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_2?0===a?g.page.selectLeftTopic({}):g.page.selectRightTopic({}):g.page.selectTopic({}),c&&g.page.topicDeduplication({})},[c,a,p,g.page]),(0,s.useEffect)(()=>{let e={topic:w,offset:C};(!b.current||b.current.topic!==e.topic||b.current.offset!==e.offset)&&w&&C&&(b.current=e,H(),"latest"===C?Z(w):"earliest"===C&&Q(w))},[w,C,W,H]),(0,s.useEffect)(()=>{Y&&!z&&w&&(X(e=>({...e,event:Y,isLoading:!1,error:null})),g.topic.eventReceived({topicName:w,offset:"unknown",position:C,eventSize:JSON.stringify(Y).length,timestamp:new Date().toISOString()}))},[Y,z,w,C,g.topic]),(0,s.useEffect)(()=>{X(e=>({...e,isLoading:z}))},[z]),(0,s.useEffect)(()=>{J&&w&&(X(e=>({...e,error:J,isLoading:!1})),J.includes("No more events")||J.includes("No previous events")?g.topic.noEvent({topicName:w,position:C,reason:J.includes("No more events")?"end_of_topic":"beginning_of_topic",timestamp:new Date().toISOString()}):g.topic.eventError({topicName:w,position:C,error:J,timestamp:new Date().toISOString()}))},[J,w,C,g.topic]);let Z=(0,s.useCallback)(async e=>{if(e){X(e=>({...e,error:null,event:null}));try{await W(e,!1,{position:"latest"})}catch(t){X(e=>({...e,error:t instanceof Error?t.message:"Failed to fetch event"})),g.topic.eventError({topicName:e,position:"latest",error:t instanceof Error?t.message:"Failed to fetch event",timestamp:new Date().toISOString()})}}},[W,g.topic]),Q=(0,s.useCallback)(async e=>{if(e){X(e=>({...e,error:null,event:null}));try{await W(e,!1,{position:"earliest"})}catch(t){X(e=>({...e,error:t instanceof Error?t.message:"Failed to fetch event"})),g.topic.eventError({topicName:e,position:"earliest",error:t instanceof Error?t.message:"Failed to fetch event",timestamp:new Date().toISOString()})}}},[W,g.topic]),ee=(0,s.useCallback)(async(e,t)=>{if(!e||null===t)return void console.warn("fetchNextEvent: Invalid parameters",{topicName:e,currentOffset:t});X(e=>({...e,error:null,event:null}));try{await W(e,!0,{direction:"next"})}catch(t){X(e=>({...e,error:t instanceof Error?t.message:"Failed to fetch next event"})),g.topic.eventError({topicName:e,position:"next",error:t instanceof Error?t.message:"Failed to fetch next event",timestamp:new Date().toISOString()})}},[W,g.topic]),et=(0,s.useCallback)(async(e,t)=>{if(!e||null===t)return void console.warn("fetchPreviousEvent: Invalid parameters",{topicName:e,currentOffset:t});X(e=>({...e,error:null,event:null}));try{await W(e,!1,{direction:"previous"})}catch(t){X(e=>({...e,error:t instanceof Error?t.message:"Failed to fetch previous event"})),g.topic.eventError({topicName:e,position:"previous",error:t instanceof Error?t.message:"Failed to fetch previous event",timestamp:new Date().toISOString()})}},[W,g.topic]),en=(0,s.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){X(e=>({...e,error:null,event:null}));try{await W(e,t)}catch(t){console.error("Error in refreshEvent:",t),X(e=>({...e,error:t instanceof Error?t.message:"Failed to refresh event"})),g.topic.eventError({topicName:e,position:"refresh",error:t instanceof Error?t.message:"Failed to refresh event",timestamp:new Date().toISOString()})}}},[W,g.topic]),ea=(0,s.useCallback)(e=>{G(e);try{JSON.parse(e),V(!0)}catch(e){V(!1)}},[]),es=(0,s.useCallback)(e=>{e!==w&&(j(e),m.updateTopic({index:a,name:e,initialOffset:C,events:[],selectedEvent:{event:void 0,topicIndex:a,position:C},replicas:A,partitionCount:0}),g.topic.selected({offset:C}))},[a,C,m,w,v,g.topic,x,p]),ei=(0,s.useCallback)(e=>{e!==C&&(T(e),m.updateTopic({index:a,name:w,initialOffset:e,events:[],selectedEvent:{event:void 0,topicIndex:a,position:e},replicas:A,partitionCount:_}))},[a,w,m,C,A]),eo=(0,s.useCallback)(e=>{e!==A&&(E(e),m.updateTopic({index:a,name:w,initialOffset:C,events:[],selectedEvent:{event:void 0,topicIndex:a,position:C},replicas:e,partitionCount:_}))},[a,w,m,C,A,_]),er=(0,s.useCallback)(e=>{e!==_&&m.updateTopic({index:a,name:w,initialOffset:C,events:[],selectedEvent:{event:void 0,topicIndex:a,position:C},replicas:A,partitionCount:e})},[a,w,m,C,A,_]),el=(0,s.useCallback)((e,t)=>{let n={key:e.key,keyType:e.keyType,window:t.window,unit:t.unit};R(n);let s=!!(e.key&&t.window);q(s);let i={enabled:s,...n};f.updateDeduplication(a,i),d&&d(i),s&&g.key.dedupKey({keyType:e.keyType,window:t.window,unit:t.unit})},[a,f,d,g.key,x,p]),ec=(0,s.useMemo)(()=>{let e=w&&($.event||B&&K);return c?e&&U:e},[w,$.event,B,K,c,U]),ed=(0,s.useCallback)(()=>{var e,t,n,s,i,r,d,u;let h=null;try{h=(B?JSON.parse(B):null)||$.event}catch(e){console.error("Error parsing event:",e);return}let g=(null==(e=y.current)?void 0:e.name)||(null==(t=m.topics[a])?void 0:t.name),S=(null==(n=y.current)?void 0:n.event)||(null==(i=m.topics[a])||null==(s=i.selectedEvent)?void 0:s.event);console.log("[Topic Submit] Comparison sources:",{usingOriginalRef:!!y.current,originalTopicName:null==(r=y.current)?void 0:r.name,currentTopicName:w,hasOriginalEvent:!!(null==(d=y.current)?void 0:d.event)}),!S&&h&&w===g?(S=h,console.log("[Topic Submit] \uD83D\uDD04 FALLBACK: No previous event, using current event as previous (same topic, metadata-only change)")):!S&&h&&w!==g&&console.log("[Topic Submit] ⚠️ Topic changed and no previous event - will invalidate (first time or new topic selection)"),!h&&S?(h=S,console.log("[Topic Submit] \uD83D\uDD04 FALLBACK 2: No new event, using original event (metadata-only change)"),console.log("[Topic Submit] Event keys:",Object.keys(h).slice(0,10))):h||S?h&&(console.log("[Topic Submit] ✓ FinalEvent exists, using it for comparison"),console.log("[Topic Submit] Source: state.event?",!!$.event,"manualEvent?",!!B)):console.warn("[Topic Submit] ⚠️ Neither finalEvent nor previousEvent exists!"),console.log("[Topic Submit] Current state:",{topicName:w,previousTopicName:g,topicChanged:w!==g,replicas:A,previousReplicas:null==(u=m.topics[a])?void 0:u.replicas,hasFinalEvent:!!h,hasPreviousEvent:!!S,finalEventKeys:h?Object.keys(h).length:0,previousEventKeys:S?Object.keys(S).length:0,sameEventObject:h===S});let b={index:a,name:w,initialOffset:C,events:[{event:h,topicIndex:a,position:C,isManualEvent:""!==B}],selectedEvent:{event:h,topicIndex:a,position:C,isManualEvent:""!==B},replicas:A,partitionCount:_},j=!!(M.key&&M.window),N=c&&j?{enabled:!0,window:M.window,unit:M.unit,key:M.key,keyType:M.keyType}:D||{enabled:!1,window:0,unit:"hours",key:"",keyType:""};m.updateTopic(b),f.updateDeduplication(a,N);let k=!1,T="";if(S)if(h){console.log("[Topic Submit] \uD83D\uDD0D PATH 3: Comparing schemas..."),console.log("[Topic Submit] Previous event sample:",S?Object.keys(S).slice(0,5):"none"),console.log("[Topic Submit] Final event sample:",h?Object.keys(h).slice(0,5):"none");let e=(0,l.EP)(S,h);console.log("[Topic Submit] Schema comparison result:",e),e?(k=!1,w!==g?console.log("[Topic Submit] ✅ Topic name changed but schema is identical, preserving dependent sections"):console.log("[Topic Submit] ✅ Schema unchanged, preserving dependent sections (offset/replica/event change)")):(k=!0,T=w!==g?"Topic changed and schema differs":"Event schema changed",console.log("[Topic Submit] ❌ Schemas differ, invalidating dependent sections. Reason: ".concat(T)))}else k=!0,T="Missing current event",console.error("[Topic Submit] ⚠️ PATH 2: No current event found (THIS SHOULD NOT HAPPEN!), invalidating dependent sections"),console.error("[Topic Submit] Debug: previousEvent exists?",!!S,"finalEvent exists?",!!h);else k=!0,T="First event selection",console.log("[Topic Submit] ⚠️ PATH 1: No previous event found, invalidating dependent sections");k?(console.log("[Topic Submit] \uD83E\uDDF9 Schema changed, invalidating dependent sections"),v.setEnabled(!1),v.setType(""),v.setStreams([]),"topic-selection-1"===p||p===o.Fn.TOPIC_SELECTION_1?(x.invalidateSection(o.Fn.DEDUPLICATION_CONFIGURATOR,T),x.invalidateSection(o.Fn.JOIN_CONFIGURATOR,T),x.invalidateSection(o.Fn.CLICKHOUSE_MAPPER,T)):"topic-selection-2"===p||p===o.Fn.TOPIC_SELECTION_2||"topic-deduplication-configurator-1"===p||p===o.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_1||"topic-deduplication-configurator-2"===p||p===o.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_2?(x.invalidateSection(o.Fn.JOIN_CONFIGURATOR,T),x.invalidateSection(o.Fn.CLICKHOUSE_MAPPER,T)):p&&(p.includes("topic-selection")||p.includes("topic-deduplication"))&&(x.invalidateSection(o.Fn.JOIN_CONFIGURATOR,T),x.invalidateSection(o.Fn.CLICKHOUSE_MAPPER,T))):console.log("[Topic Submit] ✅ Skipping invalidation - schema unchanged, preserving all dependent sections"),y.current&&(console.log("[Topic Submit] Resetting original topic reference for next edit session"),y.current={name:w,event:h})},[a,w,C,$.event,B,c,U,M,D,m,f,v,x,p,A,_]);return{topicName:w,offset:C,event:$.event,isLoading:$.isLoading,isEmptyTopic:$.isEmptyTopic,error:$.error,deduplicationConfig:M,deduplicationConfigured:U,canContinue:ec,manualEvent:B,isManualEventValid:K,replicas:A,partitionCount:_,currentOffset:$.currentOffset,earliestOffset:$.earliestOffset,latestOffset:$.latestOffset,isAtLatest:$.isAtLatest,isAtEarliest:$.isAtEarliest,selectTopic:es,selectOffset:ei,selectReplicaCount:eo,updatePartitionCount:er,configureDeduplication:el,handleManualEventChange:ea,submit:ed,fetchNewestEvent:Z,fetchOldestEvent:Q,fetchNextEvent:ee,fetchPreviousEvent:et,refreshEvent:en}}({index:B,enableDeduplication:v,onDeduplicationChange:g,initialDeduplicationConfig:x,currentStep:p});(0,s.useEffect)(()=>{0===M.length&&!P&&W<3&&(Y(e=>e+1),F()),z&&J(!1)},[M.length,F,P,z,W]),(0,s.useEffect)(()=>{if(H&&O.length>0){let e=_(H);e>0&&e!==er&&(eu(e),1===eo&&e>1&&ed(e))}},[H,O,_,er,eu,eo,ed]),(0,s.useEffect)(()=>{L.length>0&&R(L)},[L,R]);let[eN,ek]=(0,s.useState)(!1);(0,s.useEffect)(()=>{!m&&eN&&ek(!1)},[m,eN]);let eT=(0,s.useCallback)((e,t)=>{el(e);let n=_(e);n>0&&ed(n)},[el,ed,_]),eA=(0,s.useCallback)((e,t)=>{ec(e)},[ec]),eE=(0,s.useCallback)(()=>{ef(),f&&h?(p===o.Fn.TOPIC_SELECTION_1?E.markSectionAsValid(o.Fn.TOPIC_SELECTION_1):p===o.Fn.TOPIC_SELECTION_2?E.markSectionAsValid(o.Fn.TOPIC_SELECTION_2):p===o.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_1?E.markSectionAsValid(o.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_1):p===o.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_2?E.markSectionAsValid(o.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_2):p&&E.markSectionAsValid(p),A.markAsDirty(),console.log("[TopicSelector] Configuration marked as dirty - changes will be saved on Resume"),null==b||b()):p===o.Fn.TOPIC_SELECTION_1?d(o.Fn.TOPIC_SELECTION_1):p===o.Fn.TOPIC_SELECTION_2?d(o.Fn.TOPIC_SELECTION_2):p===o.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_1?d(o.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_1):p===o.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_2?d(o.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_2):d(p||o.Fn.TOPIC_SELECTION_1)},[ef,p,E,d,f,h]),eL=(0,s.useCallback)(()=>{eE(),f&&h&&ek(!0)},[eE,f,h]),eO=(0,s.useCallback)(async()=>{await F()},[F]),eP=(0,s.useCallback)(()=>{let e=["topics"];(p===o.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_1||p===o.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_2)&&(e=["topics","deduplication"]),A.discardSections(e)},[A,p]);return(0,a.jsx)("div",{className:"space-y-6 w-full",children:(0,a.jsxs)("div",{className:"flex flex-col gap-6 pb-6 bg-background-neutral-faded rounded-md p-0",children:[(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6",children:(0,a.jsx)(w,{index:B,existingTopic:G,onTopicChange:eT,onOffsetChange:eA,onManualEventChange:em,availableTopics:M,additionalContent:(()=>{if(!v)return null;let e=X||(es&&ei?JSON.parse(es):null);return e?(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)(C.A,{index:B,onChange:ep,disabled:!H,eventData:e,readOnly:m})}):null})(),isEditingEnabled:""!==es||(null==G||null==(t=G.selectedEvent)?void 0:t.isManualEvent)||!1,readOnly:m,disableTopicChange:f,topicName:H,offset:$,event:X,isLoading:Z,error:ee,currentOffset:eh,earliestOffset:ev,latestOffset:eg,isAtLatest:ex,isAtEarliest:eS,fetchNewestEvent:eb,fetchOldestEvent:ey,fetchNextEvent:ew,fetchPreviousEvent:ej,refreshEvent:eC,partitionCount:er,replicas:eo,onReplicaCountChange:ed,onRefreshTopics:eO})}),(0,a.jsx)(j.A,{standalone:f,onSubmit:eL,onDiscard:eP,isLoading:!1,isSuccess:eN,disabled:!ea,successText:"Continue",loadingText:"Loading...",regularText:"Continue",actionType:"primary",showLoadingIcon:!1,readOnly:m,toggleEditMode:h,pipelineActionState:S,onClose:b}),v&&H&&X&&!en&&(0,a.jsx)("div",{className:"text-amber-500 text-sm px-6",children:"Please configure deduplication settings to continue"})]})})}},3233:(e,t,n)=>{n.d(t,{J:()=>o});var a=n(1929);n(2477);var s=n(2093),i=n(8387);function o(e){let{className:t,...n}=e;return(0,a.jsx)(s.b,{"data-slot":"label",className:(0,i.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...n})}},3511:(e,t,n)=>{n.d(t,{E:()=>o});var a=n(2477),s=n(8090),i=n(4775);let o=()=>{let{clickhouseConnectionStore:e,clickhouseDestinationStore:t}=(0,s.useStore)(),{clickhouseConnection:n,setClickhouseConnection:o,updateDatabases:r}=e,l=(0,i.U)(),[c,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)("idle"),[m,f]=(0,a.useState)(null),h=(0,a.useCallback)(async e=>{d(!0),p("idle"),f(null);try{var t,n,a,s,i,c;let d={host:e.host,httpPort:e.httpPort,username:e.username,password:e.password,database:e.database||"",useSSL:null==(t=e.useSSL)||t,skipCertificateVerification:null==(n=e.skipCertificateVerification)||n,connectionType:e.connectionType||"direct",proxyUrl:e.proxyUrl,connectionString:e.connectionString,testType:"connection"},u=await fetch("/ui-api/clickhouse/test-connection",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),m=await u.json();if(m.success){if(p("success"),f(null),o({connectionType:"direct",directConnection:{host:e.host,httpPort:e.httpPort,username:e.username,password:e.password,nativePort:null!=(s=e.nativePort)?s:"",useSSL:null==(i=e.useSSL)||i,skipCertificateVerification:null==(c=e.skipCertificateVerification)||c},connectionStatus:"success",connectionError:null}),m.databases&&m.databases.length>0){let t="".concat(e.host,":").concat(e.httpPort);r(m.databases,t)}return l.clickhouse.success({host:e.host,databaseCount:(null==(a=m.databases)?void 0:a.length)||0}),{success:!0,databases:m.databases||[]}}{p("error");let t=m.error||"Test connection failed - Failed to connect to ClickHouse";return f(t),l.clickhouse.failed({error:t,host:e.host}),{success:!1,error:t}}}catch(n){p("error");let t=n instanceof Error?n.message:"An unknown error occurred";return f(t),l.clickhouse.failed({error:t,host:e.host}),{success:!1,error:t}}finally{d(!1)}},[o,r,l]),v=(0,a.useCallback)(async e=>{if(!e.database)return f("Please select a database"),{success:!1,error:"Please select a database"};d(!0),p("idle"),f(null);try{var t,n,a,s,i,r;let c={host:e.host,httpPort:e.httpPort,username:e.username,password:e.password,database:e.database,useSSL:null==(t=e.useSSL)||t,skipCertificateVerification:null==(n=e.skipCertificateVerification)||n,connectionType:e.connectionType||"direct",proxyUrl:e.proxyUrl,connectionString:e.connectionString,testType:"database"},d=await fetch("/ui-api/clickhouse/test-connection",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),u=await d.json();if(u.success)return p("success"),f(null),o({connectionType:"direct",directConnection:{host:e.host,httpPort:e.httpPort,username:e.username,password:e.password,nativePort:null!=(s=e.nativePort)?s:"",useSSL:null==(i=e.useSSL)||i,skipCertificateVerification:null==(r=e.skipCertificateVerification)||r},connectionStatus:"success",connectionError:null}),l.destination.tablesFetched({database:e.database,count:(null==(a=u.tables)?void 0:a.length)||0}),{success:!0,tables:u.tables||[]};{p("error");let t=u.error||"Failed to access database '".concat(e.database,"'");return f(t),l.destination.tableFetchedError({database:e.database,error:t}),{success:!1,error:t}}}catch(n){p("error");let t=n instanceof Error?n.message:"An unknown error occurred";return f(t),l.destination.tableFetchedError({database:e.database,error:t}),{success:!1,error:t}}finally{d(!1)}},[o,l]);return{isLoading:c,connectionStatus:u,connectionError:m,testConnection:h,testDatabaseAccess:v,testTableAccess:(0,a.useCallback)(async e=>{if(!e.database||!e.table)return f("Please select both database and table"),{success:!1,error:"Please select both database and table"};d(!0),p("idle"),f(null);try{var t,n,a,s,i;let r={host:e.host,httpPort:e.httpPort,username:e.username,password:e.password,database:e.database,table:e.table,useSSL:null==(t=e.useSSL)||t,skipCertificateVerification:null==(n=e.skipCertificateVerification)||n,connectionType:e.connectionType||"direct",proxyUrl:e.proxyUrl,connectionString:e.connectionString,testType:"table"},c=await fetch("/ui-api/clickhouse/test-connection",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),d=await c.json();if(d.success)return p("success"),f(null),o({connectionType:"direct",directConnection:{host:e.host,httpPort:e.httpPort,username:e.username,password:e.password,nativePort:null!=(a=e.nativePort)?a:"",useSSL:null==(s=e.useSSL)||s,skipCertificateVerification:null==(i=e.skipCertificateVerification)||i},connectionStatus:"success",connectionError:null}),l.destination.tableSelected({database:e.database,table:e.table}),{success:!0,sample:d.sample};{p("error");let t=d.error||"Failed to access table '".concat(e.table,"' in database '").concat(e.database,"'");return f(t),l.destination.tableFetchedError({database:e.database,table:e.table,error:t}),{success:!1,error:t}}}catch(n){p("error");let t=n instanceof Error?n.message:"An unknown error occurred";return f(t),l.destination.tableFetchedError({database:e.database,table:e.table,error:t}),{success:!1,error:t}}finally{d(!1)}},[o,l]),getDatabases:(0,a.useCallback)(async e=>{if(!e.host||!e.httpPort||!e.username||!e.password)return f("Please fill in all fields"),{success:!1,error:"Please fill in all fields"};let t=await fetch("/ui-api/clickhouse/databases",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e})});return await t.json()},[])}}},3528:(e,t,n)=>{n.d(t,{x:()=>p});var a=n(1929),s=n(4049),i=n(3233),o=n(1611),r=n(8821),l=n(9596),c=n(7904),d=n(2246),u=n(2477);function p(e){let{window:t,setWindow:n,windowUnit:p,setWindowUnit:m,label:f="Deduplication Time Window",tooltip:h="Maximum time window is 7 days. Longer time windows can process more events but may result in slower performance.",readOnly:v}=e,[g,x]=(0,u.useState)(null),S=(e,t)=>{switch(t){case r.XR.DAYS.value:if(e>7)return x("Maximum time window is ".concat(7," days")),!1;break;case r.XR.HOURS.value:if(e>168)return x("Maximum time window is ".concat(168," hours (").concat(7," days)")),!1;break;case r.XR.MINUTES.value:if(e>10080)return x("Maximum time window is ".concat(10080," minutes (").concat(7," days)")),!1;break;case r.XR.SECONDS.value:if(e>604800)return x("Maximum time window is ".concat(604800," seconds (").concat(7," days)")),!1}return x(null),!0};return(0,u.useEffect)(()=>{S(t,p)},[t,p]),(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(i.J,{htmlFor:"window-unit",className:"label-regular text-content",children:f}),(0,a.jsxs)(d.m_,{children:[(0,a.jsx)(d.k$,{asChild:!0,children:(0,a.jsx)(l.default,{src:c.A,alt:"Info",className:"w-4 h-4"})}),(0,a.jsx)(d.ZI,{side:"right",align:"start",className:"max-w-[300px] bg-gray-800 text-gray-100 border border-gray-700 rounded-lg p-3 shadow-lg",children:(0,a.jsx)("p",{className:"text-sm leading-relaxed",children:h})})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"w-[35%] max-w-[35%]",children:(0,a.jsx)(o.p,{id:"window-size",type:"number",value:t,onChange:e=>(e=>{let t=parseInt(e);S(t,p)&&n(t)})(e.target.value),min:"1",className:"w-full input-regular input-border-regular text-content ".concat(g?"border-red-500":""),disabled:v})}),(0,a.jsx)("div",{className:"w-[65%] max-w-[65%]",children:(0,a.jsxs)(s.l6,{value:p,onValueChange:e=>{S(t,e)&&m(e)},disabled:v,children:[(0,a.jsx)(s.bq,{id:"window-unit",className:"w-full input-regular select-content-custom text-content",children:(0,a.jsx)(s.yv,{placeholder:"Select unit"})}),(0,a.jsx)(s.gC,{className:"select-content-custom",children:Object.values(r.XR).map(e=>(0,a.jsx)(s.eb,{value:e.value,className:"select-item-custom text-content",children:e.label},e.value))})]})})]}),g&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:g})]})]})}},4049:(e,t,n)=>{n.d(t,{bq:()=>u,eb:()=>m,gC:()=>p,l6:()=>c,yv:()=>d});var a=n(1929);n(2477);var s=n(6450),i=n(5155),o=n(3367),r=n(7346),l=n(8387);function c(e){let{...t}=e;return(0,a.jsx)(s.bL,{"data-slot":"select",...t})}function d(e){let{...t}=e;return(0,a.jsx)(s.WT,{"data-slot":"select-value",...t})}function u(e){let{className:t,size:n="default",children:o,...r}=e;return(0,a.jsxs)(s.l9,{"data-slot":"select-trigger","data-size":n,className:(0,l.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...r,children:[o,(0,a.jsx)(s.In,{asChild:!0,children:(0,a.jsx)(i.A,{className:"size-4 opacity-50"})})]})}function p(e){let{className:t,children:n,position:i="popper",...o}=e;return(0,a.jsx)(s.ZL,{children:(0,a.jsxs)(s.UC,{"data-slot":"select-content",className:(0,l.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-40 max-h-(--radix-select-content-available-height) min-w-[8rem] overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...o,children:[(0,a.jsx)(f,{}),(0,a.jsx)(s.LM,{className:(0,l.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:n}),(0,a.jsx)(h,{})]})})}function m(e){let{className:t,children:n,...i}=e;return(0,a.jsxs)(s.q7,{"data-slot":"select-item",className:(0,l.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...i,children:[(0,a.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,a.jsx)(s.VF,{children:(0,a.jsx)(o.A,{className:"size-4"})})}),(0,a.jsx)(s.p4,{children:n})]})}function f(e){let{className:t,...n}=e;return(0,a.jsx)(s.PP,{"data-slot":"select-scroll-up-button",className:(0,l.cn)("flex cursor-default items-center justify-center py-1",t),...n,children:(0,a.jsx)(r.A,{className:"size-4"})})}function h(e){let{className:t,...n}=e;return(0,a.jsx)(s.wn,{"data-slot":"select-scroll-down-button",className:(0,l.cn)("flex cursor-default items-center justify-center py-1",t),...n,children:(0,a.jsx)(i.A,{className:"size-4"})})}},4122:(e,t,n)=>{n.d(t,{Z:()=>d});var a=n(1929),s=n(2477),i=n(1611),o=n(1869),r=n(3165),l=n(8387),c=n(4400);function d(e){let{availableOptions:t,selectedOption:n,onSelect:d,placeholder:u="Select an option",className:p,disabled:m=!1,clearable:f=!0,open:h,onOpenChange:v,readOnly:g,label:x}=e,[S,b]=(0,s.useState)(!1),[y,w]=(0,s.useState)(""),[j,C]=(0,s.useState)(0),N=(0,s.useRef)(null),k=(0,s.useRef)(null),T=(0,s.useRef)(null),[A,E]=(0,s.useState)([]),[L,O]=(0,s.useState)([]),[P,I]=(0,s.useState)(null),[F,_]=(0,s.useState)("below"),[D,M]=(0,s.useState)(null),R=void 0!==h,U=R?h:S,q=e=>{R?null==v||v(e):b(e),e||M(null)};return(0,s.useEffect)(()=>{n?w(n):w("")},[n]),(0,s.useEffect)(()=>{if(0===t.length)return;let e=t.filter(e=>e.toLowerCase().includes(y.toLowerCase()));E(e),e.length>0&&C(0)},[y,t.length]),(0,s.useEffect)(()=>{if(!U||!k.current)return;let e=()=>{var e;let t,n=null==(e=k.current)?void 0:e.getBoundingClientRect();if(!n)return;let a=Math.min(32*A.length+16,200),s=window.innerHeight-n.bottom,i=n.top;null===D?M(t=s<220&&i>=220?"above":"below"):t=D,_(t),I({top:"above"===t?n.top-a-8:n.bottom+4,left:n.left,width:n.width})};return e(),window.addEventListener("scroll",e,!0),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e,!0),window.removeEventListener("resize",e)}},[U,A.length]),(0,s.useEffect)(()=>{let e=e=>{let t=document.getElementById("searchable-select-dropdown"),n=t&&t.contains(e.target),a=k.current&&k.current.contains(e.target);n||a||q(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,s.useEffect)(()=>{if(U&&T.current&&A.length>0){let e=T.current.children[j];e&&e.scrollIntoView({block:"nearest"})}},[j,U,A.length]),(0,a.jsxs)("div",{ref:k,className:(0,l.cn)("relative w-full",p),onKeyDown:e=>{if(!U){("ArrowDown"===e.key||"ArrowUp"===e.key)&&(e.preventDefault(),q(!0));return}if(0!==A.length)switch(e.key){case"ArrowDown":e.preventDefault(),C(e=>(e+1)%A.length);break;case"ArrowUp":e.preventDefault(),C(e=>(e-1+A.length)%A.length);break;case"Enter":j>=0&&j<A.length&&(e.preventDefault(),d(A[j]),q(!1));break;case"Escape":e.preventDefault(),q(!1);break;case"Tab":q(!1)}},children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-left gap-2 w-full",children:[x&&(0,a.jsx)("span",{className:"text-sm text-content",children:x}),(0,a.jsxs)("div",{className:"relative w-full",children:[(0,a.jsx)(i.p,{ref:N,type:"text",placeholder:u,value:y,onChange:e=>{let t=e.target.value;w(t),q(!0),""===t&&M(null),""===t&&n&&d(null)},onClick:()=>!m&&!g&&q(!0),onFocus:()=>!m&&!g&&q(!0),className:(0,l.cn)("w-full pr-10 input-regular input-border-regular text-content",m&&"opacity-60 cursor-not-allowed"),disabled:m||g,"aria-expanded":U,"aria-controls":"searchable-select-dropdown",role:"combobox"}),(0,a.jsxs)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center space-x-1",children:[f&&n&&(0,a.jsxs)(o.$,{type:"button",variant:"ghost",size:"icon",className:"h-5 w-5 opacity-70 hover:opacity-100",onClick:e=>{e.stopPropagation(),w(""),d(null),N.current&&N.current.focus()},disabled:m,"aria-label":"Clear selection",children:[(0,a.jsx)("span",{className:"sr-only",children:"Clear"}),(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[(0,a.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,a.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})]}),(0,a.jsx)(r.A,{className:(0,l.cn)("h-4 w-4 opacity-50 cursor-pointer",m&&"cursor-not-allowed"),onClick:()=>!m&&q(!U),"aria-hidden":"true"})]})]})]})}),U&&!m&&P&&(0,c.createPortal)((0,a.jsx)("div",{id:"searchable-select-dropdown",className:"fixed z-50 shadow-md rounded-md border border-border overflow-hidden select-content-custom bg-[#1e1e1f]",style:{width:P.width+"px",top:P.top+"px",left:P.left+"px"},role:"listbox",children:(0,a.jsx)("div",{className:"max-h-[200px] overflow-auto p-1",children:0===A.length?(0,a.jsx)("div",{className:"py-2 px-2 text-sm text-muted-foreground",children:"No options found."}):(0,a.jsx)("div",{ref:T,className:"space-y-1",children:A.map((e,t)=>(0,a.jsx)("div",{role:"option","aria-selected":n===e,className:(0,l.cn)("flex w-full items-center px-2 py-1.5 text-sm outline-none cursor-pointer transition-all duration-150","hover:bg-accent hover:text-accent-foreground",n===e&&"bg-accent/50",j===t?"bg-primary/20 font-medium":"rounded-md",j===t&&"text-[var(--color-background-primary)]"),onClick:t=>{t.preventDefault(),t.stopPropagation(),d(e),q(!1)},onMouseEnter:()=>C(t),children:e},e))})})}),document.body)]})}},4281:(e,t,n)=>{n.d(t,{E:()=>o});var a=n(1929),s=n(2477);let i=(0,n(5526).default)(async()=>{let e=await Promise.all([n.e(7077),n.e(8519)]).then(n.bind(n,8519));return await n.e(9965).then(n.t.bind(n,9965,23)),await n.e(1462).then(n.t.bind(n,1462,23)),e},{loadableGenerated:{webpack:()=>[1462]},ssr:!1}),o=e=>{let{event:t,topic:n,isLoadingEvent:o,eventError:r,isEmptyTopic:l=!1,onManualEventChange:c,isEditingEnabled:d,readOnly:u}=e,[p,m]=(0,s.useState)(t),[f,h]=(0,s.useState)(!0),[v,g]=(0,s.useState)("");(0,s.useEffect)(()=>{m(t)},[t]);let x=!(l||d)||u;return(0,a.jsx)("div",{className:"rounded-md p-4 h-full flex flex-col overflow-auto",children:n&&(!o||l)?(0,a.jsxs)(a.Fragment,{children:[l&&(0,a.jsx)("div",{className:"bg-amber-500/20 p-3 mb-3 rounded-md text-amber-500 text-sm",children:"This topic has no events. Please select a different topic with events or enter event schema manually to proceed."}),(0,a.jsx)("div",{className:"flex-grow relative w-full h-full code-editor-container",children:o?(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black-500 bg-opacity-50",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}):(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(i,{mode:"json",theme:"merbivore",name:"event-editor",value:p,onChange:e=>{m(e);try{JSON.parse(e),h(!0),g("")}catch(e){h(!1),g("Invalid JSON format")}c&&c(e)},readOnly:x,width:"100%",height:"100%",minLines:10,maxLines:1/0,fontSize:14,showPrintMargin:!1,showGutter:!0,highlightActiveLine:!0,setOptions:{useWorker:!1,showPrintMargin:!1,showGutter:!0,highlightActiveLine:!1,wrap:!1,verticalScrollbarAlwaysVisible:!0,horizontalScrollbarAlwaysVisible:!0,fontSize:14,tabSize:2,showLineNumbers:!0},editorProps:{$blockScrolling:!0}})})}),!f&&(0,a.jsx)("div",{className:"bg-red-500/20 p-3 mb-3 mt-3 rounded-md text-red-500 text-sm",children:v}),r&&!l&&(0,a.jsx)("div",{className:"mt-2 text-sm ".concat(r.includes("Note:")?"text-amber-500":"text-red-500"),children:r})]}):(0,a.jsx)("div",{className:"h-full flex items-center justify-center bg-background-neutral rounded-md",children:(0,a.jsx)("p",{className:"text-white"})})})}},4370:(e,t,n)=>{n.d(t,{c:()=>X});var a=n(1929),s=n(2477),i=n(44),o=n(1511),r=n(3062),l=n(2511),c=n(8821),d=n(9543);let u={base:{fields:{authMethod:{name:"authMethod",label:"Authentication Method",placeholder:"Select authentication method",required:"Authentication Method is required",type:"select",options:Object.values(c.qp).filter(e=>e.active).map(e=>({label:e.label,value:e.name}))},securityProtocol:{name:"securityProtocol",label:"Security Protocol",placeholder:"Select security protocol",required:"Security Protocol is required",type:"select",options:Object.values(c.NS).map(e=>({label:e,value:e}))},bootstrapServers:{name:"bootstrapServers",label:"Bootstrap Servers",placeholder:"Enter bootstrap servers",required:"Bootstrap Servers are required",type:"text"}}}},p={[c.qp["SASL/PLAIN"].name]:{securityProtocol:c.NS.SASL_PLAINTEXT,authMethod:c.qp["SASL/PLAIN"],fields:{username:{name:"saslPlain.username",label:"Username",placeholder:"Enter username",required:"Username is required",type:"text"},password:{name:"saslPlain.password",label:"Password",placeholder:"Enter password",required:"Password is required",type:"password"}}},[c.qp["SASL/JAAS"].name]:{securityProtocol:c.NS.SASL_SSL,authMethod:c.qp["SASL/JAAS"],fields:{jaasConfig:{name:"saslJaas.jaasConfig",label:"JAAS Config",placeholder:"Enter JAAS Config",required:"JAAS Config is required",type:"textarea"}}},[c.qp["SASL/GSSAPI"].name]:{securityProtocol:c.NS.SASL_SSL,authMethod:c.qp["SASL/GSSAPI"],fields:{kerberosPrincipal:{name:"saslGssapi.kerberosPrincipal",label:"Kerberos Principal",placeholder:"Enter kerberos principal",required:"Kerberos Principal is required",type:"text"},kerberosKeytab:{name:"saslGssapi.kerberosKeytab",label:"Kerberos Keytab",placeholder:"Enter kerberos keytab",required:"Kerberos Keytab is required",type:"textarea"},serviceName:{name:"saslGssapi.serviceName",label:"Kerberos Service Name",placeholder:"Enter kerberos service name",optional:"Kerberos Service Name is optional",type:"text",defaultValue:"kafka"},kerberosRealm:{name:"saslGssapi.kerberosRealm",label:"Kerberos Realm",placeholder:"Enter kerberos realm",optional:"Kerberos Realm is optional",type:"text"},kdc:{name:"saslGssapi.kdc",label:"Kerberos KDC",placeholder:"Enter kerberos kdc",optional:"Kerberos KDC is optional",type:"text"},krb5Config:{name:"saslGssapi.krb5Config",label:"Kerberos Configuration (krb5.conf)",placeholder:"Enter kerberos configuration (krb5.conf)",optional:"Kerberos Configuration (krb5.conf) is optional",type:"textarea"}}},[c.qp["SASL/OAUTHBEARER"].name]:{securityProtocol:c.NS.SASL_SSL,authMethod:c.qp["SASL/OAUTHBEARER"],fields:{oauthBearerToken:{name:"saslOauthbearer.oauthBearerToken",label:"OAuth Bearer Token",placeholder:"Enter oauth bearer token",required:"OAuth Bearer Token is required",type:"textarea"}}},[c.qp["SASL/SCRAM-256"].name]:{securityProtocol:c.NS.SASL_SSL,authMethod:c.qp["SASL/SCRAM-256"],fields:{username:{name:"saslScram256.username",label:"Username",placeholder:"Enter username",required:"Username is required",type:"text"},password:{name:"saslScram256.password",label:"Password",placeholder:"Enter password",required:"Password is required",type:"password"}}},[c.qp["SASL/SCRAM-512"].name]:{securityProtocol:c.NS.SASL_SSL,authMethod:c.qp["SASL/SCRAM-512"],fields:{username:{name:"saslScram512.username",label:"Username",placeholder:"Enter username",required:"Username is required",type:"text"},password:{name:"saslScram512.password",label:"Password",placeholder:"Enter password",required:"Password is required",type:"password"}}},[c.qp["Delegation tokens"].name]:{securityProtocol:c.NS.SASL_SSL,authMethod:c.qp["Delegation tokens"],fields:{delegationToken:{name:"delegationToken.delegationToken",label:"Delegation Token",placeholder:"Enter delegation token",required:"Delegation Token is required",type:"textarea"}}},[c.qp["SASL/LDAP"].name]:{securityProtocol:c.NS.SASL_SSL,authMethod:c.qp["SASL/LDAP"],fields:{ldapServerUrl:{name:"ldap.ldapServerUrl",label:"LDAP Server URL",placeholder:"Enter LDAP server URL",required:"LDAP Server URL is required",type:"text"},ldapServerPort:{name:"ldap.ldapServerPort",label:"LDAP Server Port",placeholder:"Enter LDAP server port",required:"LDAP Server Port is required",type:"number"},ldapBaseDn:{name:"ldap.ldapBaseDn",label:"LDAP Base DN",placeholder:"Enter LDAP base DN",required:"LDAP Base DN is required",type:"text"},ldapBindDn:{name:"ldap.ldapBindDn",label:"LDAP Bind DN",placeholder:"Enter LDAP bind DN",required:"LDAP Bind DN is required",type:"text"},ldapBindPassword:{name:"ldap.ldapBindPassword",label:"LDAP Bind Password",placeholder:"Enter LDAP bind password",required:"LDAP Bind Password is required",type:"password"},userSearchFilter:{name:"ldap.ldapUserSearchFilter",label:"LDAP User Search Filter",placeholder:"Enter LDAP user search filter",required:"LDAP User Search Filter is required",type:"text"}}},[c.qp.AWS_MSK_IAM.name]:{securityProtocol:c.NS.SASL_SSL,authMethod:c.qp.AWS_MSK_IAM,fields:{awsAccessKey:{name:"awsIam.awsAccessKey",label:"AWS Access Key ID",placeholder:"Enter AWS access key ID",required:"AWS Access Key ID is required",type:"textarea"},awsAccessKeySecret:{name:"awsIam.awsAccessKeySecret",label:"AWS Access Key Secret",placeholder:"Enter AWS access key secret",required:"AWS Access Key Secret is required",type:"textarea"},awsRegion:{name:"awsIam.awsRegion",label:"AWS Region",placeholder:"Enter AWS region",required:"AWS Region is required",type:"text"},awsAuthorizationIdentity:{name:"awsIam.awsAuthorizationIdentity",label:"AWS Authorization Identity",placeholder:"Enter AWS authorization identity",required:"AWS Authorization Identity is required",type:"text"},awsIAMRoleArn:{name:"awsIam.awsIAMRoleArn",label:"AWS Role ARN",placeholder:"Enter AWS Role ARN",optional:"AWS Role ARN is optional",type:"text"},awsSessionToken:{name:"awsIam.awsSessionToken",label:"AWS Session Token",placeholder:"Enter AWS session token",optional:"AWS Session Token is optional",type:"text"}}},[c.qp.mTLS.name]:{securityProtocol:c.NS.SASL_SSL,authMethod:c.qp.mTLS,fields:{clientCert:{name:"mtls.clientCert",label:"Client Certificate",placeholder:"Enter client certificate",required:"Client Certificate is required",type:"textarea"},clientKey:{name:"mtls.clientKey",label:"Client Key",placeholder:"Enter client key",required:"Client Key is required",type:"textarea"},password:{name:"mtls.password",label:"Password",placeholder:"Enter password",required:"Password is required",type:"password"}}},[c.qp.NO_AUTH.name]:{securityProtocol:c.NS.SASL_PLAINTEXT,authMethod:c.qp.NO_AUTH,fields:{}},truststore:{fields:{location:{name:"truststore.location",label:"Certificate File",placeholder:"Upload or paste certificate content",required:!1,type:"file"},password:{name:"truststore.password",label:"Truststore Password (optional)",placeholder:"Enter password for encrypted truststore",required:!1,type:"password"},type:{name:"truststore.type",label:"Truststore Type (optional)",placeholder:"JKS, PKCS12, PEM, etc.",required:!1,type:"text"},algorithm:{name:"truststore.algorithm",label:"SSL Algorithm (optional)",placeholder:"Leave empty for self-signed certificates",required:!1,type:"text"},certificates:{name:"truststore.certificates",label:"CA Certificate (PEM format)",placeholder:"Paste CA certificate content here or upload a file",required:!1,type:"textarea"}}}},m={authMethod:c.qp["SASL/PLAIN"].name,securityProtocol:c.NS.SASL_PLAINTEXT,bootstrapServers:"true"===d.env.NEXT_PUBLIC_IS_DOCKER?"host.docker.internal:9092,host.docker.internal:9093,host.docker.internal:9094":"localhost:9092,localhost:9093,localhost:9094",isConnected:!1,noAuth:{truststore:{location:"",password:"",type:"",algorithm:"",certificates:"",certificatesFileName:""}},saslPlain:{username:"admin",password:"admin-secret",truststore:{location:"",password:"",type:"",algorithm:"",certificates:"",certificatesFileName:""},consumerGroup:""},saslJaas:{jaasConfig:""},saslGssapi:{kerberosPrincipal:"",kerberosKeytab:"",kerberosKeytabFileName:"",kerberosRealm:"",kdc:"",serviceName:"kafka",krb5Config:"",krb5ConfigFileName:"",useTicketCache:!1,ticketCachePath:"",truststore:{location:"",password:"",type:"",algorithm:"",certificates:"",certificatesFileName:""}},saslOauthbearer:{oauthBearerToken:""},saslScram256:{username:"",password:"",truststore:{location:"",password:"",type:"",algorithm:"",certificates:"",certificatesFileName:""},consumerGroup:""},saslScram512:{username:"",password:"",truststore:{location:"",password:"",type:"",algorithm:"",certificates:"",certificatesFileName:""},consumerGroup:""},delegationToken:{delegationToken:""},ldap:{ldapServerUrl:"",ldapServerPort:"",ldapBaseDn:"",ldapBindDn:"",ldapBindPassword:"",ldapUserSearchFilter:""},awsIam:{awsAccessKey:"",awsAccessKeySecret:"",awsRegion:"",awsIAMRoleArn:""},mtls:{clientCert:"",clientKey:"",password:""}};var f=n(253),h=n(6107),v=n(8864),g=n(5596),x=n(8387),S=n(1869),b=n(1611);function y(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"input-group",role:"group",className:(0,x.cn)("group/input-group border-input dark:bg-input/30 relative flex w-full items-center rounded-md border shadow-xs transition-[color,box-shadow] outline-none","h-9 min-w-0 has-[>textarea]:h-auto","has-[>[data-align=inline-start]]:[&>input]:pl-2","has-[>[data-align=inline-end]]:[&>input]:pr-2","has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3","has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3","has-[[data-slot=input-group-control]:focus-visible]:border-ring has-[[data-slot=input-group-control]:focus-visible]:ring-ring/50 has-[[data-slot=input-group-control]:focus-visible]:ring-[3px]","has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40",t),...n})}n(4811);let w=(0,g.F)("text-muted-foreground flex h-auto cursor-text items-center justify-center gap-2 py-1.5 text-sm font-medium select-none [&>svg:not([class*='size-'])]:size-4 [&>kbd]:rounded-[calc(var(--radius)-5px)] group-data-[disabled=true]/input-group:opacity-50",{variants:{align:{"inline-start":"order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]","inline-end":"order-last pr-3 has-[>button]:mr-[-0.45rem] has-[>kbd]:mr-[-0.35rem]","block-start":"order-first w-full justify-start px-3 pt-3 [.border-b]:pb-3 group-has-[>input]/input-group:pt-2.5","block-end":"order-last w-full justify-start px-3 pb-3 [.border-t]:pt-3 group-has-[>input]/input-group:pb-2.5"}},defaultVariants:{align:"inline-start"}});function j(e){let{className:t,align:n="inline-start",...s}=e;return(0,a.jsx)("div",{role:"group","data-slot":"input-group-addon","data-align":n,className:(0,x.cn)(w({align:n}),t),onClick:e=>{var t,n;e.target.closest("button")||null==(n=e.currentTarget.parentElement)||null==(t=n.querySelector("input"))||t.focus()},...s})}let C=(0,g.F)("text-sm shadow-none flex gap-2 items-center",{variants:{size:{xs:"h-6 gap-1 px-2 rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-3.5 has-[>svg]:px-2",sm:"h-8 px-2.5 gap-1.5 rounded-md has-[>svg]:px-2.5","icon-xs":"size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0","icon-sm":"size-8 p-0 has-[>svg]:p-0"}},defaultVariants:{size:"xs"}});function N(e){let{className:t,type:n="button",variant:s="ghost",size:i="xs",...o}=e;return(0,a.jsx)(S.$,{type:n,"data-size":i,variant:s,className:(0,x.cn)(C({size:i}),t),...o})}function k(e){let{className:t,...n}=e;return(0,a.jsx)(b.p,{"data-slot":"input-group-control",className:(0,x.cn)("flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent",t),...n})}function T(e){let{id:t,label:n,placeholder:i="No file selected",allowedFileTypes:o,onChange:r,value:l,initialFileName:c,readType:d="text",disabled:u=!1,className:p="",showClearButton:m=!0,showLoadingState:g=!1,showErrorState:S=!1,onValidate:b,hintText:w,externalError:C}=e,[T,A]=(0,s.useState)(c||""),[E,L]=(0,s.useState)(""),[O,P]=(0,s.useState)(!1),[I,F]=(0,s.useState)(null),_=(0,s.useRef)(null),D=async e=>{var t;let n=null==(t=e.target.files)?void 0:t[0];if(n){P(!0),F(null),A(n.name);try{let e=new FileReader;switch(e.onload=async e=>{var t;let a=null==(t=e.target)?void 0:t.result;if(b){let e=await b(a,n.name);if(!e.valid){F(e.error||"Invalid file"),P(!1),A("");return}}L(a),P(!1)},e.onerror=()=>{F("Failed to read file"),P(!1),A("")},d){case"text":default:e.readAsText(n);break;case"base64":e.readAsDataURL(n)}}catch(e){F(e instanceof Error?e.message:"Failed to read file"),P(!1),A("")}}},M=(0,s.useMemo)(()=>{let e=o.filter(e=>e&&""!==e.trim());if(0!==e.length)return e.map(e=>".".concat(e)).join(",")},[o]);(0,s.useEffect)(()=>{void 0!==l&&l!==E&&L(l)},[l]),(0,s.useEffect)(()=>{void 0===c||c===T||E||A(c)},[c]),(0,s.useEffect)(()=>{E&&r(E,T)},[E,T]);let R=C||I;return(0,a.jsxs)("div",{className:"flex flex-col space-y-2 ".concat(p),children:[n&&(0,a.jsx)("label",{className:"text-sm font-medium text-content",children:n}),(0,a.jsx)("input",{ref:_,id:t,type:"file",onChange:D,className:"hidden",accept:M,disabled:u||O}),(0,a.jsxs)(y,{className:(0,x.cn)("input-border-regular",R&&"input-border-error","has-[[data-slot=input-group-control]:focus-visible]:!ring-0","has-[[data-slot=input-group-control]:focus-visible]:!border-[var(--color-background-primary,#a5b9e4)]","has-[[data-slot=input-group-control]:focus-visible]:!shadow-[0_0_0_2px_rgba(165,185,228,0.25)]"),children:[(0,a.jsx)(k,{value:T,placeholder:i,readOnly:!0,disabled:u,"aria-invalid":!!R}),(0,a.jsxs)(j,{align:"inline-end",children:[g&&O&&(0,a.jsx)(f.A,{className:"h-4 w-4 animate-spin text-muted-foreground"}),m&&T&&!O&&(0,a.jsx)(N,{onClick:()=>{L(""),A(""),F(null),r("",""),_.current&&(_.current.value="")},disabled:u,variant:"ghost",size:"icon-xs",title:"Clear file",children:(0,a.jsx)(h.A,{className:"h-4 w-4"})}),(0,a.jsxs)(N,{onClick:()=>{var e;null==(e=_.current)||e.click()},disabled:u||O,variant:"secondary",size:"xs",children:[(0,a.jsx)(v.A,{className:"h-3.5 w-3.5"}),"Browse"]})]})]}),S&&R&&(0,a.jsx)("div",{className:"text-sm text-content",children:R}),w&&(0,a.jsx)("div",{className:"text-xs text-content",children:w})]})}function A(e){let{onFileRead:t,disabled:n,className:s,externalError:i,initialFileName:o,value:r}=e;return(0,a.jsx)(T,{id:"certificate-upload",placeholder:"Select certificate file",allowedFileTypes:[],onChange:(e,n)=>{t(e,n)},value:r,initialFileName:o,readType:"text",disabled:n,className:s,showClearButton:!0,showLoadingState:!0,showErrorState:!0,onValidate:e=>e&&0!==e.trim().length?(!(e.includes("-----BEGIN CERTIFICATE-----")||e.includes("-----BEGIN RSA PRIVATE KEY-----")||e.includes("-----BEGIN PRIVATE KEY-----")||e.includes("-----BEGIN PUBLIC KEY-----")),{valid:!0}):{valid:!1,error:"Certificate content is empty"},hintText:"All file types accepted (PEM, CRT, CER, KEY, or files without extensions like ca-cert)",externalError:i})}let E=e=>{let{errors:t,readOnly:n}=e,{register:s,watch:i}=(0,o.xW)(),d=i("authMethod"),u=i("securityProtocol"),m=d===c.qp["SASL/PLAIN"].name&&("SASL_SSL"===u||"SSL"===u);return(0,a.jsxs)(r.gE,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,a.jsx)("div",{className:"space-y-2 w-full lg:w-1/2",children:(0,l.bl)({field:p[c.qp["SASL/PLAIN"].name].fields.username,register:s,errors:t,readOnly:n})}),(0,a.jsx)("div",{className:"space-y-2 w-full lg:w-1/2",children:(0,l.bl)({field:p[c.qp["SASL/PLAIN"].name].fields.password,register:s,errors:t,readOnly:n})})]}),m&&(0,a.jsxs)("div",{className:"space-y-4 mt-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-content",children:"SSL/TLS Configuration"}),(0,a.jsx)(q,{errors:t,readOnly:n,authMethodPrefix:"saslPlain"})]})]})},L=e=>{let{errors:t,readOnly:n}=e,{watch:s}=(0,o.xW)(),i=s("authMethod"),l=s("securityProtocol"),d=i===c.qp.NO_AUTH.name&&("SASL_SSL"===l||"SSL"===l);return(0,a.jsx)(r.gE,{className:"space-y-4",children:d&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-content",children:"SSL/TLS Configuration"}),(0,a.jsx)(q,{errors:t,readOnly:n,authMethodPrefix:"noAuth"})]})})},O=e=>{let{errors:t,readOnly:n}=e,{register:s}=(0,o.xW)();return(0,a.jsx)(r.gE,{className:"space-y-4",children:(0,l.$C)({formConfig:p,formGroupName:"SASL/JAAS",register:s,errors:t,readOnly:n})})},P=e=>{let{errors:t,readOnly:n}=e,{register:s,watch:i,setValue:c}=(0,o.xW)(),d=i("securityProtocol"),u=Object.entries(p["SASL/GSSAPI"].fields).filter(e=>{let[t]=e;return"kerberosKeytab"!==t&&"krb5Config"!==t});return(0,a.jsxs)(r.gE,{className:"space-y-4",children:[u.map(e=>{let[i,o]=e;return(0,a.jsx)("div",{className:"space-y-2 w-full",children:(0,l.bl)({field:o,register:s,errors:t,readOnly:n})},i)}),(0,a.jsx)("div",{className:"space-y-2 w-full",children:(0,a.jsx)(T,{label:"Kerberos Configuration (krb5.conf) File",id:"saslGssapi.krb5Config",placeholder:"Select krb5.conf file",allowedFileTypes:["conf","txt","cfg","ini","properties"],onChange:(e,t)=>{console.log("fileContent",e,"fileName",t);try{c("saslGssapi.krb5Config",e,{shouldValidate:!0,shouldDirty:!0}),c("saslGssapi.krb5ConfigFileName",t,{shouldValidate:!1,shouldDirty:!0})}catch(e){console.error("Error reading krb5.conf file:",e)}},value:i("saslGssapi.krb5Config"),initialFileName:i("saslGssapi.krb5ConfigFileName"),readType:"text",showLoadingState:!0,showErrorState:!0,hintText:"Accepted formats: .conf, .txt, .cfg, .ini, .properties",externalError:t?K(t,"saslGssapi.krb5Config"):void 0})}),(0,a.jsx)("div",{className:"space-y-2 w-full",children:(0,a.jsx)(T,{label:"Kerberos Keytab File",id:"saslGssapi.kerberosKeytab",placeholder:"Select keytab file",allowedFileTypes:["keytab","txt"],onChange:(e,t)=>{console.log("fileContent",e,"fileName",t);try{c("saslGssapi.kerberosKeytab",e,{shouldValidate:!0,shouldDirty:!0}),c("saslGssapi.kerberosKeytabFileName",t,{shouldValidate:!1,shouldDirty:!0})}catch(e){console.error("Error reading keytab file:",e)}},value:i("saslGssapi.kerberosKeytab"),initialFileName:i("saslGssapi.kerberosKeytabFileName"),readType:"base64",showLoadingState:!0,showErrorState:!0,hintText:"Accepted formats: .keytab, .txt",externalError:t?K(t,"saslGssapi.kerberosKeytab"):void 0})}),("SASL_SSL"===d||"SSL"===d)&&(0,a.jsxs)("div",{className:"space-y-4 mt-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-content",children:"SSL/TLS Configuration"}),(0,a.jsx)(q,{errors:t,readOnly:n,authMethodPrefix:"saslGssapi"})]})]})},I=e=>{let{errors:t,readOnly:n}=e,{register:s}=(0,o.xW)();return(0,a.jsx)(r.gE,{className:"space-y-4",children:(0,l.$C)({formConfig:p,formGroupName:"SASL/OAUTHBEARER",register:s,errors:t,readOnly:n})})},F=e=>{let{errors:t,readOnly:n}=e,{register:s,watch:i}=(0,o.xW)(),c=i("securityProtocol");return(0,a.jsxs)(r.gE,{className:"space-y-4",children:[(0,l.$C)({formConfig:p,formGroupName:"SASL/SCRAM-256",register:s,errors:t,readOnly:n}),("SASL_SSL"===c||"SSL"===c)&&(0,a.jsxs)("div",{className:"space-y-4 mt-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-content",children:"SSL/TLS Configuration"}),(0,a.jsx)(q,{errors:t,readOnly:n,authMethodPrefix:"saslScram256"})]})]})},_=e=>{let{errors:t,readOnly:n}=e,{register:s,watch:i}=(0,o.xW)(),c=i("securityProtocol");return(0,a.jsxs)(r.gE,{className:"space-y-4",children:[(0,l.$C)({formConfig:p,formGroupName:"SASL/SCRAM-512",register:s,errors:t,readOnly:n}),("SASL_SSL"===c||"SSL"===c)&&(0,a.jsxs)("div",{className:"space-y-4 mt-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-content",children:"SSL/TLS Configuration"}),(0,a.jsx)(q,{errors:t,readOnly:n,authMethodPrefix:"saslScram512"})]})]})},D=e=>{let{errors:t,readOnly:n}=e,{register:s}=(0,o.xW)();return(0,a.jsx)(r.gE,{children:(0,l.$C)({formConfig:p,formGroupName:"mTLS",register:s,errors:t,readOnly:n})})},M=e=>{let{errors:t,readOnly:n}=e,{register:s}=(0,o.xW)();return(0,a.jsx)(r.gE,{children:(0,l.$C)({formConfig:p,formGroupName:"AWS_MSK_IAM",register:s,errors:t,readOnly:n})})},R=e=>{let{errors:t,readOnly:n}=e,{register:s}=(0,o.xW)();return(0,a.jsx)(r.gE,{children:(0,l.$C)({formConfig:p,formGroupName:"Delegation tokens",register:s,errors:t,readOnly:n})})},U=e=>{let{errors:t,readOnly:n}=e,{register:s}=(0,o.xW)();return(0,a.jsx)(r.gE,{children:(0,l.$C)({formConfig:p,formGroupName:"SASL/LDAP",register:s,errors:t,readOnly:n})})},q=e=>{let{errors:t,readOnly:n,authMethodPrefix:s}=e,{register:i,setValue:c,watch:d}=(0,o.xW)(),u=p.truststore.fields,m=s?"".concat(s,".truststore"):"truststore";return(0,a.jsx)(r.gE,{className:"space-y-4",children:Object.entries(u).map(e=>{let[s,o]=e,r={...o,name:"".concat(m,".").concat(s)};if("location"===s||"password"===s||"type"===s||"algorithm"===s)return null;if("certificates"===s){let e=t?K(t,r.name):void 0,l="".concat(m,".certificatesFileName");return(0,a.jsxs)("div",{className:"space-y-2 w-full",children:[(0,a.jsx)("label",{htmlFor:r.name,className:"block text-sm font-medium text-content",children:o.label}),(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsx)(A,{onFileRead:(e,t)=>{c(r.name,e,{shouldValidate:!0,shouldDirty:!0}),c(l,t,{shouldValidate:!1,shouldDirty:!0})},disabled:n,className:"w-full",externalError:e,value:d(r.name),initialFileName:d(l)})}),(0,a.jsxs)("div",{className:"space-y-1 mt-2",children:[(0,a.jsx)("label",{htmlFor:"".concat(r.name,"-textarea"),className:"block text-xs text-content",children:"Or paste certificate content:"}),(0,a.jsx)("textarea",{id:"".concat(r.name,"-textarea"),...i(r.name,{required:!1}),placeholder:o.placeholder,className:"w-full min-h-[150px] px-3 py-2 text-sm rounded-md font-mono input-border-regular focus:outline-none focus:border-[var(--color-background-primary,#a5b9e4)] focus:shadow-[0_0_0_2px_rgba(165,185,228,0.25)] ".concat(e?"input-border-error":""),readOnly:n})]}),e&&(0,a.jsx)("p",{className:"text-sm text-content",children:e})]},s)}return(0,a.jsx)("div",{className:"space-y-2 w-full",children:(0,l.bl)({field:r,register:i,errors:t,readOnly:n})},s)})})};function K(e,t){if(!e||!t)return;let n=null==t?void 0:t.split("."),a=e;for(let e of n){if(!a[e])return;a=a[e]}return a.message?a.message:void 0}let V=e=>{let{errors:t,authMethod:n,readOnly:i,securityProtocolOptions:c}=e,{register:d}=(0,o.xW)(),[p,m]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=setTimeout(()=>m(!0),100);return()=>clearTimeout(e)},[]),(0,a.jsxs)(r.gE,{className:"space-y-4 transition-all duration-700 ease-out ".concat(p?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"),children:[(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,a.jsx)("div",{className:"space-y-2 w-full lg:w-1/2",children:(0,l.bl)({field:u.base.fields.authMethod,register:d,errors:t,readOnly:i})}),(0,a.jsx)("div",{className:"space-y-2 w-full lg:w-1/2",children:(0,l.bl)({field:{...u.base.fields.securityProtocol,options:c},register:d,errors:t,readOnly:i})})]}),(0,a.jsx)("div",{className:"space-y-2 w-full",children:(0,l.bl)({field:u.base.fields.bootstrapServers,register:d,errors:t,readOnly:i})})]})},B=e=>{let{authMethod:t,securityProtocol:n,errors:i,readOnly:r}=e,{watch:l}=(0,o.xW)(),[d,u]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=setTimeout(()=>u(!0),200);return()=>clearTimeout(e)},[]);let p=l("authMethod"),m=Object.values(p===c.qp["SASL/SCRAM-256"].name||p===c.qp["SASL/SCRAM-512"].name?c.dw:c.NS).map(e=>({label:e,value:e}));return(0,a.jsxs)("div",{className:"space-y-4 md:space-y-6 transition-all duration-700 ease-out ".concat(d?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"),children:[(0,a.jsx)("div",{children:(e=>{let{authMethod:t,readOnly:n}=e;return(0,a.jsx)(V,{errors:i,authMethod:t,readOnly:n,securityProtocolOptions:m})})({authMethod:t,readOnly:r})}),(0,a.jsx)("div",{children:(e=>{let{readOnly:n}=e;switch(t){case"SASL/PLAIN":default:return(0,a.jsx)(E,{errors:i,readOnly:n});case"SASL/JAAS":return(0,a.jsx)(O,{errors:i,readOnly:n});case"SASL/GSSAPI":return(0,a.jsx)(P,{errors:i,readOnly:n});case"SASL/OAUTHBEARER":return(0,a.jsx)(I,{errors:i,readOnly:n});case"SASL/SCRAM-256":return(0,a.jsx)(F,{errors:i,readOnly:n});case"SASL/SCRAM-512":return(0,a.jsx)(_,{errors:i,readOnly:n});case"AWS_MSK_IAM":return(0,a.jsx)(M,{errors:i,readOnly:n});case"mTLS":return(0,a.jsx)(D,{errors:i,readOnly:n});case"Delegation tokens":return(0,a.jsx)(R,{errors:i,readOnly:n});case"SASL/LDAP":return(0,a.jsx)(U,{errors:i,readOnly:n});case"NO_AUTH":return(0,a.jsx)(L,{errors:i,readOnly:n})}})({readOnly:r})})]})};var G=n(4991),W=n(386);let Y=e=>{let{onTestConnection:t,onDiscardConnectionChange:n,isConnecting:r,connectionResult:l,readOnly:c,standalone:d,initialValues:u,authMethod:p,securityProtocol:m,bootstrapServers:f,toggleEditMode:h,pipelineActionState:v,onClose:g}=e,x=(0,s.useRef)(u),[S,b]=(0,s.useState)(!0),[y,w]=(0,s.useState)(!1),j=(0,s.useRef)(!1),C=!!f,N=(0,o.mN)({resolver:(0,i.u)(G.YT),defaultValues:u,mode:"onBlur",criteriaMode:"firstError",shouldFocusError:!1}),{watch:k,setValue:T,trigger:A,handleSubmit:E}=N,{errors:L,isValid:O,isDirty:P,touchedFields:I}=N.formState,F=k("authMethod"),_=k("securityProtocol");(0,s.useEffect)(()=>{F&&("SASL/SCRAM-256"===F||"SASL/SCRAM-512"===F?T("securityProtocol","SASL_SSL"):"SASL/PLAIN"===F?T("securityProtocol","SASL_PLAINTEXT"):"NO_AUTH"===F?T("securityProtocol","PLAINTEXT"):"SASL/JAAS"===F?T("securityProtocol","SASL_JAAS"):"SASL/GSSAPI"===F&&T("securityProtocol","SASL_GSSAPI"))},[F,T]),(0,s.useEffect)(()=>{x.current=u},[u]),(0,s.useEffect)(()=>(C&&!j.current&&(p&&T("authMethod",p),m&&T("securityProtocol",m),f&&T("bootstrapServers",f),j.current=!0),()=>{S&&b(!1)}),[p,m,f,T,S,C]);let D=y||C&&!S&&Object.keys(I).length>0,M=async()=>{let e=N.getValues();if(w(!0),!await N.trigger())return void console.log("Form has validation errors",N.formState.errors);if(d){t&&await t(e);return}t&&await t(e)};return(0,a.jsx)(o.Op,{...N,children:(0,a.jsxs)("form",{onSubmit:E(()=>{}),className:"space-y-6",onChange:()=>{y||w(!0)},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()},children:[(0,a.jsx)(B,{authMethod:F,securityProtocol:_,errors:D?L:{},readOnly:c}),(0,a.jsx)(W.A,{onSubmit:M,onDiscard:()=>{N.reset(x.current),w(!1),j.current=!1,p&&N.setValue("authMethod",p),m&&N.setValue("securityProtocol",m),f&&N.setValue("bootstrapServers",f),n()},toggleEditMode:h,standalone:d,readOnly:c,disabled:r||(null==v?void 0:v.isLoading)&&((null==v?void 0:v.lastAction)==="stop"||(null==v?void 0:v.lastAction)==="edit"),isLoading:r||(null==v?void 0:v.isLoading)&&((null==v?void 0:v.lastAction)==="stop"||(null==v?void 0:v.lastAction)==="edit"),isSuccess:null==l?void 0:l.success,successText:"Continue",loadingText:(null==v?void 0:v.isLoading)&&(null==v?void 0:v.lastAction)==="stop"?"Stopping pipeline for editing...":(null==v?void 0:v.isLoading)&&(null==v?void 0:v.lastAction)==="edit"?"Saving configuration...":"Testing...",regularText:"Continue",actionType:"primary",showLoadingIcon:!0,pipelineActionState:v,onClose:g})]})})};var z=n(8090),J=n(4775),H=n(2272),$=n(8967);function X(e){let{steps:t,onCompleteStep:n,validate:i,readOnly:o=!1,toggleEditMode:r,standalone:l,onCompleteStandaloneEditing:d,pipelineActionState:u,pipeline:p}=e,[f,h]=(0,s.useState)(!1),{kafkaStore:v,topicsStore:g,coreStore:x}=(0,z.useStore)(),{operationsSelected:S}=x,{setKafkaAuthMethod:b,setKafkaSecurityProtocol:y,setKafkaBootstrapServers:w,setKafkaNoAuth:j,setKafkaSaslPlain:C,setKafkaSaslJaas:N,setKafkaSaslGssapi:k,setKafkaSaslOauthbearer:T,setKafkaSaslScram256:A,setKafkaSaslScram512:E,setKafkaDelegationTokens:L,setKafkaConnection:O,setKafkaSkipAuth:P,isConnected:I,authMethod:F,securityProtocol:_,bootstrapServers:D,saslPlain:M,saslJaas:R,saslGssapi:U,saslOauthbearer:q,saslScram256:K,saslScram512:V,delegationTokens:B,noAuth:G}=v,{resetTopicsStore:W}=g,X=(0,s.useRef)(D),[Z,Q]=(0,s.useState)(null),ee=(0,J.U)(),{testConnection:et,connectionResult:en,kafkaConnection:ea,isConnecting:es}=(()=>{let[e,t]=(0,s.useState)(!1),[n,a]=(0,s.useState)(null),[i,o]=(0,s.useState)(null);return{testConnection:async e=>{try{var n,s,i,r;t(!0),a(null),await new Promise(e=>setTimeout(e,5e3));let l={servers:e.bootstrapServers,securityProtocol:e.securityProtocol,authMethod:e.authMethod};switch(e.authMethod){case"NO_AUTH":(null==(n=e.noAuth.truststore)?void 0:n.certificates)&&(l.certificate=e.noAuth.truststore.certificates);break;case"SASL/PLAIN":l.username=e.saslPlain.username,l.password=e.saslPlain.password,l.consumerGroup=e.saslPlain.consumerGroup,(null==(s=e.saslPlain.truststore)?void 0:s.certificates)&&(l.certificate=e.saslPlain.truststore.certificates);break;case"SASL/JAAS":l.jaasConfig=e.saslJaas.jaasConfig;break;case"SASL/GSSAPI":l.kerberosPrincipal=e.saslGssapi.kerberosPrincipal,l.kerberosKeytab=e.saslGssapi.kerberosKeytab,l.kerberosRealm=e.saslGssapi.kerberosRealm,l.kdc=e.saslGssapi.kdc,l.serviceName=e.saslGssapi.serviceName,l.krb5Config=e.saslGssapi.krb5Config,(null==(i=e.saslGssapi.truststore)?void 0:i.certificates)&&(l.certificate=e.saslGssapi.truststore.certificates);break;case"SASL/OAUTHBEARER":l.oauthBearerToken=e.saslOauthbearer.oauthBearerToken;break;case"SASL/SCRAM-256":case"SASL/SCRAM-512":let c="SASL/SCRAM-256"===e.authMethod?e.saslScram256:e.saslScram512;l.username=c.username,l.password=c.password,l.consumerGroup=c.consumerGroup,(null==(r=c.truststore)?void 0:r.certificates)&&(l.certificate=c.truststore.certificates);break;case"AWS_MSK_IAM":l.awsAccessKey=e.awsIam.awsAccessKey,l.awsAccessKeySecret=e.awsIam.awsAccessKeySecret,l.awsRegion=e.awsIam.awsRegion;break;case"Delegation tokens":l.delegationToken=e.delegationTokens.delegationToken;break;case"SASL/LDAP":l.ldapServerUrl=e.ldap.ldapServerUrl,l.ldapServerPort=e.ldap.ldapServerPort,l.ldapBindDn=e.ldap.ldapBindDn,l.ldapBindPassword=e.ldap.ldapBindPassword,l.ldapUserSearchFilter=e.ldap.ldapUserSearchFilter,l.ldapBaseDn=e.ldap.ldapBaseDn;break;case"mTLS":l.clientCert=e.mtls.clientCert,l.clientKey=e.mtls.clientKey,l.password=e.mtls.password}let d=await fetch("/ui-api/kafka/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),u=await d.json();if(u.success){let t={success:!0,message:"Successfully connected to Kafka cluster!"};return a(t),o({...e,isConnected:!0}),t}{let t={success:!1,message:u.error||"Failed to connect to Kafka cluster"};return a(t),o({...e,isConnected:!1}),t}}catch(n){console.error("Error testing Kafka connection:",n);let t={success:!1,message:n instanceof Error?n.message:"Unknown error occurred"};return a(t),o({...e,isConnected:!1}),t}finally{t(!1)}},isConnecting:e,connectionResult:n,kafkaConnection:i}})(),{executeAction:ei}=(0,H.z)(p),eo={...m,authMethod:F||m.authMethod,securityProtocol:_||m.securityProtocol,bootstrapServers:D||m.bootstrapServers,saslPlain:M||m.saslPlain,saslGssapi:U||m.saslGssapi,noAuth:G||m.noAuth,saslScram256:K||m.saslScram256,saslScram512:V||m.saslScram512};(0,s.useEffect)(()=>{X.current!==D&&(W(),X.current=D)},[D]),(0,s.useEffect)(()=>{(null==S?void 0:S.operation)?ee.page.setupKafkaConnection({}):console.log("no operation selected")},[null==S?void 0:S.operation,ee.page]),(0,s.useEffect)(()=>{en&&(en.success?ee.kafka.success({authMethod:null==Z?void 0:Z.authMethod,securityProtocol:null==Z?void 0:Z.securityProtocol,connectionTime:es?Date.now():void 0}):ee.kafka.failed({authMethod:null==Z?void 0:Z.authMethod,securityProtocol:null==Z?void 0:Z.securityProtocol,error:en.message}))},[en,Z,es,ee.kafka]);let er=async e=>{ee.kafka.started({authMethod:e.authMethod,securityProtocol:e.securityProtocol}),Q(e);let t=await et(e);if(t.success){let{authMethod:t,securityProtocol:a,bootstrapServers:s}=e;O({...e,bootstrapServers:e.bootstrapServers,isConnected:!0}),b(t),y(a),w(s),t===c.qp.NO_AUTH.name?(P(!0),j({...e.noAuth})):P(!1),e.authMethod===c.qp["SASL/PLAIN"].name&&C({...e.saslPlain}),e.authMethod===c.qp["SASL/JAAS"].name&&N({...e.saslJaas}),e.authMethod===c.qp["SASL/GSSAPI"].name&&k({...e.saslGssapi}),e.authMethod===c.qp["SASL/OAUTHBEARER"].name&&T({...e.saslOauthbearer}),e.authMethod===c.qp["SASL/SCRAM-256"].name&&A({...e.saslScram256}),e.authMethod===c.qp["SASL/SCRAM-512"].name&&E({...e.saslScram512}),e.authMethod===c.qp["Delegation tokens"].name&&L({...e.delegationTokens}),l&&r&&(x.markAsDirty(),console.log("[KafkaConnection] Configuration marked as dirty - changes will be saved on Resume")),!l&&n?n(c.Fn.KAFKA_CONNECTION):l&&d&&d(),ee.kafka.success({authMethod:e.authMethod,securityProtocol:e.securityProtocol})}else ee.kafka.failed({authMethod:e.authMethod,securityProtocol:e.securityProtocol,error:t.message})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Y,{onTestConnection:er,onDiscardConnectionChange:()=>{h(!0)},isConnecting:es,connectionResult:en,readOnly:o,standalone:l,initialValues:eo,authMethod:F,securityProtocol:_,bootstrapServers:D,toggleEditMode:r,pipelineActionState:u,onClose:d}),en&&!f&&(0,a.jsx)($.A,{message:en.message,success:en.success})]})}},4511:(e,t,n)=>{n.d(t,{I:()=>x});var a=n(1929),s=n(2477),i=n(8090),o=n(8821),r=n(6456),l=n(3233),c=n(4049),d=n(3528);function u(e){let{streamIndex:t,stream:n,availableKeys:s,onChange:i,errors:o={},readOnly:r}=e;return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h4",{className:"font-medium",children:["Stream ",t+1]}),(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)("div",{className:"w-[65%]",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.J,{htmlFor:"join-key-".concat(t),className:"label-regular text-content",children:"Join Key"}),(0,a.jsxs)(c.l6,{value:n.joinKey,onValueChange:e=>i(t,"joinKey",e),disabled:r,children:[(0,a.jsx)(c.bq,{id:"join-key-".concat(t),className:"w-full input-regular select-content-custom text-content ".concat(o.joinKey?"border-red-500":""),children:(0,a.jsx)(c.yv,{placeholder:"Select join key"})}),(0,a.jsx)(c.gC,{className:"select-content-custom",children:s.map(e=>(0,a.jsx)(c.eb,{value:e.value,className:"select-item-custom text-content",children:e.label},e.value))})]}),o.joinKey&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:o.joinKey})]})})}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("div",{className:"w-[65%]",children:(0,a.jsx)(d.x,{window:n.joinTimeWindowValue,setWindow:e=>i(t,"joinTimeWindowValue",e),windowUnit:n.joinTimeWindowUnit,setWindowUnit:e=>i(t,"joinTimeWindowUnit",e),label:"Join Time Window",tooltip:"Maximum time window is 7 days. Longer time windows can process more events but may result in slower performance.",readOnly:r})}),o.joinTimeWindowValue&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:o.joinTimeWindowValue})]})]})]})}var p=n(4775),m=n(4281),f=n(8387);function h(e){let{streams:t,dynamicOptions:n,onChange:i,errors:o={},event1:r,event2:l,topic1:c,topic2:d,readOnly:h}=e,v=(0,p.U)();return(0,s.useEffect)(()=>{t[0].joinKey&&v.key.leftJoinKey({key:t[0].joinKey})},[t[0].joinKey]),(0,s.useEffect)(()=>{t[1].joinKey&&v.key.rightJoinKey({key:t[1].joinKey})},[t[1].joinKey]),(0,a.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4 lg:gap-8 w-full",children:[(0,a.jsx)("div",{className:"w-full lg:w-1/2",children:(0,a.jsx)(u,{streamIndex:0,stream:t[0],availableKeys:n.streams[0].joinKey,onChange:i,errors:{joinKey:o["streams.0.joinKey"],joinTimeWindowValue:o["streams.0.joinTimeWindowValue"]},readOnly:h})}),(0,a.jsx)("div",{className:"w-full lg:w-1/2",children:(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-2",children:(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Stream 1 Sample Event"})}),(0,a.jsx)("div",{className:"flex-1 bg-background-neutral rounded-md p-4 min-h-[300px]",children:(0,a.jsx)(m.E,{event:(0,f.$c)(r||{}),topic:(null==c?void 0:c.name)||"",isLoadingEvent:!1,eventError:"",isEmptyTopic:!1,onManualEventChange:()=>{},isEditingEnabled:!1,readOnly:h},"event1-".concat(null==c?void 0:c.name,"-").concat(JSON.stringify(r)))})]})})]}),(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4 lg:gap-8 w-full",children:[(0,a.jsx)("div",{className:"w-full lg:w-1/2",children:(0,a.jsx)(u,{streamIndex:1,stream:t[1],availableKeys:n.streams[1].joinKey,onChange:i,errors:{joinKey:o["streams.1.joinKey"],joinTimeWindowValue:o["streams.1.joinTimeWindowValue"]},readOnly:h})}),(0,a.jsx)("div",{className:"w-full lg:w-1/2",children:(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-2",children:(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Stream 2 Sample Event"})}),(0,a.jsx)("div",{className:"flex-1 bg-background-neutral rounded-md p-4 min-h-[300px]",children:(0,a.jsx)(m.E,{event:(0,f.$c)(l||{}),topic:(null==d?void 0:d.name)||"",isLoadingEvent:!1,eventError:"",isEmptyTopic:!1,onManualEventChange:()=>{},isEditingEnabled:!1,readOnly:h},"event2-".concat(null==d?void 0:d.name,"-").concat(JSON.stringify(l)))})]})})]})]})}var v=n(386),g=n(1409);function x(e){var t,n,l,c,d,u,m,x,S,b,y,w;let{steps:j,onCompleteStep:C,validate:N,index:k=0,readOnly:T,standalone:A,toggleEditMode:E,pipelineActionState:L,onCompleteStandaloneEditing:O}=e,{topicsStore:P,joinStore:I,coreStore:F}=(0,i.useStore)(),_=(0,g.D)(),D=(0,p.U)(),{getTopic:M,getEvent:R}=P,{enabled:U,type:q,streams:K,setEnabled:V,setType:B,setStreams:G}=I,[W,Y]=(0,s.useState)({streams:[{streamId:(null==K||null==(t=K[0])?void 0:t.streamId)||"",joinKey:(null==K||null==(n=K[0])?void 0:n.joinKey)||"",joinTimeWindowValue:(null==K||null==(l=K[0])?void 0:l.joinTimeWindowValue)||1,joinTimeWindowUnit:(null==K||null==(c=K[0])?void 0:c.joinTimeWindowUnit)||o.XR.MINUTES.value},{streamId:(null==K||null==(d=K[1])?void 0:d.streamId)||"",joinKey:(null==K||null==(u=K[1])?void 0:u.joinKey)||"",joinTimeWindowValue:(null==K||null==(m=K[1])?void 0:m.joinTimeWindowValue)||1,joinTimeWindowUnit:(null==K||null==(x=K[1])?void 0:x.joinTimeWindowUnit)||o.XR.MINUTES.value}]}),[z,J]=(0,s.useState)(!0),[H,$]=(0,s.useState)(!1),[X,Z]=(0,s.useState)(!1),[Q,ee]=(0,s.useState)(!1),[et,en]=(0,s.useState)({}),[ea,es]=(0,s.useState)(!1),ei=M(k),eo=M(k+1),er=null==ei||null==(S=ei.events[0])?void 0:S.event,el=null==eo||null==(b=eo.events[0])?void 0:b.event,ec=ei&&ei.name&&eo&&eo.name;(0,s.useEffect)(()=>{D.page.joinKey({mode:A?"edit":"create",readOnly:T,hasExistingData:ec,timestamp:new Date().toISOString()}),D.join.configurationStarted({mode:A?"edit":"create",readOnly:T,hasExistingData:ec,leftTopicName:null==ei?void 0:ei.name,rightTopicName:null==eo?void 0:eo.name,timestamp:new Date().toISOString()})},[D.page,D.join,A,T,ec,null==ei?void 0:ei.name,null==eo?void 0:eo.name]),(0,s.useEffect)(()=>{!T&&ea&&es(!1)},[T,ea]),(0,s.useEffect)(()=>{z&&ec&&J(!1)},[z,ec]),(0,s.useEffect)(()=>{if((null==ei?void 0:ei.name)&&(null==eo?void 0:eo.name)){var e,t;let n=(null==K||null==(e=K[0])?void 0:e.streamId)||"".concat(ei.name,"_").concat((0,r.A)().slice(0,8)),a=(null==K||null==(t=K[1])?void 0:t.streamId)||"".concat(eo.name,"_").concat((0,r.A)().slice(0,8));Y(e=>({streams:[{...e.streams[0],streamId:n},{...e.streams[1],streamId:a}]}))}},[null==ei?void 0:ei.name,null==eo?void 0:eo.name,K]),(0,s.useEffect)(()=>{ec&&(null==K?void 0:K.length)===2&&!H&&K.every(e=>(null==e?void 0:e.streamId)&&(null==e?void 0:e.joinKey)&&(null==e?void 0:e.joinTimeWindowValue)&&(null==e?void 0:e.joinTimeWindowUnit))&&(Y({streams:K.map(e=>({streamId:e.streamId,joinKey:e.joinKey,joinTimeWindowValue:e.joinTimeWindowValue,joinTimeWindowUnit:e.joinTimeWindowUnit}))}),ee(!0))},[ec,K,H]);let ed=(H||ec&&Q)&&W.streams.every(e=>e.streamId&&e.joinKey&&e.joinTimeWindowValue&&e.joinTimeWindowUnit),eu={streams:[{joinKey:(null==(y=(0,f.B$)(er))?void 0:y.map(e=>({label:e,value:e})))||[],joinTimeWindowUnit:Object.values(o.XR).map(e=>({label:e.label,value:e.value}))},{joinKey:(null==(w=(0,f.B$)(el))?void 0:w.map(e=>({label:e,value:e})))||[],joinTimeWindowUnit:Object.values(o.XR).map(e=>({label:e.label,value:e.value}))}]};return(0,a.jsx)("form",{className:"space-y-6 w-full",children:(0,a.jsxs)("div",{className:"flex flex-col gap-6 pb-6 bg-background-neutral-faded rounded-md p-6",children:[(0,a.jsx)("div",{className:"flex flex-row gap-8",children:(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,a.jsx)("h3",{className:"text-sm font-weight-[400]",children:"This Kafka topic will be used as the data source for the pipeline."})}),(0,a.jsx)(h,{streams:W.streams,dynamicOptions:eu,onChange:(e,t,n)=>{var a,s,i;$(!0),Y(a=>({streams:a.streams.map((a,s)=>s===e?{...a,[t]:n}:a)})),D.join.fieldChanged({field:t,value:"string"==typeof n?n:JSON.stringify(n),streamIndex:e,streamId:null==(a=W.streams[e])?void 0:a.streamId,topicName:0===e?null==ei?void 0:ei.name:null==eo?void 0:eo.name,streamOrientation:0===e?"left":"right",timestamp:new Date().toISOString()}),"joinKey"===t&&n&&(0===e?D.key.leftJoinKey({joinKey:n,topicName:null==ei?void 0:ei.name,streamId:null==(s=W.streams[e])?void 0:s.streamId,timestamp:new Date().toISOString()}):D.key.rightJoinKey({joinKey:n,topicName:null==eo?void 0:eo.name,streamId:null==(i=W.streams[e])?void 0:i.streamId,timestamp:new Date().toISOString()})),_.invalidateSection(o.Fn.CLICKHOUSE_MAPPER,"Join configuration changed")},errors:et,event1:er,event2:el,topic1:ei,topic2:eo,readOnly:T})]})}),(0,a.jsx)(v.A,{standalone:A,onSubmit:()=>{Z(!0),(()=>{let e={},t=!0;return W.streams.forEach((n,a)=>{n.joinKey||(e["streams.".concat(a,".joinKey")]="Join key is required",t=!1),(!n.joinTimeWindowValue||n.joinTimeWindowValue<1)&&(e["streams.".concat(a,".joinTimeWindowValue")]="Time window value must be at least 1",t=!1),n.joinTimeWindowUnit||(e["streams.".concat(a,".joinTimeWindowUnit")]="Time window unit is required",t=!1)}),en(e),ee(t),t})()&&(V(!0),B("temporal"),G(W.streams.map((e,t)=>({...e,orientation:0===t?"left":"right",topicName:0===t?(null==ei?void 0:ei.name)||"":(null==eo?void 0:eo.name)||""}))),D.join.configurationCompleted({joinType:"temporal",leftStream:{streamId:W.streams[0].streamId,joinKey:W.streams[0].joinKey,timeWindow:"".concat(W.streams[0].joinTimeWindowValue," ").concat(W.streams[0].joinTimeWindowUnit),topicName:null==ei?void 0:ei.name},rightStream:{streamId:W.streams[1].streamId,joinKey:W.streams[1].joinKey,timeWindow:"".concat(W.streams[1].joinTimeWindowValue," ").concat(W.streams[1].joinTimeWindowUnit),topicName:null==eo?void 0:eo.name},timestamp:new Date().toISOString()}),_.onSectionConfigured(o.Fn.JOIN_CONFIGURATOR),A?(es(!0),null==O||O()):C(o.Fn.JOIN_CONFIGURATOR))},onDiscard:()=>{F.discardSection("join")},isLoading:!1,isSuccess:ea,disabled:!ed,successText:"Continue",loadingText:"Loading...",regularText:"Continue",actionType:"primary",showLoadingIcon:!1,readOnly:T,toggleEditMode:E,pipelineActionState:L,onClose:O})]})})}},4811:(e,t,n)=>{n.d(t,{T:()=>i});var a=n(1929);n(2477);var s=n(8387);function i(e){let{className:t,...n}=e;return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,s.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...n})}},4903:(e,t,n)=>{n.d(t,{BT:()=>l,Wu:()=>c,ZB:()=>r,Zp:()=>i,aR:()=>o});var a=n(1929);n(2477);var s=n(8387);function i(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...n})}function o(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,s.cn)("flex flex-col gap-1.5 px-6",t),...n})}function r(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,s.cn)("leading-none font-semibold",t),...n})}function l(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,s.cn)("text-muted-foreground text-sm",t),...n})}function c(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("px-6",t),...n})}},4991:(e,t,n)=>{n.d(t,{DS:()=>C,_O:()=>N,YT:()=>x,uZ:()=>y,TT:()=>w});var a=n(5509);n(1528);var s=n(1868);a.Ik({authMethod:a.Yj(),securityProtocol:a.Yj()}),a.Ik({bootstrapServers:a.Yj().min(1,"Bootstrap servers are required")});let i=a.Ik({location:a.Yj().optional(),password:a.Yj().optional(),type:a.Yj().optional(),algorithm:a.Yj().optional(),certificates:a.Yj().optional(),certificatesFileName:a.Yj().optional()}),o=a.Ik({username:a.Yj().min(1,"Username is required"),password:a.Yj().min(1,"Password is required"),truststore:i.optional(),consumerGroup:a.Yj().optional()}),r=a.Ik({truststore:i.optional()}),l=a.Ik({jaasConfig:a.Yj().min(1,"JAAS config is required")}),c=a.Ik({kerberosPrincipal:a.Yj().min(1,"Kerberos principal is required"),kerberosKeytab:a.Yj().min(1,"Kerberos keytab is required"),kerberosKeytabFileName:a.Yj().optional(),kerberosRealm:a.Yj().min(1,"Kerberos realm is required"),kdc:a.Yj().min(1,"Kerberos KDC is required"),serviceName:a.Yj().min(1,"Kerberos service name is required"),krb5Config:a.Yj().min(1,"Kerberos configuration is required"),krb5ConfigFileName:a.Yj().optional(),truststore:i.optional()}),d=a.Ik({oauthBearerToken:a.Yj().min(1,"OAuth bearer token is required")}),u=a.Ik({username:a.Yj().min(1,"Username is required"),password:a.Yj().min(1,"Password is required"),truststore:i.optional(),consumerGroup:a.Yj().optional()}),p=a.Ik({username:a.Yj().min(1,"Username is required"),password:a.Yj().min(1,"Password is required"),truststore:i.optional(),consumerGroup:a.Yj().optional()}),m=a.Ik({delegationToken:a.Yj().min(1,"Delegation token is required")}),f=a.Ik({ldapServerUrl:a.Yj().min(1,"LDAP server URL is required"),ldapServerPort:a.Yj().min(1,"LDAP server port is required"),ldapBindDn:a.Yj().min(1,"LDAP bind DN is required"),ldapBindPassword:a.Yj().min(1,"LDAP bind password is required"),ldapUserSearchFilter:a.lq(a.Yj().min(1,"LDAP user search filter is required")),ldapBaseDn:a.lq(a.Yj().min(1,"LDAP base DN is required"))}),h=a.Ik({awsRegion:a.Yj().min(1,"AWS region is required"),awsAccessKey:a.Yj().min(1,"AWS access key is required"),awsAccessKeySecret:a.Yj().min(1,"AWS access key secret is required"),awsAuthorizationIdentity:a.Yj().optional(),awsIAMRoleArn:a.Yj().optional(),awsSessionToken:a.Yj().optional()}),v=a.Ik({clientCert:a.Yj().min(1,"Client certificate is required"),clientKey:a.Yj().min(1,"Client key is required"),password:a.Yj().min(1,"Password is required")}),g=a.Ik({authMethod:a.Yj(),securityProtocol:a.Yj(),bootstrapServers:a.Yj().min(1,"Bootstrap servers are required"),isConnected:a.zM().optional()}),x=a.gM("authMethod",[g.extend({authMethod:a.eu("SASL/PLAIN"),saslPlain:o}),g.extend({authMethod:a.eu("SASL/JAAS"),saslJaas:l}),g.extend({authMethod:a.eu("SASL/GSSAPI"),saslGssapi:c}),g.extend({authMethod:a.eu("SASL/OAUTHBEARER"),saslOauthbearer:d}),g.extend({authMethod:a.eu("SASL/SCRAM-256"),saslScram256:u}),g.extend({authMethod:a.eu("SASL/SCRAM-512"),saslScram512:p}),g.extend({authMethod:a.eu("AWS_MSK_IAM"),awsIam:h}),g.extend({authMethod:a.eu("Delegation tokens"),delegationTokens:m}),g.extend({authMethod:a.eu("SASL/LDAP"),ldap:f}),g.extend({authMethod:a.eu("mTLS"),mtls:v}),g.extend({authMethod:a.eu("NO_AUTH"),noAuth:r})]).superRefine((e,t)=>{if((e=>"SASL_SSL"===e||"SSL"===e)(e.securityProtocol)){var n,a,i,o,r;"SASL/PLAIN"===e.authMethod&&e.saslPlain?(null==(n=e.saslPlain.truststore)?void 0:n.certificates)&&""!==e.saslPlain.truststore.certificates.trim()||t.addIssue({code:s.eq.custom,message:"Certificate is required when using SSL/TLS",path:["saslPlain","truststore","certificates"]}):"NO_AUTH"===e.authMethod&&e.noAuth?(null==(a=e.noAuth.truststore)?void 0:a.certificates)&&""!==e.noAuth.truststore.certificates.trim()||t.addIssue({code:s.eq.custom,message:"Certificate is required when using SSL/TLS",path:["noAuth","truststore","certificates"]}):"SASL/GSSAPI"===e.authMethod&&e.saslGssapi?(null==(i=e.saslGssapi.truststore)?void 0:i.certificates)&&""!==e.saslGssapi.truststore.certificates.trim()||t.addIssue({code:s.eq.custom,message:"Certificate is required when using SSL/TLS",path:["saslGssapi","truststore","certificates"]}):"SASL/SCRAM-256"===e.authMethod&&e.saslScram256?(null==(o=e.saslScram256.truststore)?void 0:o.certificates)&&""!==e.saslScram256.truststore.certificates.trim()||t.addIssue({code:s.eq.custom,message:"Certificate is required when using SSL/TLS",path:["saslScram256","truststore","certificates"]}):"SASL/SCRAM-512"===e.authMethod&&e.saslScram512&&((null==(r=e.saslScram512.truststore)?void 0:r.certificates)&&""!==e.saslScram512.truststore.certificates.trim()||t.addIssue({code:s.eq.custom,message:"Certificate is required when using SSL/TLS",path:["saslScram512","truststore","certificates"]}))}}),S=a.Ik({event:a.bz(),topicIndex:a.ai(),position:(0,a.KC)([a.ai(),a.Yj()]),kafkaOffset:a.ai().optional(),isAtEarliest:a.zM().optional(),isAtLatest:a.zM().optional(),isManualEvent:a.zM().optional()}),b=a.Ik({name:a.Yj(),index:a.ai(),events:a.YO(S),selectedEvent:S,initialOffset:a.k5(["earliest","latest"]),replicas:a.ai().optional(),partitionCount:a.ai().optional()}),y=a.g1(a.ai(),b);a.YO(a.Yj()),a.Ik({enabled:a.zM(),window:a.ai(),unit:a.k5(["seconds","minutes","hours","days"]),key:a.Yj(),keyType:a.Yj()}),a.Ik({topicName:a.Yj(),initialOffset:a.k5(["earliest","latest"])}).extend({event:S});let w=a.Ik({operation:a.Yj()}),j=a.Ik({window:a.Yj(),windowUnit:a.Yj(),keys:a.YO(a.Yj())}),C=a.g1(a.Yj(),j),N=a.Ik({join:a.zM(),streams:a.YO(a.Ik({name:a.Yj(),keys:a.YO(a.Ik({key:a.Yj(),index:a.ai(),type:a.k5(["string","number","boolean","array","object"])}))}))});a.Ik({events:a.YO(a.g1(a.Yj(),a.Yj()))})},5156:(e,t,n)=>{n.d(t,{A:()=>u});var a=n(1929),s=n(2477),i=n(3233),o=n(4122),r=n(8090),l=n(8387),c=n(3528),d=n(8821);let u=function(e){let{index:t,disabled:n=!1,onChange:u,eventData:p,readOnly:m}=e,[f,h]=(0,s.useState)(""),[v,g]=(0,s.useState)("string"),[x,S]=(0,s.useState)(1),[b,y]=(0,s.useState)(d.XR.HOURS.value),[w,j]=(0,s.useState)([]),[C,N]=(0,s.useState)(!1),[k,T]=(0,s.useState)(null),{topicsStore:A}=(0,r.useStore)(),{getTopic:E}=A;E(t);let L=(0,r.useStore)(e=>e.deduplicationStore.getDeduplication(t));(0,s.useEffect)(()=>{if(L&&(h(L.key||""),g(L.keyType||"string"),S(L.window||1),y(L.unit||d.XR.HOURS.value)),p){N(!0),T(null);try{let e=(0,l.B$)(p||{});e.length>0?j(e):T("No keys found in event data")}catch(e){console.error("Error processing event data:",e),T("Error processing event data")}finally{N(!1)}}},[L,p]),(0,s.useCallback)(()=>0===w.length?[]:w,[w]);let O=(0,s.useCallback)(e=>{h(e||""),g("string"),u({key:e||"",keyType:e?"string":""},{window:x,unit:b})},[v,x,b,u]);(0,s.useCallback)(e=>{g(e),u({key:f,keyType:e},{window:x,unit:b})},[f,x,b,u]);let P=(0,s.useCallback)(e=>{S(e),u({key:f,keyType:v},{window:e,unit:b})},[f,v,b,u]),I=(0,s.useCallback)(e=>{y(e),u({key:f,keyType:v},{window:x,unit:e})},[f,v,x,u]);return(0,a.jsxs)("div",{className:"flex flex-col gap-8 ".concat(n?"opacity-50 pointer-events-none":""),children:[(0,a.jsx)("div",{className:"text-sm font-weight-[400] text-content",children:p?"The deduplicate key will be used to detect and remove duplicate data in your pipeline.":"Select a topic and wait for event data to load to configure deduplication."}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)(i.J,{className:"text-lg font-medium text-content",children:"Deduplicate Key"})}),(0,a.jsxs)("div",{className:"flex gap-2 w-full",children:[(0,a.jsx)("div",{className:"w-[70%]",children:C?(0,a.jsx)("div",{className:"text-sm text-gray-500 p-2 border rounded",children:"Loading available keys..."}):w.length>0?(0,a.jsx)(o.Z,{availableOptions:w,selectedOption:f,onSelect:O,placeholder:"Enter de-duplicate key",clearable:!0,readOnly:m}):(0,a.jsx)("div",{className:"text-sm text-gray-500 p-2 border rounded",children:k||"Please select a topic with valid event data."})}),(0,a.jsx)("div",{className:"w-[30%]"})]})]}),(0,a.jsx)(c.x,{window:x,setWindow:P,windowUnit:b,setWindowUnit:I,readOnly:m})]})}},5735:(e,t,n)=>{n.d(t,{A0:()=>o,BF:()=>r,Hj:()=>l,XI:()=>i,nA:()=>d,nd:()=>c});var a=n(1929);n(2477);var s=n(8387);function i(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,a.jsx)("table",{"data-slot":"table",className:(0,s.cn)("w-full caption-bottom text-sm",t),...n})})}function o(e){let{className:t,...n}=e;return(0,a.jsx)("thead",{"data-slot":"table-header",className:(0,s.cn)("[&_tr]:border-b",t),...n})}function r(e){let{className:t,...n}=e;return(0,a.jsx)("tbody",{"data-slot":"table-body",className:(0,s.cn)("[&_tr:last-child]:border-0",t),...n})}function l(e){let{className:t,...n}=e;return(0,a.jsx)("tr",{"data-slot":"table-row",className:(0,s.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...n})}function c(e){let{className:t,...n}=e;return(0,a.jsx)("th",{"data-slot":"table-head",className:(0,s.cn)("text-muted-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...n})}function d(e){let{className:t,...n}=e;return(0,a.jsx)("td",{"data-slot":"table-cell",className:(0,s.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...n})}},5855:(e,t,n)=>{n.d(t,{A:()=>a});let a={src:"/_next/static/media/loader-small.ac73cbe2.svg",height:24,width:24,blurWidth:0,blurHeight:0}},6718:(e,t,n)=>{n.d(t,{Q:()=>l});var a=n(1929),s=n(2477),i=n(1869),o=n(1588),r=n(8387);function l(e){let{type:t,database:n,table:l,onRefresh:c,className:d,size:u="sm",variant:p="outline",disabled:m}=e,[f,h]=(0,s.useState)(!1),v=async()=>{h(!0);try{await c()}finally{h(!1)}};return(0,a.jsxs)(i.$,{variant:p,size:u,onClick:v,disabled:f||m,className:(0,r.cn)("transition-all duration-200",{"animate-spin":f,"opacity-50 cursor-not-allowed":m&&!f,"text-muted-foreground":m&&!f},d,"btn-neutral"),title:"Refresh ".concat(t," data"),children:[(0,a.jsx)(o.A,{className:(0,r.cn)("h-4 w-4",{"text-muted-foreground opacity-50":m&&!f})}),(0,a.jsx)("span",{className:(0,r.cn)({"text-muted-foreground opacity-50":m&&!f}),children:"Reload"})]})}},7904:(e,t,n)=>{n.d(t,{A:()=>a});let a={src:"/_next/static/media/info.0ff69a55.svg",height:16,width:16,blurWidth:0,blurHeight:0}},8099:(e,t,n)=>{n.d(t,{z:()=>m});var a=n(1929),s=n(2477),i=n(8090),o=n(4281),r=n(8387),l=n(8821),c=n(5156),d=n(4775),u=n(386),p=n(1409);function m(e){let{onCompleteStep:t,index:n=0,readOnly:m,standalone:f,toggleEditMode:h,pipelineActionState:v,onCompleteStandaloneEditing:g}=e,x=(0,d.U)(),S=(0,p.D)(),{coreStore:b}=(0,i.useStore)(),y=(0,i.useStore)(e=>e.deduplicationStore.getDeduplication(n)),w=(0,i.useStore)(e=>e.deduplicationStore.updateDeduplication),j=(0,i.useStore)(e=>e.topicsStore.getTopic(n)),C=null==j?void 0:j.selectedEvent,N=(null==C?void 0:C.event)||null;(0,s.useEffect)(()=>{x.page.deduplicationKey({})},[]);let[k,T]=(0,s.useState)(!1);(0,s.useEffect)(()=>{!m&&k&&T(!1)},[m,k]);let A=y||{enabled:!1,window:0,unit:"hours",key:"",keyType:"string"},E=!!(A.key&&A.window&&A.unit),L=(0,s.useCallback)((e,t)=>{let{key:a,keyType:s}=e,{window:i,unit:o}=t;w(n,{enabled:!0,window:i,unit:o,key:a,keyType:s}),x.key.dedupKey({keyType:s,window:i,unit:o})},[n,w,x.key]),O=(0,s.useCallback)(()=>{(null==j?void 0:j.name)&&(S.onSectionConfigured(l.Fn.DEDUPLICATION_CONFIGURATOR),f&&h?(T(!0),null==g||g()):t(l.Fn.DEDUPLICATION_CONFIGURATOR))},[j,t,S,f,h]),P=(0,s.useCallback)(()=>{b.discardSection("deduplication")},[b]);return j?N?(0,a.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"flex flex-col gap-12 w-[40%]",children:(0,a.jsx)(c.A,{index:n,onChange:L,disabled:!(null==j?void 0:j.name),eventData:N,readOnly:m},"dedup-keys-".concat(j.name,"-").concat(Date.now()))}),(0,a.jsx)("div",{className:"w-[60%] min-h-[400px]",children:(0,a.jsx)(o.E,{event:(0,r.$c)(N),topic:null==j?void 0:j.name,isLoadingEvent:!1,eventError:"",isEmptyTopic:!1,onManualEventChange:()=>{},isEditingEnabled:!1,readOnly:m})})]}),(0,a.jsx)(u.A,{standalone:f,onSubmit:O,onDiscard:P,isLoading:!1,isSuccess:k,disabled:!E,successText:"Continue",loadingText:"Loading...",regularText:"Continue",actionType:"primary",showLoadingIcon:!1,readOnly:m,toggleEditMode:h,pipelineActionState:v,onClose:g})]}):(0,a.jsxs)("div",{children:['No event data available for topic "',j.name,'". Please ensure the topic has been configured with event data.']}):(0,a.jsxs)("div",{children:["No topic data available for index ",n]})}},8967:(e,t,n)=>{n.d(t,{A:()=>i});var a=n(1929),s=n(2477);let i=function(e){let{message:t,success:n}=e,[i,o]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=setTimeout(()=>o(!0),100);return()=>clearTimeout(e)},[]),(0,a.jsx)("div",{className:"mt-4 overflow-hidden",children:(0,a.jsx)("div",{className:"p-3 rounded transform transition-all duration-500 ease-out ".concat(n?"bg-green-100 text-green-800":"bg-red-100 text-red-800"," ").concat(i?"translate-y-0 opacity-100":"-translate-y-4 opacity-0"),children:t})})}},9313:(e,t,n)=>{n(1929),n(2477),n(8387)}}]);