(()=>{var a={};a.id=5332,a.ids=[5332],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3994:(a,b,c)=>{"use strict";c.d(b,{PipelineNotFound:()=>h});var d=c(48477);c(48296);var e=c(26403),f=c(84135),g=c(39293);function h({pipelineId:a}){(0,g.U)();let b=(0,f.useRouter)();return(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-200px)] gap-6",children:[(0,d.jsxs)("div",{className:"flex flex-col items-center gap-3 text-center",children:[(0,d.jsx)("h2",{className:"text-2xl font-semibold text-foreground",children:"Pipeline not found"}),(0,d.jsxs)("p",{className:"text-sm text-content",children:["Pipeline with ID ",(0,d.jsx)("span",{className:"font-mono bg-muted px-2 py-1 rounded",children:a})," does not exist or has been deleted."]})]}),(0,d.jsx)(e.$,{variant:"outline",className:"btn-primary flex items-center gap-2",onClick:()=>{b.push("/pipelines")},children:"← Back to Pipelines"})]})}},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12906:(a,b,c)=>{"use strict";c.d(b,{m7:()=>g,e9:()=>f,O_:()=>e});var d=c(6372);let e=()=>"true"===process.env.NEXT_PUBLIC_USE_MOCK_API,f=a=>{let b,c="true"===process.env.NEXT_PUBLIC_IN_DOCKER;if("true"===process.env.NEXT_PUBLIC_USE_MOCK_API)if(0)b=`/ui-api/mock/${a}`;else{let c=process.env.PORT||"3000";b=`http://localhost:${c}/ui-api/mock/${a}`}else b=`${c?"http://ui:8080":"http://localhost:3000"}/ui-api/${a}`;return b},g=(a=`pipeline-${Date.now()}`)=>{let b=d.mockPipelines,c=b[Math.floor(Math.random()*b.length)],e=["active","paused","stopped","error"],f=e[Math.floor(Math.random()*e.length)];return{...c,pipeline_id:a,name:`Mock Pipeline ${a}`,state:f}}},14215:(a,b,c)=>{"use strict";c.d(b,{default:()=>d});let d=(0,c(13383).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/nnaumov/Apps/clickhouse-etl/ui/src/modules/pipelines/[id]/PipelineDetailsModule.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/nnaumov/Apps/clickhouse-etl/ui/src/modules/pipelines/[id]/PipelineDetailsModule.tsx","default")},15162:(a,b,c)=>{Promise.resolve().then(c.bind(c,18413)),Promise.resolve().then(c.bind(c,14215)),Promise.resolve().then(c.bind(c,40668))},16389:(a,b,c)=>{"use strict";c.d(b,{O:()=>f});var d=c(48296),e=c(31041);let f=({pipelineId:a,enabled:b=!0,pollingInterval:c=5e3,onStatusChange:f,onError:g,onHealthUpdate:h,stopOnStatuses:i=["Running","Terminated","Failed"],maxRetries:j=3})=>{let[k,l]=(0,d.useState)(null),[m,n]=(0,d.useState)(!1),[o,p]=(0,d.useState)(null),[q,r]=(0,d.useState)(!1),[s,t]=(0,d.useState)(!1),[u,v]=(0,d.useState)(0),w=(0,d.useRef)(null),x=(0,d.useRef)(null);console.log(`[usePipelineHealth] Pipeline: ${a}, enabled: ${b}, started: ${q}, stopped: ${s}`);let y=(0,d.useCallback)(async()=>{if(!b||!a||s)return void console.log(`[usePipelineHealth] Skipping fetch - enabled: ${b}, pipelineId: ${!!a}, stopped: ${s}`);console.log(`[usePipelineHealth] Fetching health for ${a}`),n(!0);try{let d=await (0,e.nk)(a),g=d.overall_status,j=x.current;if(console.log(`[usePipelineHealth] Got status: ${g} for ${a}`),l(d),p(null),v(0),x.current=g,j!==g&&f?.(g,j),h?.(d),i.includes(g)){console.log(`[usePipelineHealth] Status ${g} is final, stopping polling for ${a}`),t(!0),w.current&&(clearTimeout(w.current),w.current=null);return}!s&&b&&(w.current=setTimeout(y,c),console.log(`[usePipelineHealth] Scheduled next fetch in ${c}ms for ${a}`))}catch(e){let d=u+1;if(console.log(`[usePipelineHealth] Error ${e.code} for ${a}, count: ${d}/${j}`),p(e),v(d),g?.(e),404===e.code||e.code>=500||d>=j){console.log(`[usePipelineHealth] Critical error or max retries reached, stopping polling for ${a}`),t(!0),w.current&&(clearTimeout(w.current),w.current=null);return}!s&&b&&(w.current=setTimeout(y,c),console.log(`[usePipelineHealth] Scheduled retry in ${c}ms for ${a}`))}finally{n(!1)}},[a,b,s,u,j,c,f,g,h,i]);(0,d.useEffect)(()=>{b&&a&&!q&&!s&&(console.log(`[usePipelineHealth] Starting health monitoring for ${a}`),r(!0),y())},[b,a,q,s,y]),(0,d.useEffect)(()=>()=>{console.log(`[usePipelineHealth] Cleanup for ${a}`),w.current&&(clearTimeout(w.current),w.current=null)},[a]);let z=(0,d.useCallback)(()=>{s||(r(!0),y())},[s,y]),A=(0,d.useCallback)(()=>{console.log(`[usePipelineHealth] Manual stop for ${a}`),t(!0),w.current&&(clearTimeout(w.current),w.current=null)},[a]),B=(0,d.useCallback)(async()=>{s||await y()},[s,y]);return{health:k,isLoading:m,error:o,isPolling:q&&!s,refetch:B,startPolling:z,stopPolling:A}}},18413:(a,b,c)=>{"use strict";c.d(b,{default:()=>d});let d=(0,c(13383).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/nnaumov/Apps/clickhouse-etl/ui/src/modules/pipelines/[id]/PipelineDetailsClientWrapper.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/nnaumov/Apps/clickhouse-etl/ui/src/modules/pipelines/[id]/PipelineDetailsClientWrapper.tsx","default")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},26713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},28354:a=>{"use strict";a.exports=require("util")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:a=>{"use strict";a.exports=require("path")},38017:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GlobalError:()=>C.a,__next_app__:()=>I,handler:()=>K,pages:()=>H,routeModule:()=>J,tree:()=>G});var d=c(40177),e=c(30166),f=c(38566),g=c(7431),h=c(30461),i=c(12933),j=c(30828),k=c(16205),l=c(51911),m=c(49011),n=c(83540),o=c(4050),p=c(70543),q=c(261),r=c(59254),s=c(21483),t=c(26713),u=c(79431),v=c(50932),w=c(98632),x=c(41449),y=c(3855),z=c(53845),A=c(86439),B=c(75755),C=c.n(B),D=c(17207),E=c(82502),F={};for(let a in D)0>["default","tree","pages","GlobalError","__next_app__","routeModule","handler"].indexOf(a)&&(F[a]=()=>D[a]);c.d(b,F);let G={children:["",{children:["pipelines",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(c.bind(c,52761)),"/Users/nnaumov/Apps/clickhouse-etl/ui/src/app/pipelines/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(c.bind(c,58283)),"/Users/nnaumov/Apps/clickhouse-etl/ui/src/app/layout.tsx"],"global-error":[()=>Promise.resolve().then(c.t.bind(c,75755,23)),"next/dist/client/components/builtin/global-error.js"],"not-found":[()=>Promise.resolve().then(c.t.bind(c,66787,23)),"next/dist/client/components/builtin/not-found.js"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,94534,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,43121,23)),"next/dist/client/components/builtin/unauthorized.js"]}]}.children,H=["/Users/nnaumov/Apps/clickhouse-etl/ui/src/app/pipelines/[id]/page.tsx"],I={require:c,loadChunk:()=>Promise.resolve()},J=new d.AppPageRouteModule({definition:{kind:e.RouteKind.APP_PAGE,page:"/pipelines/[id]/page",pathname:"/pipelines/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:G},distDir:".next",projectDir:""});async function K(a,b,c){var d;let B="/pipelines/[id]/page";"/index"===B&&(B="/");let F="false",L=(0,h.getRequestMeta)(a,"postponed"),M=(0,h.getRequestMeta)(a,"minimalMode"),N=await J.prepare(a,b,{srcPage:B,multiZoneDraftMode:F});if(!N)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:O,query:P,params:Q,parsedUrl:R,pageIsDynamic:S,buildManifest:T,nextFontManifest:U,reactLoadableManifest:V,serverActionsManifest:W,clientReferenceManifest:X,subresourceIntegrityManifest:Y,prerenderManifest:Z,isDraftMode:$,resolvedPathname:_,revalidateOnlyGenerated:aa,routerServerContext:ab,nextConfig:ac}=N,ad=R.pathname||"/",ae=(0,q.normalizeAppPath)(B),{isOnDemandRevalidate:af}=N,ag=Z.dynamicRoutes[ae],ah=Z.routes[_],ai=!!(ag||ah||Z.routes[ae]),aj=a.headers["user-agent"]||"",ak=(0,t.getBotType)(aj),al=(0,o.isHtmlBotRequest)(a),am=(0,h.getRequestMeta)(a,"isPrefetchRSCRequest")??!!a.headers[s.NEXT_ROUTER_PREFETCH_HEADER],an=(0,h.getRequestMeta)(a,"isRSCRequest")??!!a.headers[s.RSC_HEADER],ao=(0,r.getIsPossibleServerAction)(a),ap=(0,l.checkIsAppPPREnabled)(ac.experimental.ppr)&&(null==(d=Z.routes[ae]??Z.dynamicRoutes[ae])?void 0:d.renderingMode)==="PARTIALLY_STATIC",aq=!1,ar=!1,as=ap?L:void 0,at=ap&&an&&!am,au=(0,h.getRequestMeta)(a,"segmentPrefetchRSCRequest"),av=!aj||(0,o.shouldServeStreamingMetadata)(aj,ac.htmlLimitedBots);al&&ap&&(ai=!1,av=!1);let aw=!0===J.isDev||!ai||"string"==typeof L||at,ax=al&&ap,ay=null;$||!ai||aw||ao||as||at||(ay=_);let az=ay;!az&&J.isDev&&(az=_);let aA={...D,tree:G,pages:H,GlobalError:C(),handler:K,routeModule:J,__next_app__:I};W&&X&&(0,n.setReferenceManifestsSingleton)({page:B,clientReferenceManifest:X,serverActionsManifest:W,serverModuleMap:(0,p.createServerModuleMap)({serverActionsManifest:W})});let aB=a.method||"GET",aC=(0,g.getTracer)(),aD=aC.getActiveScopeSpan();try{let d=async(c,d)=>{let e=new k.NodeNextRequest(a),f=new k.NodeNextResponse(b);return J.render(e,f,d).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=aC.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${aB} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${aB} ${a.url}`)})},f=async({span:e,postponed:f,fallbackRouteParams:g})=>{let i={query:P,params:Q,page:ae,sharedContext:{buildId:O},serverComponentsHmrCache:(0,h.getRequestMeta)(a,"serverComponentsHmrCache"),fallbackRouteParams:g,renderOpts:{App:()=>null,Document:()=>null,pageConfig:{},ComponentMod:aA,Component:(0,j.T)(aA),params:Q,routeModule:J,page:B,postponed:f,shouldWaitOnAllReady:ax,serveStreamingMetadata:av,supportsDynamicResponse:"string"==typeof f||aw,buildManifest:T,nextFontManifest:U,reactLoadableManifest:V,subresourceIntegrityManifest:Y,serverActionsManifest:W,clientReferenceManifest:X,setIsrStatus:null==ab?void 0:ab.setIsrStatus,dir:J.projectDir,isDraftMode:$,isRevalidate:ai&&!f&&!at,botType:ak,isOnDemandRevalidate:af,isPossibleServerAction:ao,assetPrefix:ac.assetPrefix,nextConfigOutput:ac.output,crossOrigin:ac.crossOrigin,trailingSlash:ac.trailingSlash,previewProps:Z.preview,deploymentId:ac.deploymentId,enableTainting:ac.experimental.taint,htmlLimitedBots:ac.htmlLimitedBots,devtoolSegmentExplorer:ac.experimental.devtoolSegmentExplorer,reactMaxHeadersLength:ac.reactMaxHeadersLength,multiZoneDraftMode:F,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:ac.experimental.cacheLife,basePath:ac.basePath,serverActions:ac.experimental.serverActions,...aq?{nextExport:!0,supportsDynamicResponse:!1,isStaticGeneration:!0,isRevalidate:!0,isDebugDynamicAccesses:aq}:{},experimental:{isRoutePPREnabled:ap,expireTime:ac.expireTime,staleTimes:ac.experimental.staleTimes,dynamicIO:!!ac.experimental.dynamicIO,clientSegmentCache:!!ac.experimental.clientSegmentCache,dynamicOnHover:!!ac.experimental.dynamicOnHover,inlineCss:!!ac.experimental.inlineCss,authInterrupts:!!ac.experimental.authInterrupts,clientTraceMetadata:ac.experimental.clientTraceMetadata||[]},waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:()=>{},onInstrumentationRequestError:(b,c,d)=>J.onRequestError(a,b,d,ab),err:(0,h.getRequestMeta)(a,"invokeError"),dev:J.isDev}},k=await d(e,i),{metadata:l}=k,{cacheControl:m,headers:n={},fetchTags:o}=l;if(o&&(n[x.NEXT_CACHE_TAGS_HEADER]=o),a.fetchMetrics=l.fetchMetrics,ai&&(null==m?void 0:m.revalidate)===0&&!J.isDev&&!ap){let a=l.staticBailoutInfo,b=Object.defineProperty(Error(`Page changed from static to dynamic at runtime ${_}${(null==a?void 0:a.description)?`, reason: ${a.description}`:""}
see more here https://nextjs.org/docs/messages/app-static-to-dynamic-error`),"__NEXT_ERROR_CODE",{value:"E132",enumerable:!1,configurable:!0});if(null==a?void 0:a.stack){let c=a.stack;b.stack=b.message+c.substring(c.indexOf("\n"))}throw b}return{value:{kind:u.CachedRouteKind.APP_PAGE,html:k,headers:n,rscData:l.flightData,postponed:l.postponed,status:l.statusCode,segmentData:l.segmentData},cacheControl:m}},l=async({hasResolved:d,previousCacheEntry:g,isRevalidating:i,span:j})=>{let k,l=!1===J.isDev,n=d||b.writableEnded;if(af&&aa&&!g&&!M)return(null==ab?void 0:ab.render404)?await ab.render404(a,b):(b.statusCode=404,b.end("This page could not be found")),null;if(ag&&(k=(0,v.parseFallbackField)(ag.fallback)),k===v.FallbackMode.PRERENDER&&(0,t.isBot)(aj)&&(k=v.FallbackMode.BLOCKING_STATIC_RENDER),(null==g?void 0:g.isStale)===-1&&(af=!0),af&&(k!==v.FallbackMode.NOT_FOUND||g)&&(k=v.FallbackMode.BLOCKING_STATIC_RENDER),!M&&k!==v.FallbackMode.BLOCKING_STATIC_RENDER&&az&&!n&&!$&&S&&(l||!ah)){let b;if((l||ag)&&k===v.FallbackMode.NOT_FOUND)throw new A.NoFallbackError;if(ap&&!an){if(b=await J.handleResponse({cacheKey:l?ae:null,req:a,nextConfig:ac,routeKind:e.RouteKind.APP_PAGE,isFallback:!0,prerenderManifest:Z,isRoutePPREnabled:ap,responseGenerator:async()=>f({span:j,postponed:void 0,fallbackRouteParams:l||ar?(0,m.u)(ae):null}),waitUntil:c.waitUntil}),null===b)return null;if(b)return delete b.cacheControl,b}}let o=af||i||!as?void 0:as;if(aq&&void 0!==o)return{cacheControl:{revalidate:1,expire:void 0},value:{kind:u.CachedRouteKind.PAGES,html:w.default.fromStatic(""),pageData:{},headers:void 0,status:void 0}};let p=S&&ap&&((0,h.getRequestMeta)(a,"renderFallbackShell")||ar)?(0,m.u)(ad):null;return f({span:j,postponed:o,fallbackRouteParams:p})},n=async d=>{var g,i,j,k,m;let n,o=await J.handleResponse({cacheKey:ay,responseGenerator:a=>l({span:d,...a}),routeKind:e.RouteKind.APP_PAGE,isOnDemandRevalidate:af,isRoutePPREnabled:ap,req:a,nextConfig:ac,prerenderManifest:Z,waitUntil:c.waitUntil});if($&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),J.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),!o){if(ay)throw Object.defineProperty(Error("invariant: cache entry required but not generated"),"__NEXT_ERROR_CODE",{value:"E62",enumerable:!1,configurable:!0});return null}if((null==(g=o.value)?void 0:g.kind)!==u.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant app-page handler received invalid cache entry ${null==(j=o.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E707",enumerable:!1,configurable:!0});let p="string"==typeof o.value.postponed;ai&&!at&&(!p||am)&&(M||b.setHeader("x-nextjs-cache",af?"REVALIDATED":o.isMiss?"MISS":o.isStale?"STALE":"HIT"),b.setHeader(s.NEXT_IS_PRERENDER_HEADER,"1"));let{value:q}=o;if(as)n={revalidate:0,expire:void 0};else if(M&&an&&!am&&ap)n={revalidate:0,expire:void 0};else if(!J.isDev)if($)n={revalidate:0,expire:void 0};else if(ai){if(o.cacheControl)if("number"==typeof o.cacheControl.revalidate){if(o.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${o.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});n={revalidate:o.cacheControl.revalidate,expire:(null==(k=o.cacheControl)?void 0:k.expire)??ac.expireTime}}else n={revalidate:x.CACHE_ONE_YEAR,expire:void 0}}else b.getHeader("Cache-Control")||(n={revalidate:0,expire:void 0});if(o.cacheControl=n,"string"==typeof au&&(null==q?void 0:q.kind)===u.CachedRouteKind.APP_PAGE&&q.segmentData){b.setHeader(s.NEXT_DID_POSTPONE_HEADER,"2");let c=null==(m=q.headers)?void 0:m[x.NEXT_CACHE_TAGS_HEADER];M&&ai&&c&&"string"==typeof c&&b.setHeader(x.NEXT_CACHE_TAGS_HEADER,c);let d=q.segmentData.get(au);return void 0!==d?(0,z.sendRenderResult)({req:a,res:b,type:"rsc",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:w.default.fromStatic(d),cacheControl:o.cacheControl}):(b.statusCode=204,(0,z.sendRenderResult)({req:a,res:b,type:"rsc",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:w.default.fromStatic(""),cacheControl:o.cacheControl}))}let r=(0,h.getRequestMeta)(a,"onCacheEntry");if(r&&await r({...o,value:{...o.value,kind:"PAGE"}},{url:(0,h.getRequestMeta)(a,"initURL")}))return null;if(p&&as)throw Object.defineProperty(Error("Invariant: postponed state should not be present on a resume request"),"__NEXT_ERROR_CODE",{value:"E396",enumerable:!1,configurable:!0});if(q.headers){let a={...q.headers};for(let[c,d]of(M&&ai||delete a[x.NEXT_CACHE_TAGS_HEADER],Object.entries(a)))if(void 0!==d)if(Array.isArray(d))for(let a of d)b.appendHeader(c,a);else"number"==typeof d&&(d=d.toString()),b.appendHeader(c,d)}let t=null==(i=q.headers)?void 0:i[x.NEXT_CACHE_TAGS_HEADER];if(M&&ai&&t&&"string"==typeof t&&b.setHeader(x.NEXT_CACHE_TAGS_HEADER,t),!q.status||an&&ap||(b.statusCode=q.status),!M&&q.status&&E.RedirectStatusCode[q.status]&&an&&(b.statusCode=200),p&&b.setHeader(s.NEXT_DID_POSTPONE_HEADER,"1"),an&&!$){if(void 0===q.rscData){if(q.postponed)throw Object.defineProperty(Error("Invariant: Expected postponed to be undefined"),"__NEXT_ERROR_CODE",{value:"E372",enumerable:!1,configurable:!0});return(0,z.sendRenderResult)({req:a,res:b,type:"rsc",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:q.html,cacheControl:at?{revalidate:0,expire:void 0}:o.cacheControl})}return(0,z.sendRenderResult)({req:a,res:b,type:"rsc",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:w.default.fromStatic(q.rscData),cacheControl:o.cacheControl})}let v=q.html;if(!p||M)return(0,z.sendRenderResult)({req:a,res:b,type:"html",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:v,cacheControl:o.cacheControl});if(aq)return v.chain(new ReadableStream({start(a){a.enqueue(y.ENCODED_TAGS.CLOSED.BODY_AND_HTML),a.close()}})),(0,z.sendRenderResult)({req:a,res:b,type:"html",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:v,cacheControl:{revalidate:0,expire:void 0}});let A=new TransformStream;return v.chain(A.readable),f({span:d,postponed:q.postponed,fallbackRouteParams:null}).then(async a=>{var b,c;if(!a)throw Object.defineProperty(Error("Invariant: expected a result to be returned"),"__NEXT_ERROR_CODE",{value:"E463",enumerable:!1,configurable:!0});if((null==(b=a.value)?void 0:b.kind)!==u.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant: expected a page response, got ${null==(c=a.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E305",enumerable:!1,configurable:!0});await a.value.html.pipeTo(A.writable)}).catch(a=>{A.writable.abort(a).catch(a=>{console.error("couldn't abort transformer",a)})}),(0,z.sendRenderResult)({req:a,res:b,type:"html",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:v,cacheControl:{revalidate:0,expire:void 0}})};if(!aD)return await aC.withPropagatedContext(a.headers,()=>aC.trace(i.BaseServerSpan.handleRequest,{spanName:`${aB} ${a.url}`,kind:g.SpanKind.SERVER,attributes:{"http.method":aB,"http.target":a.url}},n));await n(aD)}catch(b){throw aD||await J.onRequestError(a,b,{routerKind:"App Router",routePath:B,routeType:"render",revalidateReason:(0,f.c)({isRevalidate:ai,isOnDemandRevalidate:af})},ab),b}}},40668:(a,b,c)=>{"use strict";c.d(b,{PipelineNotFound:()=>d});let d=(0,c(13383).registerClientReference)(function(){throw Error("Attempted to call PipelineNotFound() from the server but PipelineNotFound is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/nnaumov/Apps/clickhouse-etl/ui/src/modules/pipelines/PipelineNotFound.tsx","PipelineNotFound")},41025:a=>{"use strict";a.exports=require("next/dist/server/app-render/dynamic-access-async-storage.external.js")},51884:(a,b,c)=>{"use strict";c.d(b,{default:()=>ag});var d=c(48477),e=c(48296),f=c(26403),g=c(24370),h=c(19677);let i=(0,c(76230).A)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var j=c(43188),k=c(50899),l=c(36241),m=c(8420);let n=function({visible:a,onOk:b,onCancel:c}){return(0,d.jsx)(m.R,{visible:a,title:"Unsaved Changes Detected",description:`<div>
        <div style="margin-bottom: 16px;">You have unsaved changes that haven't been deployed yet.</div>
        <div style="margin-bottom: 16px;">The downloaded configuration will reflect the <strong>currently deployed version</strong>, not your local changes.</div>
        <div>To include your changes in the configuration:</div>
        <ol style="margin-top: 8px; margin-left: 20px; list-style-type: decimal;">
          <li>Click "Resume" to deploy your changes</li>
          <li>Wait for the pipeline to become active</li>
          <li>Download the configuration</li>
        </ol>
      </div>`,okButtonText:"Download Anyway",cancelButtonText:"Cancel",onComplete:a=>{a===m.i.YES?b():c()},criticalOperation:!1})};var o=c(75580),p=c(16389),q=c(64708),r=c(78864),s=c(5862);let t={src:"/_next/static/media/play.01cbd0f0.svg",height:16,width:17,blurWidth:0,blurHeight:0},u={src:"/_next/static/media/edit.0bcb30f5.svg",height:16,width:16,blurWidth:0,blurHeight:0};var v=c(9119),w=c(1733),x=c(49679),y=c(29001),z=c(53061),A=c(48661),B=c(92940),C=c(24022),D=c(84621);let E=function({pipeline:a,onPipelineUpdate:b,onPipelineDeleted:m,actions:E,showHeader:F=!0}){let[G,H]=(0,e.useState)(null),[I,J]=(0,e.useState)(!1),[K,L]=(0,e.useState)(!1),M=(0,e.useRef)(null),{coreStore:N}=(0,q.useStore)(),O=(0,B.Tu)(a.pipeline_id),P=(0,B.c7)();(0,B.qs)([a.pipeline_id]);let Q=O||a.status||"active",R="pausing"===Q||"stopping"===Q||"resuming"===Q,{health:S,isLoading:T,error:U}=(0,p.O)({pipelineId:a.pipeline_id,enabled:!R,pollingInterval:5e3,stopOnStatuses:["Running","Terminated","Failed"],maxRetries:2,onStatusChange:(b,c)=>{console.log(`Pipeline ${a.pipeline_id} health status changed: ${c} → ${b}`)},onError:b=>{console.error(`Pipeline ${a.pipeline_id} health check error:`,b)}}),V={...a,status:Q},{actionState:W,executeAction:X,getActionConfiguration:Y,getButtonText:Z,isActionDisabled:$,shouldShowModal:_,clearError:aa}=(0,o.z)(V),ab=async d=>{if(!Y(d).isDisabled)if(_(d))H(d);else try{if("stop"===d)P.reportStop(a.pipeline_id);else if("resume"===d){let{coreStore:b}=q.useStore.getState();if(b.isDirty){let{generateApiConfig:a}=await Promise.resolve().then(c.bind(c,4673)),{kafkaStore:d,topicsStore:e,clickhouseConnectionStore:f,clickhouseDestinationStore:g,joinStore:h,deduplicationStore:i}=q.useStore.getState(),j=a({pipelineId:b.pipelineId,pipelineName:b.pipelineName,setPipelineId:b.setPipelineId,clickhouseConnection:f.clickhouseConnection,clickhouseDestination:g.clickhouseDestination,selectedTopics:Object.values(e.topics||{}),getMappingType:(a,b)=>{let c=b.find(b=>b.eventField===a);return c?c.jsonType:"string"},joinStore:h,kafkaStore:d,deduplicationStore:i});await X("edit",j),b.markAsClean()}P.reportResume(a.pipeline_id)}else"terminate"===d?P.reportTerminate(a.pipeline_id):"delete"===d&&(P.reportDelete(a.pipeline_id),m?.());let e=await X(d);e&&b&&b(e),M.current={action:d,timestamp:Date.now()}}catch(b){if("stop"===d)P.revertOptimisticUpdate(a.pipeline_id,"active");else if("resume"===d)P.revertOptimisticUpdate(a.pipeline_id,"stopped");else if("terminate"===d){let b=a.status||"active";P.revertOptimisticUpdate(a.pipeline_id,b)}else if("delete"===d){let b=a.status||"active";P.revertOptimisticUpdate(a.pipeline_id,b)}}},ac=async()=>{if(N.isDirty)return void L(!0);await ad()},ad=async()=>{try{await (0,C.Tt)(a),L(!1)}catch(a){console.error("Failed to download pipeline configuration:",a)}},ae=async(c,d)=>{try{"stop"===c?P.reportStop(a.pipeline_id):"resume"===c?P.reportResume(a.pipeline_id):"terminate"===c?P.reportTerminate(a.pipeline_id):"delete"===c&&P.reportDelete(a.pipeline_id),H(null);let e=await X(c,d);if("delete"===c)m?.();else if(e&&b)b(e);else if("rename"===c&&b){let c={...a,name:d?.name||a.name};b(c)}M.current={action:c,timestamp:Date.now()}}catch(b){if("stop"===c)P.revertOptimisticUpdate(a.pipeline_id,"active");else if("resume"===c)P.revertOptimisticUpdate(a.pipeline_id,"stopped");else if("terminate"===c){let b=a.status||"active";P.revertOptimisticUpdate(a.pipeline_id,b)}}},af=()=>{H(null),aa()},ag=async()=>{try{await navigator.clipboard.writeText(a.pipeline_id),J(!0),setTimeout(()=>J(!1),2e3)}catch(c){let b=document.createElement("textarea");b.value=a.pipeline_id,document.body.appendChild(b),b.select();try{document.execCommand("copy"),J(!0),setTimeout(()=>J(!1),2e3)}catch(a){console.error("Fallback copy failed:",a)}document.body.removeChild(b)}},ah=a=>{let b=Y(a),c=Z(a),e=$(a);return(0,d.jsx)(f.$,{variant:"outline",onClick:()=>ab(a),disabled:e,className:`group ${"resume"===a?"btn-primary":"btn-action"}`,title:b.disabledReason,children:W.isLoading&&W.lastAction===a?(0,d.jsxs)("span",{className:"flex items-center gap-3",children:[(0,d.jsx)(r.default,{src:s.A,alt:"Loading",width:16,height:16,className:"animate-spin"}),"Loading..."]}):(0,d.jsxs)("div",{className:"flex items-center gap-3",children:["resume"===a&&(0,d.jsx)(r.default,{src:t,alt:"Start",width:16,height:16,className:"filter brightness-100 group-hover:brightness-0"}),"stop"===a&&(0,d.jsx)(r.default,{src:z.A,alt:"Stop",width:16,height:16,className:"filter brightness-100 group-hover:brightness-0"}),"rename"===a&&(0,d.jsx)(r.default,{src:v.A,alt:"Rename",width:16,height:16,className:"filter brightness-100 group-hover:brightness-0"}),"terminate"===a&&(0,d.jsx)(r.default,{src:x.A,alt:"Terminate",width:16,height:16,className:"filter brightness-100 group-hover:brightness-0"}),"delete"===a&&(0,d.jsx)(r.default,{src:w.A,alt:"Delete",width:16,height:16,className:"filter brightness-100 group-hover:brightness-0"}),"edit"===a&&(0,d.jsx)(r.default,{src:u,alt:"Edit",width:16,height:16,className:"filter brightness-0 group-hover:brightness-0"}),c]})},a)};return(0,d.jsxs)("div",{className:(0,D.cn)("flex flex-col gap-4 transition-all duration-750 ease-out",F?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:[(0,d.jsx)(h.Zp,{className:"border-[var(--color-border-neutral)] radius-large py-2 px-6 mb-4",children:(0,d.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,d.jsxs)("div",{className:"flex flex-row justify-between gap-2",children:[(0,d.jsxs)("div",{className:"flex flex-row flex-start gap-2 items-center",children:[W.isLoading&&(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(r.default,{src:s.A,alt:"Loading",width:24,height:24,className:"animate-spin"}),(0,d.jsxs)("span",{className:"text-sm text-blue-600 font-medium",children:["stop"===W.lastAction&&"Stopping pipeline...","resume"===W.lastAction&&"Resuming pipeline...","terminate"===W.lastAction&&"Terminating pipeline...","delete"===W.lastAction&&"Deleting pipeline...","rename"===W.lastAction&&"Renaming pipeline...","edit"===W.lastAction&&"Updating pipeline..."]})]}),(0,d.jsx)("h2",{className:"text-2xl font-bold",children:a.name}),(0,d.jsx)(g.E,{variant:(a=>{let b=Q,c=M.current,d=c&&Date.now()-c.timestamp<5e3;if(!O&&S?.overall_status&&!W.isLoading&&!d&&("active"===a||!a||"no_configuration"===a)){let c=(0,A.U)(S.overall_status);("active"!==c||"no_configuration"===a)&&(b=c)}switch(b){case"active":return"success";case"paused":case"pausing":case"resuming":case"stopping":case"terminating":return"warning";case"stopped":case"terminated":return"secondary";case"failed":return"error";default:return"default"}})(Q),className:"rounded-xl my-2 mx-4",children:T&&!O?"Checking...":(a=>{let b=Q,c=M.current,d=c&&Date.now()-c.timestamp<5e3;if(!O&&S?.overall_status&&!W.isLoading&&!d&&("active"===a||!a||"no_configuration"===a)){let c=(0,A.U)(S.overall_status);("active"!==c||"no_configuration"===a)&&(b=c)}switch(b){case"active":return"Active";case"pausing":return"Pausing...";case"paused":return"Paused";case"resuming":return"Resuming...";case"stopping":return"Stopping...";case"stopped":return"Stopped";case"terminating":return"Terminating...";case"terminated":return"Terminated";case"failed":return"Failed";default:return"Unknown status"}})(Q)}),U&&(0,d.jsx)(g.E,{variant:"destructive",className:"ml-2",children:"Health Error"}),W.error&&(0,d.jsx)(g.E,{variant:"destructive",className:"ml-2",children:W.error})]}),(0,d.jsx)("div",{className:"flex flex-row flex-end gap-2",children:E||(()=>{let a="active"===Q||"stopping"===Q,b="stopped"===Q||"terminated"===Q,c="stopped"!==Q&&"terminated"!==Q&&"terminating"!==Q,e="stopped"===Q||"terminated"===Q,h=!Y("rename").isDisabled;return(0,d.jsxs)(d.Fragment,{children:[b&&ah("resume"),h&&ah("rename"),c&&ah("terminate"),e&&ah("delete"),a&&ah("stop"),(0,d.jsxs)(f.$,{variant:"outline",onClick:()=>ac(),disabled:!1,className:"group btn-action relative",title:N.isDirty?"Unsaved changes will not be included in downloaded config":"Download configuration",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)(r.default,{src:y.A,alt:"Download",width:16,height:16,className:"filter brightness-100 group-hover:brightness-0"}),N.isDirty&&(0,d.jsx)(g.E,{variant:"warning",className:"ml-1 px-1.5 py-0.5 text-[10px] leading-none",title:"Unsaved changes",children:"⚠️"})]}),"Download config"]},"download")]})})()})]}),(0,d.jsx)("div",{className:"flex flex-start items-center gap-1 text-sm text-muted-foreground",children:a.pipeline_id?(0,d.jsxs)("div",{className:"group flex items-center gap-1",children:[(0,d.jsxs)("span",{className:"cursor-pointer hover:text-foreground transition-colors",onClick:ag,title:"Click to copy pipeline ID",children:["Pipeline ID: ",a.pipeline_id]}),(0,d.jsx)(i,{className:"h-3 w-3 opacity-0 group-hover:opacity-100 transition-opacity"}),I&&(0,d.jsx)(g.E,{variant:"secondary",className:"ml-2 h-6 w-18 text-sm",children:"Copied"})]}):(0,d.jsx)("span",{children:"Pipeline ID: None"})})]})}),(0,d.jsx)(j.A,{visible:"terminate"===G,onOk:()=>{ae("terminate",{graceful:!1})},onCancel:af}),(0,d.jsx)(k.A,{visible:"rename"===G,currentName:a.name,onOk:a=>{ae("rename",{name:a})},onCancel:af}),(0,d.jsx)(n,{visible:K,onOk:ad,onCancel:()=>{L(!1)}}),(0,d.jsx)(l.A,{visible:"stop"===G,onOk:()=>{ae("stop")},onCancel:af})]})},F={src:"/_next/static/media/dlq2.e07001e3.svg",height:24,width:24,blurWidth:0,blurHeight:0},G={src:"/_next/static/media/maximize-2.175afa19.svg",height:20,width:20,blurWidth:0,blurHeight:0},H={src:"/_next/static/media/minimize-2.5855f4dc.svg",height:20,width:20,blurWidth:0,blurHeight:0};var I=c(54299);let J={totalDlq:"0",lastEventReceived:"-",unconsumedEvents:"0",lastConsumedAt:"-"},K=function({pipelineId:a}){let[b,c]=(0,e.useState)(!1),[f,g]=(0,e.useState)(J),[i,j]=(0,e.useState)(!0),[k,l]=(0,e.useState)(null),[m,n]=(0,e.useState)(!1),o=(0,e.useRef)(null),[p,q]=(0,e.useState)(0);return i?(0,d.jsx)(h.Zp,{className:"border-[var(--color-border-neutral)] radius-large py-4 px-6 mb-4 w-full",children:(0,d.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,d.jsxs)("div",{className:"flex flex-row justify-between gap-2 items-center",children:[(0,d.jsxs)("div",{className:"flex flex-start flex-row gap-2 items-center",children:[(0,d.jsx)(r.default,{src:F,alt:"Dead Letter Queue",className:"w-6 h-6",width:24,height:24}),(0,d.jsx)("h3",{className:"text-lg font-bold",children:"Dead Letter Queue"})]}),(0,d.jsx)("div",{className:"w-6 h-6"})," "]}),(0,d.jsx)("div",{className:"text-sm text-muted-foreground animate-pulse",children:"Loading DLQ data..."})]})}):k?(0,d.jsx)(h.Zp,{className:"border-[var(--color-border-neutral)] radius-large py-4 px-6 mb-4 w-full",children:(0,d.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,d.jsxs)("div",{className:"flex flex-row justify-between gap-2 items-center",children:[(0,d.jsxs)("div",{className:"flex flex-start flex-row gap-2 items-center",children:[(0,d.jsx)(r.default,{src:F,alt:"Dead Letter Queue",className:"w-6 h-6",width:24,height:24}),(0,d.jsx)("h3",{className:"text-lg font-bold",children:"Dead Letter Queue"})]}),(0,d.jsx)("div",{className:"w-6 h-6"})," "]}),(0,d.jsxs)("div",{className:"text-sm text-muted-foreground animate-fadeIn",children:["Missing DLQ data: ",k]})]})}):(0,d.jsx)(h.Zp,{className:"border-[var(--color-border-neutral)] radius-large py-4 px-6 mb-4 w-full",children:(0,d.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,d.jsxs)("div",{className:"flex flex-row justify-between gap-2 items-center",children:[(0,d.jsxs)("div",{className:"flex flex-start flex-row gap-2 items-center",children:[(0,d.jsx)(r.default,{src:F,alt:"Dead Letter Queue",className:"w-6 h-6",width:24,height:24}),(0,d.jsx)("h3",{className:"text-lg font-bold",children:"Dead Letter Queue"})]}),(0,d.jsx)(r.default,{src:b?H:G,alt:"Toggle expand",className:`w-6 h-6 cursor-pointer transition-transform duration-200 hover:scale-110 ${m?"animate-pulse":""}`,width:24,height:24,onClick:()=>{n(!0),c(!b),setTimeout(()=>{n(!1)},300)}})]}),(0,d.jsx)("div",{className:"transition-all duration-300 ease-out",style:{maxHeight:b?`${p}px`:"40px",opacity:i?.7:1,overflow:"hidden"},children:(0,d.jsx)("div",{ref:o,className:"pb-1",children:b?(0,d.jsx)("div",{className:"animate-fadeIn",children:(({totalDlq:a,lastEventReceived:b,unconsumedEvents:c,lastConsumedAt:e})=>(0,d.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("span",{className:"text-md font-bold",children:a}),(0,d.jsx)("span",{className:"text-sm font-normal text-[var(--color-foreground-neutral-faded)]",children:"Total events in DLQ"})]}),(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("span",{className:"text-md font-bold",children:b}),(0,d.jsx)("span",{className:"text-sm font-normal text-[var(--color-foreground-neutral-faded)]",children:"Last event received"})]}),(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("span",{className:"text-md font-bold",children:c}),(0,d.jsx)("span",{className:"text-sm font-normal text-[var(--color-foreground-neutral-faded)]",children:"Unconsumed events"})]}),(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("span",{className:"text-md font-bold",children:e}),(0,d.jsx)("span",{className:"text-sm font-normal text-[var(--color-foreground-neutral-faded)]",children:"Last consumed at"})]})]}))(f)}):(0,d.jsx)("div",{className:"animate-fadeIn",children:(({unconsumedEvents:a})=>(0,d.jsx)("div",{className:"flex flex-row gap-2 items-center",children:(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500"}),(0,d.jsx)("span",{className:"text-md font-bold",children:a}),(0,d.jsx)("span",{className:"text-sm font-normal",children:"Unconsumed events"})]})}))({unconsumedEvents:f.unconsumedEvents})})})})]})})},L={src:"/_next/static/media/clickhouse.9d6c8bc7.svg",height:20,width:21,blurWidth:0,blurHeight:0},M={rowCount:"0",insertRateRows:"0 rows/sec",insertRateBytes:"0 B/sec",latencyP50:"0ms",latencyP95:"0ms",tableSize:"0B",queryMemory:"0B",activeQueries:"0",failedInserts:"0",lastUpdated:"-"},N=function({pipeline:a}){let[b,c]=(0,e.useState)(!1),[f,g]=(0,e.useState)(M),[i,j]=(0,e.useState)(null),[k,l]=(0,e.useState)(!0),[m,n]=(0,e.useState)(null),[o,p]=(0,e.useState)(!1),q=(0,e.useRef)(null),[s,t]=(0,e.useState)(0),[u,v]=(0,e.useState)(new Date);return k?(0,d.jsx)(h.Zp,{className:"border-[var(--color-border-neutral)] radius-large py-4 px-6 mb-4 w-full",children:(0,d.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,d.jsxs)("div",{className:"flex flex-row justify-between gap-2 items-center",children:[(0,d.jsxs)("div",{className:"flex flex-start flex-row gap-2 items-center",children:[(0,d.jsx)(r.default,{src:L,alt:"ClickHouse Table Metrics",className:"w-6 h-6",width:24,height:24}),(0,d.jsx)("h3",{className:"text-lg font-bold",children:"ClickHouse Table Metrics"})]}),(0,d.jsx)("div",{className:"w-6 h-6"})," "]}),(0,d.jsx)("div",{className:"text-sm text-muted-foreground animate-pulse",children:"Loading ClickHouse metrics..."})]})}):m?(0,d.jsx)(h.Zp,{className:"border-[var(--color-border-neutral)] radius-large py-4 px-6 mb-4 w-full",children:(0,d.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,d.jsxs)("div",{className:"flex flex-row justify-between gap-2 items-center",children:[(0,d.jsxs)("div",{className:"flex flex-start flex-row gap-2 items-center",children:[(0,d.jsx)(r.default,{src:L,alt:"ClickHouse Table Metrics",className:"w-6 h-6",width:24,height:24}),(0,d.jsx)("h3",{className:"text-lg font-bold",children:"ClickHouse Table Metrics"})]}),(0,d.jsx)("div",{className:"w-6 h-6"})," "]}),(0,d.jsxs)("div",{className:"text-sm text-muted-foreground animate-fadeIn",children:["Missing ClickHouse metrics: ",m]})]})}):(0,d.jsx)(h.Zp,{className:"border-[var(--color-border-neutral)] radius-large py-4 px-6 mb-4 w-full",children:(0,d.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,d.jsxs)("div",{className:"flex flex-row justify-between gap-2 items-center",children:[(0,d.jsxs)("div",{className:"flex flex-start flex-row gap-2 items-center",children:[(0,d.jsx)(r.default,{src:L,alt:"ClickHouse Table Metrics",className:"w-6 h-6",width:24,height:24}),(0,d.jsx)("h3",{className:"text-lg font-bold",children:"ClickHouse Table Metrics"})]}),(0,d.jsx)(r.default,{src:b?H:G,alt:"Toggle expand",className:`w-6 h-6 cursor-pointer transition-transform duration-200 hover:scale-110 ${o?"animate-pulse":""}`,width:24,height:24,onClick:()=>{p(!0),c(!b),setTimeout(()=>{p(!1)},300)}})]}),(0,d.jsx)("div",{className:"transition-all duration-300 ease-out",style:{maxHeight:b?`${s}px`:"40px",opacity:k?.7:1,overflow:"hidden"},children:(0,d.jsx)("div",{ref:q,className:"pb-1",children:b?(0,d.jsx)("div",{className:"animate-fadeIn",children:(({rowCount:a,insertRateRows:b,insertRateBytes:c,latencyP50:e,latencyP95:f,tableSize:g,queryMemory:h,activeQueries:i,failedInserts:j,lastUpdated:k})=>(0,d.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("span",{className:"text-md font-bold",children:a}),(0,d.jsx)("span",{className:"text-sm font-normal text-[var(--color-foreground-neutral-faded)]",children:"Total rows"})]}),(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("span",{className:"text-md font-bold",children:b}),(0,d.jsx)("span",{className:"text-sm font-normal text-[var(--color-foreground-neutral-faded)]",children:"Insert rate (rows)"})]}),(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("span",{className:"text-md font-bold",children:c}),(0,d.jsx)("span",{className:"text-sm font-normal text-[var(--color-foreground-neutral-faded)]",children:"Insert rate (bytes)"})]}),(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("span",{className:"text-md font-bold",children:e}),(0,d.jsx)("span",{className:"text-sm font-normal text-[var(--color-foreground-neutral-faded)]",children:"Latency P50"})]}),(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("span",{className:"text-md font-bold",children:f}),(0,d.jsx)("span",{className:"text-sm font-normal text-[var(--color-foreground-neutral-faded)]",children:"Latency P95"})]}),(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("span",{className:"text-md font-bold",children:g}),(0,d.jsx)("span",{className:"text-sm font-normal text-[var(--color-foreground-neutral-faded)]",children:"Table size (disk)"})]}),(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("span",{className:"text-md font-bold",children:h}),(0,d.jsx)("span",{className:"text-sm font-normal text-[var(--color-foreground-neutral-faded)]",children:"Query memory"})]}),(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("span",{className:"text-md font-bold",children:i}),(0,d.jsx)("span",{className:"text-sm font-normal text-[var(--color-foreground-neutral-faded)]",children:"Active queries"})]}),(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("span",{className:"text-md font-bold",children:j}),(0,d.jsx)("span",{className:"text-sm font-normal text-[var(--color-foreground-neutral-faded)]",children:"Failed inserts (5min)"})]}),(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("span",{className:"text-md font-bold",children:k}),(0,d.jsx)("span",{className:"text-sm font-normal text-[var(--color-foreground-neutral-faded)]",children:"Last updated"})]})]}))(f)}):(0,d.jsx)("div",{className:"animate-fadeIn",children:(({rowCount:a,insertRateRows:b})=>(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),(0,d.jsx)("span",{className:"text-md font-bold",children:a}),(0,d.jsx)("span",{className:"text-sm font-normal",children:"rows"})]}),(0,d.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,d.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500"}),(0,d.jsx)("span",{className:"text-md font-bold",children:b})]})]}))({rowCount:f.rowCount,insertRateRows:f.insertRateRows})})})})]})})},O=function({pipeline:a,showStatusOverview:b}){return(0,d.jsx)("div",{className:(0,D.cn)("flex flex-col gap-4 transition-all duration-750 ease-out",b?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:(0,d.jsx)(h.Zp,{className:"py-0 px-0 mb-4 border-none",children:(0,d.jsxs)("div",{className:"flex flex-row gap-4 items-start",children:[(0,d.jsx)(K,{pipelineId:a.pipeline_id}),(0,d.jsx)(N,{pipeline:a})]})})})},P=function({label:a,value:b,orientation:c="center",width:e="half",onClick:f,disabled:g,validation:i,selected:j}){return(0,d.jsx)(h.Zp,{className:(0,D.cn)("border-[var(--color-border-neutral)] radius-large p-4","full"===e?"w-full":"w-1/2",g?"opacity-50 cursor-not-allowed":"",i?.status==="invalidated"&&"border-red-500",j&&"border-primary"),onClick:f,children:(0,d.jsx)("div",{className:`flex flex-col gap-4 ${"left"===c?"items-start":"right"===c?"items-end":"items-center"}`,children:(0,d.jsxs)("div",{className:`flex flex-col gap-2 ${"left"===c?"text-left":"right"===c?"text-right":"text-center"}`,children:[(0,d.jsx)("span",{className:"text-lg font-bold text-[var(--color-foreground-neutral-faded)]",children:a[0]}),(0,d.jsx)("span",{className:"text-sm font-normal",children:b[0]}),a[1]&&(0,d.jsx)("span",{className:"text-lg font-bold text-[var(--color-foreground-neutral-faded)]",children:a[1]}),b[1]&&(0,d.jsx)("span",{className:"text-sm font-normal",children:b[1]})]})})})},Q=function({label:a,value:b,width:c="half",onClick:e,disabled:f,validation:g,selected:i}){return(0,d.jsx)(h.Zp,{className:(0,D.cn)("border-[var(--color-border-neutral)] radius-large p-4","full"===c?"w-full":"w-1/2",f?"opacity-50 cursor-not-allowed":"",g?.topicsValidation?.status==="invalidated"||g?.joinValidation?.status==="invalidated"||g?.deduplicationValidation?.status==="invalidated"||g?.clickhouseDestinationValidation?.status==="invalidated"||g?.status==="invalidated"?"border-red-500":"",i&&"border-primary"),onClick:e,children:(0,d.jsxs)("div",{className:"flex flex-row justify-between gap-4",children:[(0,d.jsxs)("div",{className:"flex flex-col gap-2 text-left",children:[(0,d.jsx)("span",{className:"text-lg font-bold text-[var(--color-foreground-neutral-faded)]",children:a[0]}),(0,d.jsx)("span",{className:"text-sm font-normal",children:b[0]})]}),(0,d.jsxs)("div",{className:"flex flex-col gap-2 text-right",children:[(0,d.jsx)("span",{className:"text-lg font-bold text-[var(--color-foreground-neutral-faded)]",children:a[1]}),(0,d.jsx)("span",{className:"text-sm font-normal",children:b[1]})]})]})})};var R=c(65357);let S=({topic:a,hasDedup:b,destinationTable:c,totalSourceFields:e,totalDestinationColumns:f,onStepClick:g,disabled:h,validation:i,activeStep:j})=>(0,d.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,d.jsx)(P,{label:["Topic"],value:[a.name],orientation:"center",width:"full",onClick:()=>g(R.Fn.TOPIC_SELECTION_1),disabled:h,validation:i,selected:j===R.Fn.TOPIC_SELECTION_1}),b&&(()=>{let a=q.useStore.getState().deduplicationStore.getDeduplication(0);return(0,d.jsx)(P,{label:["Deduplication Key"],value:[a?.key||"N/A"],orientation:"center",width:"full",onClick:()=>g(R.Fn.DEDUPLICATION_CONFIGURATOR),disabled:h,validation:i.deduplicationValidation,selected:j===R.Fn.DEDUPLICATION_CONFIGURATOR})})(),(0,d.jsx)(Q,{label:["Destination Table","Schema Mapping"],value:[c,`${e} fields → ${f} columns`],width:"full",onClick:()=>g(R.Fn.CLICKHOUSE_MAPPER),disabled:h,validation:i,selected:j===R.Fn.CLICKHOUSE_MAPPER})]}),T=({leftTopic:a,rightTopic:b,leftSource:c,rightSource:e,destinationTable:f,totalSourceFields:g,totalDestinationColumns:h,onStepClick:i,disabled:j,validation:k,activeStep:l})=>(0,d.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,d.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,d.jsx)(P,{label:["Left Topic"],orientation:"left",value:[a?.name||"N/A"],width:"full",onClick:()=>i(R.Fn.TOPIC_SELECTION_1),disabled:j,validation:k.topicsValidation,selected:l===R.Fn.TOPIC_SELECTION_1}),(0,d.jsx)(P,{label:["Right Topic"],orientation:"right",value:[b?.name||"N/A"],width:"full",onClick:()=>i(R.Fn.TOPIC_SELECTION_2),disabled:j,validation:k.topicsValidation,selected:l===R.Fn.TOPIC_SELECTION_2})]}),(0,d.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,d.jsx)(P,{label:["Left Join Key"],orientation:"left",value:[c?.join_key||"N/A"],width:"full",onClick:()=>i(R.Fn.JOIN_CONFIGURATOR),disabled:j,selected:l===R.Fn.JOIN_CONFIGURATOR}),(0,d.jsx)(P,{label:["Right Join Key"],orientation:"right",value:[e?.join_key||"N/A"],width:"full",onClick:()=>i(R.Fn.JOIN_CONFIGURATOR),disabled:j,selected:l===R.Fn.JOIN_CONFIGURATOR})]}),(0,d.jsx)(Q,{label:["Destination Table","Schema Mapping"],value:[f,`${g} fields → ${h} columns`],width:"full",onClick:()=>i(R.Fn.CLICKHOUSE_MAPPER),disabled:j,validation:k,selected:l===R.Fn.CLICKHOUSE_MAPPER})]}),U=({leftTopic:a,rightTopic:b,leftSource:c,rightSource:e,destinationTable:f,totalSourceFields:g,totalDestinationColumns:h,onStepClick:i,disabled:j,validation:k,activeStep:l})=>(0,d.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,d.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,d.jsx)(Q,{label:["Left Topic","Dedup Key"],value:[a?.name||"N/A",(()=>{let a=q.useStore.getState().deduplicationStore.getDeduplication(0);return a?.enabled?a.key:"None"})()],width:"full",onClick:()=>i(R.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_1),disabled:j,validation:k.topicsValidation,selected:l===R.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_1}),(0,d.jsx)(Q,{label:["Dedup Key","Right Topic"],value:[(()=>{let a=q.useStore.getState().deduplicationStore.getDeduplication(1);return a?.enabled?a.key:"None"})(),b?.name||"N/A"],width:"full",onClick:()=>i(R.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_2),disabled:j,validation:k.topicsValidation,selected:l===R.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_2})]}),(0,d.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,d.jsx)(P,{label:["Left Join Key"],orientation:"left",value:[c?.join_key||"N/A"],width:"full",onClick:()=>i(R.Fn.JOIN_CONFIGURATOR),disabled:j,validation:k.joinValidation,selected:l===R.Fn.JOIN_CONFIGURATOR}),(0,d.jsx)(P,{label:["Right Join Key"],orientation:"right",value:[e?.join_key||"N/A"],width:"full",onClick:()=>i(R.Fn.JOIN_CONFIGURATOR),disabled:j,validation:k.joinValidation,selected:l===R.Fn.JOIN_CONFIGURATOR})]}),(0,d.jsx)(Q,{label:["Destination Table","Schema Mapping"],value:[f,`${g} fields → ${h} columns`],width:"full",onClick:()=>i(R.Fn.CLICKHOUSE_MAPPER),disabled:j,validation:k.clickhouseDestinationValidation,selected:l===R.Fn.CLICKHOUSE_MAPPER})]}),V=function({pipeline:a,onStepClick:b,disabled:c,validation:e,activeStep:f}){let{topicsStore:g,joinStore:h,clickhouseDestinationStore:i}=(0,q.useStore)(),j=Object.values(g.topics).map(a=>({name:a.name,deduplication:{enabled:!1}})),k=j.length>0?j:a?.source?.topics||[],l=!!(h.enabled&&(h.streams?.length||0)>0||a?.join?.enabled&&(a?.join?.sources?.length||0)>0),{deduplicationStore:m}=(0,q.useStore)(),n=m.getDeduplication(0),o=m.getDeduplication(1),p=k[0],r=k[1],s=(a,b)=>{let c=a?.enabled===!0||b?.deduplication?.enabled===!0,d=(a?.key||b?.deduplication?.id_field||"").trim();return c&&d.length>0},t=s(n,p),u=s(o,r),v=h.streams.map(a=>({source_id:a.topicName,join_key:a.joinKey,orientation:a.orientation}))||[],w=v.length>0?v:a?.join?.sources||[],x=i.clickhouseDestination.table,y=i.clickhouseDestination.mapping||[],z=x||a?.sink?.table||"N/A",B=y.length>0?y:a?.sink?.table_mapping||[],C=B.length,D=B.length,E=null;if(1!==k.length||l)if(k.length>1&&l&&!(t&&u)){let a=w.find(a=>"left"===a.orientation),g=w.find(a=>"right"===a.orientation),h=k.find(b=>b.name===a?.source_id),i=k.find(a=>a.name===g?.source_id);return(0,d.jsx)(T,{leftTopic:h,rightTopic:i,leftSource:a,rightSource:g,destinationTable:z,totalSourceFields:C,totalDestinationColumns:D,onStepClick:b,disabled:c,validation:e,activeStep:f})}else E=k.length>1&&l&&t&&u?(0,d.jsx)(U,{leftTopic:k[0],rightTopic:k[1],leftSource:w.find(a=>"left"===a.orientation),rightSource:w.find(a=>"right"===a.orientation),destinationTable:z,totalSourceFields:C,totalDestinationColumns:D,onStepClick:b,disabled:c,validation:e,activeStep:f}):(0,d.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,d.jsx)(P,{label:["Configuration"],value:[`${k.length} topic(s), Join: ${l?"Yes":"No"}`],orientation:"center",width:"full",disabled:c}),(0,d.jsx)(Q,{label:["Destination Table","Schema Mapping"],value:[z,`${C} fields → ${D} columns`],width:"full",disabled:c})]});else{let a=k[0],g=s(n,a);E=(0,d.jsx)(S,{topic:a,hasDedup:g,destinationTable:z,totalSourceFields:C,totalDestinationColumns:D,onStepClick:b,disabled:c,validation:e,activeStep:f})}return(0,d.jsxs)("div",{className:"flex flex-col gap-4 w-3/5",children:[(0,d.jsx)("div",{className:"text-center",children:(0,d.jsxs)("span",{className:"text-lg font-bold text-[var(--color-foreground-neutral-faded)]",children:["Transformation: ",(()=>{try{let b=q.useStore.getState(),c=!!(b.joinStore?.enabled&&(b.joinStore.streams?.length||0)>0||a?.join?.enabled&&(a?.join?.sources?.length||0)>0),d=b.deduplicationStore?.getDeduplication?.(0),e=b.deduplicationStore?.getDeduplication?.(1),f=a?.source?.topics?.[0],g=a?.source?.topics?.[1],h=(a,b)=>{let c=a?.enabled===!0||b?.deduplication?.enabled===!0,d=(a?.key||b?.deduplication?.id_field||"").trim();return c&&d.length>0},i=h(d,f),j=h(e,g);if(c&&i&&j)return"Join & Deduplication";if(c)return"Join";return(0,A.t)(a)}catch{return(0,A.t)(a)}})()]})}),E]})};c(63674),c(24294),c(8527),c(93862),c(65569),c(61127);let W=function({children:a,stepInfo:b,handleBack:c,onClose:e,isLoading:f=!1,loadingText:g="Processing..."}){return(0,d.jsxs)("div",{className:"mt-6 w-full bg-[var(--color-background-elevation-raised-faded-2)] border border-[var(--color-border-neutral)] rounded-xl animate-in fade-in slide-in-from-top-2 duration-300",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between p-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-xl font-semibold mb-2",children:b.title}),(0,d.jsx)("p",{className:"text-sm text-gray-600",children:b.description})]}),f&&(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(r.default,{src:s.A,alt:"Loading",width:16,height:16,className:"animate-spin"}),(0,d.jsx)("span",{className:"text-sm text-blue-600",children:g})]})]}),(0,d.jsx)("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:a})]})};var X=c(22317);function Y({isLoading:a,error:b,progress:c,onRetry:e,stepTitle:f}){return b?(0,d.jsx)("div",{className:"flex flex-col items-center justify-center py-8 px-4",children:(0,d.jsxs)("div",{className:"text-center max-w-md",children:[(0,d.jsxs)("p",{className:"text-red-500 text-sm mb-3",children:["Failed to load data for ",f,". ",b]}),(0,d.jsx)("button",{onClick:e,className:"text-blue-600 hover:text-blue-700 text-sm font-medium underline",children:"Try again"})]})}):a?(0,d.jsx)("div",{className:"flex flex-col items-center justify-center py-8 px-4",children:(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,d.jsx)(r.default,{src:s.A,alt:"Loading",width:20,height:20,className:"animate-spin"}),(0,d.jsx)("span",{className:"text-sm text-primary font-medium",children:"Loading..."})]})}):null}var Z=c(75299);let $=function({visible:a,onOk:b,onCancel:c,stepName:e}){let f=e?`You are about to edit the "${e}" configuration. This will pause the pipeline temporarily to allow editing. Any events currently in the queue will be processed before pausing, which may take some time.`:"You are about to edit this pipeline configuration. This will pause the pipeline temporarily to allow editing. Any events currently in the queue will be processed before pausing, which may take some time.";return(0,d.jsx)(m.R,{visible:a,title:"Edit Pipeline Configuration?",description:f,content:(0,d.jsx)("div",{className:"text-sm text-muted-foreground",children:"Are you sure you want to proceed with editing?"}),okButtonText:"Edit Configuration",cancelButtonText:"Cancel",onComplete:a=>{a===m.i.YES?b():c()}})},_=function({stepKey:a,onClose:b,pipeline:c,onPipelineStatusUpdate:f}){let{kafkaStore:g,clickhouseConnectionStore:h,clickhouseDestinationStore:i,coreStore:j}=(0,q.useStore)(),[k,l]=(0,e.useState)(null),[m,n]=(0,e.useState)({}),[p,r]=(0,e.useState)(!1),{enterEditMode:s,mode:t}=j,u=(0,B.Tu)(c?.pipeline_id),v=u||c?.status||"stopped",{executeAction:w,actionState:x}=(0,o.z)(c),{isEditConfirmationModalVisible:y,selectedPipeline:z,selectedStep:A,openEditConfirmationModal:C,closeEditConfirmationModal:D}=(0,Z.uv)(),E=function(a,b){let{topicsStore:c,kafkaStore:d}=(0,q.useStore)(),[f,g]=(0,e.useState)({isLoading:!1,isComplete:!1,error:null,progress:{current:0,total:0,description:""}}),h=(0,e.useRef)(null),i=(0,e.useRef)(!1),j=(0,e.useCallback)(a=>{let b=q.useStore.getState().topicsStore.topicCount;switch(a){case R.Fn.TOPIC_SELECTION_1:case R.Fn.TOPIC_SELECTION_2:return{needsTopicEvents:!0,topicIndices:[+(a!==R.Fn.TOPIC_SELECTION_1)],description:"Loading topic event data..."};case R.Fn.DEDUPLICATION_CONFIGURATOR:return{needsTopicEvents:!0,topicIndices:[0],description:"Loading event data for deduplication configuration..."};case R.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_1:return{needsTopicEvents:!0,topicIndices:[0],description:"Loading left topic event data..."};case R.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_2:return{needsTopicEvents:!0,topicIndices:[1],description:"Loading right topic event data..."};case R.Fn.JOIN_CONFIGURATOR:return{needsTopicEvents:!0,topicIndices:[0,1],description:"Loading event data for join configuration..."};case R.Fn.CLICKHOUSE_MAPPER:return{needsTopicEvents:!0,topicIndices:Array.from({length:b},(a,b)=>b),description:"Loading source data for schema mapping..."};case R.Fn.KAFKA_CONNECTION:case R.Fn.CLICKHOUSE_CONNECTION:default:return{needsTopicEvents:!1,topicIndices:[],description:""}}},[]),k=(0,e.useCallback)(async a=>{try{let{topicsStore:b,kafkaStore:c}=q.useStore.getState(),d=b.getTopic(a);if(!d||!d.name)return console.warn(`No topic configured at index ${a}`),!1;if(d.selectedEvent?.event)return console.log(`Event already available for topic ${d.name}`),!0;let e=await X.Y.fetchEvent(c,{topic:d.name,format:R.us.JSON,runConsumerFirst:!0,position:d.initialOffset});if(!e.success)throw Error(e.error||"Failed to fetch event");let f=e.data?.event||e.event;if(!f)return console.warn(`No event data received for topic: ${d.name}`),!1;let g={...d,selectedEvent:{...d.selectedEvent,event:f},events:[{event:f,topicIndex:a,position:d.initialOffset}]};return b.updateTopic(g),!0}catch(b){return console.error(`Failed to fetch event for topic at index ${a}:`,b),!1}},[]),l=(0,e.useCallback)(async()=>{if(i.current)return void console.log("Preloading already in progress, skipping");if(h.current===a&&f.isComplete)return void console.log("Step already preloaded, skipping");i.current=!0,h.current=a;try{let b=j(a);if(!b.needsTopicEvents||0===b.topicIndices.length)return void g({isLoading:!1,isComplete:!0,error:null,progress:{current:0,total:0,description:""}});g({isLoading:!0,isComplete:!1,error:null,progress:{current:0,total:b.topicIndices.length,description:b.description}});for(let a=0;a<b.topicIndices.length;a++){let c=b.topicIndices[a];if(g(c=>({...c,progress:{...c.progress,current:a,description:`${b.description} (${a+1}/${b.topicIndices.length})`}})),!await k(c)){let a=q.useStore.getState().topicsStore.getTopic(c),b=a?.name||`topic at index ${c}`;throw Error(`Failed to load event data for ${b}`)}}g({isLoading:!1,isComplete:!0,error:null,progress:{current:b.topicIndices.length,total:b.topicIndices.length,description:"Data loaded successfully"}})}catch(a){console.error("Preloading failed:",a),g({isLoading:!1,isComplete:!1,error:a instanceof Error?a.message:"Failed to load required data",progress:{current:0,total:0,description:""}})}finally{i.current=!1}},[a,j,k]),m=(0,e.useCallback)(()=>{console.log("Retrying preload..."),h.current=null,i.current=!1,l()},[l]);return{...f,retry:m}}(a,0),F=async()=>{if(z){D();try{await w("stop",{graceful:!0}),f?.("stopped"),await new Promise(a=>setTimeout(a,1e3)),r(!0),"edit"!==t?(console.log("[StandaloneStepRenderer] Entering edit mode after stopping pipeline"),s(c)):console.log("[StandaloneStepRenderer] Already in global edit mode after stopping, preserving existing changes")}catch(a){console.error("Failed to stop pipeline for editing:",a)}}};if(E.isLoading||E.error){let b=m[a];return(0,d.jsx)(Y,{isLoading:E.isLoading,error:E.error,progress:E.progress,onRetry:E.retry,stepTitle:b?.title||"Configuration Step"})}if(!E.isComplete||!a||!k||!m[k])return null;let G=m[k].component,H=m[k],I=a===R.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_1||a===R.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_2,J=a===R.Fn.TOPIC_SELECTION_1||a===R.Fn.TOPIC_SELECTION_2||a===R.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_1||a===R.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_2,K={steps:m,onCompleteStep:a=>{l(a)},validate:async()=>!0,standalone:!0,onCompleteStandaloneEditing:(a,c)=>{b()},readOnly:!p,toggleEditMode:()=>{console.log("handleToggleEditMode called",{pipelineStatus:c?.status,centralizedStatus:u,effectiveStatus:v,editMode:p}),"stopped"!==v&&"terminated"!==v||p?"active"!==v&&"paused"!==v||p?"stopping"===v||"pausing"===v||"resuming"===v||"terminating"===v?console.warn("Edit mode not available while pipeline is in transitional state:",v):(console.warn("Edit mode requested for pipeline status:",v),p||(r(!0),"edit"!==t?(console.log("[StandaloneStepRenderer] Entering edit mode for first time"),s(c)):console.log("[StandaloneStepRenderer] Already in global edit mode, preserving existing changes"))):C(c,m[a]):(r(!0),"edit"!==t?(console.log("[StandaloneStepRenderer] Entering edit mode for first time"),s(c)):console.log("[StandaloneStepRenderer] Already in global edit mode, preserving existing changes"))},pipelineActionState:x,pipeline:c},L=J?{...K,currentStep:a,enableDeduplication:I}:K;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(W,{stepInfo:H,handleBack:()=>{b()},onClose:b,isLoading:x.isLoading,loadingText:"stop"===x.lastAction?"Stopping pipeline for editing...":"resume"===x.lastAction?"Resuming pipeline...":"delete"===x.lastAction?"Deleting pipeline...":"rename"===x.lastAction?"Renaming pipeline...":"edit"===x.lastAction?"Saving pipeline configuration...":"Processing...",children:(0,d.jsx)(G,{...L})}),(0,d.jsx)($,{visible:y,onOk:F,onCancel:D,stepName:A?.title})]})};var aa=c(84135),ab=c(99927);let ac=function({title:a,children:b,onClick:c,isClickable:e=!1,disabled:f=!1,validation:g,selected:i=!1}){return(0,d.jsx)(h.Zp,{className:(0,D.cn)("border-[var(--color-border-neutral)] radius-large p-6 h-48 flex flex-col items-center justify-center",e&&"cursor-pointer transition-all duration-200 hover:shadow-md hover:border-gray-300 hover:scale-[1.02]",f&&"opacity-50 cursor-not-allowed",g?.status==="invalidated"&&"border-red-500",i&&"border-primary"),onClick:()=>{f||c?.()},children:(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[(0,d.jsx)("div",{className:"flex items-center justify-center",children:b}),(0,d.jsx)("h3",{className:"text-lg font-bold text-center text-[var(--color-foreground-neutral-faded)]","text-":!0,children:a}),e&&(0,d.jsx)("p",{className:"text-sm text-gray-500 text-center",children:"Click to edit"})]})})},ad={src:"/_next/static/media/kafka.90a38d70.svg",height:20,width:20,blurWidth:0,blurHeight:0};function ae({disabled:a,selected:b,onStepClick:c}){let e=(0,q.useStore)(a=>a.kafkaStore.validation);return(0,d.jsxs)("div",{className:"flex flex-col gap-4 w-1/5",children:[(0,d.jsx)("div",{className:"text-center",children:(0,d.jsx)("span",{className:"text-lg font-bold",children:"Source"})}),(0,d.jsx)(ac,{validation:e,title:"Kafka",onClick:()=>c(R.Fn.KAFKA_CONNECTION),disabled:a,selected:b,children:(0,d.jsx)(r.default,{src:ad,alt:"Kafka",className:"w-8 h-8",width:32,height:32})})]})}function af({disabled:a,selected:b,onStepClick:c}){let e=(0,q.useStore)(a=>a.clickhouseConnectionStore.validation);return(0,d.jsxs)("div",{className:"flex flex-col gap-4 w-1/5",children:[(0,d.jsx)("div",{className:"text-center",children:(0,d.jsx)("span",{className:"text-lg font-bold",children:"Sink"})}),(0,d.jsx)(ac,{validation:e,title:"ClickHouse",onClick:()=>c(R.Fn.CLICKHOUSE_CONNECTION),disabled:a,selected:b,children:(0,d.jsx)(r.default,{src:L,alt:"ClickHouse",className:"w-8 h-8",width:32,height:32})})]})}let ag=function({pipeline:a}){let b=(0,aa.useRouter)(),[c,f]=(0,e.useState)(a),[g,h]=(0,e.useState)(null),[i,j]=(0,e.useState)(!1),[k,l]=(0,e.useState)(!1),[m,n]=(0,e.useState)(!1),{actionState:p}=(0,o.z)(c);(0,B.c7)();let r=(0,q.useStore)(a=>a.kafkaStore.validation),s=(0,q.useStore)(a=>a.clickhouseConnectionStore.validation),t=(0,q.useStore)(a=>a.clickhouseDestinationStore.validation),u=(0,q.useStore)(a=>a.joinStore.validation),v=(0,q.useStore)(a=>a.topicsStore.validation),w=(0,q.useStore)(a=>a.deduplicationStore.validation),{coreStore:x}=(0,q.useStore)(),{enterViewMode:y,mode:z}=x,A=(0,ab.rT)(c.status)||p.isLoading;(0,e.useCallback)(async()=>{try{let a=await (0,I.B0)(c.pipeline_id);f(a)}catch(a){console.error("Failed to refresh pipeline data:",a)}},[c.pipeline_id,c.status]);let C=a=>{A||h(a)},F=new Set([R.Fn.KAFKA_CONNECTION]);R.Fn.TOPIC_SELECTION_1,R.Fn.TOPIC_SELECTION_2,R.Fn.DEDUPLICATION_CONFIGURATOR,R.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_1,R.Fn.TOPIC_DEDUPLICATION_CONFIGURATOR_2,R.Fn.JOIN_CONFIGURATOR,R.Fn.CLICKHOUSE_MAPPER;let G=new Set([R.Fn.CLICKHOUSE_CONNECTION]),H=!!g&&F.has(g),J=!!g&&G.has(g);return(0,d.jsxs)("div",{children:[(0,d.jsx)(E,{pipeline:c,onPipelineUpdate:a=>{f(a)},onPipelineDeleted:()=>{b.push("/pipelines")},showHeader:i}),(0,d.jsx)(O,{pipeline:c,showStatusOverview:k}),(0,d.jsxs)("div",{className:(0,D.cn)("flex flex-row gap-4 items-stretch transition-all duration-750 ease-out",m?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:[(0,d.jsx)(ae,{disabled:A,selected:H,onStepClick:C}),(0,d.jsx)(V,{pipeline:c,onStepClick:C,disabled:A,validation:{kafkaValidation:r,topicsValidation:v,joinValidation:u,deduplicationValidation:w,clickhouseConnectionValidation:s,clickhouseDestinationValidation:t},activeStep:g}),(0,d.jsx)(af,{disabled:A,selected:J,onStepClick:C})]}),g&&(0,d.jsx)(_,{stepKey:g,onClose:()=>{h(null)},pipeline:c,onPipelineStatusUpdate:a=>{f(b=>({...b,status:a}))}})]})}},52761:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>k});var d=c(81367),e=c(14215),f=c(12906),g=c(6391);let h=async a=>{try{let b=(0,f.e9)(`pipeline/${a}`),c=(0,f.e9)(`pipeline/${a}/health`),[d,e]=await Promise.all([fetch(b),fetch(c)]);if(d.ok){let a=await d.json();if(a?.success===!0){let b=a.pipeline,c="active";if(e.ok)try{let a=await e.json();a?.overall_status&&(c=(0,g.U)(a.overall_status))}catch(a){console.warn("Failed to parse health data:",a)}return b.status=c,b}if(a&&"object"==typeof a&&a.pipeline_id){let b="active";if(e.ok)try{let a=await e.json();a?.overall_status&&(b=(0,g.U)(a.overall_status))}catch(a){console.warn("Failed to parse health data:",a)}return a.status=b,a}throw{code:d.status,message:a?.error||"Failed to fetch pipeline"}}throw{code:d.status,message:"Failed to fetch pipeline"}}catch(b){try{let[b,c]=await Promise.all([fetch(`/ui-api/mock/pipeline/${a}`),fetch(`/ui-api/mock/pipeline/${a}/health`)]),d=await b.json();if(b.ok&&d?.success===!0){let a=d.pipeline,b="active";if(c.ok)try{let a=await c.json();a?.health?.overall_status&&(b=(0,g.U)(a.health.overall_status))}catch(a){console.warn("Failed to parse mock health data:",a)}return a.status=b,a}throw{code:b.status,message:d?.error||"Failed to fetch pipeline (mock)"}}catch(a){if(b.code)throw b;throw{code:500,message:b.message||"Failed to fetch pipeline"}}}};var i=c(18413),j=c(40668);let k=async function({params:a,searchParams:b}){let c=await a,g=await b,{id:k}=c;if((0,f.O_)()||g?.deployment==="progress")return(0,d.jsx)(i.default,{pipelineId:k});try{let a=await h(k);return(0,d.jsx)(e.default,{pipeline:a})}catch(a){if(console.error("Failed to fetch pipeline during SSR:",a),a?.code===404)return(0,d.jsx)(j.PipelineNotFound,{pipelineId:k});return(0,d.jsx)(i.default,{pipelineId:k})}}},55330:(a,b,c)=>{Promise.resolve().then(c.bind(c,91529)),Promise.resolve().then(c.bind(c,51884)),Promise.resolve().then(c.bind(c,3994))},55511:a=>{"use strict";a.exports=require("crypto")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},91529:(a,b,c)=>{"use strict";c.d(b,{default:()=>w});var d=c(48477),e=c(48296),f=c(84135),g=c(54299),h=c(51884),i=c(19677),j=c(16389),k=c(84621);let l={src:"/_next/static/media/icon-check-green.052d5738.svg",height:11,width:16,blurWidth:0,blurHeight:0},m={src:"/_next/static/media/icon-x-red.c87d8f17.svg",height:12,width:12,blurWidth:0,blurHeight:0};var n=c(78864),o=c(5862);let p=({label:a})=>(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("div",{className:"flex-shrink-0 w-5 h-5 flex items-center justify-center",children:(0,d.jsx)(n.default,{src:l,alt:"Success",width:16,height:16})}),(0,d.jsx)("span",{className:"text-sm",children:a})]}),q=({label:a})=>(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("div",{className:"flex-shrink-0 w-5 h-5 flex items-center justify-center",children:(0,d.jsx)(n.default,{src:m,alt:"Failed",width:16,height:16})}),(0,d.jsx)("span",{className:"text-sm",children:a})]}),r=({label:a})=>(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("div",{className:"flex-shrink-0 w-5 h-5 flex items-center justify-center",children:(0,d.jsx)(n.default,{src:o.A,alt:"Loading",width:16,height:16})}),(0,d.jsx)("span",{className:"text-sm",children:a})]}),s=({deploymentPhase:a})=>(0,d.jsx)("div",{className:"flex items-center gap-3",children:"deploying"===a?(0,d.jsx)(r,{label:"Deploying..."}):"deployed"===a?(0,d.jsx)(p,{label:"Pipeline deployed."}):"failed"===a?(0,d.jsx)(q,{label:"Deployment failed."}):(0,d.jsx)(r,{label:"Loading..."})}),t=({pipelineId:a,pipelineName:b,onDeploymentComplete:c,onDeploymentFailed:f,onNavigateToList:g})=>{let[h,l]=(0,e.useState)(!1),{deploymentPhase:m,deploymentHistory:n,error:o,isPolling:q,retryDeployment:r,timeoutReached:t}=(({pipelineId:a,onDeploymentComplete:b,onDeploymentFailed:c,maxDeploymentTime:d=3e5,autoNavigateDelay:f=2e3})=>{let[g,h]=(0,e.useState)("created"),[i,k]=(0,e.useState)([]),[l,m]=(0,e.useState)(null),[n,o]=(0,e.useState)(!1),[p]=(0,e.useState)(Date.now()),q=(0,e.useCallback)((a,b,c)=>{let d={phase:a,message:b,timestamp:new Date,error:c};k(a=>[...a,d])},[]);(0,e.useEffect)(()=>{q("created","Pipeline configuration saved successfully");let a=setTimeout(()=>{h("deploying"),q("deploying","Starting pipeline deployment...")},1500);return()=>clearTimeout(a)},[q]),(0,e.useEffect)(()=>{let a=setTimeout(()=>{if("deploying"===g){o(!0),h("failed");let a="Deployment timeout: Pipeline took too long to deploy";m(a),q("failed","Deployment timed out after 5 minutes",a),setTimeout(()=>{c?.(a)},f)}},d);return()=>clearTimeout(a)},[g,d,q,c]);let{health:r,isLoading:s,error:t}=(0,j.O)({pipelineId:a,enabled:"deploying"===g&&!n,pollingInterval:2e3,stopOnStatuses:["Running","Failed","Terminated"],maxRetries:5,onStatusChange:(a,d)=>{if(console.log(`[DeploymentProgress] Status change: ${d} → ${a}`),"Running"===a)h("deployed"),q("deployed","Pipeline deployed successfully and is now running"),setTimeout(()=>{b?.()},f);else if("Failed"===a||"Terminated"===a){h("failed");let b="Failed"===a?"Pipeline deployment failed":"Pipeline was terminated during deployment";m(b),q("failed",b,b),setTimeout(()=>{c?.(b)},f)}},onError:a=>{console.error("[DeploymentProgress] Health check error:",a);let b=Date.now()-p,d=404===a.code||500===a.code;if(b>3e4||d){h("failed");let b=`Deployment monitoring failed: ${a.message}`;m(b),q("failed","Unable to monitor deployment progress",b),setTimeout(()=>{c?.(b)},f)}}});return{deploymentPhase:g,deploymentHistory:i,error:l,isPolling:s&&"deploying"===g,retryDeployment:(0,e.useCallback)(()=>{h("deploying"),m(null),o(!1),q("deploying","Retrying pipeline deployment...")},[q]),timeoutReached:n}})({pipelineId:a,onDeploymentComplete:()=>{l(!0),setTimeout(()=>{c()},1e3)},onDeploymentFailed:a=>{l(!0),setTimeout(()=>{f?.(a)},1e3)}});return(0,d.jsx)("div",{className:(0,k.cn)("transition-opacity duration-500",h&&"opacity-0"),children:(0,d.jsx)("div",{className:"flex flex-col gap-4",children:(0,d.jsx)(i.Zp,{className:"border-[var(--color-border-neutral)] radius-large py-2 px-6 mb-4",children:(0,d.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,d.jsx)("div",{className:"flex flex-col flex-start gap-2",children:(0,d.jsx)("h2",{className:"text-2xl font-bold",children:b})}),(0,d.jsx)(p,{label:"Pipeline created."}),(0,d.jsx)(s,{deploymentPhase:m})]})})})})};var u=c(3994),v=c(64708);function w({pipelineId:a}){let[b,c]=(0,e.useState)(null),[i,j]=(0,e.useState)(!0),[k,l]=(0,e.useState)(null),[m,n]=(0,e.useState)(!1),[o,p]=(0,e.useState)(!1),q=(0,f.useSearchParams)(),r=(0,f.useRouter)();q?.get("deployment");let{coreStore:s}=(0,v.useStore)(),{pipelineName:w}=s;if(i)return(0,d.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"animate-spin h-8 w-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),(0,d.jsx)("p",{className:"text-gray-600",children:"Loading pipeline details..."})]})});if(m)return(0,d.jsx)(u.PipelineNotFound,{pipelineId:a});if(k)return(0,d.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"text-red-500 text-lg font-semibold mb-2",children:"Error"}),(0,d.jsx)("p",{className:"text-gray-600 mb-4",children:k}),(0,d.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"Retry"})]})});if(o){let b=w||`Pipeline ${a.slice(0,8)}`;return(0,d.jsx)("div",{children:(0,d.jsx)(t,{pipelineId:a,pipelineName:b,onDeploymentComplete:()=>{p(!1),r.replace(`/pipelines/${a}`),(async()=>{try{j(!0),l(null),n(!1);let b=await (0,g.B0)(a);c(b)}catch(a){console.error("Failed to fetch pipeline after deployment:",a),a?.code===404?n(!0):l(a.message||"Failed to fetch pipeline")}finally{j(!1)}})()},onDeploymentFailed:a=>{console.error("Pipeline deployment failed:",a),r.push("/pipelines")},onNavigateToList:()=>{r.push("/pipelines")}})})}return b?(0,d.jsx)(h.default,{pipeline:b}):(0,d.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"text-gray-500 text-lg font-semibold mb-2",children:"Pipeline Not Found"}),(0,d.jsxs)("p",{className:"text-gray-600",children:['Pipeline with ID "',a,'" could not be found.']})]})})}}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[1407,1624,6103,7571,6372,7489,4673,8370,5419],()=>b(b.s=38017));module.exports=c})();