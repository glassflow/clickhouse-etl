(()=>{var a={};a.id=4398,a.ids=[4398],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5862:(a,b,c)=>{"use strict";c.d(b,{A:()=>d});let d={src:"/_next/static/media/loader-small.ac73cbe2.svg",height:24,width:24,blurWidth:0,blurHeight:0}},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12884:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>d});let d=(0,c(13383).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/nnaumov/Apps/clickhouse-etl/ui/src/app/pipelines/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/nnaumov/Apps/clickhouse-etl/ui/src/app/pipelines/page.tsx","default")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19232:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>X});var d=c(48477),e=c(48296),f=c.n(e),g=c(78864),h=c(64708),i=c(84135),j=c(24370),k=c(26403);c(5375),c(4179),c(94480);var l=c(39293),m=c(84621);let n={src:"/_next/static/media/sort.1687e1f4.svg",height:16,width:16,blurWidth:0,blurHeight:0},o={src:"/_next/static/media/sort-up.8e29f883.svg",height:16,width:16,blurWidth:0,blurHeight:0},p={src:"/_next/static/media/sort-down.2f9b683d.svg",height:16,width:16,blurWidth:0,blurHeight:0},q={active:1,resuming:2,pausing:3,paused:4,stopping:5,stopped:6,failed:7};function r({data:a,columns:b,emptyMessage:c="No data found",className:f,onRowClick:h,isLoading:i=!1,onPause:j,onEdit:k,onRename:l,onDelete:r}){let s=b.map(a=>a.width||"1fr").join(" "),[t,u]=(0,e.useState)(null),[v,w]=(0,e.useState)(null),x=(0,e.useMemo)(()=>t&&v?[...a].sort((a,b)=>{let c,d;if(t.includes(".")){let e=t.split(".");c=e.reduce((a,b)=>a?.[b],a),d=e.reduce((a,b)=>a?.[b],b)}else c=a[t],d=b[t];if(null==c&&null==d)return 0;if(null==c)return"asc"===v?1:-1;if(null==d)return"asc"===v?-1:1;if("status"===t){let a=q[String(c).toLowerCase()]||999,b=q[String(d).toLowerCase()]||999;return"asc"===v?a-b:b-a}if("string"==typeof c&&"string"==typeof d){let a=c.toLowerCase().localeCompare(d.toLowerCase());return"asc"===v?a:-a}if("number"==typeof c&&"number"==typeof d)return"asc"===v?c-d:d-c;if("created_at"===t){let a=new Date(c).getTime(),b=new Date(d).getTime();return"asc"===v?a-b:b-a}let e=String(c),f=String(d),g=e.toLowerCase().localeCompare(f.toLowerCase());return"asc"===v?g:-g}):a,[a,t,v]),y=a=>a.sortable?t!==(a.sortKey||a.key)?(0,d.jsx)(g.default,{src:n,alt:"Sort",width:14,height:14,className:"ml-1 text-gray-400"}):"asc"===v?(0,d.jsx)(g.default,{src:o,alt:"Sort Ascending",width:14,height:14,className:"ml-1"}):(0,d.jsx)(g.default,{src:p,alt:"Sort Descending",width:14,height:14,className:"ml-1"}):null;return i?(0,d.jsxs)("div",{className:(0,m.cn)("table-container",f),children:[(0,d.jsx)("div",{className:"table-header",children:(0,d.jsx)("div",{className:"table-header-row",style:{gridTemplateColumns:s},children:b.map(a=>(0,d.jsx)("div",{className:(0,m.cn)("table-header-cell",a.align&&`text-${a.align}`,a.sortable&&"cursor-pointer select-none"),children:(0,d.jsxs)("div",{className:(0,m.cn)("flex items-center","center"===a.align&&"justify-center","right"===a.align&&"justify-end",(!a.align||"left"===a.align)&&"justify-start"),children:[a.header,y(a)]})},a.key))})}),(0,d.jsx)("div",{className:"table-body",children:(0,d.jsx)("div",{className:"table-cell-empty",children:"Loading..."})})]}):(0,d.jsxs)("div",{className:(0,m.cn)("table-container",f),children:[(0,d.jsx)("div",{className:"table-header",children:(0,d.jsx)("div",{className:"table-header-row",style:{gridTemplateColumns:s},children:b.map(a=>(0,d.jsx)("div",{className:(0,m.cn)("table-header-cell",a.align&&`text-${a.align}`,a.sortable&&"cursor-pointer select-none hover:opacity-70"),onClick:()=>(a=>{if(!a.sortable)return;let b=a.sortKey||a.key;t===b?"asc"===v?w("desc"):"desc"===v&&(w(null),u(null)):(u(b),w("asc"))})(a),children:(0,d.jsxs)("div",{className:(0,m.cn)("flex items-center","center"===a.align&&"justify-center","right"===a.align&&"justify-end",(!a.align||"left"===a.align)&&"justify-start"),children:[a.header,y(a)]})},a.key))})}),(0,d.jsxs)("div",{className:"table-body",children:[x.map((a,c)=>(0,d.jsx)("div",{className:(0,m.cn)("table-row",h&&"cursor-pointer"),onClick:()=>h?.(a),style:{gridTemplateColumns:s},children:b.map(b=>(0,d.jsx)("div",{className:(0,m.cn)("table-cell",b.align&&`text-${b.align}`),"data-label":b.header,children:b.render?b.render(a):a[b.key]},b.key))},c)),0===x.length&&(0,d.jsx)("div",{className:"table-row",style:{gridTemplateColumns:s},children:(0,d.jsx)("div",{className:"table-cell-empty",children:c})})]})]})}let s=(0,c(76230).A)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);var t=c(99927);let u={src:"/_next/static/media/play-white.be5817b4.svg",height:16,width:17,blurWidth:0,blurHeight:0};var v=c(9119),w=c(1733),x=c(29001),y=c(49679),z=c(53061);let A=({pipelineStatus:a,isLoading:b=!1,onStop:c,onResume:f,onEdit:h,onRename:i,onTerminate:j,onDelete:l,onDownload:n,disabled:o=!1,onOpen:p})=>{let[q,r]=(0,e.useState)(!1),A=(0,t.zg)("stop",a),B=(0,t.zg)("resume",a);(0,t.zg)("edit",a);let C=(0,t.zg)("rename",a);(0,t.zg)("terminate",a);let D=(0,t.zg)("delete",a),E="active"===a&&!A.isDisabled,F=("stopped"===a||"terminated"===a)&&!B.isDisabled,G="stopped"!==a&&"terminated"!==a&&"terminating"!==a,H=(a,b,c)=>{a.stopPropagation(),!c&&b&&b(),r(!1)};return(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(k.$,{variant:"ghost",size:"sm",className:(0,m.cn)("h-8 w-8 p-0 hover:bg-muted",(o||b)&&"opacity-50 cursor-not-allowed"),onClick:a=>{a.stopPropagation(),p&&p(a),o||b||r(!q)},disabled:o||b,children:(0,d.jsx)(s,{className:"h-4 w-4"})}),q&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"fixed inset-0 z-10",onClick:a=>{a.stopPropagation(),r(!1)}}),(0,d.jsxs)("div",{className:"absolute right-0 top-full mt-1 z-20 w-48 bg-[var(--color-background-regular)] border border-[var(--color-border-neutral)] rounded-md shadow-lg p-1 min-w-[160px] sm:min-w-[180px]",onClick:a=>a.stopPropagation(),children:[E&&c&&(0,d.jsxs)(k.$,{variant:"ghost",className:(0,m.cn)("flex justify-start items-center w-full px-3 py-2 text-sm transition-colors",A.isDisabled||b?"text-muted-foreground cursor-not-allowed opacity-50":"text-foreground hover:bg-[var(--color-background-neutral-faded)]"),onClick:a=>H(a,c,A.isDisabled||b),disabled:A.isDisabled||b,title:A.disabledReason,children:[(0,d.jsx)(g.default,{src:z.A,alt:"Stop",width:16,height:16,className:"filter brightness-100 group-hover:brightness-0"}),(0,d.jsx)("span",{className:"truncate",children:"Stop"})]}),F&&f&&(0,d.jsxs)(k.$,{variant:"ghost",className:(0,m.cn)("flex justify-start items-center w-full px-3 py-2 text-sm transition-colors",B.isDisabled||b?"text-muted-foreground cursor-not-allowed opacity-50":"text-foreground hover:bg-[var(--color-background-neutral-faded)]"),onClick:a=>H(a,f,B.isDisabled||b),disabled:B.isDisabled||b,title:B.disabledReason,children:[(0,d.jsx)(g.default,{src:u,alt:"Resume",width:16,height:16}),(0,d.jsx)("span",{className:"truncate",children:"Resume"})]}),i&&(0,d.jsxs)(k.$,{variant:"ghost",className:(0,m.cn)("flex justify-start items-center w-full px-3 py-2 text-sm transition-colors",C.isDisabled||b?"text-muted-foreground cursor-not-allowed opacity-50":"text-foreground hover:bg-[var(--color-background-neutral-faded)]"),onClick:a=>{a.stopPropagation(),H(a,i,C.isDisabled||b)},disabled:C.isDisabled||b,title:C.disabledReason,children:[(0,d.jsx)(g.default,{src:v.A,alt:"Rename",width:16,height:16,className:"filter brightness-100 group-hover:brightness-0"}),(0,d.jsx)("span",{className:"truncate",children:"Rename"})]}),G&&j&&(0,d.jsxs)(k.$,{variant:"ghost",className:(0,m.cn)("flex justify-start items-center w-full px-3 py-2 text-sm transition-colors",b?"text-muted-foreground cursor-not-allowed opacity-50":"text-destructive hover:bg-[var(--color-background-neutral-faded)]"),onClick:a=>{a.stopPropagation(),H(a,j,b)},disabled:b,title:"Immediately terminate pipeline",children:[(0,d.jsx)(g.default,{src:y.A,alt:"Terminate",width:16,height:16,className:"filter brightness-100 group-hover:brightness-0"}),(0,d.jsx)("span",{className:"truncate",children:"Terminate"})]}),l&&(0,d.jsxs)(k.$,{variant:"ghost",className:(0,m.cn)("flex justify-start items-center w-full px-3 py-2 text-sm transition-colors",D.isDisabled||b?"text-muted-foreground cursor-not-allowed opacity-50":"text-destructive hover:bg-[var(--color-background-neutral-faded)]"),onClick:a=>{a.stopPropagation(),H(a,l,D.isDisabled||b)},disabled:D.isDisabled||b,title:D.disabledReason,children:[(0,d.jsx)(g.default,{src:w.A,alt:"Delete",width:16,height:16,className:"filter brightness-100 group-hover:brightness-0"}),(0,d.jsx)("span",{className:"truncate",children:"Delete"})]}),n&&(0,d.jsxs)(k.$,{variant:"ghost",className:(0,m.cn)("flex justify-start items-center w-full px-3 py-2 text-sm transition-colors","text-foreground hover:bg-[var(--color-background-neutral-faded)]"),onClick:a=>{a.stopPropagation(),H(a,n,!1)},disabled:!1,title:"Download configuration",children:[(0,d.jsx)(g.default,{src:x.A,alt:"Download",width:16,height:16,className:"filter brightness-100 group-hover:brightness-0"}),(0,d.jsx)("span",{className:"truncate",children:"Download"})]})]})]})]})};var B=c(65357),C=c(5862);function D({pipelines:a,healthMap:b,onStop:c,onResume:e,onEdit:f,onRename:h,onTerminate:i,onDelete:k,onRowClick:l,isPipelineLoading:n,getPipelineOperation:o}){return 0===a.length?(0,d.jsx)("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:(0,d.jsx)("div",{className:"text-center",children:(0,d.jsx)("p",{className:"text-muted-foreground text-lg",children:"No pipelines found. Create your first pipeline to get started."})})}):(0,d.jsx)("div",{className:"space-y-4",children:a.map(a=>{let b,p=n?.(a.pipeline_id)||!1,q=o?.(a.pipeline_id);return(0,d.jsxs)("div",{className:(0,m.cn)("bg-background border border-[var(--color-border-neutral)] rounded-lg p-4 shadow-sm",l&&"cursor-pointer hover:bg-muted/50 transition-colors"),onClick:()=>l?.(a),children:[(0,d.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,d.jsx)("div",{className:"flex-1 min-w-0",children:(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[p&&(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(g.default,{src:C.A,alt:"Loading",width:16,height:16,className:"animate-spin"}),(0,d.jsxs)("span",{className:"text-xs text-blue-600",children:["pause"===q&&"Pausing...","resume"===q&&"Resuming...","delete"===q&&"Deleting...","rename"===q&&"Renaming...","edit"===q&&"Pausing..."]})]}),(0,d.jsx)("h3",{className:"font-semibold text-foreground truncate",children:a.name})]})}),(0,d.jsx)("div",{className:"ml-3 flex-shrink-0",children:(0,d.jsx)(A,{pipelineStatus:a.status||"no_configuration",isLoading:p,onStop:c?()=>c(a):void 0,onResume:e?()=>e(a):void 0,onEdit:f?()=>f(a):void 0,onRename:h?()=>h(a):void 0,onTerminate:i?()=>i(a):void 0,onDelete:k?()=>k(a):void 0})})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:"Transformation"}),(0,d.jsx)("span",{className:"text-sm font-medium",children:a.transformation_type||"None"})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:"Status"}),(0,d.jsx)(j.E,{variant:((a,b)=>{switch(a){case B.zO.active:return"success";case B.zO.paused:case B.zO.pausing:case B.zO.stopping:return"warning";case B.zO.stopped:return"secondary";case B.zO.failed:return"error";default:return"default"}})(a.status||"no_configuration",a.pipeline_id),children:(b=a.status||"no_configuration",a.pipeline_id,b||"No Configuration")})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:"Events in DLQ"}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(j.E,{variant:0===(a.dlq_stats?.unconsumed_messages||0)?"success":10>(a.dlq_stats?.unconsumed_messages||0)?"warning":"error",children:(a.dlq_stats?.unconsumed_messages||0).toLocaleString()}),(a.dlq_stats?.total_messages||0)>0&&(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:["of ",(a.dlq_stats?.total_messages||0).toLocaleString()]})]})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:"Stability"}),(0,d.jsx)(j.E,{variant:"stable"===(a.health_status||"stable")?"success":"error",children:"stable"===(a.health_status||"stable")?"Stable":"Unstable"})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:"Created"}),(0,d.jsx)("span",{className:"text-sm",children:new Date(a.created_at).toLocaleDateString()})]})]})]},a.pipeline_id)})})}let E=({className:a,size:b=16})=>(0,d.jsx)("svg",{width:b,height:b,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a,children:(0,d.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.99984 2.66797C8.36803 2.66797 8.6665 2.96645 8.6665 3.33464V7.33464H12.6665C13.0347 7.33464 13.3332 7.63311 13.3332 8.0013C13.3332 8.36949 13.0347 8.66797 12.6665 8.66797H8.6665V12.668C8.6665 13.0362 8.36803 13.3346 7.99984 13.3346C7.63165 13.3346 7.33317 13.0362 7.33317 12.668V8.66797H3.33317C2.96498 8.66797 2.6665 8.36949 2.6665 8.0013C2.6665 7.63311 2.96498 7.33464 3.33317 7.33464H7.33317V3.33464C7.33317 2.96645 7.63165 2.66797 7.99984 2.66797Z",fill:"currentColor"})}),F=({className:a,size:b=20})=>(0,d.jsx)("svg",{width:b,height:b,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a,children:(0,d.jsx)("path",{d:"M2.5 5H17.5M5 10H15M7.5 15H12.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})});var G=c(87437),H=c(36241),I=c(43188),J=c(50899);let K=()=>(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("span",{className:"text-sm",children:"To edit the pipeline, it must be paused. Any events currently in the queue will be processed before pausing, which may take some time."}),(0,d.jsx)("br",{}),(0,d.jsx)("br",{}),(0,d.jsx)("span",{className:"text-sm",children:"Are you sure you want to proceed with editing?"})]}),L={title:"Edit Pipeline Configuration",description:(0,d.jsx)(K,{}),okButtonText:"Edit Pipeline",cancelButtonText:"Cancel"},M=function({visible:a,onOk:b,onCancel:c}){return(0,d.jsx)(G.W,{visible:a,title:L.title,description:(0,d.jsx)(K,{}),okButtonText:L.okButtonText,cancelButtonText:L.cancelButtonText,onComplete:a=>{a===G.R.YES?b():c()}})};function N({isOpen:a,onClose:b,filters:c,onFiltersChange:f,anchorEl:g}){let h=(0,e.useRef)(null);return a?(0,d.jsx)("div",{ref:h,className:"absolute z-50 w-64 rounded-lg shadow-lg",style:{top:g?`${g.getBoundingClientRect().bottom+4}px`:void 0,left:g?`${g.getBoundingClientRect().left}px`:void 0,backgroundColor:"var(--color-background-elevation-raised-faded-2)"},children:(0,d.jsxs)("div",{className:"p-4 space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-sm font-semibold mb-3",style:{color:"var(--color-foreground-neutral)"},children:"Status"}),(0,d.jsx)("div",{className:"space-y-2",children:["active","paused","stopped","failed"].map(a=>(0,d.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer p-2 rounded transition-all duration-200 hover:opacity-80",children:[(0,d.jsxs)("div",{className:"relative flex items-center justify-center",children:[(0,d.jsx)("input",{type:"checkbox",checked:c.status.includes(a),onChange:()=>(a=>{let b=c.status.includes(a)?c.status.filter(b=>b!==a):[...c.status,a];f({...c,status:b})})(a),className:"peer sr-only"}),(0,d.jsx)("div",{className:"w-5 h-5 rounded border-2 transition-all duration-200 flex items-center justify-center",style:{borderColor:c.status.includes(a)?"transparent":"var(--color-border-regular)",background:c.status.includes(a)?"linear-gradient(134deg, #ffa959 18.07%, #e7872e 76.51%)":"transparent"},children:c.status.includes(a)&&(0,d.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,d.jsx)("path",{d:"M2 6L5 9L10 3",stroke:"black",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),(0,d.jsx)("span",{className:"text-sm",style:{color:"var(--color-foreground-neutral)"},children:a.charAt(0).toUpperCase()+a.slice(1)})]},a))})]}),(0,d.jsx)("div",{className:"border-t",style:{borderColor:"var(--color-foreground-neutral-faded)"}}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-sm font-semibold mb-3",style:{color:"var(--color-foreground-neutral)"},children:"Health"}),(0,d.jsx)("div",{className:"space-y-2",children:["stable","unstable"].map(a=>(0,d.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer p-2 rounded transition-all duration-200 hover:opacity-80",children:[(0,d.jsxs)("div",{className:"relative flex items-center justify-center",children:[(0,d.jsx)("input",{type:"checkbox",checked:c.health.includes(a),onChange:()=>(a=>{let b=c.health.includes(a)?c.health.filter(b=>b!==a):[...c.health,a];f({...c,health:b})})(a),className:"peer sr-only"}),(0,d.jsx)("div",{className:"w-5 h-5 rounded border-2 transition-all duration-200 flex items-center justify-center",style:{borderColor:c.health.includes(a)?"transparent":"var(--color-border-regular)",background:c.health.includes(a)?"linear-gradient(134deg, #ffa959 18.07%, #e7872e 76.51%)":"transparent"},children:c.health.includes(a)&&(0,d.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,d.jsx)("path",{d:"M2 6L5 9L10 3",stroke:"black",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),(0,d.jsx)("span",{className:"text-sm",style:{color:"var(--color-foreground-neutral)"},children:a.charAt(0).toUpperCase()+a.slice(1)})]},a))})]})]})}):null}function O({label:a,values:b,onRemove:c,onClick:e,className:f}){if(0===b.length)return null;let g=`${a}: ${b.join(", ")}`;return(0,d.jsxs)("div",{className:(0,m.cn)("inline-flex items-center gap-2 px-3 py-2 rounded-lg","bg-[var(--color-background-elevation-raised-faded)] text-[var(--color-foreground-neutral)] text-sm font-medium","transition-all duration-200",e&&"cursor-pointer hover:opacity-90",f),onClick:e,style:{backgroundColor:"var(--color-background-elevation-raised-faded)",color:"var(--color-foreground-neutral)"},children:[(0,d.jsx)("span",{children:g}),(0,d.jsx)("button",{onClick:a=>{a.stopPropagation(),c()},className:"ml-1 hover:opacity-70 rounded p-0.5 transition-opacity duration-200","aria-label":"Remove filter",children:(0,d.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,d.jsx)("path",{d:"M10.5 3.5L3.5 10.5M3.5 3.5L10.5 10.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]})}var P=c(75299),Q=c(54299),R=c(31631),S=c(92940),T=c(24022);function U({pipelines:a,onRefresh:b,onUpdatePipelineStatus:c,onUpdatePipelineName:n,onRemovePipeline:o}){let p=(0,l.U)(),{coreStore:q,resetAllPipelineState:s}=(0,h.useStore)(),{pipelineId:u,setPipelineId:v}=q,[w,x]=(0,e.useState)("active"),[y,z]=(0,e.useState)(null),{isRenameModalVisible:B,selectedPipeline:K,openRenameModal:L,closeRenameModal:U}=(0,P.h_)(),{isTerminateModalVisible:V,selectedPipeline:W,openTerminateModal:X,closeTerminateModal:Y}=(0,P.er)(),{isStopModalVisible:Z,selectedPipeline:$,openStopModal:_,closeStopModal:aa}=(0,P.xJ)(),{isEditModalVisible:ab,selectedPipeline:ac,openEditModal:ad,closeEditModal:ae}=(0,P.lB)(),{isFeatureDisabled:af,isDocker:ag,isLocal:ah}=(0,R.s)(),[ai,aj]=(0,e.useState)(!1),[ak,al]=(0,e.useState)(!1),[am,an]=(0,e.useState)({status:[],health:[]}),[ao,ap]=(0,e.useState)(!1),aq=f().useRef(null),[ar,as]=(0,e.useState)({}),at=(0,i.useRouter)(),[au,av]=(0,e.useState)(!1),aw=(0,e.useMemo)(()=>a.map(a=>a.pipeline_id),[a]),ax=(0,S.RP)(aw),ay=(0,S.c7)();(0,S.qs)(aw);let az=(a,b)=>{as(c=>({...c,[a]:{isLoading:!0,operation:b}}))},aA=a=>{as(b=>({...b,[a]:{isLoading:!1,operation:null}}))},aB=a=>ar[a]?.isLoading||!1,aC=a=>ar[a]?.operation||null,aD=a=>ax[a.pipeline_id]||a.status||"active",aE=(0,e.useMemo)(()=>a.filter(a=>{if(am.status.length>0){let b=aD(a);if(!am.status.includes(b))return!1}if(am.health.length>0){let b=a.health_status||"stable";if(!am.health.includes(b))return!1}return!0}),[a,am,ax]),aF=(0,e.useMemo)(()=>(0,t.vF)(a),[a]),aG=(0,e.useMemo)(()=>(!!ag||!!ah)&&aF>0,[ag,ah,aF]),aH=[{key:"name",header:"Name",width:"2fr",sortable:!0,render:a=>{let b=aB(a.pipeline_id);return aC(a.pipeline_id),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[b&&(0,d.jsx)("div",{className:"flex items-center gap-1",children:(0,d.jsx)(g.default,{src:C.A,alt:"Loading",width:16,height:16,className:"animate-spin"})}),(0,d.jsx)("span",{className:"font-medium",children:a.name})]})}},{key:"operations",header:"Transformation",width:"2fr",sortable:!0,sortKey:"transformation_type",render:a=>a.transformation_type||"None"},{key:"health",header:"Health",width:"1fr",align:"left",sortable:!0,sortKey:"health_status",render:a=>{let b=a.health_status||"stable";return a.dlq_stats,(0,d.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 text-content",children:["stable"===b?(0,d.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500 items-center"}):(0,d.jsx)("div",{className:"w-3 h-3 rounded-full bg-red-500 items-center"}),"stable"===b?"Stable":"Unstable"]})}},{key:"dlqStats",header:"Events in DLQ",width:"1fr",align:"left",sortable:!0,sortKey:"dlq_stats.unconsumed_messages",render:a=>{let b=a.dlq_stats,c=b?.unconsumed_messages||0;return(0,d.jsx)("div",{className:"flex flex-row items-center justify-start gap-1 text-content",children:(0,m.ZV)(c)})}},{key:"status",header:"Status",width:"1fr",align:"center",sortable:!0,render:a=>{let b=aD(a);return(0,d.jsx)("div",{className:"flex flex-row items-center justify-center gap-2 text-content w-full",children:(0,d.jsx)(j.E,{className:"rounded-xl my-2 mx-4",variant:(a=>{switch(a){case"active":return"success";case"paused":case"pausing":case"resuming":case"stopping":case"terminating":return"warning";case"stopped":case"terminated":return"secondary";case"failed":return"error";default:return"default"}})(b),children:(a=>{switch(a){case"active":return"Active";case"pausing":return"Pausing...";case"paused":return"Paused";case"resuming":return"Resuming...";case"stopping":return"Stopping...";case"stopped":return"Stopped";case"terminating":return"Terminating...";case"terminated":return"Terminated";case"failed":return"Failed";default:return"Unknown status"}})(b)})})}},{key:"created_at",header:"Created",width:"1.5fr",align:"left",sortable:!0,render:a=>(0,d.jsx)("div",{className:"flex flex-row items-center justify-start text-content",children:(0,m.zO)(a.created_at)})},{key:"actions",header:"Actions",align:"center",width:"1fr",render:a=>{let b=aD(a);return(0,d.jsx)(A,{pipelineStatus:b,isLoading:aB(a.pipeline_id),onStop:()=>aI(a),onResume:()=>aJ(a),onEdit:()=>aK(a),onRename:()=>aL(a),onTerminate:()=>aM(a),onDelete:()=>aN(a),onDownload:()=>aO(a)})}}],aI=a=>{_(a)},aJ=async a=>{p.pipeline.resumeClicked({pipelineId:a.pipeline_id,pipelineName:a.name,currentStatus:a.status}),az(a.pipeline_id,"resume");try{ay.reportResume(a.pipeline_id),await (0,Q.WQ)(a.pipeline_id),p.pipeline.resumeSuccess({pipelineId:a.pipeline_id,pipelineName:a.name})}catch(b){console.error("Failed to resume pipeline:",b),p.pipeline.resumeFailed({pipelineId:a.pipeline_id,pipelineName:a.name,error:b instanceof Error?b.message:"Unknown error"}),ay.revertOptimisticUpdate(a.pipeline_id,"stopped")}finally{aA(a.pipeline_id)}},aK=a=>{ad(a)},aL=a=>{L(a)},aM=a=>{X(a)},aN=async a=>{p.pipeline.deleteClicked({pipelineId:a.pipeline_id,pipelineName:a.name,currentStatus:a.status,processEvents:!1}),az(a.pipeline_id,"delete");try{ay.reportDelete(a.pipeline_id),await (0,Q.gP)(a.pipeline_id),p.pipeline.deleteSuccess({pipelineId:a.pipeline_id,pipelineName:a.name,processEvents:!1}),o?.(a.pipeline_id),setTimeout(()=>b?.(),1e3)}catch(c){console.error("Failed to delete pipeline:",c),p.pipeline.deleteFailed({pipelineId:a.pipeline_id,pipelineName:a.name,error:c instanceof Error?c.message:"Unknown error",processEvents:!1});let b=a.status||"active";ay.revertOptimisticUpdate(a.pipeline_id,b)}finally{aA(a.pipeline_id)}},aO=async a=>{try{await (0,T.Tt)(a)}catch(a){console.error("Failed to download pipeline configuration:",a)}};return(0,d.jsxs)("div",{className:"flex flex-col w-full gap-6",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between w-full flex-wrap gap-3",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,d.jsx)("h1",{className:"text-xl sm:text-2xl font-semibold",children:"Pipelines"}),(0,d.jsxs)("button",{ref:aq,onClick:()=>ap(!ao),className:"p-2 hover:opacity-70 rounded-lg transition-opacity duration-200 relative","aria-label":"Filter pipelines",children:[(0,d.jsx)(F,{size:20,className:"text-gray-600"}),(am.status.length>0||am.health.length>0)&&(0,d.jsx)("span",{className:"absolute top-1 right-1 w-2 h-2 rounded-full",style:{background:"linear-gradient(134deg, #ffa959 18.07%, #e7872e 76.51%)"}})]}),am.status.length>0&&(0,d.jsx)(O,{label:"Status",values:am.status.map(a=>a.charAt(0).toUpperCase()+a.slice(1)),onRemove:()=>{an({...am,status:[]})},onClick:()=>ap(!0)}),am.health.length>0&&(0,d.jsx)(O,{label:"Health",values:am.health.map(a=>a.charAt(0).toUpperCase()+a.slice(1)),onRemove:()=>{an({...am,health:[]})},onClick:()=>ap(!0)})]}),(0,d.jsxs)(k.$,{variant:"default",className:"btn-primary btn-text",onClick:()=>{if(aG)return void al(!0);at.push("/home")},children:[(0,d.jsx)(E,{className:"action-icon",size:16}),"New Pipeline"]})]}),(0,d.jsx)(N,{isOpen:ao,onClose:()=>ap(!1),filters:am,onFiltersChange:an,anchorEl:aq.current}),(0,d.jsx)("div",{className:"hidden md:block",children:(0,d.jsx)(r,{data:aE,columns:aH,emptyMessage:"No pipelines found. Create your first pipeline to get started.",onRowClick:a=>at.push(`/pipelines/${a.pipeline_id}`)})}),(0,d.jsx)("div",{className:"md:hidden",children:(0,d.jsx)(D,{pipelines:aE,healthMap:ax,onStop:aI,onResume:aJ,onEdit:aK,onRename:aL,onTerminate:aM,onDelete:aN,onRowClick:a=>at.push(`/pipelines/${a.pipeline_id}`),isPipelineLoading:aB,getPipelineOperation:aC})}),(0,d.jsx)(H.A,{visible:Z,onOk:async()=>{if($){p.pipeline.pauseClicked({pipelineId:$.pipeline_id,pipelineName:$.name,currentStatus:$.status}),aa(),az($.pipeline_id,"stop");try{ay.reportStop($.pipeline_id),await (0,Q.JP)($.pipeline_id),p.pipeline.pauseSuccess({pipelineId:$.pipeline_id,pipelineName:$.name})}catch(a){console.error("Failed to stop pipeline:",a),p.pipeline.pauseFailed({pipelineId:$.pipeline_id,pipelineName:$.name,error:a instanceof Error?a.message:"Unknown error"}),ay.revertOptimisticUpdate($.pipeline_id,"active")}finally{aA($.pipeline_id)}}},onCancel:()=>{aa()}}),(0,d.jsx)(J.A,{visible:B,currentName:K?.name||"",onOk:async a=>{if(!K||!a)return;p.pipeline.renameClicked({pipelineId:K.pipeline_id,pipelineName:K.name,newName:a}),U(),az(K.pipeline_id,"rename");let b=K.name;n?.(K.pipeline_id,a);try{await (0,Q.lY)(K.pipeline_id,a),p.pipeline.renameSuccess({pipelineId:K.pipeline_id,oldName:b,newName:a})}catch(c){console.error("Failed to rename pipeline:",c),p.pipeline.renameFailed({pipelineId:K.pipeline_id,pipelineName:b,newName:a,error:c instanceof Error?c.message:"Unknown error"}),n?.(K.pipeline_id,b)}finally{aA(K.pipeline_id)}},onCancel:()=>{U()}}),(0,d.jsx)(M,{visible:ab,onOk:async()=>{if(ac){p.pipeline.editClicked({pipelineId:ac.pipeline_id,pipelineName:ac.name,currentStatus:ac.status}),ae(),az(ac.pipeline_id,"edit");try{"active"===ac.status?(c?.(ac.pipeline_id,"stopping"),await (0,Q.JP)(ac.pipeline_id),c?.(ac.pipeline_id,"stopped")):console.log("Pipeline already stopped, proceeding to edit:",ac.pipeline_id),p.pipeline.editSuccess({pipelineId:ac.pipeline_id,pipelineName:ac.name,wasPausedForEdit:"active"===ac.status}),at.push(`/pipelines/${ac.pipeline_id}`)}catch(a){console.error("Failed to prepare pipeline for edit:",a),p.pipeline.editFailed({pipelineId:ac.pipeline_id,pipelineName:ac.name,error:a instanceof Error?a.message:"Unknown error",currentStatus:ac.status}),c?.(ac.pipeline_id,ac.status||"no_configuration")}finally{aA(ac.pipeline_id)}}},onCancel:()=>{ae()}}),(0,d.jsx)(I.A,{visible:V,onOk:async()=>{if(W){p.pipeline.deleteClicked({pipelineId:W.pipeline_id,pipelineName:W.name,currentStatus:W.status,processEvents:!1}),Y(),az(W.pipeline_id,"delete");try{ay.reportTerminate(W.pipeline_id),await (0,Q.sw)(W.pipeline_id),p.pipeline.deleteSuccess({pipelineId:W.pipeline_id,pipelineName:W.name,processEvents:!1})}catch(b){console.error("Failed to terminate pipeline:",b),p.pipeline.deleteFailed({pipelineId:W.pipeline_id,pipelineName:W.name,error:b instanceof Error?b.message:"Unknown error",processEvents:!1});let a=W.status||"active";ay.revertOptimisticUpdate(W.pipeline_id,a)}finally{aA(W.pipeline_id)}}},onCancel:()=>{Y()}}),(0,d.jsx)(G.W,{visible:ak,title:"Pipeline Limit Reached",description:`Only one active pipeline is allowed on ${ag?"Docker":"Local"} version. To create a new pipeline, you must first terminate or delete any currently active pipelines.`,okButtonText:"Manage Pipelines",cancelButtonText:"Cancel",onComplete:a=>{al(!1),G.R.YES}})]})}var V=c(22621);function W(){(0,l.U)();let a=(0,i.useRouter)();return(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-200px)] gap-6",children:[(0,d.jsxs)("div",{className:"flex flex-col items-center gap-3 text-center",children:[(0,d.jsx)("h2",{className:"text-2xl font-semibold text-foreground",children:"There is no pipeline to display"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Create your first pipeline to get started"})]}),(0,d.jsxs)(k.$,{variant:"outline",className:"btn-primary flex items-center gap-2",onClick:()=>{a.push("/home")},children:[(0,d.jsx)(g.default,{src:V.A,alt:"New Pipeline",width:16,height:16,className:"filter brightness-0"}),"New Pipeline"]})]})}function X(){let[a,b]=(0,e.useState)([]),[c,f]=(0,e.useState)(!0),g=(0,e.useCallback)(async()=>{try{f(!0);let a=await (0,Q.Cz)();b(a)}catch(a){console.error("Failed to fetch pipelines:",a)}finally{f(!1)}},[]),h=(0,e.useCallback)((a,c)=>{b(b=>b.map(b=>b.pipeline_id===a?{...b,status:c,state:c}:b))},[]),i=(0,e.useCallback)((a,c)=>{b(b=>b.map(b=>b.pipeline_id===a?{...b,name:c}:b))},[]),j=(0,e.useCallback)(a=>{b(b=>b.filter(b=>b.pipeline_id!==a))},[]);return c?(0,d.jsx)("div",{className:"container mx-auto p-4",children:(0,d.jsx)("div",{className:"flex flex-col items-center justify-start min-h-[calc(100vh-200px)] gap-12",children:(0,d.jsx)("div",{className:"text-center",children:"Loading pipelines..."})})}):(0,d.jsx)("div",{className:"container mx-auto p-4",children:(0,d.jsx)("div",{className:"flex flex-col items-center justify-start min-h-[calc(100vh-200px)] gap-12",children:a.length>0?(0,d.jsx)(U,{pipelines:a,onRefresh:g,onUpdatePipelineStatus:h,onUpdatePipelineName:i,onRemovePipeline:j}):(0,d.jsx)(W,{})})})}},26713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},28354:a=>{"use strict";a.exports=require("util")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31631:(a,b,c)=>{"use strict";c.d(b,{s:()=>e});var d=c(54137);let e=()=>{let{platform:a,loading:b,error:c}=(0,d.V)(),e=a?.orchestrator==="docker",f=a?.orchestrator==="k8s",g=a?.orchestrator==="local",h=a?.orchestrator==="unknown";return{platform:a,loading:b,error:c,isDocker:e,isKubernetes:f,isLocal:g,isUnknown:h,isFeatureDisabled:d=>{if(b||c||!a)return!1;switch(d){case"docker-only":return!e;case"k8s-only":return!f;case"local-only":return!g;default:return!1}}}}},33737:(a,b,c)=>{Promise.resolve().then(c.bind(c,19232))},33873:a=>{"use strict";a.exports=require("path")},41025:a=>{"use strict";a.exports=require("next/dist/server/app-render/dynamic-access-async-storage.external.js")},43465:(a,b,c)=>{Promise.resolve().then(c.bind(c,12884))},46907:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GlobalError:()=>C.a,__next_app__:()=>I,handler:()=>K,pages:()=>H,routeModule:()=>J,tree:()=>G});var d=c(40177),e=c(30166),f=c(38566),g=c(7431),h=c(30461),i=c(12933),j=c(30828),k=c(16205),l=c(51911),m=c(49011),n=c(83540),o=c(4050),p=c(70543),q=c(261),r=c(59254),s=c(21483),t=c(26713),u=c(79431),v=c(50932),w=c(98632),x=c(41449),y=c(3855),z=c(53845),A=c(86439),B=c(75755),C=c.n(B),D=c(17207),E=c(82502),F={};for(let a in D)0>["default","tree","pages","GlobalError","__next_app__","routeModule","handler"].indexOf(a)&&(F[a]=()=>D[a]);c.d(b,F);let G={children:["",{children:["pipelines",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(c.bind(c,12884)),"/Users/nnaumov/Apps/clickhouse-etl/ui/src/app/pipelines/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(c.bind(c,58283)),"/Users/nnaumov/Apps/clickhouse-etl/ui/src/app/layout.tsx"],"global-error":[()=>Promise.resolve().then(c.t.bind(c,75755,23)),"next/dist/client/components/builtin/global-error.js"],"not-found":[()=>Promise.resolve().then(c.t.bind(c,66787,23)),"next/dist/client/components/builtin/not-found.js"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,94534,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,43121,23)),"next/dist/client/components/builtin/unauthorized.js"]}]}.children,H=["/Users/nnaumov/Apps/clickhouse-etl/ui/src/app/pipelines/page.tsx"],I={require:c,loadChunk:()=>Promise.resolve()},J=new d.AppPageRouteModule({definition:{kind:e.RouteKind.APP_PAGE,page:"/pipelines/page",pathname:"/pipelines",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:G},distDir:".next",projectDir:""});async function K(a,b,c){var d;let B="/pipelines/page";"/index"===B&&(B="/");let F="false",L=(0,h.getRequestMeta)(a,"postponed"),M=(0,h.getRequestMeta)(a,"minimalMode"),N=await J.prepare(a,b,{srcPage:B,multiZoneDraftMode:F});if(!N)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:O,query:P,params:Q,parsedUrl:R,pageIsDynamic:S,buildManifest:T,nextFontManifest:U,reactLoadableManifest:V,serverActionsManifest:W,clientReferenceManifest:X,subresourceIntegrityManifest:Y,prerenderManifest:Z,isDraftMode:$,resolvedPathname:_,revalidateOnlyGenerated:aa,routerServerContext:ab,nextConfig:ac}=N,ad=R.pathname||"/",ae=(0,q.normalizeAppPath)(B),{isOnDemandRevalidate:af}=N,ag=Z.dynamicRoutes[ae],ah=Z.routes[_],ai=!!(ag||ah||Z.routes[ae]),aj=a.headers["user-agent"]||"",ak=(0,t.getBotType)(aj),al=(0,o.isHtmlBotRequest)(a),am=(0,h.getRequestMeta)(a,"isPrefetchRSCRequest")??!!a.headers[s.NEXT_ROUTER_PREFETCH_HEADER],an=(0,h.getRequestMeta)(a,"isRSCRequest")??!!a.headers[s.RSC_HEADER],ao=(0,r.getIsPossibleServerAction)(a),ap=(0,l.checkIsAppPPREnabled)(ac.experimental.ppr)&&(null==(d=Z.routes[ae]??Z.dynamicRoutes[ae])?void 0:d.renderingMode)==="PARTIALLY_STATIC",aq=!1,ar=!1,as=ap?L:void 0,at=ap&&an&&!am,au=(0,h.getRequestMeta)(a,"segmentPrefetchRSCRequest"),av=!aj||(0,o.shouldServeStreamingMetadata)(aj,ac.htmlLimitedBots);al&&ap&&(ai=!1,av=!1);let aw=!0===J.isDev||!ai||"string"==typeof L||at,ax=al&&ap,ay=null;$||!ai||aw||ao||as||at||(ay=_);let az=ay;!az&&J.isDev&&(az=_);let aA={...D,tree:G,pages:H,GlobalError:C(),handler:K,routeModule:J,__next_app__:I};W&&X&&(0,n.setReferenceManifestsSingleton)({page:B,clientReferenceManifest:X,serverActionsManifest:W,serverModuleMap:(0,p.createServerModuleMap)({serverActionsManifest:W})});let aB=a.method||"GET",aC=(0,g.getTracer)(),aD=aC.getActiveScopeSpan();try{let d=async(c,d)=>{let e=new k.NodeNextRequest(a),f=new k.NodeNextResponse(b);return J.render(e,f,d).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=aC.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${aB} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${aB} ${a.url}`)})},f=async({span:e,postponed:f,fallbackRouteParams:g})=>{let i={query:P,params:Q,page:ae,sharedContext:{buildId:O},serverComponentsHmrCache:(0,h.getRequestMeta)(a,"serverComponentsHmrCache"),fallbackRouteParams:g,renderOpts:{App:()=>null,Document:()=>null,pageConfig:{},ComponentMod:aA,Component:(0,j.T)(aA),params:Q,routeModule:J,page:B,postponed:f,shouldWaitOnAllReady:ax,serveStreamingMetadata:av,supportsDynamicResponse:"string"==typeof f||aw,buildManifest:T,nextFontManifest:U,reactLoadableManifest:V,subresourceIntegrityManifest:Y,serverActionsManifest:W,clientReferenceManifest:X,setIsrStatus:null==ab?void 0:ab.setIsrStatus,dir:J.projectDir,isDraftMode:$,isRevalidate:ai&&!f&&!at,botType:ak,isOnDemandRevalidate:af,isPossibleServerAction:ao,assetPrefix:ac.assetPrefix,nextConfigOutput:ac.output,crossOrigin:ac.crossOrigin,trailingSlash:ac.trailingSlash,previewProps:Z.preview,deploymentId:ac.deploymentId,enableTainting:ac.experimental.taint,htmlLimitedBots:ac.htmlLimitedBots,devtoolSegmentExplorer:ac.experimental.devtoolSegmentExplorer,reactMaxHeadersLength:ac.reactMaxHeadersLength,multiZoneDraftMode:F,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:ac.experimental.cacheLife,basePath:ac.basePath,serverActions:ac.experimental.serverActions,...aq?{nextExport:!0,supportsDynamicResponse:!1,isStaticGeneration:!0,isRevalidate:!0,isDebugDynamicAccesses:aq}:{},experimental:{isRoutePPREnabled:ap,expireTime:ac.expireTime,staleTimes:ac.experimental.staleTimes,dynamicIO:!!ac.experimental.dynamicIO,clientSegmentCache:!!ac.experimental.clientSegmentCache,dynamicOnHover:!!ac.experimental.dynamicOnHover,inlineCss:!!ac.experimental.inlineCss,authInterrupts:!!ac.experimental.authInterrupts,clientTraceMetadata:ac.experimental.clientTraceMetadata||[]},waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:()=>{},onInstrumentationRequestError:(b,c,d)=>J.onRequestError(a,b,d,ab),err:(0,h.getRequestMeta)(a,"invokeError"),dev:J.isDev}},k=await d(e,i),{metadata:l}=k,{cacheControl:m,headers:n={},fetchTags:o}=l;if(o&&(n[x.NEXT_CACHE_TAGS_HEADER]=o),a.fetchMetrics=l.fetchMetrics,ai&&(null==m?void 0:m.revalidate)===0&&!J.isDev&&!ap){let a=l.staticBailoutInfo,b=Object.defineProperty(Error(`Page changed from static to dynamic at runtime ${_}${(null==a?void 0:a.description)?`, reason: ${a.description}`:""}
see more here https://nextjs.org/docs/messages/app-static-to-dynamic-error`),"__NEXT_ERROR_CODE",{value:"E132",enumerable:!1,configurable:!0});if(null==a?void 0:a.stack){let c=a.stack;b.stack=b.message+c.substring(c.indexOf("\n"))}throw b}return{value:{kind:u.CachedRouteKind.APP_PAGE,html:k,headers:n,rscData:l.flightData,postponed:l.postponed,status:l.statusCode,segmentData:l.segmentData},cacheControl:m}},l=async({hasResolved:d,previousCacheEntry:g,isRevalidating:i,span:j})=>{let k,l=!1===J.isDev,n=d||b.writableEnded;if(af&&aa&&!g&&!M)return(null==ab?void 0:ab.render404)?await ab.render404(a,b):(b.statusCode=404,b.end("This page could not be found")),null;if(ag&&(k=(0,v.parseFallbackField)(ag.fallback)),k===v.FallbackMode.PRERENDER&&(0,t.isBot)(aj)&&(k=v.FallbackMode.BLOCKING_STATIC_RENDER),(null==g?void 0:g.isStale)===-1&&(af=!0),af&&(k!==v.FallbackMode.NOT_FOUND||g)&&(k=v.FallbackMode.BLOCKING_STATIC_RENDER),!M&&k!==v.FallbackMode.BLOCKING_STATIC_RENDER&&az&&!n&&!$&&S&&(l||!ah)){let b;if((l||ag)&&k===v.FallbackMode.NOT_FOUND)throw new A.NoFallbackError;if(ap&&!an){if(b=await J.handleResponse({cacheKey:l?ae:null,req:a,nextConfig:ac,routeKind:e.RouteKind.APP_PAGE,isFallback:!0,prerenderManifest:Z,isRoutePPREnabled:ap,responseGenerator:async()=>f({span:j,postponed:void 0,fallbackRouteParams:l||ar?(0,m.u)(ae):null}),waitUntil:c.waitUntil}),null===b)return null;if(b)return delete b.cacheControl,b}}let o=af||i||!as?void 0:as;if(aq&&void 0!==o)return{cacheControl:{revalidate:1,expire:void 0},value:{kind:u.CachedRouteKind.PAGES,html:w.default.fromStatic(""),pageData:{},headers:void 0,status:void 0}};let p=S&&ap&&((0,h.getRequestMeta)(a,"renderFallbackShell")||ar)?(0,m.u)(ad):null;return f({span:j,postponed:o,fallbackRouteParams:p})},n=async d=>{var g,i,j,k,m;let n,o=await J.handleResponse({cacheKey:ay,responseGenerator:a=>l({span:d,...a}),routeKind:e.RouteKind.APP_PAGE,isOnDemandRevalidate:af,isRoutePPREnabled:ap,req:a,nextConfig:ac,prerenderManifest:Z,waitUntil:c.waitUntil});if($&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),J.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),!o){if(ay)throw Object.defineProperty(Error("invariant: cache entry required but not generated"),"__NEXT_ERROR_CODE",{value:"E62",enumerable:!1,configurable:!0});return null}if((null==(g=o.value)?void 0:g.kind)!==u.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant app-page handler received invalid cache entry ${null==(j=o.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E707",enumerable:!1,configurable:!0});let p="string"==typeof o.value.postponed;ai&&!at&&(!p||am)&&(M||b.setHeader("x-nextjs-cache",af?"REVALIDATED":o.isMiss?"MISS":o.isStale?"STALE":"HIT"),b.setHeader(s.NEXT_IS_PRERENDER_HEADER,"1"));let{value:q}=o;if(as)n={revalidate:0,expire:void 0};else if(M&&an&&!am&&ap)n={revalidate:0,expire:void 0};else if(!J.isDev)if($)n={revalidate:0,expire:void 0};else if(ai){if(o.cacheControl)if("number"==typeof o.cacheControl.revalidate){if(o.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${o.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});n={revalidate:o.cacheControl.revalidate,expire:(null==(k=o.cacheControl)?void 0:k.expire)??ac.expireTime}}else n={revalidate:x.CACHE_ONE_YEAR,expire:void 0}}else b.getHeader("Cache-Control")||(n={revalidate:0,expire:void 0});if(o.cacheControl=n,"string"==typeof au&&(null==q?void 0:q.kind)===u.CachedRouteKind.APP_PAGE&&q.segmentData){b.setHeader(s.NEXT_DID_POSTPONE_HEADER,"2");let c=null==(m=q.headers)?void 0:m[x.NEXT_CACHE_TAGS_HEADER];M&&ai&&c&&"string"==typeof c&&b.setHeader(x.NEXT_CACHE_TAGS_HEADER,c);let d=q.segmentData.get(au);return void 0!==d?(0,z.sendRenderResult)({req:a,res:b,type:"rsc",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:w.default.fromStatic(d),cacheControl:o.cacheControl}):(b.statusCode=204,(0,z.sendRenderResult)({req:a,res:b,type:"rsc",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:w.default.fromStatic(""),cacheControl:o.cacheControl}))}let r=(0,h.getRequestMeta)(a,"onCacheEntry");if(r&&await r({...o,value:{...o.value,kind:"PAGE"}},{url:(0,h.getRequestMeta)(a,"initURL")}))return null;if(p&&as)throw Object.defineProperty(Error("Invariant: postponed state should not be present on a resume request"),"__NEXT_ERROR_CODE",{value:"E396",enumerable:!1,configurable:!0});if(q.headers){let a={...q.headers};for(let[c,d]of(M&&ai||delete a[x.NEXT_CACHE_TAGS_HEADER],Object.entries(a)))if(void 0!==d)if(Array.isArray(d))for(let a of d)b.appendHeader(c,a);else"number"==typeof d&&(d=d.toString()),b.appendHeader(c,d)}let t=null==(i=q.headers)?void 0:i[x.NEXT_CACHE_TAGS_HEADER];if(M&&ai&&t&&"string"==typeof t&&b.setHeader(x.NEXT_CACHE_TAGS_HEADER,t),!q.status||an&&ap||(b.statusCode=q.status),!M&&q.status&&E.RedirectStatusCode[q.status]&&an&&(b.statusCode=200),p&&b.setHeader(s.NEXT_DID_POSTPONE_HEADER,"1"),an&&!$){if(void 0===q.rscData){if(q.postponed)throw Object.defineProperty(Error("Invariant: Expected postponed to be undefined"),"__NEXT_ERROR_CODE",{value:"E372",enumerable:!1,configurable:!0});return(0,z.sendRenderResult)({req:a,res:b,type:"rsc",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:q.html,cacheControl:at?{revalidate:0,expire:void 0}:o.cacheControl})}return(0,z.sendRenderResult)({req:a,res:b,type:"rsc",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:w.default.fromStatic(q.rscData),cacheControl:o.cacheControl})}let v=q.html;if(!p||M)return(0,z.sendRenderResult)({req:a,res:b,type:"html",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:v,cacheControl:o.cacheControl});if(aq)return v.chain(new ReadableStream({start(a){a.enqueue(y.ENCODED_TAGS.CLOSED.BODY_AND_HTML),a.close()}})),(0,z.sendRenderResult)({req:a,res:b,type:"html",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:v,cacheControl:{revalidate:0,expire:void 0}});let A=new TransformStream;return v.chain(A.readable),f({span:d,postponed:q.postponed,fallbackRouteParams:null}).then(async a=>{var b,c;if(!a)throw Object.defineProperty(Error("Invariant: expected a result to be returned"),"__NEXT_ERROR_CODE",{value:"E463",enumerable:!1,configurable:!0});if((null==(b=a.value)?void 0:b.kind)!==u.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant: expected a page response, got ${null==(c=a.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E305",enumerable:!1,configurable:!0});await a.value.html.pipeTo(A.writable)}).catch(a=>{A.writable.abort(a).catch(a=>{console.error("couldn't abort transformer",a)})}),(0,z.sendRenderResult)({req:a,res:b,type:"html",generateEtags:ac.generateEtags,poweredByHeader:ac.poweredByHeader,result:v,cacheControl:{revalidate:0,expire:void 0}})};if(!aD)return await aC.withPropagatedContext(a.headers,()=>aC.trace(i.BaseServerSpan.handleRequest,{spanName:`${aB} ${a.url}`,kind:g.SpanKind.SERVER,attributes:{"http.method":aB,"http.target":a.url}},n));await n(aD)}catch(b){throw aD||await J.onRequestError(a,b,{routerKind:"App Router",routePath:B,routeType:"render",revalidateReason:(0,f.c)({isRevalidate:ai,isOnDemandRevalidate:af})},ab),b}}},55511:a=>{"use strict";a.exports=require("crypto")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},94480:(a,b,c)=>{"use strict";c(48477),c(48296)}};var b=require("../../webpack-runtime.js");b.C(a);var c=b.X(0,[1407,1624,7571,7489,5419],()=>b(b.s=46907));module.exports=c})();