exports.id=7281,exports.ids=[7281],exports.modules={42:(a,b,c)=>{let d=c(13949);a.exports=({transactionalId:a,transactionTimeout:b})=>Object.assign(d({transactionalId:a,transactionTimeout:b}),{apiVersion:1})},199:(a,b,c)=>{let{parse:d,decode:e}=c(63486);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},280:(a,b,c)=>{let d=c(39652);a.exports=({authorizationIdentity:a=null,username:b,password:c})=>({encode:async()=>new d().writeBytes([a,b,c].join("\0")).buffer})},308:a=>{a.exports=class extends Map{getKey(a,b){return JSON.stringify([a,b])}set(a,b,c){let d=this.getKey(a,b);super.set(d,c)}has(a,b){let c=this.getKey(a,b);return super.has(c)}pop(a,b){if(0===this.size||!this.has(a,b))return;let c=this.getKey(a,b),d=this.get(c);return this.delete(c),{topic:a,partition:b,offset:d}}}},401:(a,b,c)=>{let d=c(39652),{ApiVersions:e}=c(81451);a.exports=()=>({apiKey:e,apiVersion:0,apiName:"ApiVersions",encode:async()=>new d})},486:(a,b,c)=>{let d=c(39652),{TxnOffsetCommit:e}=c(81451);a.exports=({transactionalId:a,groupId:b,producerId:c,producerEpoch:g,topics:h})=>({apiKey:e,apiVersion:0,apiName:"TxnOffsetCommit",encode:async()=>new d().writeString(a).writeString(b).writeInt64(c).writeInt16(g).writeArray(h.map(f))});let f=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(g)),g=({partition:a,offset:b,metadata:c})=>new d().writeInt32(a).writeInt64(b).writeString(c)},787:(a,b,c)=>{let{parse:d,decode:e}=c(42362);a.exports={decode:e,parse:d}},1103:(a,b,c)=>{let d=c(95356);a.exports=({groupId:a,memberId:b})=>Object.assign(d({groupId:a,memberId:b}),{apiVersion:1})},1214:(a,b,c)=>{let{parse:d,decode:e}=c(10469);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},1406:(a,b,c)=>{let{parse:d,decode:e}=c(68229);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},1731:(a,b,c)=>{let d=c(94735);a.exports=({nodeId:a,workerQueue:b,partitionAssignments:c,fetch:e,logger:f})=>{let g=f.namespace(`Fetcher ${a}`),h=new d,i=!1,j=({topic:a,partition:b})=>`${a}|${b}`,k=b=>c.set(j(b),a),l=a=>c.delete(j(a)),m=b=>b.filter(b=>{let d=c.get(j(b));return null==d||d===a||(g.info("Filtering out batch due to partition already being processed by another fetcher",{topic:b.topic,partition:b.partition,assignedFetcher:d,fetcher:a}),!1)});return{start:async()=>{if(!i){for(i=!0;i;)try{let c=await e(a);if(i){let a=m(c);if(a.length>0){a.forEach(k);try{await b.push(...a)}finally{a.forEach(l)}}}}catch(a){throw i=!1,h.emit("end"),a}h.emit("end")}},stop:async()=>{i&&(i=!1,await new Promise(a=>h.once("end",()=>a())))},getWorkerQueue:()=>b}}},1857:a=>{a.exports={GROUP:0,TRANSACTION:1}},1907:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>a.readInt32(),h=a=>{let b={partition:a.readInt32(),replicas:a.readUVarIntArray(g),addingReplicas:a.readUVarIntArray(g),removingReplicas:a.readUVarIntArray(g)};return a.readTaggedFields(),b},i=a=>{let b={name:a.readUVarIntString(),partitions:a.readUVarIntArray(h)};return a.readTaggedFields(),b};a.exports={decode:async a=>{let b=new d(a);b.readTaggedFields();let c=b.readInt32(),e=b.readInt16();return b.readUVarIntString(),{throttleTime:c,errorCode:e,topics:b.readUVarIntArray(i)}},parse:async a=>{if(e(a.errorCode))throw f(a.errorCode);return a}}},2041:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>({errorCode:a.readInt16(),errorMessage:a.readString()});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),creationResponses:b.readArray(g)}},parse:async a=>{let b=a.creationResponses.filter(({errorCode:a})=>e(a));if(b.length>0)throw f(b[0].errorCode);return a}}},2087:a=>{class b{constructor(a){this.value=a}static isLong(a){return"bigint"==typeof a.value}static fromBits(a){return new b(BigInt(a))}static fromInt(a){return isNaN(a)?b.ZERO:new b(BigInt.asIntN(64,BigInt(a)))}static fromNumber(a){return isNaN(a)?b.ZERO:new b(BigInt(a))}static fromValue(a){return"number"==typeof a?this.fromNumber(a):"string"==typeof a?this.fromString(a):new b("bigint"==typeof a?a:this.isLong(a)?BigInt(a.value):BigInt(a))}static fromString(a){if(0===a.length)throw Error("empty string");return"NaN"===a||"Infinity"===a||"+Infinity"===a||"-Infinity"===a?b.ZERO:new b(BigInt(a))}isZero(){return this.value===BigInt(0)}isNegative(){return this.value<BigInt(0)}toString(){return String(this.value)}toNumber(){return Number(this.value)}toInt(){return Number(BigInt.asIntN(32,this.value))}toJSON(){return this.toString()}shiftLeft(a){return new b(this.value<<BigInt(a))}shiftRight(a){return new b(this.value>>BigInt(a))}or(a){return b.isLong(a)||(a=b.fromValue(a)),b.fromBits(this.value|a.value)}xor(a){return b.isLong(a)||(a=b.fromValue(a)),new b(this.value^a.value)}and(a){return b.isLong(a)||(a=b.fromValue(a)),new b(this.value&a.value)}not(){return new b(~this.value)}shiftRightUnsigned(a){return new b(this.value>>BigInt.asUintN(64,BigInt(a)))}equals(a){return b.isLong(a)||(a=b.fromValue(a)),this.value===a.value}greaterThanOrEqual(a){return b.isLong(a)||(a=b.fromValue(a)),this.value>=a.value}gte(a){return this.greaterThanOrEqual(a)}notEquals(a){return b.isLong(a)||(a=b.fromValue(a)),!this.equals(a)}add(a){return b.isLong(a)||(a=b.fromValue(a)),new b(this.value+a.value)}subtract(a){return b.isLong(a)||(a=b.fromValue(a)),this.add(a.negate())}multiply(a){return this.isZero()?b.ZERO:(b.isLong(a)||(a=b.fromValue(a)),new b(this.value*a.value))}divide(a){if(b.isLong(a)||(a=b.fromValue(a)),a.isZero())throw Error("division by zero");return new b(this.value/a.value)}compare(a){return(b.isLong(a)||(a=b.fromValue(a)),this.value===a.value)?0:this.value>a.value?1:a.value>this.value?-1:void 0}lessThan(a){return b.isLong(a)||(a=b.fromValue(a)),this.value<a.value}negate(){return this.equals(b.MIN_VALUE)?b.MIN_VALUE:this.not().add(b.ONE)}getHighBits(){return Number(BigInt.asIntN(32,this.value>>BigInt(32)))}getLowBits(){return Number(BigInt.asIntN(32,this.value))}}b.MIN_VALUE=new b(BigInt("-9223372036854775808")),b.MAX_VALUE=new b(BigInt("9223372036854775807")),b.ZERO=b.fromInt(0),b.ONE=b.fromInt(1),a.exports=b},2505:(a,b,c)=>{let d=c(69478);a.exports=()=>Object.assign(d(),{apiVersion:1})},2664:(a,b,c)=>{let d={0:({resourceType:a,resourceName:b,principal:d,host:e,operation:f,permissionType:g})=>{let h=c(26074),i=c(51792);return{request:h({resourceType:a,resourceName:b,principal:d,host:e,operation:f,permissionType:g}),response:i}},1:({resourceType:a,resourceName:b,resourcePatternType:d,principal:e,host:f,operation:g,permissionType:h})=>{let i=c(65773),j=c(79905);return{request:i({resourceType:a,resourceName:b,resourcePatternType:d,principal:e,host:f,operation:g,permissionType:h}),response:j}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},2834:(a,b,c)=>{let d=c(83301);a.exports=({groupId:a,sessionTimeout:b,rebalanceTimeout:c,memberId:e,protocolType:f,groupProtocols:g})=>Object.assign(d({groupId:a,sessionTimeout:b,rebalanceTimeout:c,memberId:e,protocolType:f,groupProtocols:g}),{apiVersion:3})},2891:(a,b,c)=>{let{parse:d,decode:e}=c(3931);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},2952:(a,b,c)=>{let d=c(88923);a.exports=a=>()=>{let b={};return({topic:c,partitionMetadata:e,message:f})=>{c in b||(b[c]=d(32).readUInt32BE(0));let g=e.length,h=e.filter(a=>a.leader>=0),i=h.length;return null!==f.partition&&void 0!==f.partition?f.partition:null!==f.key&&void 0!==f.key?(0x7fffffff&a(f.key))%g:i>0?h[(0x7fffffff&++b[c])%i].partitionId:(0x7fffffff&++b[c])%g}}},2982:(a,b,c)=>{let d=c(39652),{CreateTopics:e}=c(81451);a.exports=({topics:a,timeout:b=5e3})=>({apiKey:e,apiVersion:0,apiName:"CreateTopics",encode:async()=>new d().writeArray(a.map(f)).writeInt32(b)});let f=({topic:a,numPartitions:b=-1,replicationFactor:c=-1,replicaAssignment:e=[],configEntries:f=[]})=>new d().writeString(a).writeInt32(b).writeInt16(c).writeArray(e.map(g)).writeArray(f.map(h)),g=({partition:a,replicas:b})=>new d().writeInt32(a).writeArray(b),h=({name:a,value:b})=>new d().writeString(a).writeString(b)},3323:(a,b,c)=>{let d=c(4702),e=c(71205),f=c(31311),g=c(76408),h=c(9688),{events:i,wrap:j,unwrap:k}=c(70528),{LEVELS:l}=c(44361),{KafkaJSNonRetriableError:m,KafkaJSDeleteGroupsError:n,KafkaJSBrokerNotFound:o,KafkaJSDeleteTopicRecordsError:p,KafkaJSAggregateError:q}=c(16920),{staleMetadata:r}=c(88374),s=c(6691),t=c(22631),u=c(86854),v=c(33330),w=c(8297),{EARLIEST_OFFSET:x,LATEST_OFFSET:y}=c(57142),{CONNECT:z,DISCONNECT:A}=i,{values:B,keys:C,entries:D}=Object,E=B(i),F=C(i).map(a=>`admin.events.${a}`).join(", "),G=async(a,b)=>(await a.addTargetTopic(b),await a.refreshMetadataIfNecessary(),a.findTopicPartitionMetadata(b).map(({partitionId:a})=>a).sort());a.exports=({logger:a,instrumentationEmitter:b,retry:c,cluster:C})=>{let H=a.namespace("Admin"),I=b||new h,J=async a=>{if(!a||"string"!=typeof a)throw new m(`Invalid topic ${a}`);return d(c)(async(b,c,d)=>{try{await C.addTargetTopic(a),await C.refreshMetadataIfNecessary();let b=C.findTopicPartitionMetadata(a),c=await C.fetchTopicsOffset([{topic:a,fromBeginning:!1,partitions:b.map(a=>({partition:a.partitionId}))}]),d=await C.fetchTopicsOffset([{topic:a,fromBeginning:!0,partitions:b.map(a=>({partition:a.partitionId}))}]),{partitions:e}=c.pop(),{partitions:f}=d.pop();return e.map(({partition:a,offset:b})=>({partition:a,offset:b,high:b,low:f.find(({partition:b})=>b===a).offset}))}catch(a){if("UNKNOWN_TOPIC_OR_PARTITION"===a.type)throw await C.refreshMetadata(),a;b(a)}})},K=async({groupId:a,topic:b,earliest:c=!1})=>{if(!a)throw new m(`Invalid groupId ${a}`);if(!b)throw new m(`Invalid topic ${b}`);let d=(await G(C,b)).map(a=>({partition:a,offset:C.defaultOffset({fromBeginning:c})}));return L({groupId:a,topic:b,partitions:d})},L=async({groupId:b,topic:c,partitions:d})=>{if(!b)throw new m(`Invalid groupId ${b}`);if(!c)throw new m(`Invalid topic ${c}`);if(!d||0===d.length)throw new m("Invalid partitions");let e=g({logger:a.namespace("Admin",l.NOTHING),cluster:C,groupId:b});await e.subscribe({topic:c,fromBeginning:!0});let f=await e.describeGroup();if(!["Empty","Dead"].includes(f.state))throw new m(`The consumer group must have no running instances, current state: ${f.state}`);return new Promise((a,b)=>{for(let f of(e.on(e.events.FETCH,async()=>e.stop().then(a).catch(b)),e.run({eachBatchAutoResolve:!1,eachBatch:async()=>!0}).catch(b),e.pause([{topic:c}]),d))e.seek({topic:c,...f})})},M=({resources:a,defaultBroker:b})=>f(a,async({type:a,name:c})=>[s.BROKER,s.BROKER_LOGGER].includes(a)?await C.findBroker({nodeId:String(c)}):b),N=async({topic:a,partitions:b})=>{if(!a||"string"!=typeof a)throw new m(`Invalid topic "${a}"`);if(!b||0===b.length)throw new m("Invalid partitions");let e=C.findLeaderForPartitions(a,b.map(a=>a.partition)),f=B(e).flat(),g=await J(a),h=[];if(b.forEach(({partition:b,offset:c})=>{if(!f.includes(b))return void h.push({partition:b,offset:c,error:new o("Could not find the leader for the partition",{retriable:!1})});let{low:d}=g.find(a=>a.partition===b)||{high:void 0,low:void 0};parseInt(c)<parseInt(d)&&-1!==parseInt(c)&&H.warn("The requested offset is before the earliest offset maintained on the partition - no records will be deleted from this partition",{topic:a,partition:b,offset:c})}),h.length>0)throw new p({topic:a,partitions:h});let i=D(e).reduce((c,[d,e])=>(c[d]={topic:a,partitions:b.filter(a=>e.includes(a.partition))},c),{});return d(c)(async b=>{try{let b=[],c=D(i).map(([a,{topic:b,partitions:c}])=>async()=>{let d=await C.findBroker({nodeId:a});await d.deleteRecords({topics:[{topic:b,partitions:c}]}),delete i[a]});if(await Promise.all(c.map(a=>a().catch(a=>{if("KafkaJSDeleteTopicRecordsError"===a.name)a.partitions.forEach(({partition:a,offset:c,error:d})=>{b.push({partition:a,offset:c,error:d})});else throw a}))),b.length>0)throw new p({topic:a,partitions:b})}catch(a){throw a.retriable&&a.partitions.some(({error:a})=>r(a)||"KafkaJSMetadataNotLoaded"===a.name)&&await C.refreshMetadata(),a}})};return{connect:async()=>{await C.connect(),I.emit(z)},disconnect:async()=>{await C.disconnect(),I.emit(A)},listTopics:async()=>{let{topicMetadata:a}=await C.metadata();return a.map(a=>a.topic)},createTopics:async({topics:a,validateOnly:b,timeout:f,waitForLeaders:g=!0})=>{if(!a||!Array.isArray(a))throw new m(`Invalid topics array ${a}`);if(a.filter(({topic:a})=>"string"!=typeof a).length>0)throw new m("Invalid topics array, the topic names have to be a valid string");let h=new Set(a.map(({topic:a})=>a));if(h.size<a.length)throw new m("Invalid topics array, it cannot have multiple entries for the same topic");for(let{topic:b,configEntries:c}of a)if(null!=c){if(!Array.isArray(c))throw new m(`Invalid configEntries for topic "${b}", must be an array`);c.forEach((a,c)=>{if("object"!=typeof a||null==a)throw new m(`Invalid configEntries for topic "${b}". Entry ${c} must be an object`);for(let d of["name","value"])if(!Object.prototype.hasOwnProperty.call(a,d)||"string"!=typeof a[d])throw new m(`Invalid configEntries for topic "${b}". Entry ${c} must have a valid "${d}" property`)})}return d(c)(async(c,d,i)=>{try{await C.refreshMetadata();let c=await C.findControllerBroker();if(await c.createTopics({topics:a,validateOnly:b,timeout:f}),g){let a=Array.from(h.values());await ((a,b={})=>e(async()=>{try{return await a()}catch(a){if("LEADER_NOT_AVAILABLE"!==a.type)throw a;return!1}},b))(async()=>await c.metadata(a),{delay:100,maxWait:f,timeoutMessage:"Timed out while waiting for topic leaders"})}return!0}catch(a){if("NOT_CONTROLLER"===a.type)throw H.warn("Could not create topics",{error:a.message,retryCount:d,retryTime:i}),a;if(a instanceof q&&a.errors.every(a=>"TOPIC_ALREADY_EXISTS"===a.type))return!1;c(a)}})},deleteTopics:async({topics:a,timeout:b})=>{if(!a||!Array.isArray(a))throw new m(`Invalid topics array ${a}`);if(a.filter(a=>"string"!=typeof a).length>0)throw new m("Invalid topics array, the names must be a valid string");return d(c)(async(c,d,e)=>{try{await C.refreshMetadata();let c=await C.findControllerBroker();for(let d of(await c.deleteTopics({topics:a,timeout:b}),a))C.targetTopics.delete(d);await C.refreshMetadata()}catch(a){if(["NOT_CONTROLLER","UNKNOWN_TOPIC_OR_PARTITION"].includes(a.type))throw H.warn("Could not delete topics",{error:a.message,retryCount:d,retryTime:e}),a;"REQUEST_TIMED_OUT"===a.type&&H.error('Could not delete topics, check if "delete.topic.enable" is set to "true" (the default value is "false") or increase the timeout',{error:a.message,retryCount:d,retryTime:e}),c(a)}})},createPartitions:async({topicPartitions:a,validateOnly:b,timeout:e})=>{if(!a||!Array.isArray(a))throw new m(`Invalid topic partitions array ${a}`);if(0===a.length)throw new m("Empty topic partitions array");if(a.filter(({topic:a})=>"string"!=typeof a).length>0)throw new m("Invalid topic partitions array, the topic names have to be a valid string");if(new Set(a.map(({topic:a})=>a)).size<a.length)throw new m("Invalid topic partitions array, it cannot have multiple entries for the same topic");return d(c)(async(c,d,f)=>{try{await C.refreshMetadata();let c=await C.findControllerBroker();await c.createPartitions({topicPartitions:a,validateOnly:b,timeout:e})}catch(a){if("NOT_CONTROLLER"===a.type)throw H.warn("Could not create topics",{error:a.message,retryCount:d,retryTime:f}),a;c(a)}})},fetchTopicMetadata:async({topics:a=[]}={})=>(a&&a.forEach(a=>{if(!a||"string"!=typeof a)throw new m(`Invalid topic ${a}`)}),{topics:(await C.metadata({topics:a})).topicMetadata.map(a=>({name:a.topic,partitions:a.partitionMetadata}))}),describeCluster:async()=>{let{brokers:a,clusterId:b,controllerId:c}=await C.metadata({topics:[]});return{brokers:a.map(({nodeId:a,host:b,port:c})=>({nodeId:a,host:b,port:c})),controller:null==c||-1===c?null:c,clusterId:b}},events:i,fetchOffsets:async({groupId:a,topics:b,resolveOffsets:c=!1})=>{if(!a)throw new m(`Invalid groupId ${a}`);if(b||(b=[]),!Array.isArray(b))throw new m("Expected topics array to be set");let d=await C.findGroupCoordinator({groupId:a}),e=await Promise.all(b.map(async a=>{let b=(await G(C,a)).map(a=>({partition:a}));return{topic:a,partitions:b}})),{responses:f}=await d.offsetFetch({groupId:a,topics:e});return c&&(f=await Promise.all(f.map(async({topic:b,partitions:c})=>{let d=(await J(b)).reduce((a,{partition:b,...c})=>Object.assign(a,{[b]:{...c}}),{}),e=c.map(({offset:a,partition:b,...c})=>{let e=a;return Number(a)===x&&(e=d[b].low),Number(a)===y&&(e=d[b].high),{partition:b,offset:e,...c}});return await L({groupId:a,topic:b,partitions:e}),{topic:b,partitions:e}}))),f.map(({topic:a,partitions:b})=>({topic:a,partitions:b.map(({partition:a,offset:b,metadata:c})=>({partition:a,offset:b,metadata:c||null}))}))},fetchTopicOffsets:J,fetchTopicOffsetsByTimestamp:async(a,b)=>{if(!a||"string"!=typeof a)throw new m(`Invalid topic ${a}`);return d(c)(async(c,d,e)=>{try{await C.addTargetTopic(a),await C.refreshMetadataIfNecessary();let c=C.findTopicPartitionMetadata(a).map(a=>({partition:a.partitionId})),{partitions:d}=(await C.fetchTopicsOffset([{topic:a,fromBeginning:!1,partitions:c}])).pop(),{partitions:e}=(await C.fetchTopicsOffset([{topic:a,fromTimestamp:b,partitions:c}])).pop();return e.map(({partition:a,offset:b})=>({partition:a,offset:parseInt(b,10)>=0?b:d.find(({partition:b})=>b===a).offset}))}catch(a){if("UNKNOWN_TOPIC_OR_PARTITION"===a.type)throw await C.refreshMetadata(),a;c(a)}})},setOffsets:L,resetOffsets:K,describeConfigs:async({resources:a,includeSynonyms:b})=>{if(!a||!Array.isArray(a))throw new m(`Invalid resources array ${a}`);if(0===a.length)throw new m("Resources array cannot be empty");let e=Object.values(s),f=a.find(a=>!e.includes(a.type));if(f)throw new m(`Invalid resource type ${f.type}: ${JSON.stringify(f)}`);let g=a.find(a=>!a.name||"string"!=typeof a.name);if(g)throw new m(`Invalid resource name ${g.name}: ${JSON.stringify(g)}`);let h=a.find(a=>!Array.isArray(a.configNames)&&null!=a.configNames);if(h){let{configNames:a}=h;throw new m(`Invalid resource configNames ${a}: ${JSON.stringify(h)}`)}return d(c)(async(c,d,e)=>{try{await C.refreshMetadata();let c=await C.findControllerBroker(),d=await M({resources:a,defaultBroker:c}),e=async a=>{let e=a||c;return e.describeConfigs({resources:d.get(e),includeSynonyms:b})},f=Array.from(d.keys());return{resources:(await Promise.all(f.map(e))).reduce((a,{resources:b})=>[...a,...b],[])}}catch(a){if("NOT_CONTROLLER"===a.type)throw H.warn("Could not describe configs",{error:a.message,retryCount:d,retryTime:e}),a;c(a)}})},alterConfigs:async({resources:a,validateOnly:b})=>{if(!a||!Array.isArray(a))throw new m(`Invalid resources array ${a}`);if(0===a.length)throw new m("Resources array cannot be empty");let e=Object.values(s),f=a.find(a=>!e.includes(a.type));if(f)throw new m(`Invalid resource type ${f.type}: ${JSON.stringify(f)}`);let g=a.find(a=>!a.name||"string"!=typeof a.name);if(g)throw new m(`Invalid resource name ${g.name}: ${JSON.stringify(g)}`);let h=a.find(a=>!Array.isArray(a.configEntries));if(h){let{configEntries:a}=h;throw new m(`Invalid resource configEntries ${a}: ${JSON.stringify(h)}`)}let i=a.find(a=>a.configEntries.some(a=>"string"!=typeof a.name||"string"!=typeof a.value));if(i)throw new m(`Invalid resource config value: ${JSON.stringify(i)}`);return d(c)(async(c,d,e)=>{try{await C.refreshMetadata();let c=await C.findControllerBroker(),d=await M({resources:a,defaultBroker:c}),e=async a=>{let e=a||c;return e.alterConfigs({resources:d.get(e),validateOnly:!!b})},f=Array.from(d.keys());return{resources:(await Promise.all(f.map(e))).reduce((a,{resources:b})=>[...a,...b],[])}}catch(a){if("NOT_CONTROLLER"===a.type)throw H.warn("Could not alter configs",{error:a.message,retryCount:d,retryTime:e}),a;c(a)}})},on:(a,b)=>{if(!E.includes(a))throw new m(`Event name should be one of ${F}`);return I.addListener(k(a),c=>{c.type=j(c.type),Promise.resolve(b(c)).catch(b=>{H.error(`Failed to execute listener: ${b.message}`,{eventName:a,stack:b.stack})})})},logger:()=>H,listGroups:async()=>{await C.refreshMetadata();let a=[];for(var b in C.brokerPool.brokers){let c=await C.findBroker({nodeId:b}),d=await c.listGroups();a=a.concat(d.groups)}return{groups:a}},describeGroups:async a=>{let b=Object.values((await Promise.all(a.map(async a=>({coordinator:await C.findGroupCoordinator({groupId:a}),groupId:a})))).reduce((a,{coordinator:b,groupId:c})=>{let d=a[b.nodeId];return d?a[b.nodeId]={...d,groupIds:[...d.groupIds,c]}:a[b.nodeId]={coordinator:b,groupIds:[c]},a},{})),e=await Promise.all(b.map(async({coordinator:a,groupIds:b})=>{let e=d(c),{groups:f}=await e(()=>a.describeGroups({groupIds:b}));return f}));return{groups:[].concat.apply([],e)}},deleteGroups:async a=>{if(!a||!Array.isArray(a))throw new m(`Invalid groupIds array ${a}`);let b=a.some(a=>"string"!=typeof a);if(b)throw new m(`Invalid groupId name: ${JSON.stringify(b)}`);let e=d(c),f=a.slice();return e(async(a,b,c)=>{try{if(0===f.length)return[];await C.refreshMetadata();let a={},b={};for(let c of f){let d=await C.findGroupCoordinator({groupId:c});void 0===a[d.nodeId]&&(a[d.nodeId]=[]),a[d.nodeId].push(c),b[d.nodeId]=d}let c=await Promise.all(Object.keys(b).map(async c=>await b[c].deleteGroups(a[c]))),d=c.flatMap(({results:a})=>a.map(({groupId:a,errorCode:b,error:c})=>({groupId:a,errorCode:b,error:c}))).filter(({errorCode:a})=>0!==a);if(f=d.map(({groupId:a})=>a),d.length>0)throw new n("Error in DeleteGroups",d);return c.flatMap(({results:a})=>a)}catch(d){if("NOT_CONTROLLER"===d.type||"COORDINATOR_NOT_AVAILABLE"===d.type)throw H.warn("Could not delete groups",{error:d.message,retryCount:b,retryTime:c}),d;a(d)}})},describeAcls:async({resourceType:a,resourceName:b,resourcePatternType:e,principal:f,host:g,operation:h,permissionType:i})=>{if("string"!=typeof f&&void 0!==f)throw new m("Invalid principal, the principal have to be a valid string");if("string"!=typeof g&&void 0!==g)throw new m("Invalid host, the host have to be a valid string");if("string"!=typeof b&&void 0!==b)throw new m("Invalid resourceName, the resourceName have to be a valid string");if(!Object.values(u).includes(h))throw new m(`Invalid operation type ${h}`);if(!Object.values(w).includes(e))throw new m(`Invalid resource pattern filter type ${e}`);if(!Object.values(v).includes(i))throw new m(`Invalid permission type ${i}`);if(!Object.values(t).includes(a))throw new m(`Invalid resource type ${a}`);return d(c)(async(c,d,j)=>{try{await C.refreshMetadata();let c=await C.findControllerBroker(),{resources:d}=await c.describeAcls({resourceType:a,resourceName:b,resourcePatternType:e,principal:f,host:g,operation:h,permissionType:i});return{resources:d}}catch(a){if("NOT_CONTROLLER"===a.type)throw H.warn("Could not describe ACL",{error:a.message,retryCount:d,retryTime:j}),a;c(a)}})},deleteAcls:async({filters:a})=>{let b;if(!a||!Array.isArray(a))throw new m(`Invalid ACL Filter array ${a}`);if(0===a.length)throw new m("Empty ACL Filter array");if(a.some(({principal:a})=>"string"!=typeof a&&void 0!==a))throw new m("Invalid ACL Filter array, the principals have to be a valid string");if(a.some(({host:a})=>"string"!=typeof a&&void 0!==a))throw new m("Invalid ACL Filter array, the hosts have to be a valid string");if(a.some(({resourceName:a})=>"string"!=typeof a&&void 0!==a))throw new m("Invalid ACL Filter array, the resourceNames have to be a valid string");let e=Object.values(u);if(b=a.find(a=>!e.includes(a.operation)))throw new m(`Invalid operation type ${b.operation}: ${JSON.stringify(b)}`);let f=Object.values(w);if(b=a.find(a=>!f.includes(a.resourcePatternType)))throw new m(`Invalid resource pattern type ${b.resourcePatternType}: ${JSON.stringify(b)}`);let g=Object.values(v);if(b=a.find(a=>!g.includes(a.permissionType)))throw new m(`Invalid permission type ${b.permissionType}: ${JSON.stringify(b)}`);let h=Object.values(t);if(b=a.find(a=>!h.includes(a.resourceType)))throw new m(`Invalid resource type ${b.resourceType}: ${JSON.stringify(b)}`);return d(c)(async(b,c,d)=>{try{await C.refreshMetadata();let b=await C.findControllerBroker(),{filterResponses:c}=await b.deleteAcls({filters:a});return{filterResponses:c}}catch(a){if("NOT_CONTROLLER"===a.type)throw H.warn("Could not delete ACL",{error:a.message,retryCount:c,retryTime:d}),a;b(a)}})},createAcls:async({acl:a})=>{let b;if(!a||!Array.isArray(a))throw new m(`Invalid ACL array ${a}`);if(0===a.length)throw new m("Empty ACL array");if(a.some(({principal:a})=>"string"!=typeof a))throw new m("Invalid ACL array, the principals have to be a valid string");if(a.some(({host:a})=>"string"!=typeof a))throw new m("Invalid ACL array, the hosts have to be a valid string");if(a.some(({resourceName:a})=>"string"!=typeof a))throw new m("Invalid ACL array, the resourceNames have to be a valid string");let e=Object.values(u);if(b=a.find(a=>!e.includes(a.operation)))throw new m(`Invalid operation type ${b.operation}: ${JSON.stringify(b)}`);let f=Object.values(w);if(b=a.find(a=>!f.includes(a.resourcePatternType)))throw new m(`Invalid resource pattern type ${b.resourcePatternType}: ${JSON.stringify(b)}`);let g=Object.values(v);if(b=a.find(a=>!g.includes(a.permissionType)))throw new m(`Invalid permission type ${b.permissionType}: ${JSON.stringify(b)}`);let h=Object.values(t);if(b=a.find(a=>!h.includes(a.resourceType)))throw new m(`Invalid resource type ${b.resourceType}: ${JSON.stringify(b)}`);return d(c)(async(b,c,d)=>{try{await C.refreshMetadata();let b=await C.findControllerBroker();return await b.createAcls({acl:a}),!0}catch(a){if("NOT_CONTROLLER"===a.type)throw H.warn("Could not create ACL",{error:a.message,retryCount:c,retryTime:d}),a;b(a)}})},deleteTopicRecords:N,alterPartitionReassignments:async({topics:a,timeout:b})=>{if(!a||!Array.isArray(a))throw new m(`Invalid topics array ${a}`);if(a.filter(({topic:a})=>"string"!=typeof a).length>0)throw new m("Invalid topics array, the topic names have to be a valid string");if(new Set(a.map(({topic:a})=>a)).size<a.length)throw new m("Invalid topics array, it cannot have multiple entries for the same topic");for(let{topic:b,partitionAssignment:c}of a){if(!c||!Array.isArray(c))throw new m(`Invalid partitions array: ${c} for topic: ${b}`);for(let{partition:a,replicas:d}of c){if(null==a||"number"!=typeof a||a<0)throw new m(`Invalid partitions index: ${a} for topic: ${b}`);if(!d||!Array.isArray(d))throw new m(`Invalid replica assignment: ${d} for topic: ${b} on partition: ${a}`);if(d.filter(a=>"number"!=typeof a||a<0).length>=1)throw new m(`Invalid replica assignment: ${d} for topic: ${b} on partition: ${a}. Replicas must be a non negative number`)}}return d(c)(async(c,d,e)=>{try{await C.refreshMetadata();let c=await C.findControllerBroker();await c.alterPartitionReassignments({topics:a,timeout:b})}catch(a){if("NOT_CONTROLLER"===a.type)throw H.warn("Could not reassign partitions",{error:a.message,retryCount:d,retryTime:e}),a;c(a)}})},listPartitionReassignments:async({topics:a=null,timeout:b})=>{if(a){if(!Array.isArray(a))throw new m(`Invalid topics array ${a}`);if(a.filter(({topic:a})=>"string"!=typeof a).length>0)throw new m("Invalid topics array, the topic names have to be a valid string");if(new Set(a.map(({topic:a})=>a)).size<a.length)throw new m("Invalid topics array, it cannot have multiple entries for the same topic");for(let{topic:b,partitions:c}of a){if(!c||!Array.isArray(c))throw new m(`Invalid partition array: ${c} for topic: ${b}`);if(c.filter(a=>"number"!=typeof a||a<0).length>=1)throw new m(`Invalid partition array: ${c} for topic: ${b}. The partition indices have to be a valid number greater than 0.`)}}return d(c)(async(c,d,e)=>{try{await C.refreshMetadata();let c=await C.findControllerBroker();return{topics:(await c.listPartitionReassignments({topics:a,timeout:b})).topics}}catch(a){if("NOT_CONTROLLER"===a.type)throw H.warn("Could not reassign partitions",{error:a.message,retryCount:d,retryTime:e}),a;c(a)}})}}}},3931:(a,b,c)=>{let d=c(45500),{failIfVersionNotSupported:e}=c(88374),{parse:f}=c(32802);a.exports={decode:async a=>{let b=new d(a),c=b.readInt32(),f=b.readInt16();return e(f),{throttleTime:c,errorCode:f}},parse:f}},4079:(a,b,c)=>{let{parse:d,decode:e}=c(33116);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},4176:a=>{a.exports=a=>({attributes:a.readInt8(),timestamp:a.readInt64().toString(),key:a.readBytes(),value:a.readBytes()})},4702:(a,b,c)=>{let{KafkaJSNumberOfRetriesExceeded:d,KafkaJSNonRetriableError:e}=c(16920),f=c(97274),g=(a,b)=>{let c=a*b;return Math.ceil(((a,b)=>Math.random()*(b-a)+a)(b-c,b+c))},h=["RangeError","ReferenceError","SyntaxError","TypeError"];a.exports=(a={})=>b=>new Promise((c,i)=>{let j=Object.assign({},f,a);((a,b,c,f)=>{let i=!1,{factor:j,multiplier:k,maxRetryTime:l,retries:m}=a,n=a=>{i=!0,c(a||Error("Aborted"))},o=(a,p=0)=>{if(i)return;let q=Math.min(g(j,a)*k,l),r=p<m;f(n,p,a).then(b).catch(b=>{(a=>(a.retriable||!1!==a.retriable)&&!h.includes(a.name))(b)?r?setTimeout(()=>o(q,p+1),a):c(new d(b,{retryCount:p,retryTime:a,cause:b.cause||b})):c(new e(b,{cause:b.cause||b}))})};return o})(j,c,i,b)(g(j.factor,j.initialRetryTime))})},5332:(a,b,c)=>{let d=c(69831);a.exports=({topics:a,timeout:b})=>Object.assign(d({topics:a,timeout:b}),{apiVersion:1})},5642:(a,b,c)=>{let d=c(45500),e=c(39652),{failure:f,createErrorFromCode:g,failIfVersionNotSupported:h,errorCodes:i}=c(88374),{KafkaJSProtocolError:j}=c(16920),k=i.find(a=>58===a.code);a.exports={decode:async a=>{let b=new d(a),c=b.readInt16();return h(c),{errorCode:c,errorMessage:b.readString(),authBytes:new e().writeBytes(b.readBytes()).buffer}},parse:async a=>{if(58===a.errorCode&&a.errorMessage)throw new j({...k,message:a.errorMessage});if(f(a.errorCode))throw g(a.errorCode);return a}}},5770:(a,b,c)=>{let d=c(81451),e=c(63412);a.exports=class{constructor(a){this.logger=a.logger.namespace("ConnectionPool"),this.connectionTimeout=a.connectionTimeout,this.host=a.host,this.port=a.port,this.rack=a.rack,this.ssl=a.ssl,this.sasl=a.sasl,this.clientId=a.clientId,this.socketFactory=a.socketFactory,this.pool=[,,].fill().map(()=>new e(a))}isConnected(){return this.pool.some(a=>a.isConnected())}isAuthenticated(){return this.pool.some(a=>a.isAuthenticated())}setSupportAuthenticationProtocol(a){this.map(b=>b.setSupportAuthenticationProtocol(a))}setVersions(a){this.map(b=>b.setVersions(a))}map(a){return this.pool.map(b=>a(b))}async send(a){return(await this.getConnectionByRequest(a)).send(a)}getConnectionByRequest({request:{apiKey:a}}){let b={[d.Fetch]:1}[a]||0;return this.getConnection(b)}async getConnection(a=0){let b=this.pool[a];return b.isConnected()||await b.connect(),b}async destroy(){await Promise.all(this.map(a=>a.disconnect()))}}},5806:a=>{let b=0;class c{constructor(a,c){this.id=(b===Number.MAX_VALUE&&(b=0),b++),this.type=a,this.timestamp=Date.now(),this.payload=c}}a.exports=c},6303:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>({errorCode:a.readInt16(),errorMessage:a.readString(),resourceType:a.readInt8(),resourceName:a.readString()});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),resources:b.readArray(g)}},parse:async a=>{let b=a.resources.filter(({errorCode:a})=>e(a));if(b.length>0)throw f(b[0].errorCode);return a}}},6460:(a,b,c)=>{let d=c(45500),{parse:e}=c(57333),f=c(44285),g=a=>({producerId:a.readInt64().toString(),firstOffset:a.readInt64().toString()}),h=async a=>({partition:a.readInt32(),errorCode:a.readInt16(),highWatermark:a.readInt64().toString(),lastStableOffset:a.readInt64().toString(),lastStartOffset:a.readInt64().toString(),abortedTransactions:a.readArray(g),messages:await f(a)}),i=async a=>({topicName:a.readString(),partitions:await a.readArrayAsync(h)});a.exports={decode:async a=>{let b=new d(a),c=b.readInt32(),e=b.readInt16();return{throttleTime:0,clientSideThrottleTime:c,errorCode:e,sessionId:b.readInt32(),responses:await b.readArrayAsync(i)}},parse:e}},6691:a=>{a.exports={UNKNOWN:0,TOPIC:2,BROKER:4,BROKER_LOGGER:8}},6693:(a,b,c)=>{let d=c(44430),e=c(1731),f=c(55244),g=c(66729),{KafkaJSFetcherRebalanceError:h,KafkaJSNoBrokerAvailableError:i}=c(16920);a.exports=({logger:a,getNodeIds:b,fetch:c,handler:j,concurrency:k=1})=>{let l=a.namespace("FetchManager"),m=g({workers:d(k,a=>f({handler:j,workerId:a}))}),n=[],o=()=>{let a=b(),d=new Map;if(0===a.length)throw new i;let f=a.map(f=>e({nodeId:f,workerQueue:m,partitionAssignments:d,fetch:async d=>((()=>{let c=b();if((a.length!==c.length||a.some(a=>!c.includes(a)))&&0!==c.length)throw new h})(),c(d)),logger:l}));return l.debug(`Created ${f.length} fetchers`,{nodeIds:a,concurrency:k}),f},p=async()=>{l.debug("Stopping fetchers..."),await Promise.all(n.map(a=>a.stop())),l.debug("Stopped fetchers")};return{start:async()=>{for(l.debug("Starting...");;){n=o();try{await Promise.all(n.map(a=>a.start()))}catch(a){if(await p(),a instanceof h){l.debug("Rebalancing fetchers...");continue}throw a}break}},stop:p,getFetchers:()=>n}}},6956:(a,b,c)=>{let d=c(39652),e=c(45500);a.exports={MemberMetadata:{encode:({version:a,topics:b,userData:c=Buffer.alloc(0)})=>new d().writeInt16(a).writeArray(b).writeBytes(c).buffer,decode(a){let b=new e(a);return{version:b.readInt16(),topics:b.readArray(a=>a.readString()),userData:b.readBytes()}}},MemberAssignment:{encode:({version:a,assignment:b,userData:c=Buffer.alloc(0)})=>new d().writeInt16(a).writeArray(Object.keys(b).map(a=>new d().writeString(a).writeArray(b[a]))).writeBytes(c).buffer,decode(a){let b=new e(a),c=a=>a.readInt32();return b.canReadInt16()?{version:b.readInt16(),assignment:b.readArray(a=>({topic:a.readString(),partitions:a.readArray(c)})).reduce((a,{topic:b,partitions:c})=>Object.assign(a,{[b]:c}),{}),userData:b.readBytes()}:null}}}},7092:(a,b,c)=>{let d={0:c(68127),1:c(82996)};a.exports=({version:a=0})=>d[a]},7752:(a,b,c)=>{a.exports={roundRobin:c(39531)}},8297:a=>{a.exports={UNKNOWN:0,ANY:1,MATCH:2,LITERAL:3,PREFIXED:4}},8462:a=>{let b={CONNECTED:"connected",DISCONNECTING:"disconnecting",DISCONNECTED:"disconnected"},c=[b.CONNECTED,b.DISCONNECTING];a.exports={CONNECTION_STATUS:b,CONNECTED_STATUS:c}},8567:(a,b,c)=>{let{parse:d,decode:e}=c(68142);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},8909:(a,b,c)=>{let d={0:({transactionalId:a,transactionTimeout:b=5e3})=>{let d=c(13949),e=c(80465);return{request:d({transactionalId:a,transactionTimeout:b}),response:e}},1:({transactionalId:a,transactionTimeout:b=5e3})=>{let d=c(42),e=c(23552);return{request:d({transactionalId:a,transactionTimeout:b}),response:e}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},9127:(a,b,c)=>{let d=c(39652),{Fetch:e}=c(81451),f=c(96268);a.exports=({replicaId:a,maxWaitTime:b,minBytes:c,maxBytes:i,topics:j,isolationLevel:k=f.READ_COMMITTED,sessionId:l=0,sessionEpoch:m=-1,forgottenTopics:n=[]})=>({apiKey:e,apiVersion:7,apiName:"Fetch",encode:async()=>new d().writeInt32(a).writeInt32(b).writeInt32(c).writeInt32(i).writeInt8(k).writeInt32(l).writeInt32(m).writeArray(j.map(h)).writeArray(n.map(g))});let g=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b),h=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(i)),i=({partition:a,fetchOffset:b,logStartOffset:c=-1,maxBytes:e})=>new d().writeInt32(a).writeInt64(b).writeInt64(c).writeInt32(e)},9265:(a,b,c)=>{let d={1:({groupId:a,topics:b})=>{let d=c(65630),e=c(60556);return{request:d({groupId:a,topics:b}),response:e}},2:({groupId:a,topics:b})=>{let d=c(10507),e=c(91839);return{request:d({groupId:a,topics:b}),response:e}},3:({groupId:a,topics:b})=>{let d=c(26632),e=c(33590);return{request:d({groupId:a,topics:b}),response:e}},4:({groupId:a,topics:b})=>{let d=c(57973),e=c(77113);return{request:d({groupId:a,topics:b}),response:e}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},9475:(a,b,c)=>{a.exports=()=>{let a=c(91645),b=c(34631);return({host:c,port:d,ssl:e,onConnect:f})=>{let g=e?b.connect(Object.assign({host:c,port:d},a.isIP(c)?{}:{servername:c},e),f):a.connect({host:c,port:d},f);return g.setKeepAlive(!0,6e4),g}}},9524:(a,b,c)=>{let d=c(39652),{AddOffsetsToTxn:e}=c(81451);a.exports=({transactionalId:a,producerId:b,producerEpoch:c,groupId:f})=>({apiKey:e,apiVersion:0,apiName:"AddOffsetsToTxn",encode:async()=>new d().writeString(a).writeInt64(b).writeInt16(c).writeString(f)})},9652:(a,b,c)=>{let d={0:({mechanism:a})=>{let b=c(13958),d=c(20388);return{request:b({mechanism:a}),response:d}},1:({mechanism:a})=>{let b=c(66345),d=c(98069);return{request:b({mechanism:a}),response:d}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},9688:(a,b,c)=>{let{EventEmitter:d}=c(94735),e=c(5806),{KafkaJSError:f}=c(16920);a.exports=class{constructor(){this.emitter=new d}emit(a,b){if(!a)throw new f("Invalid event name",{retriable:!1});if(this.emitter.listenerCount(a)>0){let c=new e(a,b);this.emitter.emit(a,c)}}addListener(a,b){return this.emitter.addListener(a,b),()=>this.emitter.removeListener(a,b)}}},9833:(a,b,c)=>{let d=c(486);a.exports=({transactionalId:a,groupId:b,producerId:c,producerEpoch:e,topics:f})=>Object.assign(d({transactionalId:a,groupId:b,producerId:c,producerEpoch:e,topics:f}),{apiVersion:1})},10073:(a,b,c)=>{let d=c(39652),{ListOffsets:e}=c(81451);a.exports=({replicaId:a,topics:b})=>({apiKey:e,apiVersion:1,apiName:"ListOffsets",encode:async()=>new d().writeInt32(a).writeArray(b.map(f))});let f=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(g)),g=({partition:a,timestamp:b=-1})=>new d().writeInt32(a).writeInt64(b)},10117:(a,b,c)=>{let d=c(39652),{LeaveGroup:e}=c(81451);a.exports=({groupId:a,members:b})=>({apiKey:e,apiVersion:3,apiName:"LeaveGroup",encode:async()=>new d().writeString(a).writeArray(b.map(a=>f(a)))});let f=({memberId:a,groupInstanceId:b=null})=>new d().writeString(a).writeString(b)},10368:(a,b,c)=>{let d=c(53654);a.exports=({topics:a})=>Object.assign(d({topics:a}),{apiVersion:3})},10467:(a,b,c)=>{let d=c(45500),{parse:e}=c(57333),f=c(44285),g=a=>({producerId:a.readInt64().toString(),firstOffset:a.readInt64().toString()}),h=async a=>({partition:a.readInt32(),errorCode:a.readInt16(),highWatermark:a.readInt64().toString(),lastStableOffset:a.readInt64().toString(),lastStartOffset:a.readInt64().toString(),abortedTransactions:a.readArray(g),messages:await f(a)}),i=async a=>({topicName:a.readString(),partitions:await a.readArrayAsync(h)});a.exports={decode:async a=>{let b=new d(a),c=b.readInt32(),e=b.readInt16();return{throttleTime:c,errorCode:e,sessionId:b.readInt32(),responses:await b.readArrayAsync(i)}},parse:e}},10469:(a,b,c)=>{let d=c(45500),{parse:e}=c(74323),f=a=>({partition:a.readInt32(),errorCode:a.readInt16(),baseOffset:a.readInt64().toString(),logAppendTime:a.readInt64().toString(),logStartOffset:a.readInt64().toString()});a.exports={decode:async a=>{let b=new d(a);return{topics:b.readArray(a=>({topicName:a.readString(),partitions:a.readArray(f)})),throttleTime:b.readInt32()}},parse:e}},10494:(a,b,c)=>{let d=c(45500),{parse:e}=c(40645),f=a=>({nodeId:a.readInt32(),host:a.readString(),port:a.readInt32(),rack:a.readString()}),g=a=>({topicErrorCode:a.readInt16(),topic:a.readString(),isInternal:a.readBoolean(),partitionMetadata:a.readArray(h)}),h=a=>({partitionErrorCode:a.readInt16(),partitionId:a.readInt32(),leader:a.readInt32(),replicas:a.readArray(a=>a.readInt32()),isr:a.readArray(a=>a.readInt32())});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),brokers:b.readArray(f),clusterId:b.readString(),controllerId:b.readInt32(),topicMetadata:b.readArray(g)}},parse:e}},10507:(a,b,c)=>{let d=c(65630);a.exports=({groupId:a,topics:b})=>Object.assign(d({groupId:a,topics:b}),{apiVersion:2})},11041:a=>{a.exports=({socketFactory:a,host:b,port:c,ssl:d,onConnect:e,onData:f,onEnd:g,onError:h,onTimeout:i})=>{let j=a({host:b,port:c,ssl:d,onConnect:e});return j.on("data",f),j.on("end",g),j.on("error",h),j.on("timeout",i),j}},11153:(a,b,c)=>{let d=c(85582);a.exports=({groupId:a,groupGenerationId:b,memberId:c})=>Object.assign(d({groupId:a,groupGenerationId:b,memberId:c}),{apiVersion:1})},11200:(a,b,c)=>{let{LEVELS:d}=c(44361);a.exports=()=>({namespace:a,level:b,label:c,log:e})=>{let f=a?`[${a}] `:"",g=JSON.stringify(Object.assign({level:c},e,{message:`${f}${e.message}`}));switch(b){case d.INFO:return console.info(g);case d.ERROR:return console.error(g);case d.WARN:return console.warn(g);case d.DEBUG:return console.log(g)}}},11797:(a,b,c)=>{let d=c(62239);a.exports=c(2952)(d)},11813:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>({topic:a.readString(),partitions:a.readArray(h)}),h=a=>({partition:a.readInt32(),errorCode:a.readInt16(),timestamp:a.readInt64().toString(),offset:a.readInt64().toString()});a.exports={decode:async a=>({responses:new d(a).readArray(g)}),parse:async a=>{let b=a.responses.flatMap(a=>a.partitions.filter(a=>e(a.errorCode)))[0];if(b)throw f(b.errorCode);return a}}},11998:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f,failIfVersionNotSupported:g}=c(88374);a.exports={decode:async a=>{let b=new d(a),c=b.readInt32(),e=b.readInt16();return g(e),{throttleTime:c,errorCode:e,errorMessage:b.readString(),coordinator:{nodeId:b.readInt32(),host:b.readString(),port:b.readInt32()}}},parse:async a=>{if(e(a.errorCode))throw f(a.errorCode);return a}}},12079:(a,b,c)=>{let d={0:({topics:a,timeout:b})=>{let d=c(69831),e=c(90531);return{request:d({topics:a,timeout:b}),response:e({topics:a})}},1:({topics:a,timeout:b})=>{let d=c(5332),e=c(92074);return{request:d({topics:a,timeout:b}),response:e({topics:a})}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},12418:a=>{a.exports={decode:async()=>!0,parse:async()=>!0}},12578:(a,b,c)=>{let{parse:d,decode:e}=c(61211);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},12777:(a,b,c)=>{a.exports={request:c(40732),response:c(12418)}},12855:(a,b,c)=>{let d=c(69754),{KafkaJSError:e,KafkaJSNonRetriableError:f}=c(16920),{CONNECTION_STATUS:g}=c(8462);a.exports=({logger:a,cluster:b,partitioner:c,eosManager:h,idempotent:i,retrier:j,getConnectionStatus:k})=>{let l=d({logger:a,cluster:b,retrier:j,partitioner:c,eosManager:h}),m=async({acks:a=-1,timeout:b,compression:c,topicMessages:d=[]})=>{if(d.some(({topic:a})=>!a))throw new f("Invalid topic");if(i&&-1!==a)throw new f("Not requiring ack for all messages invalidates the idempotent producer's EoS guarantees");for(let{topic:a,messages:b}of d){if(!b)throw new f(`Invalid messages array [${b}] for topic "${a}"`);let c=b.find(a=>void 0===a.value);if(c)throw new f(`Invalid message without value for topic "${a}": ${JSON.stringify(c)}`)}switch(k()){case g.DISCONNECTING:throw new f("The producer is disconnecting; therefore, it can't safely accept messages anymore");case g.DISCONNECTED:throw new e("The producer is disconnected")}let h=d.reduce((a,{topic:b,messages:c})=>{let d=a.findIndex(({topic:a})=>b===a);return -1===d?a.push({topic:b,messages:c}):a[d].messages=[...a[d].messages,...c],a},[]);return await l({acks:a,timeout:b,compression:c,topicMessages:h})};return{send:async({acks:a,timeout:b,compression:c,topic:d,messages:e})=>m({acks:a,timeout:b,compression:c,topicMessages:[{topic:d,messages:e}]}),sendBatch:m}}},13881:(a,b,c)=>{let d=c(39652),{DescribeConfigs:e}=c(81451);a.exports=({resources:a,includeSynonyms:b=!1})=>({apiKey:e,apiVersion:1,apiName:"DescribeConfigs",encode:async()=>new d().writeArray(a.map(f)).writeBoolean(b)});let f=({type:a,name:b,configNames:c=[]})=>new d().writeInt8(a).writeString(b).writeNullableArray(c)},13949:(a,b,c)=>{let d=c(39652),{InitProducerId:e}=c(81451);a.exports=({transactionalId:a,transactionTimeout:b})=>({apiKey:e,apiVersion:0,apiName:"InitProducerId",encode:async()=>new d().writeString(a).writeInt32(b)})},13958:(a,b,c)=>{let d=c(39652),{SaslHandshake:e}=c(81451);a.exports=({mechanism:a})=>({apiKey:e,apiVersion:0,apiName:"SaslHandshake",encode:async()=>new d().writeString(a)})},13983:(a,b,c)=>{let d={0:({topics:a,timeout:b})=>{let d=c(98775),e=c(1907);return{request:d({topics:a,timeout:b}),response:e}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},14039:(a,b,c)=>{a.exports={firstMessage:{request:c(14864),response:c(47374)},finalMessage:{request:c(63270),response:c(86852)}}},14040:(a,b,c)=>{let d=c(39652),{JoinGroup:e}=c(81451);a.exports=({groupId:a,sessionTimeout:b,rebalanceTimeout:c,memberId:g,groupInstanceId:h=null,protocolType:i,groupProtocols:j})=>({apiKey:e,apiVersion:5,apiName:"JoinGroup",encode:async()=>new d().writeString(a).writeInt32(b).writeInt32(c).writeString(g).writeString(h).writeString(i).writeArray(j.map(f))});let f=({name:a,metadata:b=Buffer.alloc(0)})=>new d().writeString(a).writeBytes(b)},14613:(a,b,c)=>{let d={0:({creations:a})=>{let b=c(14837),d=c(2041);return{request:b({creations:a}),response:d}},1:({creations:a})=>{let b=c(86818),d=c(69064);return{request:b({creations:a}),response:d}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},14670:a=>{a.exports=({topic:a,partitionMetadata:b,messages:c,partitioner:d})=>0===b.length?{}:c.reduce((c,e)=>{let f=d({topic:a,partitionMetadata:b,message:e}),g=c[f]||[];return Object.assign(c,{[f]:[...g,e]})},{})},14837:(a,b,c)=>{let d=c(39652),{CreateAcls:e}=c(81451),f=({resourceType:a,resourceName:b,principal:c,host:e,operation:f,permissionType:g})=>new d().writeInt8(a).writeString(b).writeString(c).writeString(e).writeInt8(f).writeInt8(g);a.exports=({creations:a})=>({apiKey:e,apiVersion:0,apiName:"CreateAcls",encode:async()=>new d().writeArray(a.map(f))})},14864:(a,b,c)=>{let d=c(39652);a.exports=({clientFirstMessage:a})=>({encode:async()=>new d().writeBytes(a).buffer})},15143:(a,b,c)=>{let d=c(45500),{parse:e}=c(40645),f=a=>({nodeId:a.readInt32(),host:a.readString(),port:a.readInt32(),rack:a.readString()}),g=a=>({topicErrorCode:a.readInt16(),topic:a.readString(),isInternal:a.readBoolean(),partitionMetadata:a.readArray(h)}),h=a=>({partitionErrorCode:a.readInt16(),partitionId:a.readInt32(),leader:a.readInt32(),replicas:a.readArray(a=>a.readInt32()),isr:a.readArray(a=>a.readInt32())});a.exports={decode:async a=>{let b=new d(a);return{brokers:b.readArray(f),clusterId:b.readString(),controllerId:b.readInt32(),topicMetadata:b.readArray(g)}},parse:e}},15226:(a,b,c)=>{let d=c(79315),e=c(7752),f=c(6956),g=c(38773),h=c(61097),i=c(6691),j=c(52173),k=c(22631),l=c(86854),m=c(33330),n=c(8297),{isRebalancing:o,isKafkaJSError:p,...q}=c(16920),{LEVELS:r}=c(44361);a.exports={Kafka:d,PartitionAssigners:e,AssignerProtocol:f,Partitioners:g,logLevel:r,CompressionTypes:h.Types,CompressionCodecs:h.Codecs,ConfigResourceTypes:i,AclResourceTypes:k,AclOperationTypes:l,AclPermissionTypes:m,ResourcePatternTypes:n,ConfigSource:j,...q}},15558:(a,b,c)=>{let d=c(39652),{Fetch:e}=c(81451);a.exports=({replicaId:a,maxWaitTime:b,minBytes:c,topics:g})=>({apiKey:e,apiVersion:0,apiName:"Fetch",encode:async()=>new d().writeInt32(a).writeInt32(b).writeInt32(c).writeArray(g.map(f))});let f=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(g)),g=({partition:a,fetchOffset:b,maxBytes:c})=>new d().writeInt32(a).writeInt64(b).writeInt32(c)},15847:(a,b,c)=>{let{KafkaJSConnectionError:d,KafkaJSNonRetriableError:e}=c(16920),f=c(5770);a.exports=({socketFactory:a,brokers:b,ssl:c,sasl:g,clientId:h,requestTimeout:i,enforceRequestTimeout:j,connectionTimeout:k,maxInFlightRequests:l,logger:m,instrumentationEmitter:n=null,reauthenticationThreshold:o})=>{let p=0,q=async()=>{let a;if("function"==typeof b)try{a=await b()}catch(b){let a=new d(`Failed to connect: "config.brokers" threw: ${b.message}`);throw a.stack=`${a.name}
  Caused by: ${b.stack}`,a}else a=b;return(a=>{if(!a)throw new e("Failed to connect: brokers should not be null");if(Array.isArray(a)){if(!a.length)throw new e("Failed to connect: brokers array is empty");a.forEach((a,b)=>{if(!(a=>a&&"string"==typeof a&&a.length>0)(a))throw new e(`Failed to connect: broker at index ${b} is invalid "${typeof a}"`)})}})(a),a};return{build:async({host:b,port:d,rack:e}={})=>{if(!b){let a=await q(),c=a[p++%a.length];b=c.split(":")[0],d=Number(c.split(":")[1])}return new f({host:b,port:d,rack:e,sasl:g,ssl:c,clientId:h,socketFactory:a,connectionTimeout:k,requestTimeout:i,enforceRequestTimeout:j,maxInFlightRequests:l,instrumentationEmitter:n,logger:m,reauthenticationThreshold:o})}}}},16237:(a,b,c)=>{let d=c(45500),{failIfVersionNotSupported:e}=c(88374),{parse:f}=c(99484);a.exports={decode:async a=>{let b=new d(a),c=b.readInt32(),f=b.readInt16();return e(f),{throttleTime:c,errorCode:f}},parse:f}},16515:(a,b,c)=>{let d=c(45500),e=c(39652),{parse:f}=c(5642),{failIfVersionNotSupported:g}=c(88374);a.exports={decode:async a=>{let b=new d(a),c=b.readInt16();g(c);let f=b.readString();return{errorCode:c,errorMessage:f,authBytes:new e().writeBytes(b.readBytes()).buffer,sessionLifetimeMs:b.readInt64().toString()}},parse:f}},16920:(a,b,c)=>{let{bugs:d}=c(18632);class e extends Error{constructor(a,{retriable:b=!0,cause:c}={}){super(a,{cause:c}),Error.captureStackTrace(this,this.constructor),this.message=a.message||a,this.name="KafkaJSError",this.retriable=b,this.helpUrl=a.helpUrl,this.cause=c}}class f extends e{constructor(a,{cause:b}={}){super(a,{retriable:!1,cause:b}),this.name="KafkaJSNonRetriableError"}}class g extends e{constructor(a,{retriable:b=a.retriable}={}){super(a,{retriable:b}),this.type=a.type,this.code=a.code,this.name="KafkaJSProtocolError"}}class h extends g{constructor(a,{topic:b,partition:c}){super(a),this.topic=b,this.partition=c,this.name="KafkaJSOffsetOutOfRange"}}class i extends g{constructor(a,{memberId:b}){super(a),this.memberId=b,this.name="KafkaJSMemberIdRequired"}}class j extends f{constructor(a,{retryCount:b,retryTime:c}){super(a,{cause:a}),this.stack=`${this.name}
  Caused by: ${a.stack}`,this.retryCount=b,this.retryTime=c,this.name="KafkaJSNumberOfRetriesExceeded"}}class k extends e{constructor(a,{broker:b,code:c}={}){super(a),this.broker=b,this.code=c,this.name="KafkaJSConnectionError"}}class l extends k{constructor(a,{host:b,port:c}={}){super(a,{broker:`${b}:${c}`}),this.host=b,this.port=c,this.name="KafkaJSConnectionClosedError"}}class m extends e{constructor(a,{broker:b,correlationId:c,createdAt:d,sentAt:e,pendingDuration:f}={}){super(a),this.broker=b,this.correlationId=c,this.createdAt=d,this.sentAt=e,this.pendingDuration=f,this.name="KafkaJSRequestTimeoutError"}}class n extends e{constructor(){super(...arguments),this.name="KafkaJSMetadataNotLoaded"}}class o extends n{constructor(a,{topic:b}={}){super(a),this.topic=b,this.name="KafkaJSTopicMetadataNotLoaded"}}class p extends e{constructor(a,{topic:b,unknownPartitions:c}={}){super(a),this.topic=b,this.unknownPartitions=c,this.name="KafkaJSStaleTopicMetadataAssignment"}}class q extends e{constructor(a,b=[]){super(a),this.groups=b,this.name="KafkaJSDeleteGroupsError"}}class r extends f{constructor(a,{apiKey:b,apiName:c}={}){super(a),this.apiKey=b,this.apiName=c,this.name="KafkaJSServerDoesNotSupportApiKey"}}class s extends e{constructor(){super(...arguments),this.name="KafkaJSBrokerNotFound"}}class t extends f{constructor(){super(...arguments),this.name="KafkaJSPartialMessageError"}}class u extends f{constructor(){super(...arguments),this.name="KafkaJSSASLAuthenticationError"}}class v extends f{constructor(){super(...arguments),this.name="KafkaJSGroupCoordinatorNotFound"}}class w extends f{constructor(){super(...arguments),this.name="KafkaJSNotImplemented"}}class x extends f{constructor(){super(...arguments),this.name="KafkaJSTimeout"}}class y extends x{constructor(){super(...arguments),this.name="KafkaJSLockTimeout"}}class z extends f{constructor(){super(...arguments),this.name="KafkaJSUnsupportedMagicByteInMessageSet"}}class A extends e{constructor({partitions:a}){super("Error while deleting records",{retriable:a.filter(({error:a})=>null!=a).every(({error:a})=>!0===a.retriable)}),this.name="KafkaJSDeleteTopicRecordsError",this.partitions=a}}let B=d?d.url:null;class C extends f{constructor(a){let b=a.message||a;if(super(`Invariant violated: ${b}. This is likely a bug and should be reported.`),this.name="KafkaJSInvariantViolation",null!==B){let a=encodeURIComponent(`Invariant violation: ${b}`);this.helpUrl=`${B}/new?assignees=&labels=bug&template=bug_report.md&title=${a}`}}}class D extends f{constructor(){super(...arguments),this.name="KafkaJSNonRetriableError"}}class E extends f{constructor(){super(...arguments),this.name="KafkaJSNonRetriableError"}}class F extends g{constructor(a,b){super(a),this.topic=b,this.name="KafkaJSCreateTopicError"}}class G extends g{constructor(a,b,c){super(a),this.topic=b,this.partition=c,this.name="KafkaJSAlterPartitionReassignmentsError"}}class H extends Error{constructor(a,b){super(a),this.errors=b,this.name="KafkaJSAggregateError"}}class I extends Error{}class J extends e{constructor(){super("No broker available"),this.name="KafkaJSNoBrokerAvailableError"}}a.exports={KafkaJSError:e,KafkaJSNonRetriableError:f,KafkaJSPartialMessageError:t,KafkaJSBrokerNotFound:s,KafkaJSProtocolError:g,KafkaJSConnectionError:k,KafkaJSConnectionClosedError:l,KafkaJSRequestTimeoutError:m,KafkaJSSASLAuthenticationError:u,KafkaJSNumberOfRetriesExceeded:j,KafkaJSOffsetOutOfRange:h,KafkaJSMemberIdRequired:i,KafkaJSGroupCoordinatorNotFound:v,KafkaJSNotImplemented:w,KafkaJSMetadataNotLoaded:n,KafkaJSTopicMetadataNotLoaded:o,KafkaJSStaleTopicMetadataAssignment:p,KafkaJSDeleteGroupsError:q,KafkaJSTimeout:x,KafkaJSLockTimeout:y,KafkaJSServerDoesNotSupportApiKey:r,KafkaJSUnsupportedMagicByteInMessageSet:z,KafkaJSDeleteTopicRecordsError:A,KafkaJSInvariantViolation:C,KafkaJSInvalidVarIntError:D,KafkaJSInvalidLongError:E,KafkaJSCreateTopicError:F,KafkaJSAggregateError:H,KafkaJSFetcherRebalanceError:I,KafkaJSNoBrokerAvailableError:J,KafkaJSAlterPartitionReassignmentsError:G,isRebalancing:a=>"REBALANCE_IN_PROGRESS"===a.type||"NOT_COORDINATOR_FOR_GROUP"===a.type||"ILLEGAL_GENERATION"===a.type,isKafkaJSError:a=>a instanceof e}},17076:(a,b,c)=>{let{decode:d,parse:e}=c(74323);a.exports={decode:d,parse:e}},17262:(a,b,c)=>{let{decode:d,parse:e}=c(57333);a.exports={decode:d,parse:e}},17564:(a,b,c)=>{let{parse:d,decode:e}=c(88527);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},17619:(a,b,c)=>{let d=c(36016);a.exports=({topics:a,validateOnly:b,timeout:c})=>Object.assign(d({topics:a,validateOnly:b,timeout:c}),{apiVersion:3})},17976:a=>{a.exports=a=>{if(!Array.isArray(a))throw TypeError("'array' is not an array");if(a.length<2)return a;let b=a.slice();for(let a=b.length-1;a>0;a--){let c=Math.floor(Math.random()*(a+1)),d=b[a];b[a]=b[c],b[c]=d}return b}},17990:(a,b,c)=>{let{parse:d,decode:e}=c(16237);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},18145:(a,b,c)=>{let d=c(45500),{parse:e}=c(45680),f=a=>({partition:a.readInt32(),errorCode:a.readInt16(),offset:a.readInt64().toString()});a.exports={decode:async a=>{let b=new d(a);return{topics:b.readArray(a=>({topicName:a.readString(),partitions:a.readArray(f)})),throttleTime:b.readInt32()}},parse:e}},18632:a=>{"use strict";a.exports=JSON.parse('{"name":"kafkajs","version":"2.2.4","description":"A modern Apache Kafka client for node.js","author":"Tulio Ornelas <ornelas.tulio@gmail.com>","main":"index.js","types":"types/index.d.ts","license":"MIT","keywords":["kafka","sasl","scram"],"engines":{"node":">=14.0.0"},"repository":{"type":"git","url":"https://github.com/tulios/kafkajs.git"},"bugs":{"url":"https://github.com/tulios/kafkajs/issues"},"homepage":"https://kafka.js.org","scripts":{"jest":"export KAFKA_VERSION=${KAFKA_VERSION:=\'2.4\'} && NODE_ENV=test echo \\"KAFKA_VERSION: ${KAFKA_VERSION}\\" && KAFKAJS_DEBUG_PROTOCOL_BUFFERS=1 jest","test:local":"yarn jest --detectOpenHandles","test:debug":"NODE_ENV=test KAFKAJS_DEBUG_PROTOCOL_BUFFERS=1 node --inspect-brk $(yarn bin 2>/dev/null)/jest --detectOpenHandles --runInBand --watch","test:local:watch":"yarn test:local --watch","test":"yarn lint && JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh \'yarn jest --ci --maxWorkers=4 --no-watchman --forceExit\'","lint":"find . -path ./node_modules -prune -o -path ./coverage -prune -o -path ./website -prune -o -name \'*.js\' -print0 | xargs -0 eslint","format":"find . -path ./node_modules -prune -o -path ./coverage -prune -o -path ./website -prune -o -name \'*.js\' -print0 | xargs -0 prettier --write","precommit":"lint-staged","test:group:broker":"yarn jest --forceExit --testPathPattern \'src/broker/.*\'","test:group:admin":"yarn jest --forceExit --testPathPattern \'src/admin/.*\'","test:group:producer":"yarn jest --forceExit --testPathPattern \'src/producer/.*\'","test:group:consumer":"yarn jest --forceExit --testPathPattern \'src/consumer/.*.spec.js\'","test:group:others":"yarn jest --forceExit --testPathPattern \'src/(?!(broker|admin|producer|consumer)/).*\'","test:group:oauthbearer":"OAUTHBEARER_ENABLED=1 yarn jest --forceExit src/producer/index.spec.js src/broker/__tests__/connect.spec.js src/consumer/__tests__/connection.spec.js src/broker/__tests__/disconnect.spec.js src/admin/__tests__/connection.spec.js src/broker/__tests__/reauthenticate.spec.js","test:group:broker:ci":"JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh \\"yarn test:group:broker --ci --maxWorkers=4 --no-watchman\\"","test:group:admin:ci":"JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh \\"yarn test:group:admin --ci --maxWorkers=4 --no-watchman\\"","test:group:producer:ci":"JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh \\"yarn test:group:producer --ci --maxWorkers=4 --no-watchman\\"","test:group:consumer:ci":"JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh \\"yarn test:group:consumer --ci --maxWorkers=4 --no-watchman\\"","test:group:others:ci":"JEST_JUNIT_OUTPUT_NAME=test-report.xml ./scripts/testWithKafka.sh \\"yarn test:group:others --ci --maxWorkers=4 --no-watchman\\"","test:group:oauthbearer:ci":"JEST_JUNIT_OUTPUT_NAME=test-report.xml COMPOSE_FILE=\'docker-compose.2_4_oauthbearer.yml\' ./scripts/testWithKafka.sh \\"yarn test:group:oauthbearer --ci --maxWorkers=4 --no-watchman\\"","test:types":"tsc -p types/"},"devDependencies":{"@types/jest":"^27.4.0","@types/node":"^12.0.8","@typescript-eslint/typescript-estree":"^1.10.2","eslint":"^6.8.0","eslint-config-prettier":"^6.0.0","eslint-config-standard":"^13.0.1","eslint-plugin-import":"^2.18.2","eslint-plugin-jest":"^26.1.0","eslint-plugin-node":"^11.0.0","eslint-plugin-prettier":"^3.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^4.0.0","execa":"^2.0.3","glob":"^7.1.4","husky":"^3.0.1","ip":"^1.1.5","jest":"^25.1.0","jest-circus":"^25.1.0","jest-extended":"^0.11.2","jest-junit":"^10.0.0","jsonwebtoken":"^9.0.0","lint-staged":"^9.2.0","mockdate":"^2.0.5","prettier":"^1.18.2","semver":"^6.2.0","typescript":"^3.8.3","uuid":"^3.3.2"},"dependencies":{},"lint-staged":{"*.js":["prettier --write","git add"]}}')},19028:(a,b,c)=>{let d={0:({transactionalId:a,groupId:b,producerId:d,producerEpoch:e,topics:f})=>{let g=c(486),h=c(41796);return{request:g({transactionalId:a,groupId:b,producerId:d,producerEpoch:e,topics:f}),response:h}},1:({transactionalId:a,groupId:b,producerId:d,producerEpoch:e,topics:f})=>{let g=c(9833),h=c(86101);return{request:g({transactionalId:a,groupId:b,producerId:d,producerEpoch:e,topics:f}),response:h}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},19259:(a,b,c)=>{let d=c(1857),e={0:({groupId:a})=>{let b=c(86243),d=c(57287);return{request:b({groupId:a}),response:d}},1:({groupId:a,coordinatorType:b=d.GROUP})=>{let e=c(24864),f=c(11998);return{request:e({coordinatorKey:a,coordinatorType:b}),response:f}},2:({groupId:a,coordinatorType:b=d.GROUP})=>{let e=c(95865),f=c(62469);return{request:e({coordinatorKey:a,coordinatorType:b}),response:f}}};a.exports={versions:Object.keys(e),protocol:({version:a})=>e[a]}},19267:(a,b,c)=>{let d=c(26826),e=c(78499),f=c(65467),g=c(4702),h=c(81442),i=c(32937),j=c(27816),k=c(308),l=c(29710),{events:{GROUP_JOIN:m,HEARTBEAT:n,CONNECT:o,RECEIVED_UNSUBSCRIBED_TOPICS:p}}=c(60695),{MemberAssignment:q}=c(6956),{KafkaJSError:r,KafkaJSNonRetriableError:s,KafkaJSStaleTopicMetadataAssignment:t,isRebalancing:u}=c(16920),{keys:v}=Object,w=["LEADER_NOT_AVAILABLE","NOT_LEADER_FOR_PARTITION","FENCED_LEADER_EPOCH","UNKNOWN_LEADER_EPOCH","UNKNOWN_TOPIC_OR_PARTITION"],x={JOIN:Symbol("private:ConsumerGroup:join"),SYNC:Symbol("private:ConsumerGroup:sync"),SHARED_HEARTBEAT:Symbol("private:ConsumerGroup:sharedHeartbeat")};a.exports=class{constructor({retry:a,cluster:b,groupId:c,topics:d,topicConfigurations:e,logger:f,instrumentationEmitter:i,assigners:j,sessionTimeout:m,rebalanceTimeout:o,maxBytesPerPartition:p,minBytes:q,maxBytes:r,maxWaitTimeInMs:s,autoCommit:t,autoCommitInterval:u,autoCommitThreshold:v,isolationLevel:w,rackId:y,metadataMaxAge:z}){this.cluster=b,this.groupId=c,this.topics=d,this.topicsSubscribed=d,this.topicConfigurations=e,this.logger=f.namespace("ConsumerGroup"),this.instrumentationEmitter=i,this.retrier=g(Object.assign({},a)),this.assigners=j,this.sessionTimeout=m,this.rebalanceTimeout=o,this.maxBytesPerPartition=p,this.minBytes=q,this.maxBytes=r,this.maxWaitTime=s,this.autoCommit=t,this.autoCommitInterval=u,this.autoCommitThreshold=v,this.isolationLevel=w,this.rackId=y,this.metadataMaxAge=z,this.seekOffset=new k,this.coordinator=null,this.generationId=null,this.leaderId=null,this.memberId=null,this.members=null,this.groupProtocol=null,this.partitionsPerSubscribedTopic=null,this.preferredReadReplicasPerTopicPartition={},this.offsetManager=null,this.subscriptionState=new l,this.lastRequest=Date.now(),this[x.SHARED_HEARTBEAT]=h(async({interval:a})=>{let{groupId:b,generationId:c,memberId:d}=this,e=Date.now();if(d&&e>=this.lastRequest+a){let a={groupId:b,memberId:d,groupGenerationId:c};await this.coordinator.heartbeat(a),this.instrumentationEmitter.emit(n,a),this.lastRequest=Date.now()}})}isLeader(){return this.leaderId&&this.memberId===this.leaderId}getNodeIds(){return this.cluster.getNodeIds()}async connect(){await this.cluster.connect(),this.instrumentationEmitter.emit(o),await this.cluster.refreshMetadataIfNecessary()}async [x.JOIN](){let{groupId:a,sessionTimeout:b,rebalanceTimeout:c}=this;this.coordinator=await this.cluster.findGroupCoordinator({groupId:a});let d=await this.coordinator.joinGroup({groupId:a,sessionTimeout:b,rebalanceTimeout:c,memberId:this.memberId||"",groupProtocols:this.assigners.map(a=>a.protocol({topics:this.topicsSubscribed}))});this.generationId=d.generationId,this.leaderId=d.leaderId,this.memberId=d.memberId,this.members=d.members,this.groupProtocol=d.groupProtocol}async leave(){let{groupId:a,memberId:b}=this;b&&(await this.coordinator.leaveGroup({groupId:a,memberId:b}),this.memberId=null)}async [x.SYNC](){let a=[],{groupId:b,generationId:c,memberId:d,members:g,groupProtocol:h,topics:j,topicsSubscribed:k,coordinator:l}=this;if(this.isLeader()){this.logger.debug("Chosen as group leader",{groupId:b,generationId:c,memberId:d,topics:j});let e=this.assigners.find(({name:a})=>a===h);if(!e)throw new s(`Unsupported partition assigner "${h}", the assigner wasn't found in the assigners list`);await this.cluster.refreshMetadata(),a=await e.assign({members:g,topics:k}),this.logger.debug("Group assignment",{groupId:b,generationId:c,groupProtocol:h,assignment:a,topics:k})}this.partitionsPerSubscribedTopic=this.generatePartitionsPerSubscribedTopic();let{memberAssignment:m}=await this.coordinator.syncGroup({groupId:b,generationId:c,memberId:d,groupAssignment:a}),n=q.decode(m),o=null!=n?n.assignment:{};this.logger.debug("Received assignment",{groupId:b,generationId:c,memberId:d,memberAssignment:o});let r=v(o),t=f(r,k);if(t.length>0){let a={groupId:b,generationId:c,memberId:d,assignedTopics:r,topicsSubscribed:k,topicsNotSubscribed:t};this.instrumentationEmitter.emit(p,a),this.logger.warn("Consumer group received unsubscribed topics",{...a,helpUrl:e("docs/faq","why-am-i-receiving-messages-for-topics-i-m-not-subscribed-to")})}let u=f(r,t).map(a=>({topic:a,partitions:o[a]}));for(let a of u){let{topic:e,partitions:f}=a,g=this.partitionsPerSubscribedTopic.get(e);if(!f.every(a=>g.includes(a))){this.logger.warn("Consumer is not aware of all assigned partitions, refreshing metadata",{groupId:b,generationId:c,memberId:d,topic:e,knownPartitions:g,assignedPartitions:f}),await this.cluster.refreshMetadata(),this.partitionsPerSubscribedTopic=this.generatePartitionsPerSubscribedTopic();break}}this.topics=u.map(({topic:a})=>a),this.subscriptionState.assign(u),this.offsetManager=new i({cluster:this.cluster,topicConfigurations:this.topicConfigurations,instrumentationEmitter:this.instrumentationEmitter,memberAssignment:u.reduce((a,{topic:b,partitions:c})=>({...a,[b]:c}),{}),autoCommit:this.autoCommit,autoCommitInterval:this.autoCommitInterval,autoCommitThreshold:this.autoCommitThreshold,coordinator:l,groupId:b,generationId:c,memberId:d})}joinAndSync(){let a=Date.now();return this.retrier(async b=>{try{await this[x.JOIN](),await this[x.SYNC]();let b=this.assigned().reduce((a,{topic:b,partitions:c})=>({...a,[b]:c}),{}),c={groupId:this.groupId,memberId:this.memberId,leaderId:this.leaderId,isLeader:this.isLeader(),memberAssignment:b,groupProtocol:this.groupProtocol,duration:Date.now()-a};this.instrumentationEmitter.emit(m,c),this.logger.info("Consumer has joined the group",c)}catch(a){if(u(a))throw new r(a);if("UNKNOWN_MEMBER_ID"===a.type)throw this.memberId=null,new r(a);b(a)}})}resetOffset({topic:a,partition:b}){this.offsetManager.resetOffset({topic:a,partition:b})}resolveOffset({topic:a,partition:b,offset:c}){this.offsetManager.resolveOffset({topic:a,partition:b,offset:c})}seek({topic:a,partition:b,offset:c}){this.seekOffset.set(a,b,c)}pause(a){this.logger.info(`Pausing fetching from ${a.length} topics`,{topicPartitions:a}),this.subscriptionState.pause(a)}resume(a){this.logger.info(`Resuming fetching from ${a.length} topics`,{topicPartitions:a}),this.subscriptionState.resume(a)}assigned(){return this.subscriptionState.assigned()}paused(){return this.subscriptionState.paused()}isPaused(a,b){return this.subscriptionState.isPaused(a,b)}async commitOffsetsIfNecessary(){await this.offsetManager.commitOffsetsIfNecessary()}async commitOffsets(a){await this.offsetManager.commitOffsets(a)}uncommittedOffsets(){return this.offsetManager.uncommittedOffsets()}async heartbeat({interval:a}){return this[x.SHARED_HEARTBEAT]({interval:a})}async fetch(a){try{await this.cluster.refreshMetadataIfNecessary(),this.checkForStaleAssignment();let b=this.subscriptionState.assigned();b=this.filterPartitionsByNode(a,b),await this.seekOffsets(b);let c=this.offsetManager.committedOffsets(),e=this.getActiveTopicPartitions(),f=b.map(({topic:a,partitions:b})=>({topic:a,partitions:b.filter(b=>null!=c[a][b]&&e[a].has(b)).map(b=>({partition:b,fetchOffset:this.offsetManager.nextOffset(a,b).toString(),maxBytes:this.maxBytesPerPartition}))})).filter(({partitions:a})=>a.length);if(!f.length)return await d(this.maxWaitTime),[];let g=await this.cluster.findBroker({nodeId:a}),{responses:h}=await g.fetch({maxWaitTime:this.maxWaitTime,minBytes:this.minBytes,maxBytes:this.maxBytes,isolationLevel:this.isolationLevel,topics:f,rackId:this.rackId});return h.flatMap(({topicName:a,partitions:b})=>{let c=f.find(({topic:b})=>b===a),d=this.preferredReadReplicasPerTopicPartition[a];return d||(this.preferredReadReplicasPerTopicPartition[a]=d={}),b.filter(({partition:b})=>!this.seekOffset.has(a,b)&&!this.subscriptionState.isPaused(a,b)).map(b=>{let{partition:e,preferredReadReplica:f}=b;if(null!=f&&-1!==f){let{nodeId:b}=d[e]||{};b!==f&&this.logger.info(`Preferred read replica is now ${f}`,{groupId:this.groupId,memberId:this.memberId,topic:a,partition:e}),d[e]={nodeId:f,expireAt:Date.now()+this.metadataMaxAge}}let g=c.partitions.find(({partition:a})=>a===b.partition).fetchOffset;return new j(a,g,b)})})}catch(a){return await this.recoverFromFetch(a),[]}}async recoverFromFetch(a){if(w.includes(a.type)||"KafkaJSTopicMetadataNotLoaded"===a.name){this.logger.debug("Stale cluster metadata, refreshing...",{groupId:this.groupId,memberId:this.memberId,error:a.message}),await this.cluster.refreshMetadata(),await this.joinAndSync();return}if("KafkaJSStaleTopicMetadataAssignment"===a.name){this.logger.warn(`${a.message}, resync group`,{groupId:this.groupId,memberId:this.memberId,topic:a.topic,unknownPartitions:a.unknownPartitions}),await this.joinAndSync();return}if("KafkaJSOffsetOutOfRange"===a.name)return void await this.recoverFromOffsetOutOfRange(a);if("KafkaJSConnectionClosedError"===a.name)return void this.cluster.removeBroker({host:a.host,port:a.port});if("KafkaJSBrokerNotFound"===a.name||"KafkaJSConnectionClosedError"===a.name){this.logger.debug(`${a.message}, refreshing metadata and retrying...`),await this.cluster.refreshMetadata();return}throw a}async recoverFromOffsetOutOfRange(a){let b=this.preferredReadReplicasPerTopicPartition[a.topic];b&&"number"==typeof b[a.partition]?(this.logger.info("Offset out of range while fetching from follower, retrying with leader",{topic:a.topic,partition:a.partition,groupId:this.groupId,memberId:this.memberId}),delete b[a.partition]):(this.logger.error("Offset out of range, resetting to default offset",{topic:a.topic,partition:a.partition,groupId:this.groupId,memberId:this.memberId}),await this.offsetManager.setDefaultOffset({topic:a.topic,partition:a.partition}))}generatePartitionsPerSubscribedTopic(){let a=new Map;for(let b of this.topicsSubscribed){let c=this.cluster.findTopicPartitionMetadata(b).map(a=>a.partitionId).sort();a.set(b,c)}return a}checkForStaleAssignment(){if(this.partitionsPerSubscribedTopic)for(let[a,b]of this.generatePartitionsPerSubscribedTopic()){let c=f(b,this.partitionsPerSubscribedTopic.get(a));if(c.length>0)throw new t("Topic has been updated",{topic:a,unknownPartitions:c})}}async seekOffsets(a){for(let{topic:b,partitions:c}of a)for(let a of c){let c=this.seekOffset.pop(b,a);c&&(this.logger.debug("Seek offset",{groupId:this.groupId,memberId:this.memberId,seek:c}),await this.offsetManager.seek(c))}await this.offsetManager.resolveOffsets()}hasSeekOffset({topic:a,partition:b}){return this.seekOffset.has(a,b)}findReadReplicaForPartitions(a,b){let c=this.cluster.findTopicPartitionMetadata(a),d=this.preferredReadReplicasPerTopicPartition[a];return b.reduce((b,e)=>{let f=parseInt(e,10),g=c.find(a=>a.partitionId===f);if(!g)return b;if(null==g.leader)throw new r("Invalid partition metadata",{topic:a,partitionId:f,metadata:g});let h=g.leader;if(d){let{nodeId:b,expireAt:c}=d[f]||{};if(Date.now()>=c)this.logger.debug("Preferred read replica information has expired, using leader",{topic:a,partitionId:f,groupId:this.groupId,memberId:this.memberId,preferredReadReplica:b,leader:g.leader}),delete d[f];else if(null!=b){let c=g.offlineReplicas;Array.isArray(c)&&c.includes(h)?this.logger.debug("Preferred read replica is offline, using leader",{topic:a,partitionId:f,groupId:this.groupId,memberId:this.memberId,preferredReadReplica:b,leader:g.leader}):h=b}}let i=b[h]||[];return{...b,[h]:[...i,f]}},{})}filterPartitionsByNode(a,b){return b.map(({topic:b,partitions:c})=>({topic:b,partitions:this.findReadReplicaForPartitions(b,c)[a]||[]}))}getActiveTopicPartitions(){let a=this.subscriptionState.active(),b={};return a.forEach(({topic:a,partitions:c})=>{b[a]=new Set(c)}),b}}},19672:(a,b,c)=>{let d=c(11153);a.exports=({groupId:a,groupGenerationId:b,memberId:c})=>Object.assign(d({groupId:a,groupGenerationId:b,memberId:c}),{apiVersion:2})},20207:(a,b,c)=>{let d={0:({topics:a,timeout:b})=>{let d=c(66631),e=c(94947);return{request:d({topics:a,timeout:b}),response:e}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},20388:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f,failIfVersionNotSupported:g}=c(88374);a.exports={decode:async a=>{let b=new d(a),c=b.readInt16();return g(c),{errorCode:c,enabledMechanisms:b.readArray(a=>a.readString())}},parse:async a=>{if(e(a.errorCode))throw f(a.errorCode);return a}}},20937:(a,b,c)=>{let d=c(96268),e=c(83857);a.exports=({replicaId:a,maxWaitTime:b,minBytes:c,maxBytes:f,topics:g,isolationLevel:h=d.READ_COMMITTED,sessionId:i=0,sessionEpoch:j=-1,forgottenTopics:k=[]})=>Object.assign(e({replicaId:a,maxWaitTime:b,minBytes:c,maxBytes:f,topics:g,isolationLevel:h,sessionId:i,sessionEpoch:j,forgottenTopics:k}),{apiVersion:10})},20967:(a,b,c)=>{"use strict";c.d(b,{S:()=>e,o:()=>f});var d=c(82442);function e(a,b,c){return(0,d.createMechanism)({region:a||"",credentials:{accessKeyId:b||"",secretAccessKey:c||""}})}let f=a=>{let b=a.host.replace(/^https?:\/\//,"");return a.useSSL?`https://${b}:${a.httpPort}`:`http://${b}:${a.httpPort}`}},21127:(a,b,c)=>{let d={0:({topicPartitions:a,timeout:b,validateOnly:d})=>{let e=c(49135),f=c(30651);return{request:e({topicPartitions:a,timeout:b,validateOnly:d}),response:f}},1:({topicPartitions:a,validateOnly:b,timeout:d})=>{let e=c(43388),f=c(59522);return{request:e({topicPartitions:a,validateOnly:b,timeout:d}),response:f}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},21569:(a,b,c)=>{let d={0:({transactionalId:a,producerId:b,producerEpoch:d,transactionResult:e})=>{let f=c(38737),g=c(28493);return{request:f({transactionalId:a,producerId:b,producerEpoch:d,transactionResult:e}),response:g}},1:({transactionalId:a,producerId:b,producerEpoch:d,transactionResult:e})=>{let f=c(36974),g=c(41372);return{request:f({transactionalId:a,producerId:b,producerEpoch:d,transactionResult:e}),response:g}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},21617:(a,b,c)=>{let{SCRAM:d,DIGESTS:e}=c(72718);a.exports=a=>({host:b,port:c,logger:f,saslAuthenticate:g})=>{let h=new d(a,b,c,f,g,e.SHA256);return{authenticate:async()=>await h.authenticate()}}},21767:(a,b,c)=>{let{decode:d,parse:e}=c(1214);a.exports={decode:d,parse:e}},22077:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=async a=>({topic:a.readString(),partitionErrors:await a.readArrayAsync(h)}),h=a=>({partition:a.readInt32(),errorCode:a.readInt16()});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),errors:await b.readArrayAsync(g)}},parse:async a=>{let b=a.errors.map(({partitionErrors:a})=>({partitionsWithErrors:a.filter(({errorCode:a})=>e(a))})).filter(({partitionsWithErrors:a})=>a.length);if(b.length>0)throw f(b[0].partitionsWithErrors[0].errorCode);return a}}},22361:(a,b,c)=>{let d={0:({topics:a})=>{let b=c(99545),d=c(40645);return{request:b({topics:a}),response:d}},1:({topics:a})=>{let b=c(53654),d=c(41684);return{request:b({topics:a}),response:d}},2:({topics:a})=>{let b=c(38403),d=c(15143);return{request:b({topics:a}),response:d}},3:({topics:a})=>{let b=c(10368),d=c(10494);return{request:b({topics:a}),response:d}},4:({topics:a,allowAutoTopicCreation:b})=>{let d=c(74765),e=c(79777);return{request:d({topics:a,allowAutoTopicCreation:b}),response:e}},5:({topics:a,allowAutoTopicCreation:b})=>{let d=c(35066),e=c(51664);return{request:d({topics:a,allowAutoTopicCreation:b}),response:e}},6:({topics:a,allowAutoTopicCreation:b})=>{let d=c(28375),e=c(30995);return{request:d({topics:a,allowAutoTopicCreation:b}),response:e}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},22631:a=>{a.exports={UNKNOWN:0,ANY:1,TOPIC:2,GROUP:3,CLUSTER:4,TRANSACTIONAL_ID:5,DELEGATION_TOKEN:6}},22980:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),{KafkaJSAggregateError:g,KafkaJSCreateTopicError:h}=c(16920),i=(a,b)=>a.topic.localeCompare(b.topic),j=a=>({topic:a.readString(),errorCode:a.readInt16()});a.exports={decode:async a=>({topicErrors:new d(a).readArray(j).sort(i)}),parse:async a=>{let b=a.topicErrors.filter(({errorCode:a})=>e(a));if(b.length>0)throw new g("Topic creation errors",b.map(a=>new h(f(a.errorCode),a.topic)));return a}}},23025:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>({memberId:a.readString(),clientId:a.readString(),clientHost:a.readString(),memberMetadata:a.readBytes(),memberAssignment:a.readBytes()}),h=a=>({errorCode:a.readInt16(),groupId:a.readString(),state:a.readString(),protocolType:a.readString(),protocol:a.readString(),members:a.readArray(g)});a.exports={decode:async a=>({groups:new d(a).readArray(h)}),parse:async a=>{let b=a.groups.filter(({errorCode:a})=>e(a));if(b.length>0)throw f(b[0].errorCode);return a}}},23129:(a,b,c)=>{let d=c(36247);a.exports=({acks:a,timeout:b,transactionalId:c,producerId:e,producerEpoch:f,compression:g,topicData:h})=>Object.assign(d({acks:a,timeout:b,transactionalId:c,producerId:e,producerEpoch:f,compression:g,topicData:h}),{apiVersion:5})},23505:a=>{a.exports=a=>a.map(({topic:a,partitions:b,messagesPerPartition:c,sequencePerPartition:d})=>({topic:a,partitions:b.map(a=>({partition:a,messages:c[a]}))}))},23552:(a,b,c)=>{let{parse:d,decode:e}=c(80465);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},23704:(a,b,c)=>{let{parse:d,decode:e}=c(61641);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},24661:(a,b,c)=>{let d=c(49156),e=c(45500);a.exports={decode:async a=>{let b=new e(a),c=b.readInt32();return{throttleTime:c,errorCode:b.readInt16(),groups:b.readArray(d.decodeGroup)}},parse:d.parse}},24864:(a,b,c)=>{let d=c(39652),{GroupCoordinator:e}=c(81451);a.exports=({coordinatorKey:a,coordinatorType:b})=>({apiKey:e,apiVersion:1,apiName:"GroupCoordinator",encode:async()=>new d().writeString(a).writeInt8(b)})},25172:(a,b,c)=>{let d=c(96268),e=-1,f=a=>Number.isSafeInteger(a+100)?a+100:a,g={0:({replicaId:a=e,maxWaitTime:b,minBytes:d,topics:g})=>{let h=c(15558),i=c(63300);return{request:h({replicaId:a,maxWaitTime:b,minBytes:d,topics:g}),response:i,requestTimeout:f(b)}},1:({replicaId:a=e,maxWaitTime:b,minBytes:d,topics:g})=>{let h=c(67945),i=c(57333);return{request:h({replicaId:a,maxWaitTime:b,minBytes:d,topics:g}),response:i,requestTimeout:f(b)}},2:({replicaId:a=e,maxWaitTime:b,minBytes:d,topics:g})=>{let h=c(87600),i=c(17262);return{request:h({replicaId:a,maxWaitTime:b,minBytes:d,topics:g}),response:i,requestTimeout:f(b)}},3:({replicaId:a=e,maxWaitTime:b,minBytes:d,maxBytes:g,topics:h})=>{let i=c(57011),j=c(28791);return{request:i({replicaId:a,maxWaitTime:b,minBytes:d,maxBytes:g,topics:h}),response:j,requestTimeout:f(b)}},4:({replicaId:a=e,isolationLevel:b=d.READ_COMMITTED,maxWaitTime:g,minBytes:h,maxBytes:i,topics:j})=>{let k=c(27114),l=c(44096);return{request:k({replicaId:a,isolationLevel:b,maxWaitTime:g,minBytes:h,maxBytes:i,topics:j}),response:l,requestTimeout:f(g)}},5:({replicaId:a=e,isolationLevel:b=d.READ_COMMITTED,maxWaitTime:g,minBytes:h,maxBytes:i,topics:j})=>{let k=c(28573),l=c(82865);return{request:k({replicaId:a,isolationLevel:b,maxWaitTime:g,minBytes:h,maxBytes:i,topics:j}),response:l,requestTimeout:f(g)}},6:({replicaId:a=e,isolationLevel:b=d.READ_COMMITTED,maxWaitTime:g,minBytes:h,maxBytes:i,topics:j})=>{let k=c(44628),l=c(28362);return{request:k({replicaId:a,isolationLevel:b,maxWaitTime:g,minBytes:h,maxBytes:i,topics:j}),response:l,requestTimeout:f(g)}},7:({replicaId:a=e,isolationLevel:b=d.READ_COMMITTED,sessionId:g=0,sessionEpoch:h=-1,forgottenTopics:i=[],maxWaitTime:j,minBytes:k,maxBytes:l,topics:m})=>{let n=c(9127),o=c(10467);return{request:n({replicaId:a,isolationLevel:b,sessionId:g,sessionEpoch:h,forgottenTopics:i,maxWaitTime:j,minBytes:k,maxBytes:l,topics:m}),response:o,requestTimeout:f(j)}},8:({replicaId:a=e,isolationLevel:b=d.READ_COMMITTED,sessionId:g=0,sessionEpoch:h=-1,forgottenTopics:i=[],maxWaitTime:j,minBytes:k,maxBytes:l,topics:m})=>{let n=c(98446),o=c(6460);return{request:n({replicaId:a,isolationLevel:b,sessionId:g,sessionEpoch:h,forgottenTopics:i,maxWaitTime:j,minBytes:k,maxBytes:l,topics:m}),response:o,requestTimeout:f(j)}},9:({replicaId:a=e,isolationLevel:b=d.READ_COMMITTED,sessionId:g=0,sessionEpoch:h=-1,forgottenTopics:i=[],maxWaitTime:j,minBytes:k,maxBytes:l,topics:m})=>{let n=c(83857),o=c(93581);return{request:n({replicaId:a,isolationLevel:b,sessionId:g,sessionEpoch:h,forgottenTopics:i,maxWaitTime:j,minBytes:k,maxBytes:l,topics:m}),response:o,requestTimeout:f(j)}},10:({replicaId:a=e,isolationLevel:b=d.READ_COMMITTED,sessionId:g=0,sessionEpoch:h=-1,forgottenTopics:i=[],maxWaitTime:j,minBytes:k,maxBytes:l,topics:m})=>{let n=c(20937),o=c(83669);return{request:n({replicaId:a,isolationLevel:b,sessionId:g,sessionEpoch:h,forgottenTopics:i,maxWaitTime:j,minBytes:k,maxBytes:l,topics:m}),response:o,requestTimeout:f(j)}},11:({replicaId:a=e,isolationLevel:b=d.READ_COMMITTED,sessionId:g=0,sessionEpoch:h=-1,forgottenTopics:i=[],maxWaitTime:j,minBytes:k,maxBytes:l,topics:m,rackId:n})=>{let o=c(95238),p=c(39364);return{request:o({replicaId:a,isolationLevel:b,sessionId:g,sessionEpoch:h,forgottenTopics:i,maxWaitTime:j,minBytes:k,maxBytes:l,topics:m,rackId:n}),response:p,requestTimeout:f(j)}}};a.exports={versions:Object.keys(g),protocol:({version:a})=>g[a]}},25506:(a,b,c)=>{let{format:d}=c(28354),{KafkaJSLockTimeout:e}=c(16920),f={LOCKED:Symbol("private:Lock:locked"),TIMEOUT:Symbol("private:Lock:timeout"),WAITING:Symbol("private:Lock:waiting"),TIMEOUT_ERROR_MESSAGE:Symbol("private:Lock:timeoutErrorMessage")};a.exports=class{constructor({timeout:a,description:b=null}={}){if("number"!=typeof a)throw TypeError(`'timeout' is not a number, received '${typeof a}'`);this[f.LOCKED]=!1,this[f.TIMEOUT]=a,this[f.WAITING]=new Set,this[f.TIMEOUT_ERROR_MESSAGE]=()=>{let a=d("Timeout while acquiring lock (%d waiting locks)",this[f.WAITING].size);return b?`${a}: "${b}"`:a}}async acquire(){return new Promise((a,b)=>{if(!this[f.LOCKED])return this[f.LOCKED]=!0,a();let c=null,d=async()=>{if(!this[f.LOCKED])return this[f.LOCKED]=!0,clearTimeout(c),this[f.WAITING].delete(d),a()};this[f.WAITING].add(d),c=setTimeout(()=>{let a=new e(this[f.TIMEOUT_ERROR_MESSAGE]());this[f.WAITING].delete(d),b(a)},this[f.TIMEOUT])})}async release(){this[f.LOCKED]=!1;let a=this[f.WAITING].values().next().value;if(a)return a()}}},25700:(a,b,c)=>{let d={0:({resources:a})=>{let b=c(58070),d=c(53940);return{request:b({resources:a}),response:d}},1:({resources:a,includeSynonyms:b})=>{let d=c(13881),e=c(68229);return{request:d({resources:a,includeSynonyms:b}),response:e}},2:({resources:a,includeSynonyms:b})=>{let d=c(26528),e=c(1406);return{request:d({resources:a,includeSynonyms:b}),response:e}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},26069:(a,b,c)=>{let d=c(45500),{parse:e}=c(22980),f=(a,b)=>a.topic.localeCompare(b.topic),g=a=>({topic:a.readString(),errorCode:a.readInt16(),errorMessage:a.readString()});a.exports={decode:async a=>({topicErrors:new d(a).readArray(g).sort(f)}),parse:e}},26074:(a,b,c)=>{let d=c(39652),{DescribeAcls:e}=c(81451);a.exports=({resourceType:a,resourceName:b,principal:c,host:f,operation:g,permissionType:h})=>({apiKey:e,apiVersion:0,apiName:"DescribeAcls",encode:async()=>new d().writeInt8(a).writeString(b).writeString(c).writeString(f).writeInt8(g).writeInt8(h)})},26343:(a,b,c)=>{let d=c(39652);a.exports=({key:a,value:b})=>new d().writeVarIntString(a).writeVarIntBytes(b)},26528:(a,b,c)=>{let d=c(13881);a.exports=({resources:a,includeSynonyms:b})=>Object.assign(d({resources:a,includeSynonyms:b}),{apiVersion:2})},26632:(a,b,c)=>{let d=c(39652),{OffsetFetch:e}=c(81451);a.exports=({groupId:a,topics:b})=>({apiKey:e,apiVersion:3,apiName:"OffsetFetch",encode:async()=>new d().writeString(a).writeNullableArray(b.map(f))});let f=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(g)),g=({partition:a})=>new d().writeInt32(a)},26808:(a,b,c)=>{let d=c(83611);a.exports=({topics:a,timeout:b})=>Object.assign(d({topics:a,timeout:b}),{apiVersion:1})},26826:a=>{a.exports=a=>new Promise(b=>{setTimeout(b,a)})},26902:(a,b,c)=>{let{parse:d,decode:e}=c(6303);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},27056:(a,b,c)=>{let{request:d,response:e}=c(12777),{KafkaJSSASLAuthenticationError:f}=c(16920);a.exports=a=>({host:b,port:c,logger:g,saslAuthenticate:h})=>({authenticate:async()=>{if(!a.authorizationIdentity)throw new f("SASL AWS-IAM: Missing authorizationIdentity");if(!a.accessKeyId)throw new f("SASL AWS-IAM: Missing accessKeyId");if(!a.secretAccessKey)throw new f("SASL AWS-IAM: Missing secretAccessKey");a.sessionToken||(a.sessionToken="");let i=`${b}:${c}`;try{g.debug("Authenticate with SASL AWS-IAM",{broker:i}),await h({request:d(a),response:e}),g.debug("SASL AWS-IAM authentication successful",{broker:i})}catch(b){let a=new f(`SASL AWS-IAM authentication failed: ${b.message}`);throw g.error(a.message,{broker:i}),a}}})},27114:(a,b,c)=>{let d=c(39652),{Fetch:e}=c(81451),f=c(96268);a.exports=({replicaId:a,maxWaitTime:b,minBytes:c,maxBytes:h,topics:i,isolationLevel:j=f.READ_COMMITTED})=>({apiKey:e,apiVersion:4,apiName:"Fetch",encode:async()=>new d().writeInt32(a).writeInt32(b).writeInt32(c).writeInt32(h).writeInt8(j).writeArray(i.map(g))});let g=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(h)),h=({partition:a,fetchOffset:b,maxBytes:c})=>new d().writeInt32(a).writeInt64(b).writeInt32(c)},27816:(a,b,c)=>{let d=c(2087),e=c(40297);a.exports=class{constructor(a,b,c){this.fetchedOffset=b;let f=d.fromValue(this.fetchedOffset),{abortedTransactions:g,messages:h}=c;this.topic=a,this.partition=c.partition,this.highWatermark=c.highWatermark,this.rawMessages=h,this.messagesWithinOffset=this.rawMessages.filter(a=>d.fromValue(a.offset).gte(f)),this.messages=e({messages:this.messagesWithinOffset,abortedTransactions:g}).filter(a=>!a.isControlRecord)}isEmpty(){return 0===this.messages.length}isEmptyIncludingFiltered(){return 0===this.messagesWithinOffset.length}isEmptyDueToFiltering(){return this.isEmpty()&&this.rawMessages.length>0}isEmptyControlRecord(){return this.isEmpty()&&this.messagesWithinOffset.some(({isControlRecord:a})=>a)}isEmptyDueToLogCompactedMessages(){return this.rawMessages.length>0&&this.isEmptyIncludingFiltered()}firstOffset(){return this.isEmptyIncludingFiltered()?null:this.messagesWithinOffset[0].offset}lastOffset(){return this.isEmptyDueToLogCompactedMessages()?this.fetchedOffset:this.isEmptyIncludingFiltered()?d.fromValue(this.highWatermark).add(-1).toString():this.messagesWithinOffset[this.messagesWithinOffset.length-1].offset}offsetLag(){let a=d.fromValue(this.highWatermark).add(-1),b=d.fromValue(this.lastOffset());return a.add(b.multiply(-1)).toString()}offsetLagLow(){if(this.isEmptyIncludingFiltered())return"0";let a=d.fromValue(this.highWatermark).add(-1),b=d.fromValue(this.firstOffset());return a.add(b.multiply(-1)).toString()}}},28025:(a,b,c)=>{let d=c(78665);a.exports=a=>{let b;return b=d(a),Uint32Array.from([b])[0]}},28063:(a,b,c)=>{let d=c(76669),{keys:e,assign:f}=Object,g=(a,{partition:b,offset:c})=>f(a,{[b]:c}),h=(a,{topic:b,partitions:c})=>f(a,{[b]:c.reduce(g,{})});a.exports=(a,b)=>{let c=a.reduce(h,{}),f=b.reduce(h,{});return e(c).map(a=>{let b=c[a];return{topic:a,partitions:e(b).map(c=>{let e=b[c],g=d(e)?f[a][c]:e;return{partition:Number(c),offset:g}})}})}},28362:(a,b,c)=>{let{decode:d,parse:e}=c(82865);a.exports={decode:d,parse:e}},28375:(a,b,c)=>{let d=c(35066);a.exports=({topics:a,allowAutoTopicCreation:b=!0})=>Object.assign(d({topics:a,allowAutoTopicCreation:b}),{apiVersion:6})},28493:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f,failIfVersionNotSupported:g}=c(88374);a.exports={decode:async a=>{let b=new d(a),c=b.readInt32(),e=b.readInt16();return g(e),{throttleTime:c,errorCode:e}},parse:async a=>{if(e(a.errorCode))throw f(a.errorCode);return a}}},28573:(a,b,c)=>{let d=c(39652),{Fetch:e}=c(81451),f=c(96268);a.exports=({replicaId:a,maxWaitTime:b,minBytes:c,maxBytes:h,topics:i,isolationLevel:j=f.READ_COMMITTED})=>({apiKey:e,apiVersion:5,apiName:"Fetch",encode:async()=>new d().writeInt32(a).writeInt32(b).writeInt32(c).writeInt32(h).writeInt8(j).writeArray(i.map(g))});let g=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(h)),h=({partition:a,fetchOffset:b,logStartOffset:c=-1,maxBytes:e})=>new d().writeInt32(a).writeInt64(b).writeInt64(c).writeInt32(e)},28791:(a,b,c)=>{let{decode:d,parse:e}=c(57333);a.exports={decode:d,parse:e}},29476:(a,b,c)=>{let d=c(49017);a.exports=({groupId:a,groupGenerationId:b,memberId:c,retentionTime:e,topics:f})=>Object.assign(d({groupId:a,groupGenerationId:b,memberId:c,retentionTime:e,topics:f}),{apiVersion:4})},29710:a=>{let b=a=>({topic:a,paused:new Set,pauseAll:!1,resumed:new Set});a.exports=class{constructor(){this.assignedPartitionsByTopic={},this.subscriptionStatesByTopic={}}assign(a=[]){this.assignedPartitionsByTopic=a.reduce((a,{topic:b,partitions:c=[]})=>({...a,[b]:{topic:b,partitions:c}}),{})}pause(a=[]){a.forEach(({topic:a,partitions:c})=>{let d=this.subscriptionStatesByTopic[a]||b(a);void 0===c?(d.paused.clear(),d.resumed.clear(),d.pauseAll=!0):Array.isArray(c)&&(c.forEach(a=>{d.paused.add(a),d.resumed.delete(a)}),d.pauseAll=!1),this.subscriptionStatesByTopic[a]=d})}resume(a=[]){a.forEach(({topic:a,partitions:c})=>{let d=this.subscriptionStatesByTopic[a]||b(a);void 0===c?(d.paused.clear(),d.resumed.clear(),d.pauseAll=!1):Array.isArray(c)&&c.forEach(a=>{d.paused.delete(a),d.pauseAll&&d.resumed.add(a)}),this.subscriptionStatesByTopic[a]=d})}assigned(){return Object.values(this.assignedPartitionsByTopic).map(({topic:a,partitions:b})=>({topic:a,partitions:b.sort()}))}active(){return Object.values(this.assignedPartitionsByTopic).map(({topic:a,partitions:b})=>({topic:a,partitions:b.filter(b=>!this.isPaused(a,b)).sort()}))}paused(){return Object.values(this.assignedPartitionsByTopic).map(({topic:a,partitions:b})=>({topic:a,partitions:b.filter(b=>this.isPaused(a,b)).sort()})).filter(({partitions:a})=>0!==a.length)}isPaused(a,b){let c=this.subscriptionStatesByTopic[a];if(!c)return!1;let d=c.resumed.has(b),e=c.paused.has(b);return c.pauseAll&&!d||e}}},30651:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=(a,b)=>a.topic.localeCompare(b.topic),h=a=>({topic:a.readString(),errorCode:a.readInt16(),errorMessage:a.readString()});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),topicErrors:b.readArray(h).sort(g)}},parse:async a=>{let b=a.topicErrors.filter(({errorCode:a})=>e(a));if(b.length>0)throw f(b[0].errorCode);return a}}},30995:(a,b,c)=>{let{parse:d,decode:e}=c(51664);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},31172:(a,b,c)=>{let d=c(39652),{Produce:e}=c(81451),f=c(50196),{Types:g,lookupCodec:h}=c(61097);a.exports=({acks:a,timeout:b,compression:c=g.None,topicData:f})=>({apiKey:e,apiVersion:2,apiName:"Produce",expectResponse:()=>0!==a,encode:async()=>{let e=i(c),g=[];for(let a of f)g.push(await e(a));return new d().writeInt16(a).writeInt32(b).writeArray(g)}});let i=a=>{let b=j(a);return async({topic:a,partitions:c})=>{let e=[];for(let a of c)e.push(await b(a));return new d().writeString(a).writeArray(e)}},j=a=>async({partition:b,messages:c})=>{let e=f({messageVersion:1,compression:a,entries:c});if(a===g.None)return new d().writeInt32(b).writeInt32(e.size()).writeEncoder(e);let i=c[0].timestamp||Date.now(),j=h(a),k=f({messageVersion:1,entries:[{compression:a,timestamp:i,value:await j.compress(e)}]});return new d().writeInt32(b).writeInt32(k.size()).writeEncoder(k)}},31311:a=>{a.exports=async(a,b)=>{let c=new Map;for(let d of a){let a=await Promise.resolve(b(d));c.set(a,c.has(a)?[...c.get(a),d]:[d])}return c}},32067:(a,b,c)=>{let{parse:d,decode:e}=c(49962);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},32126:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>({topic:a.readString(),partitions:a.readArray(h)}),h=a=>({partition:a.readInt32(),errorCode:a.readInt16()});a.exports={decode:async a=>({responses:new d(a).readArray(g)}),parse:async a=>{let b=a.responses.flatMap(a=>a.partitions.filter(a=>e(a.errorCode)))[0];if(b)throw f(b.errorCode);return a}}},32333:(a,b,c)=>{let d=c(43290);a.exports=({acks:a,timeout:b,topicData:c})=>Object.assign(d({acks:a,timeout:b,topicData:c}),{apiVersion:1})},32346:(a,b,c)=>{let d={0:({transactionalId:a,producerId:b,producerEpoch:d,groupId:e})=>{let f=c(9524),g=c(49962);return{request:f({transactionalId:a,producerId:b,producerEpoch:d,groupId:e}),response:g}},1:({transactionalId:a,producerId:b,producerEpoch:d,groupId:e})=>{let f=c(74023),g=c(32067);return{request:f({transactionalId:a,producerId:b,producerEpoch:d,groupId:e}),response:g}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},32420:(a,b,c)=>{let{SCRAM:d,DIGESTS:e}=c(72718);a.exports=a=>({host:b,port:c,logger:f,saslAuthenticate:g})=>{let h=new d(a,b,c,f,g,e.SHA512);return{authenticate:async()=>await h.authenticate()}}},32802:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f,failIfVersionNotSupported:g}=c(88374);a.exports={decode:async a=>{let b=new d(a).readInt16();return g(b),{errorCode:b}},parse:async a=>{if(e(a.errorCode))throw f(a.errorCode);return a}}},32937:(a,b,c)=>{let d=c(2087),e=c(76669),f=c(28063),{events:{COMMIT_OFFSETS:g}}=c(60695),{keys:h,assign:i}=Object,j={COMMITTED_OFFSETS:Symbol("private:OffsetManager:committedOffsets")};a.exports=class{constructor({cluster:a,coordinator:b,memberAssignment:c,autoCommit:d,autoCommitInterval:e,autoCommitThreshold:f,topicConfigurations:g,instrumentationEmitter:i,groupId:j,generationId:k,memberId:l}){this.cluster=a,this.coordinator=b,this.memberAssignment=c,this.topicConfigurations=g,this.instrumentationEmitter=i,this.groupId=j,this.generationId=k,this.memberId=l,this.autoCommit=d,this.autoCommitInterval=e,this.autoCommitThreshold=f,this.lastCommit=Date.now(),this.topics=h(c),this.clearAllOffsets()}nextOffset(a,b){this.resolvedOffsets[a][b]||(this.resolvedOffsets[a][b]=this.committedOffsets()[a][b]);let c=this.resolvedOffsets[a][b];return e(c)&&(c="0"),d.fromValue(c)}async getCoordinator(){return this.coordinator.isConnected()||(this.coordinator=await this.cluster.findBroker(this.coordinator)),this.coordinator}resetOffset({topic:a,partition:b}){this.resolvedOffsets[a][b]=this.committedOffsets()[a][b]}resolveOffset({topic:a,partition:b,offset:c}){this.resolvedOffsets[a][b]=d.fromValue(c).add(1).toString()}countResolvedOffsets(){let a=this.committedOffsets();return this.topics.flatMap(b=>{let c,f;return c=this.resolvedOffsets[b],f=a[b],h(c).map(a=>((a,b)=>{let c=d.fromValue(a);return e(b)?c:c.subtract(d.fromValue(b))})(c[a],f[a]))}).reduce((a,b)=>a.add(b),d.fromValue(0))}async setDefaultOffset({topic:a,partition:b}){let{groupId:c,generationId:d,memberId:e}=this,f=this.cluster.defaultOffset(this.topicConfigurations[a]),g=await this.getCoordinator();await g.offsetCommit({groupId:c,memberId:e,groupGenerationId:d,topics:[{topic:a,partitions:[{partition:b,offset:f}]}]}),this.clearOffsets({topic:a,partition:b})}async seek({topic:a,partition:b,offset:c}){if(!this.memberAssignment[a]||!this.memberAssignment[a].includes(b))return;if(!this.autoCommit)return void this.resolveOffset({topic:a,partition:b,offset:d.fromValue(c).subtract(1).toString()});let{groupId:e,generationId:f,memberId:g}=this,h=await this.getCoordinator();await h.offsetCommit({groupId:e,memberId:g,groupGenerationId:f,topics:[{topic:a,partitions:[{partition:b,offset:c}]}]}),this.clearOffsets({topic:a,partition:b})}async commitOffsetsIfNecessary(){let a=Date.now(),b=null!=this.autoCommitInterval&&a>=this.lastCommit+this.autoCommitInterval,c=null!=this.autoCommitThreshold&&this.countResolvedOffsets().gte(d.fromValue(this.autoCommitThreshold));if(b||c)return this.commitOffsets()}uncommittedOffsets(){return{topics:this.topics.map(a=>({topic:a,partitions:h(this.resolvedOffsets[a]).map(b=>({partition:b,offset:this.resolvedOffsets[a][b]})).filter(({partition:b,offset:c})=>c!==this.committedOffsets()[a][b]&&d.fromValue(c).greaterThanOrEqual(0))})).filter(({partitions:a})=>a.length>0)}}async commitOffsets(a={}){let{groupId:b,generationId:c,memberId:d}=this,{topics:e=this.uncommittedOffsets().topics}=a;if(0===e.length){this.lastCommit=Date.now();return}let f={groupId:b,memberId:d,groupGenerationId:c,topics:e};try{let a=await this.getCoordinator();await a.offsetCommit(f),this.instrumentationEmitter.emit(g,f),e.forEach(({topic:a,partitions:b})=>{let c=b.reduce((a,{partition:b,offset:c})=>i(a,{[b]:c}),{});this[j.COMMITTED_OFFSETS][a]=i({},this.committedOffsets()[a],c)}),this.lastCommit=Date.now()}catch(a){throw"NOT_COORDINATOR_FOR_GROUP"===a.type&&await this.cluster.refreshMetadata(),a}}async resolveOffsets(){let{groupId:a}=this,b=this.topics.map(a=>({topic:a,partitions:this.memberAssignment[a].filter(b=>e(this.committedOffsets()[a][b])).map(a=>({partition:a}))})).filter(a=>a.partitions.length>0);if(0===b.length)return;let c=await this.getCoordinator(),{responses:d}=await c.offsetFetch({groupId:a,topics:b}),g=d.map(({topic:a,partitions:b})=>i({topic:a,partitions:b.filter(({offset:a})=>e(a)).map(({partition:a})=>i({partition:a}))},this.topicConfigurations[a])),h=(a,{partition:b,offset:c})=>i(a,{[b]:c}),j=d;g.some(a=>a.partitions.length>0)&&(j=f(d,await this.cluster.fetchTopicsOffset(g))),j.forEach(({topic:a,partitions:b})=>{this.committedOffsets()[a]=b.reduce(h,{...this.committedOffsets()[a]})})}clearOffsets({topic:a,partition:b}){delete this.committedOffsets()[a][b],delete this.resolvedOffsets[a][b]}clearAllOffsets(){let a=this.committedOffsets();for(let b in a)delete a[b];for(let b of this.topics)a[b]={};this.resolvedOffsets=this.topics.reduce((a,b)=>i(a,{[b]:{}}),{})}committedOffsets(){return this[j.COMMITTED_OFFSETS]||(this[j.COMMITTED_OFFSETS]=this.groupId?this.cluster.committedOffsets({groupId:this.groupId}):{}),this[j.COMMITTED_OFFSETS]}}},33116:(a,b,c)=>{let d=c(45500),{failIfVersionNotSupported:e}=c(88374),{parse:f}=c(49869),g=a=>({apiKey:a.readInt16(),minVersion:a.readInt16(),maxVersion:a.readInt16()});a.exports={decode:async a=>{let b=new d(a),c=b.readInt16();return e(c),{errorCode:c,apiVersions:b.readArray(g),throttleTime:b.canReadInt32()?b.readInt32():0}},parse:f}},33330:a=>{a.exports={UNKNOWN:0,ANY:1,DENY:2,ALLOW:3}},33440:(a,b,c)=>{let d=c(39652),{ListOffsets:e}=c(81451);a.exports=({replicaId:a,isolationLevel:b,topics:c})=>({apiKey:e,apiVersion:2,apiName:"ListOffsets",encode:async()=>new d().writeInt32(a).writeInt8(b).writeArray(c.map(f))});let f=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(g)),g=({partition:a,timestamp:b=-1})=>new d().writeInt32(a).writeInt64(b)},33590:(a,b,c)=>{let d=c(45500),{parse:e}=c(91839),f=a=>({topic:a.readString(),partitions:a.readArray(g)}),g=a=>({partition:a.readInt32(),offset:a.readInt64().toString(),metadata:a.readString(),errorCode:a.readInt16()});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),responses:b.readArray(f),errorCode:b.readInt16()}},parse:e}},34317:(a,b,c)=>{let{decode:d,parse:e}=c(17564);a.exports={decode:d,parse:e}},34339:(a,b,c)=>{let{parse:d,decode:e}=c(49792);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},35066:(a,b,c)=>{let d=c(74765);a.exports=({topics:a,allowAutoTopicCreation:b=!0})=>Object.assign(d({topics:a,allowAutoTopicCreation:b}),{apiVersion:5})},35521:(a,b,c)=>{let{KafkaJSRequestTimeoutError:d,KafkaJSNonRetriableError:e}=c(16920),f=c(67449),g={STATE:Symbol("private:SocketRequest:state"),EMIT_EVENT:Symbol("private:SocketRequest:emitEvent")},h={PENDING:Symbol("PENDING"),SENT:Symbol("SENT"),COMPLETED:Symbol("COMPLETED"),REJECTED:Symbol("REJECTED")};a.exports=class{constructor({requestTimeout:a,broker:b,clientId:c,entry:d,expectResponse:e,send:f,timeout:i,instrumentationEmitter:j=null}){this.createdAt=Date.now(),this.requestTimeout=a,this.broker=b,this.clientId=c,this.entry=d,this.correlationId=d.correlationId,this.expectResponse=e,this.sendRequest=f,this.timeoutHandler=i,this.sentAt=null,this.duration=null,this.pendingDuration=null,this[g.STATE]=h.PENDING,this[g.EMIT_EVENT]=(a,b)=>j&&j.emit(a,b)}send(){this.throwIfInvalidState({accepted:[h.PENDING],next:h.SENT}),this.sendRequest(),this.sentAt=Date.now(),this.pendingDuration=this.sentAt-this.createdAt,this[g.STATE]=h.SENT}timeoutRequest(){let{apiName:a,apiKey:b,apiVersion:c}=this.entry,e=`${a}(key: ${b}, version: ${c})`,h={broker:this.broker,clientId:this.clientId,correlationId:this.correlationId,createdAt:this.createdAt,sentAt:this.sentAt,pendingDuration:this.pendingDuration};this.timeoutHandler(),this.rejected(new d(`Request ${e} timed out`,h)),this[g.EMIT_EVENT](f.NETWORK_REQUEST_TIMEOUT,{...h,apiName:a,apiKey:b,apiVersion:c})}completed({size:a,payload:b}){this.throwIfInvalidState({accepted:[h.SENT],next:h.COMPLETED});let{entry:c,correlationId:d,broker:e,clientId:i,createdAt:j,sentAt:k,pendingDuration:l}=this;this[g.STATE]=h.COMPLETED,this.duration=Date.now()-this.sentAt,c.resolve({correlationId:d,entry:c,size:a,payload:b}),this[g.EMIT_EVENT](f.NETWORK_REQUEST,{broker:e,clientId:i,correlationId:d,size:a,createdAt:j,sentAt:k,pendingDuration:l,duration:this.duration,apiName:c.apiName,apiKey:c.apiKey,apiVersion:c.apiVersion})}rejected(a){this.throwIfInvalidState({accepted:[h.PENDING,h.SENT],next:h.REJECTED}),this[g.STATE]=h.REJECTED,this.duration=Date.now()-this.sentAt,this.entry.reject(a)}throwIfInvalidState({accepted:a,next:b}){if(a.includes(this[g.STATE]))return;let c=this[g.STATE].toString();throw new e(`Invalid state, can't transition from ${c} to ${b.toString()}`)}}},35528:(a,b,c)=>{let d=c(65848);a.exports=({resources:a,validateOnly:b})=>Object.assign(d({resources:a,validateOnly:b}),{apiVersion:1})},35558:(a,b,c)=>{let d=c(45500),{KafkaJSMemberIdRequired:e}=c(16920),{failure:f,createErrorFromCode:g,errorCodes:h,failIfVersionNotSupported:i}=c(88374),{code:j}=h.find(a=>"MEMBER_ID_REQUIRED"===a.type);a.exports={decode:async a=>{let b=new d(a),c=b.readInt32(),e=b.readInt16();return i(e),{throttleTime:0,clientSideThrottleTime:c,errorCode:e,generationId:b.readInt32(),groupProtocol:b.readString(),leaderId:b.readString(),memberId:b.readString(),members:b.readArray(a=>({memberId:a.readString(),groupInstanceId:a.readString(),memberMetadata:a.readBytes()}))}},parse:async a=>{if(f(a.errorCode)){if(a.errorCode===j)throw new e(g(a.errorCode),{memberId:a.memberId});throw g(a.errorCode)}return a}}},36016:(a,b,c)=>{let d=c(83529);a.exports=({topics:a,validateOnly:b,timeout:c})=>Object.assign(d({topics:a,validateOnly:b,timeout:c}),{apiVersion:2})},36070:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f,failIfVersionNotSupported:g}=c(88374);a.exports={decode:async a=>{let b=new d(a),c=b.readInt16();return g(c),{errorCode:c,memberAssignment:b.readBytes()}},parse:async a=>{if(e(a.errorCode))throw f(a.errorCode);return a}}},36218:(a,b,c)=>{let d={0:({authBytes:a})=>{let b=c(75348),d=c(5642);return{request:b({authBytes:a}),response:d}},1:({authBytes:a})=>{let b=c(94695),d=c(16515);return{request:b({authBytes:a}),response:d}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},36247:(a,b,c)=>{let d=c(2087),e=c(39652),{Produce:f}=c(81451),{Types:g}=c(61097),h=c(92635),{RecordBatch:i}=c(74943);a.exports=({acks:a,timeout:b,transactionalId:c=null,producerId:h=d.fromInt(-1),producerEpoch:i=0,compression:k=g.None,topicData:l})=>({apiKey:f,apiVersion:3,apiName:"Produce",expectResponse:()=>0!==a,encode:async()=>{let d=j(k),f=[];for(let a of l)f.push(await d({...a,transactionalId:c,producerId:h,producerEpoch:i}));return new e().writeString(c).writeInt16(a).writeInt32(b).writeArray(f)}});let j=a=>async({topic:b,partitions:c,transactionalId:d,producerId:f,producerEpoch:g})=>{let h=k(a),i=[];for(let a of c)i.push(await h({...a,transactionalId:d,producerId:f,producerEpoch:g}));return new e().writeString(b).writeArray(i)},k=a=>async({partition:b,messages:c,transactionalId:d,firstSequence:f,producerId:g,producerEpoch:j})=>{let k=Date.now(),l=c.map(a=>a.timestamp).filter(a=>null!=a).sort(),m=0===l.length?[k]:l,n=m[0],o=m[m.length-1],p=c.map((a,b)=>h({...a,offsetDelta:b,timestampDelta:(a.timestamp||k)-n})),q=await i({compression:a,records:p,firstTimestamp:n,maxTimestamp:o,producerId:g,producerEpoch:j,firstSequence:f,transactional:!!d,lastOffsetDelta:p.length-1});return new e().writeInt32(b).writeInt32(q.size()).writeEncoder(q)}},36445:(a,b,c)=>{let d=c(39652),{DescribeGroups:e}=c(81451);a.exports=({groupIds:a})=>({apiKey:e,apiVersion:0,apiName:"DescribeGroups",encode:async()=>new d().writeArray(a)})},36493:(a,b,c)=>{let d={0:({groupIds:a})=>{let b=c(36445),d=c(23025);return{request:b({groupIds:a}),response:d}},1:({groupIds:a})=>{let b=c(36554),d=c(49792);return{request:b({groupIds:a}),response:d}},2:({groupIds:a})=>{let b=c(83175),d=c(34339);return{request:b({groupIds:a}),response:d}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},36554:(a,b,c)=>{let d=c(36445);a.exports=({groupIds:a})=>Object.assign(d({groupIds:a}),{apiVersion:1})},36603:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f,failIfVersionNotSupported:g}=c(88374);a.exports={decode:async a=>{let b=new d(a),c=b.readInt16();return g(c),{errorCode:c,generationId:b.readInt32(),groupProtocol:b.readString(),leaderId:b.readString(),memberId:b.readString(),members:b.readArray(a=>({memberId:a.readString(),memberMetadata:a.readBytes()}))}},parse:async a=>{if(e(a.errorCode))throw f(a.errorCode);return a}}},36974:(a,b,c)=>{let d=c(38737);a.exports=({transactionalId:a,producerId:b,producerEpoch:c,transactionResult:e})=>Object.assign(d({transactionalId:a,producerId:b,producerEpoch:c,transactionResult:e}),{apiVersion:1})},38292:(a,b,c)=>{let{parse:d,decode:e}=c(32126);a.exports={decode:e,parse:d}},38370:a=>{let{keys:b}=Object;a.exports=a=>b(a).reduce((b,c)=>({...b,[a[c]]:c}),{})},38403:(a,b,c)=>{let d=c(53654);a.exports=({topics:a})=>Object.assign(d({topics:a}),{apiVersion:2})},38415:(a,b,c)=>{let d=c(2087),e=c(67323),f=c(90483);a.exports=(a,b={})=>{let{firstOffset:c,firstTimestamp:g,magicByte:h,isControlBatch:i=!1,timestampType:j,maxTimestamp:k}=b,l=a.readInt8(),m=a.readVarLong(),n=j===f.LOG_APPEND_TIME&&k?k:d.fromValue(g).add(m).toString(),o=a.readVarInt(),p=d.fromValue(c).add(o).toString(),q=a.readVarIntBytes();return{magicByte:h,attributes:l,timestamp:n,offset:p,key:q,value:a.readVarIntBytes(),headers:a.readVarIntArray(e).reduce((a,{key:b,value:c})=>({...a,[b]:void 0===a[b]?c:Array.isArray(a[b])?a[b].concat([c]):[a[b],c]}),{}),isControlRecord:i,batchContext:b}}},38503:a=>{a.exports=({topics:a})=>a.flatMap(({topicName:a,partitions:b})=>b.map(b=>({topicName:a,...b})))},38737:(a,b,c)=>{let d=c(39652),{EndTxn:e}=c(81451);a.exports=({transactionalId:a,producerId:b,producerEpoch:c,transactionResult:f})=>({apiKey:e,apiVersion:0,apiName:"EndTxn",encode:async()=>new d().writeString(a).writeInt64(b).writeInt16(c).writeBoolean(f)})},38773:(a,b,c)=>{let d=c(92891);a.exports={DefaultPartitioner:d,LegacyPartitioner:c(11797),JavaCompatiblePartitioner:d}},38810:(a,b,c)=>{let d=c(45500),{parse:e}=c(45680),f=a=>({partition:a.readInt32(),errorCode:a.readInt16(),offset:a.readInt64().toString(),timestamp:a.readInt64().toString()});a.exports={decode:async a=>{let b=new d(a);return{topics:b.readArray(a=>({topicName:a.readString(),partitions:a.readArray(f)})),throttleTime:b.readInt32()}},parse:e}},39120:(a,b,c)=>{let d=c(2087),e=c(45500),f=c(78960),{lookupCodecByAttributes:g}=c(61097),{KafkaJSPartialMessageError:h}=c(16920);a.exports=async(a,b=null)=>{let c=[],d=b||a.readInt32(),f=a.slice(d);for(;f.offset<d;)try{let a=j(f),b=g(a.attributes);if(b){let d=await b.decompress(a.value);c.push(...i(new e(d),a))}else c.push(a)}catch(a){if("KafkaJSPartialMessageError"===a.name||"KafkaJSUnsupportedMagicByteInMessageSet"===a.name)break;throw a}return a.forward(d),c};let i=(a,b)=>{let c=[];for(;a.offset<a.buffer.length;)c.push(j(a));if(b.magicByte>0&&b.offset>=0){let a=d.fromValue(b.offset)-d.fromValue(c[c.length-1].offset);for(let b of c)b.offset=d.fromValue(b.offset).add(a).toString()}return c},j=a=>{if(!a.canReadInt64())throw new h("Tried to decode a partial message: There isn't enough bytes to read the offset");let b=a.readInt64().toString();if(!a.canReadInt32())throw new h("Tried to decode a partial message: There isn't enough bytes to read the message size");return f(b,a.readInt32(),a)}},39217:(a,b,c)=>{let{promisify:d}=c(28354),e=c(74075),f=d(e.gzip),g=d(e.unzip);a.exports={compress:async a=>await f(a.buffer),decompress:async a=>await g(a)}},39364:(a,b,c)=>{let d=c(45500),{parse:e}=c(57333),f=c(44285),g=a=>({producerId:a.readInt64().toString(),firstOffset:a.readInt64().toString()}),h=async a=>({partition:a.readInt32(),errorCode:a.readInt16(),highWatermark:a.readInt64().toString(),lastStableOffset:a.readInt64().toString(),lastStartOffset:a.readInt64().toString(),abortedTransactions:a.readArray(g),preferredReadReplica:a.readInt32(),messages:await f(a)}),i=async a=>({topicName:a.readString(),partitions:await a.readArrayAsync(h)});a.exports={decode:async a=>{let b=new d(a),c=b.readInt32(),e=b.readInt16();return{throttleTime:0,clientSideThrottleTime:c,errorCode:e,sessionId:b.readInt32(),responses:await b.readArrayAsync(i)}},parse:e}},39531:(a,b,c)=>{let{MemberMetadata:d,MemberAssignment:e}=c(6956);a.exports=({cluster:a})=>({name:"RoundRobinAssigner",version:0,async assign({members:b,topics:c}){let d=b.length,f=b.map(({memberId:a})=>a).sort(),g={};return c.flatMap(b=>a.findTopicPartitionMetadata(b).map(a=>({topic:b,partitionId:a.partitionId}))).forEach((a,b)=>{let c=f[b%d];g[c]||(g[c]=Object.create(null)),g[c][a.topic]||(g[c][a.topic]=[]),g[c][a.topic].push(a.partitionId)}),Object.keys(g).map(a=>({memberId:a,memberAssignment:e.encode({version:this.version,assignment:g[a]})}))},protocol({topics:a}){return{name:this.name,metadata:d.encode({version:this.version,topics:a})}}})},39652:(a,b,c)=>{let d=c(2087);a.exports=class a{static encodeZigZag(a){return a<<1^a>>31}static encodeZigZag64(a){let b=d.fromValue(a);return b.shiftLeft(1).xor(b.shiftRight(63))}static sizeOfVarInt(a){let b=this.encodeZigZag(a),c=1;for(;(0xffffff80&b)!=0;)c+=1,b>>>=7;return c}static sizeOfVarLong(b){let c=a.encodeZigZag64(b),e=1;for(;c.and(0xffffffffffffff80n).notEquals(d.fromInt(0));)e+=1,c=c.shiftRightUnsigned(7);return e}static sizeOfVarIntBytes(b){let c=null==b?-1:Buffer.byteLength(b);return c<0?a.sizeOfVarInt(-1):a.sizeOfVarInt(c)+c}static nextPowerOfTwo(a){return 1<<31-Math.clz32(a)+1}constructor(b=511){this.buf=Buffer.alloc(a.nextPowerOfTwo(b)),this.offset=0}writeBufferInternal(a){let b=a.length;this.ensureAvailable(b),a.copy(this.buf,this.offset,0),this.offset+=b}ensureAvailable(b){if(this.offset+b>this.buf.length){let c=a.nextPowerOfTwo(this.offset+b),d=Buffer.alloc(c);this.buf.copy(d,0,0,this.offset),this.buf=d}}get buffer(){return this.buf.slice(0,this.offset)}writeInt8(a){return this.ensureAvailable(1),this.buf.writeInt8(a,this.offset),this.offset+=1,this}writeInt16(a){return this.ensureAvailable(2),this.buf.writeInt16BE(a,this.offset),this.offset+=2,this}writeInt32(a){return this.ensureAvailable(4),this.buf.writeInt32BE(a,this.offset),this.offset+=4,this}writeUInt32(a){return this.ensureAvailable(4),this.buf.writeUInt32BE(a,this.offset),this.offset+=4,this}writeInt64(a){this.ensureAvailable(8);let b=d.fromValue(a);return this.buf.writeInt32BE(b.getHighBits(),this.offset),this.buf.writeInt32BE(b.getLowBits(),this.offset+4),this.offset+=8,this}writeDouble(a){return this.ensureAvailable(8),this.buf.writeDoubleBE(a,this.offset),this.offset+=8,this}writeBoolean(a){return a?this.writeInt8(1):this.writeInt8(0),this}writeString(a){if(null==a)return this.writeInt16(-1),this;let b=Buffer.byteLength(a,"utf8");return this.ensureAvailable(2+b),this.writeInt16(b),this.buf.write(a,this.offset,b,"utf8"),this.offset+=b,this}writeVarIntString(a){if(null==a)return this.writeVarInt(-1),this;let b=Buffer.byteLength(a,"utf8");return this.writeVarInt(b),this.ensureAvailable(b),this.buf.write(a,this.offset,b,"utf8"),this.offset+=b,this}writeUVarIntString(a){if(null==a)return this.writeUVarInt(0),this;let b=Buffer.byteLength(a,"utf8");return this.writeUVarInt(b+1),this.ensureAvailable(b),this.buf.write(a,this.offset,b,"utf8"),this.offset+=b,this}writeBytes(a){if(null==a)return this.writeInt32(-1),this;if(Buffer.isBuffer(a))this.ensureAvailable(4+a.length),this.writeInt32(a.length),this.writeBufferInternal(a);else{let b=String(a),c=Buffer.byteLength(b,"utf8");this.ensureAvailable(4+c),this.writeInt32(c),this.buf.write(b,this.offset,c,"utf8"),this.offset+=c}return this}writeVarIntBytes(a){if(null==a)return this.writeVarInt(-1),this;if(Buffer.isBuffer(a))this.writeVarInt(a.length),this.writeBufferInternal(a);else{let b=String(a),c=Buffer.byteLength(b,"utf8");this.writeVarInt(c),this.ensureAvailable(c),this.buf.write(b,this.offset,c,"utf8"),this.offset+=c}return this}writeUVarIntBytes(a){if(null==a)return this.writeVarInt(0),this;if(Buffer.isBuffer(a))this.writeUVarInt(a.length+1),this.writeBufferInternal(a);else{let b=String(a),c=Buffer.byteLength(b,"utf8");this.writeUVarInt(c+1),this.ensureAvailable(c),this.buf.write(b,this.offset,c,"utf8"),this.offset+=c}return this}writeEncoder(a){if(null==a||!Buffer.isBuffer(a.buf))throw Error("value should be an instance of Encoder");return this.writeBufferInternal(a.buffer),this}writeEncoderArray(a){if(!Array.isArray(a)||a.some(a=>null==a||!Buffer.isBuffer(a.buf)))throw Error("all values should be an instance of Encoder[]");return a.forEach(a=>{this.writeBufferInternal(a.buffer)}),this}writeBuffer(a){if(!Buffer.isBuffer(a))throw Error("value should be an instance of Buffer");return this.writeBufferInternal(a),this}writeNullableArray(a,b){let c=0!==a.length?a.length:-1;return this.writeArray(a,b,c),this}writeArray(a,b,c){let d=null==c?a.length:c;if(this.writeInt32(d),void 0!==b)switch(b){case"int32":case"number":a.forEach(a=>this.writeInt32(a));break;case"string":a.forEach(a=>this.writeString(a));break;case"object":this.writeEncoderArray(a)}else a.forEach(a=>{switch(typeof a){case"number":this.writeInt32(a);break;case"string":this.writeString(a);break;case"object":this.writeEncoder(a)}});return this}writeVarIntArray(a,b){if("object"===b)this.writeVarInt(a.length),this.writeEncoderArray(a);else{let b=a.filter(a=>"object"==typeof a);this.writeVarInt(b.length),this.writeEncoderArray(b)}return this}writeUVarIntArray(a,b){if("object"===b)this.writeUVarInt(a.length+1),this.writeEncoderArray(a);else if(null===a)this.writeUVarInt(0);else{let b=a.filter(a=>"object"==typeof a);this.writeUVarInt(b.length+1),this.writeEncoderArray(b)}return this}writeVarInt(b){return this.writeUVarInt(a.encodeZigZag(b))}writeUVarInt(a){let b=[];for(;(0xffffff80&a)!=0;)b.push(127&a|128),a>>>=7;return b.push(127&a),this.writeBufferInternal(Buffer.from(b)),this}writeVarLong(b){let c=[],e=a.encodeZigZag64(b);for(;e.and(0xffffffffffffff80n).notEquals(d.fromInt(0));)c.push(e.and(127).or(128).toInt()),e=e.shiftRightUnsigned(7);return c.push(e.toInt()),this.writeBufferInternal(Buffer.from(c)),this}size(){return this.offset}toJSON(){return this.buffer.toJSON()}}},39803:(a,b,c)=>{let d=c(2834);a.exports=({groupId:a,sessionTimeout:b,rebalanceTimeout:c,memberId:e,protocolType:f,groupProtocols:g})=>Object.assign(d({groupId:a,sessionTimeout:b,rebalanceTimeout:c,memberId:e,protocolType:f,groupProtocols:g}),{apiVersion:4})},40297:(a,b,c)=>{let d=c(2087),e=Buffer.from([0,0,0,0]);a.exports=({messages:a,abortedTransactions:b})=>{let c=new Map;if(!b||!b.length)return a;let f=[...b];return a.filter(a=>{if(f.length&&d.fromValue(a.offset).gte(f[0].firstOffset)){let{producerId:a}=f.shift();c.set(a,!0)}let{producerId:b,inTransaction:g}=a.batchContext;if((({key:a})=>!!a&&Buffer.from(a).equals(e))(a))c.delete(b);else if(c.has(b)&&g)return!1;return!0})}},40577:(a,b,c)=>{let d=c(39652),{AddPartitionsToTxn:e}=c(81451);a.exports=({transactionalId:a,producerId:b,producerEpoch:c,topics:g})=>({apiKey:e,apiVersion:0,apiName:"AddPartitionsToTxn",encode:async()=>new d().writeString(a).writeInt64(b).writeInt16(c).writeArray(g.map(f))});let f=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(g)),g=a=>new d().writeInt32(a)},40645:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>({nodeId:a.readInt32(),host:a.readString(),port:a.readInt32()}),h=a=>({topicErrorCode:a.readInt16(),topic:a.readString(),partitionMetadata:a.readArray(i)}),i=a=>({partitionErrorCode:a.readInt16(),partitionId:a.readInt32(),leader:a.readInt32(),replicas:a.readArray(a=>a.readInt32()),isr:a.readArray(a=>a.readInt32())});a.exports={decode:async a=>{let b=new d(a);return{brokers:b.readArray(g),topicMetadata:b.readArray(h)}},parse:async a=>{let b=a.topicMetadata.filter(a=>e(a.topicErrorCode));if(b.length>0){let{topicErrorCode:a}=b[0];throw f(a)}let c=a.topicMetadata.flatMap(a=>a.partitionMetadata.filter(a=>e(a.partitionErrorCode)));if(c.length>0){let{partitionErrorCode:a}=c[0];throw f(a)}return a}}},40732:(a,b,c)=>{let d=c(39652);a.exports=({authorizationIdentity:a,accessKeyId:b,secretAccessKey:c,sessionToken:e=""})=>({encode:async()=>new d().writeBytes([a,b,c,e].join("\0")).buffer})},40897:a=>{a.exports={UNINITIALIZED:"UNINITIALIZED",READY:"READY",TRANSACTING:"TRANSACTING",COMMITTING:"COMMITTING",ABORTING:"ABORTING"}},41372:(a,b,c)=>{let{parse:d,decode:e}=c(28493);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},41596:a=>{a.exports=a=>{let b=!1;return(...c)=>{if(!b)return b=!0,a(...c)}}},41684:(a,b,c)=>{let d=c(45500),{parse:e}=c(40645),f=a=>({nodeId:a.readInt32(),host:a.readString(),port:a.readInt32(),rack:a.readString()}),g=a=>({topicErrorCode:a.readInt16(),topic:a.readString(),isInternal:a.readBoolean(),partitionMetadata:a.readArray(h)}),h=a=>({partitionErrorCode:a.readInt16(),partitionId:a.readInt32(),leader:a.readInt32(),replicas:a.readArray(a=>a.readInt32()),isr:a.readArray(a=>a.readInt32())});a.exports={decode:async a=>{let b=new d(a);return{brokers:b.readArray(f),controllerId:b.readInt32(),topicMetadata:b.readArray(g)}},parse:e}},41796:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=async a=>({topic:a.readString(),partitions:await a.readArrayAsync(h)}),h=a=>({partition:a.readInt32(),errorCode:a.readInt16()});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),topics:await b.readArrayAsync(g)}},parse:async a=>{let b=a.topics.map(({partitions:a})=>({partitionsWithErrors:a.filter(({errorCode:a})=>e(a))})).filter(({partitionsWithErrors:a})=>a.length);if(b.length>0)throw f(b[0].partitionsWithErrors[0].errorCode);return a}}},42362:(a,b,c)=>{let{parse:d,decode:e}=c(80453);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},42510:(a,b,c)=>{let d=c(49275);a.exports=({groupId:a,generationId:b,memberId:c,groupAssignment:e})=>Object.assign(d({groupId:a,generationId:b,memberId:c,groupAssignment:e}),{apiVersion:2})},42691:(a,b,c)=>{let d=c(33440);a.exports=({replicaId:a,isolationLevel:b,topics:c})=>Object.assign(d({replicaId:a,isolationLevel:b,topics:c}),{apiVersion:3})},43290:(a,b,c)=>{let d=c(39652),{Produce:e}=c(81451),f=c(50196);a.exports=({acks:a,timeout:b,topicData:c})=>({apiKey:e,apiVersion:0,apiName:"Produce",expectResponse:()=>0!==a,encode:async()=>new d().writeInt16(a).writeInt32(b).writeArray(c.map(g))});let g=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(h)),h=({partition:a,messages:b})=>{let c=f({messageVersion:0,entries:b});return new d().writeInt32(a).writeInt32(c.size()).writeEncoder(c)}},43388:(a,b,c)=>{let d=c(49135);a.exports=({topicPartitions:a,validateOnly:b,timeout:c})=>Object.assign(d({topicPartitions:a,validateOnly:b,timeout:c}),{apiVersion:1})},43412:(a,b,c)=>{let d={0:({topics:a,timeout:b})=>{let d=c(2982),e=c(22980);return{request:d({topics:a,timeout:b}),response:e}},1:({topics:a,validateOnly:b,timeout:d})=>{let e=c(83529),f=c(26069);return{request:e({topics:a,validateOnly:b,timeout:d}),response:f}},2:({topics:a,validateOnly:b,timeout:d})=>{let e=c(36016),f=c(68142);return{request:e({topics:a,validateOnly:b,timeout:d}),response:f}},3:({topics:a,validateOnly:b,timeout:d})=>{let e=c(17619),f=c(8567);return{request:e({topics:a,validateOnly:b,timeout:d}),response:f}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},43467:(a,b,c)=>{let d=c(45500),{parse:e}=c(63282),f=a=>({errorCode:a.readInt16(),errorMessage:a.readString(),resourceType:a.readInt8(),resourceName:a.readString(),resourcePatternType:a.readInt8(),principal:a.readString(),host:a.readString(),operation:a.readInt8(),permissionType:a.readInt8()}),g=a=>({errorCode:a.readInt16(),errorMessage:a.readString(),matchingAcls:a.readArray(f)});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:0,clientSideThrottleTime:b.readInt32(),filterResponses:b.readArray(g)}},parse:e}},44096:(a,b,c)=>{let d=c(45500),{parse:e}=c(57333),f=c(44285),g=a=>({producerId:a.readInt64().toString(),firstOffset:a.readInt64().toString()}),h=async a=>({partition:a.readInt32(),errorCode:a.readInt16(),highWatermark:a.readInt64().toString(),lastStableOffset:a.readInt64().toString(),abortedTransactions:a.readArray(g),messages:await f(a)}),i=async a=>({topicName:a.readString(),partitions:await a.readArrayAsync(h)});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),responses:await b.readArrayAsync(i)}},parse:e}},44285:(a,b,c)=>{let d=c(45500),e=c(39120),f=c(79155),{MAGIC_BYTE:g}=c(74943);a.exports=async a=>{let b=a.readInt32();if(b<=0||!a.canReadBytes(b))return[];let c=a.readBytes(b),h=new d(c);if(c.slice(16).readInt8(0)===g){let a=[];for(;h.canReadBytes(49);)try{let b=await f(h);a.push(...b.records)}catch(a){if("KafkaJSPartialMessageError"===a.name)break;throw a}return a}return e(h,b)}},44361:a=>{let{assign:b}=Object,c={NOTHING:0,ERROR:1,WARN:2,INFO:4,DEBUG:5},d=(a,c,d,e,f)=>(g,h={})=>{c>d()||f({namespace:e,level:c,label:a,log:b({timestamp:new Date().toISOString(),logger:"kafkajs",message:g},h)})},e=a=>{let b=(process.env.KAFKAJS_LOG_LEVEL||"").toUpperCase();return null==c[b]?a:c[b]};a.exports={LEVELS:c,createLogger:({level:a=c.INFO,logCreator:f}={})=>{let g=e(a),h=f(g),i=(a,b=null)=>j(a,e(b)),j=(a,e=null)=>{let f=()=>null==e?g:e;return b({info:d("INFO",c.INFO,f,a,h),error:d("ERROR",c.ERROR,f,a,h),warn:d("WARN",c.WARN,f,a,h),debug:d("DEBUG",c.DEBUG,f,a,h)},{namespace:i,setLogLevel:a=>{g=a}})};return j()}}},44430:a=>{a.exports=(a,b=a=>a)=>Array(a).fill(0).map((a,c)=>b(c))},44628:(a,b,c)=>{let d=c(96268),e=c(28573);a.exports=({replicaId:a,maxWaitTime:b,minBytes:c,maxBytes:f,topics:g,isolationLevel:h=d.READ_COMMITTED})=>Object.assign(e({replicaId:a,maxWaitTime:b,minBytes:c,maxBytes:f,topics:g,isolationLevel:h}),{apiVersion:6})},45060:(a,b,c)=>{let{request:d,response:e}=c(66413),{KafkaJSSASLAuthenticationError:f}=c(16920);a.exports=a=>({host:b,port:c,logger:g,saslAuthenticate:h})=>({authenticate:async()=>{if(null==a.username||null==a.password)throw new f("SASL Plain: Invalid username or password");let i=`${b}:${c}`;try{g.debug("Authenticate with SASL PLAIN",{broker:i}),await h({request:d(a),response:e}),g.debug("SASL PLAIN authentication successful",{broker:i})}catch(b){let a=new f(`SASL PLAIN authentication failed: ${b.message}`);throw g.error(a.message,{broker:i}),a}}})},45500:(a,b,c)=>{let{KafkaJSInvalidVarIntError:d,KafkaJSInvalidLongError:e}=c(16920),f=c(2087);a.exports=class a{static int32Size(){return 4}static decodeZigZag(a){return a>>>1^-(1&a)}static decodeZigZag64(a){return a.shiftRightUnsigned(1).xor(a.and(f.fromInt(1)).negate())}constructor(a){this.buffer=a,this.offset=0}readInt8(){let a=this.buffer.readInt8(this.offset);return this.offset+=1,a}canReadInt16(){return this.canReadBytes(2)}readInt16(){let a=this.buffer.readInt16BE(this.offset);return this.offset+=2,a}canReadInt32(){return this.canReadBytes(4)}readInt32(){let a=this.buffer.readInt32BE(this.offset);return this.offset+=4,a}canReadInt64(){return this.canReadBytes(8)}readInt64(){let a=this.buffer[this.offset],b=this.buffer[this.offset+7],c=(a<<24)+65536*this.buffer[this.offset+1]+256*this.buffer[this.offset+2]+this.buffer[this.offset+3],d=0x1000000*this.buffer[this.offset+4]+65536*this.buffer[this.offset+5]+256*this.buffer[this.offset+6]+b;return this.offset+=8,(BigInt(c)<<32n)+BigInt(d)}readDouble(){let a=this.buffer.readDoubleBE(this.offset);return this.offset+=8,a}readString(){let a=this.readInt16();if(-1===a)return null;let b=this.buffer.slice(this.offset,this.offset+a).toString("utf8");return this.offset+=a,b}readVarIntString(){let a=this.readVarInt();if(-1===a)return null;let b=this.buffer.slice(this.offset,this.offset+a).toString("utf8");return this.offset+=a,b}readUVarIntString(){let a=this.readUVarInt();if(0===a)return null;let b=this.buffer.slice(this.offset,this.offset+a-1).toString("utf8");return this.offset+=a-1,b}canReadBytes(a){return Buffer.byteLength(this.buffer)-this.offset>=a}readBytes(a=this.readInt32()){if(-1===a)return null;let b=this.buffer.slice(this.offset,this.offset+a);return this.offset+=a,b}readVarIntBytes(){let a=this.readVarInt();if(-1===a)return null;let b=this.buffer.slice(this.offset,this.offset+a);return this.offset+=a,b}readUVarIntBytes(){let a=this.readUVarInt();if(0===a)return null;let b=this.buffer.slice(this.offset,this.offset+a);return this.offset+=a-1,b}readBoolean(){return 1===this.readInt8()}readAll(){let a=this.buffer.slice(this.offset);return this.offset+=Buffer.byteLength(this.buffer),a}readArray(a){let b=this.readInt32();if(-1===b)return[];let c=Array(b);for(let d=0;d<b;d++)c[d]=a(this);return c}readVarIntArray(a){let b=this.readVarInt();if(-1===b)return[];let c=Array(b);for(let d=0;d<b;d++)c[d]=a(this);return c}readUVarIntArray(a){let b=this.readUVarInt();if(0===b)return null;let c=Array(b-1);for(let d=0;d<b-1;d++)c[d]=a(this);return c}async readArrayAsync(a){let b=this.readInt32();if(-1===b)return[];let c=Array(b);for(let d=0;d<b;d++)c[d]=await a(this);return c}readVarInt(){let b,c=0,d=0;do c+=(127&(b=this.buffer[this.offset++]))<<d,d+=7;while(b>=128);return a.decodeZigZag(c)}readUVarInt(){let a,b=0,c=0;for(;(128&(a=this.buffer[this.offset++]))!=0;)if(b|=(127&a)<<c,(c+=7)>28)throw new d("Invalid VarInt, must contain 5 bytes or less");return(b|=a<<c)>>>0}readTaggedFields(){let a=this.readUVarInt();if(0===a)return null;for(let b=0;b<a;b++)this.readUVarInt(),this.readUVarIntBytes();return{}}readVarLong(){let b,c=f.fromInt(0),d=0;do{if(d>63)throw new e("Invalid Long, must contain 9 bytes or less");b=this.buffer[this.offset++],c=c.add(f.fromInt(127&b).shiftLeft(d)),d+=7}while(b>=128);return a.decodeZigZag64(c)}slice(b){return new a(this.buffer.slice(this.offset,this.offset+b))}forward(a){this.offset+=a}}},45507:(a,b,c)=>{let d=c(54080);a.exports=({acks:a,timeout:b,transactionalId:c,producerId:e,producerEpoch:f,compression:g,topicData:h})=>Object.assign(d({acks:a,timeout:b,transactionalId:c,producerId:e,producerEpoch:f,compression:g,topicData:h}),{apiVersion:7})},45673:(a,b,c)=>{let d=c(45500),{failIfVersionNotSupported:e,failure:f,createErrorFromCode:g}=c(88374),{parse:h}=c(2891),i=a=>({memberId:a.readString(),groupInstanceId:a.readString(),errorCode:a.readInt16()});a.exports={decode:async a=>{let b=new d(a),c=b.readInt32(),f=b.readInt16(),g=b.readArray(i);return e(f),{throttleTime:0,clientSideThrottleTime:c,errorCode:f,members:g}},parse:async a=>{let b=h(a),c=a.members.find(a=>f(a.errorCode));if(c)throw g(c.errorCode);return b}}},45680:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>({partition:a.readInt32(),errorCode:a.readInt16(),offset:a.readInt64().toString()});a.exports={decode:async a=>({topics:new d(a).readArray(a=>({topicName:a.readString(),partitions:a.readArray(g)}))}),parse:async a=>{let b=a.topics.flatMap(a=>a.partitions.filter(a=>e(a.errorCode)));if(b.length>0){let{errorCode:a}=b[0];throw f(a)}return a}}},47028:a=>{a.exports={decode:async()=>!0,parse:async()=>!0}},47374:(a,b,c)=>{let d=c(45500),e=/^([rsiev])=(.*)$/;a.exports={decode:async a=>new d(a).readBytes(),parse:async a=>{let b=a.toString().split(",").map(a=>{let[b,c,d]=a.match(e);return[c,d]}).reduce((a,b)=>({...a,[b[0]]:b[1]}),{});return{original:a.toString(),...b}}}},48239:(a,b,c)=>{let d=c(39652),{JoinGroup:e}=c(81451);a.exports=({groupId:a,sessionTimeout:b,memberId:c,protocolType:g,groupProtocols:h})=>({apiKey:e,apiVersion:0,apiName:"JoinGroup",encode:async()=>new d().writeString(a).writeInt32(b).writeString(c).writeString(g).writeArray(h.map(f))});let f=({name:a,metadata:b=Buffer.alloc(0)})=>new d().writeString(a).writeBytes(b)},49017:(a,b,c)=>{let d=c(89302);a.exports=({groupId:a,groupGenerationId:b,memberId:c,retentionTime:e,topics:f})=>Object.assign(d({groupId:a,groupGenerationId:b,memberId:c,retentionTime:e,topics:f}),{apiVersion:3})},49135:(a,b,c)=>{let d=c(39652),{CreatePartitions:e}=c(81451);a.exports=({topicPartitions:a,validateOnly:b=!1,timeout:c=5e3})=>({apiKey:e,apiVersion:0,apiName:"CreatePartitions",encode:async()=>new d().writeArray(a.map(f)).writeInt32(c).writeBoolean(b)});let f=({topic:a,count:b,assignments:c=[]})=>new d().writeString(a).writeInt32(b).writeNullableArray(c.map(g)),g=a=>new d().writeNullableArray(a)},49156:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>({groupId:a.readString(),protocolType:a.readString()}),h=async a=>{let b=new d(a);return{errorCode:b.readInt16(),groups:b.readArray(g)}};a.exports={decodeGroup:g,decode:h,parse:async a=>{if(e(a.errorCode))throw f(a.errorCode);return a}}},49275:(a,b,c)=>{let d=c(76600);a.exports=({groupId:a,generationId:b,memberId:c,groupAssignment:e})=>Object.assign(d({groupId:a,generationId:b,memberId:c,groupAssignment:e}),{apiVersion:1})},49792:(a,b,c)=>{let d=c(45500),{parse:e}=c(23025),f=a=>({memberId:a.readString(),clientId:a.readString(),clientHost:a.readString(),memberMetadata:a.readBytes(),memberAssignment:a.readBytes()}),g=a=>({errorCode:a.readInt16(),groupId:a.readString(),state:a.readString(),protocolType:a.readString(),protocol:a.readString(),members:a.readArray(f)});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),groups:b.readArray(g)}},parse:e}},49869:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f,failIfVersionNotSupported:g}=c(88374),h=a=>({apiKey:a.readInt16(),minVersion:a.readInt16(),maxVersion:a.readInt16()});a.exports={decode:async a=>{let b=new d(a),c=b.readInt16();return g(c),{errorCode:c,apiVersions:b.readArray(h)}},parse:async a=>{if(e(a.errorCode))throw f(a.errorCode);return a}}},49962:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f,failIfVersionNotSupported:g}=c(88374);a.exports={decode:async a=>{let b=new d(a),c=b.readInt32(),e=b.readInt16();return g(e),{throttleTime:c,errorCode:e}},parse:async a=>{if(e(a.errorCode))throw f(a.errorCode);return a}}},49967:(a,b,c)=>{let d=c(39652),{DeleteGroups:e}=c(81451);a.exports=a=>({apiKey:e,apiVersion:0,apiName:"DeleteGroups",encode:async()=>new d().writeArray(a.map(f))});let f=a=>new d().writeString(a)},50070:(a,b,c)=>{let d=c(36247);a.exports=({acks:a,timeout:b,transactionalId:c,producerId:e,producerEpoch:f,compression:g,topicData:h})=>Object.assign(d({acks:a,timeout:b,transactionalId:c,producerId:e,producerEpoch:f,compression:g,topicData:h}),{apiVersion:4})},50183:(a,b,c)=>{let d={0:a=>{let b=c(49967),d=c(61211);return{request:b(a),response:d}},1:a=>{let b=c(96988),d=c(12578);return{request:b(a),response:d}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},50196:(a,b,c)=>{let d=c(39652),e=c(7092),{Types:f}=c(61097);a.exports=({messageVersion:a=0,compression:b,entries:c})=>{let g=b!==f.None,h=e({version:a}),i=new d;return c.forEach((a,b)=>{let c=h(a);i.writeInt64(g?b:-1),i.writeInt32(c.size()),i.writeEncoder(c)}),i}},50358:(a,b,c)=>{let d=c(39652),{ListOffsets:e}=c(81451);a.exports=({replicaId:a,topics:b})=>({apiKey:e,apiVersion:0,apiName:"ListOffsets",encode:async()=>new d().writeInt32(a).writeArray(b.map(f))});let f=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(g)),g=({partition:a,timestamp:b=-1,maxNumOffsets:c=1})=>new d().writeInt32(a).writeInt64(b).writeInt32(c)},50589:(a,b,c)=>{let d=c(38370),e=c(67449),f=c(50998)("producer"),g={CONNECT:f("connect"),DISCONNECT:f("disconnect"),REQUEST:f(e.NETWORK_REQUEST),REQUEST_TIMEOUT:f(e.NETWORK_REQUEST_TIMEOUT),REQUEST_QUEUE_SIZE:f(e.NETWORK_REQUEST_QUEUE_SIZE)},h={[g.REQUEST]:e.NETWORK_REQUEST,[g.REQUEST_TIMEOUT]:e.NETWORK_REQUEST_TIMEOUT,[g.REQUEST_QUEUE_SIZE]:e.NETWORK_REQUEST_QUEUE_SIZE},i=d(h);a.exports={events:g,wrap:a=>i[a]||a,unwrap:a=>h[a]||a}},50998:a=>{a.exports=a=>b=>`${a}.${b}`},51664:(a,b,c)=>{let d=c(45500),{parse:e}=c(40645),f=a=>({nodeId:a.readInt32(),host:a.readString(),port:a.readInt32(),rack:a.readString()}),g=a=>({topicErrorCode:a.readInt16(),topic:a.readString(),isInternal:a.readBoolean(),partitionMetadata:a.readArray(h)}),h=a=>({partitionErrorCode:a.readInt16(),partitionId:a.readInt32(),leader:a.readInt32(),replicas:a.readArray(a=>a.readInt32()),isr:a.readArray(a=>a.readInt32()),offlineReplicas:a.readArray(a=>a.readInt32())});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),brokers:b.readArray(f),clusterId:b.readString(),controllerId:b.readInt32(),topicMetadata:b.readArray(g)}},parse:e}},51792:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>({principal:a.readString(),host:a.readString(),operation:a.readInt8(),permissionType:a.readInt8()}),h=a=>({resourceType:a.readInt8(),resourceName:a.readString(),acls:a.readArray(g)});a.exports={decode:async a=>{let b=new d(a),c=b.readInt32(),e=b.readInt16();return{throttleTime:c,errorCode:e,errorMessage:b.readString(),resources:b.readArray(h)}},parse:async a=>{if(e(a.errorCode))throw f(a.errorCode);return a}}},52056:a=>{a.exports=()=>({KAFKAJS_DEBUG_PROTOCOL_BUFFERS:process.env.KAFKAJS_DEBUG_PROTOCOL_BUFFERS,KAFKAJS_DEBUG_EXTENDED_PROTOCOL_BUFFERS:process.env.KAFKAJS_DEBUG_EXTENDED_PROTOCOL_BUFFERS})},52173:a=>{a.exports={UNKNOWN:0,TOPIC_CONFIG:1,DYNAMIC_BROKER_CONFIG:2,DYNAMIC_DEFAULT_BROKER_CONFIG:3,STATIC_BROKER_CONFIG:4,DEFAULT_CONFIG:5,DYNAMIC_BROKER_LOGGER_CONFIG:6}},53416:(a,b,c)=>{let d={0:({acks:a,timeout:b,topicData:d})=>{let e=c(43290),f=c(45680);return{request:e({acks:a,timeout:b,topicData:d}),response:f}},1:({acks:a,timeout:b,topicData:d})=>{let e=c(32333),f=c(18145);return{request:e({acks:a,timeout:b,topicData:d}),response:f}},2:({acks:a,timeout:b,topicData:d,compression:e})=>{let f=c(31172),g=c(38810);return{request:f({acks:a,timeout:b,compression:e,topicData:d}),response:g}},3:({acks:a,timeout:b,compression:d,topicData:e,transactionalId:f,producerId:g,producerEpoch:h})=>{let i=c(36247),j=c(74323);return{request:i({acks:a,timeout:b,compression:d,topicData:e,transactionalId:f,producerId:g,producerEpoch:h}),response:j}},4:({acks:a,timeout:b,compression:d,topicData:e,transactionalId:f,producerId:g,producerEpoch:h})=>{let i=c(50070),j=c(17076);return{request:i({acks:a,timeout:b,compression:d,topicData:e,transactionalId:f,producerId:g,producerEpoch:h}),response:j}},5:({acks:a,timeout:b,compression:d,topicData:e,transactionalId:f,producerId:g,producerEpoch:h})=>{let i=c(23129),j=c(10469);return{request:i({acks:a,timeout:b,compression:d,topicData:e,transactionalId:f,producerId:g,producerEpoch:h}),response:j}},6:({acks:a,timeout:b,compression:d,topicData:e,transactionalId:f,producerId:g,producerEpoch:h})=>{let i=c(54080),j=c(1214);return{request:i({acks:a,timeout:b,compression:d,topicData:e,transactionalId:f,producerId:g,producerEpoch:h}),response:j}},7:({acks:a,timeout:b,compression:d,topicData:e,transactionalId:f,producerId:g,producerEpoch:h})=>{let i=c(45507),j=c(21767);return{request:i({acks:a,timeout:b,compression:d,topicData:e,transactionalId:f,producerId:g,producerEpoch:h}),response:j}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},53654:(a,b,c)=>{let d=c(39652),{Metadata:e}=c(81451);a.exports=({topics:a})=>({apiKey:e,apiVersion:1,apiName:"Metadata",encode:async()=>new d().writeNullableArray(a)})},53686:(a,b,c)=>{let d=c(39652);a.exports=async({authorizationIdentity:a=null},b)=>{let c=null==a?"":`"a=${a}`,e=function(a){let b="";if(null==a)return b;let c="";for(let d in a)b+=`${c}${d}=${a[d]}`,c="\x01";return b}(b.extensions);e.length>0&&(e=`\u0001${e}`);let f=`n,${c},\u0001auth=Bearer ${b.value}${e}\u0001\u0001`;return{encode:async()=>new d().writeBytes(Buffer.from(f)).buffer}}},53940:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=c(52173),h=c(6691),i=a=>{let b=a.readInt16(),c=a.readString(),d=a.readInt8(),e=a.readString(),f=a.readArray(a=>((a,b)=>{let c,d=a.readString(),e=a.readString(),f=a.readBoolean(),i=a.readBoolean(),j=a.readBoolean();if(i)c=g.DEFAULT_CONFIG;else switch(b){case h.BROKER:c=g.STATIC_BROKER_CONFIG;break;case h.TOPIC:c=g.TOPIC_CONFIG;break;default:c=g.UNKNOWN}return{configName:d,configValue:e,readOnly:f,isDefault:i,configSource:c,isSensitive:j}})(a,d));return{errorCode:b,errorMessage:c,resourceType:d,resourceName:e,configEntries:f}};a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),resources:b.readArray(i)}},parse:async a=>{let b=a.resources.filter(({errorCode:a})=>e(a));if(b.length>0)throw f(b[0].errorCode);return a}}},54080:(a,b,c)=>{let d=c(23129);a.exports=({acks:a,timeout:b,transactionalId:c,producerId:e,producerEpoch:f,compression:g,topicData:h})=>Object.assign(d({acks:a,timeout:b,transactionalId:c,producerId:e,producerEpoch:f,compression:g,topicData:h}),{apiVersion:6})},55244:(a,b,c)=>{let d=c(81442);a.exports=({handler:a,workerId:b})=>({run:d(async({next:c})=>{for(;;){let d=c();if(!d)break;let{batch:e,resolve:f,reject:g}=d;try{await a(e,{workerId:b}),f()}catch(a){g(a)}}})})},55346:(a,b,c)=>{let d=c(1103);a.exports=({groupId:a,memberId:b})=>Object.assign(d({groupId:a,memberId:b}),{apiVersion:2})},55480:(a,b,c)=>{let{EventEmitter:d}=c(94735),e=c(2087),f=c(4702),{isKafkaJSError:g,isRebalancing:h}=c(16920),{events:{FETCH:i,FETCH_START:j,START_BATCH_PROCESS:k,END_BATCH_PROCESS:l,REBALANCING:m}}=c(60695),n=c(6693),o="consuming-stop";a.exports=class extends d{constructor({logger:a,consumerGroup:b,instrumentationEmitter:c,eachBatchAutoResolve:d=!0,concurrency:e,eachBatch:g,eachMessage:h,heartbeatInterval:i,onCrash:j,retry:k,autoCommit:l=!0}){super(),this.logger=a.namespace("Runner"),this.consumerGroup=b,this.instrumentationEmitter=c,this.eachBatchAutoResolve=d,this.eachBatch=g,this.eachMessage=h,this.heartbeatInterval=i,this.retrier=f(Object.assign({},k)),this.onCrash=j,this.autoCommit=l,this.fetchManager=n({logger:this.logger,getNodeIds:()=>this.consumerGroup.getNodeIds(),fetch:a=>this.fetch(a),handler:a=>this.handleBatch(a),concurrency:e}),this.running=!1,this.consuming=!1}get consuming(){return this._consuming}set consuming(a){this._consuming!==a&&(this._consuming=a,this.emit(a?"consuming-start":o))}async start(){if(!this.running){try{await this.consumerGroup.connect(),await this.consumerGroup.joinAndSync()}catch(a){return this.onCrash(a)}this.running=!0,this.scheduleFetchManager()}}scheduleFetchManager(){if(!this.running){this.consuming=!1,this.logger.info("consumer not running, exiting",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId});return}this.consuming=!0,this.retrier(async(a,b,c)=>{if(this.running)try{await this.fetchManager.start()}catch(d){if(h(d)){this.logger.warn("The group is rebalancing, re-joining",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,error:d.message}),this.instrumentationEmitter.emit(m,{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId}),await this.consumerGroup.joinAndSync();return}if("UNKNOWN_MEMBER_ID"===d.type){this.logger.error("The coordinator is not aware of this member, re-joining the group",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,error:d.message}),this.consumerGroup.memberId=null,await this.consumerGroup.joinAndSync();return}if("KafkaJSNotImplemented"===d.name||"KafkaJSNoBrokerAvailableError"===d.name)return a(d);throw this.logger.debug("Error while scheduling fetch manager, trying again...",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,error:d.message,stack:d.stack,retryCount:b,retryTime:c}),d}}).then(()=>{this.scheduleFetchManager()}).catch(a=>{this.onCrash(a),this.consuming=!1,this.running=!1})}async stop(){if(this.running){this.logger.debug("stop consumer group",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId}),this.running=!1;try{await this.fetchManager.stop(),await this.waitForConsumer(),await this.consumerGroup.leave()}catch(a){}}}waitForConsumer(){return new Promise(a=>{if(!this.consuming)return a();this.logger.debug("waiting for consumer to finish...",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId}),this.once(o,()=>a())})}async heartbeat(){try{await this.consumerGroup.heartbeat({interval:this.heartbeatInterval})}catch(a){throw h(a)&&await this.autoCommitOffsets(),a}}async processEachMessage(a){let{topic:b,partition:c}=a,d=()=>(this.consumerGroup.pause([{topic:b,partitions:[c]}]),()=>this.consumerGroup.resume([{topic:b,partitions:[c]}]));for(let e of a.messages){if(!this.running||this.consumerGroup.hasSeekOffset({topic:b,partition:c}))break;try{await this.eachMessage({topic:b,partition:c,message:e,heartbeat:()=>this.heartbeat(),pause:d})}catch(a){throw g(a)||this.logger.error("Error when calling eachMessage",{topic:b,partition:c,offset:e.offset,stack:a.stack,error:a}),await this.autoCommitOffsets(),a}if(this.consumerGroup.resolveOffset({topic:b,partition:c,offset:e.offset}),await this.heartbeat(),await this.autoCommitOffsetsIfNecessary(),this.consumerGroup.isPaused(b,c))break}}async processEachBatch(a){let{topic:b,partition:c}=a,d=a.messages[a.messages.length-1];try{await this.eachBatch({batch:a,resolveOffset:f=>{let g,h=d&&(g=d.offset,e.fromValue(f).equals(e.fromValue(g)))?a.lastOffset():f;this.consumerGroup.resolveOffset({topic:b,partition:c,offset:h})},heartbeat:()=>this.heartbeat(),pause:()=>(this.consumerGroup.pause([{topic:b,partitions:[c]}]),()=>this.consumerGroup.resume([{topic:b,partitions:[c]}])),commitOffsetsIfNecessary:async a=>a?this.consumerGroup.commitOffsets(a):this.consumerGroup.commitOffsetsIfNecessary(),uncommittedOffsets:()=>this.consumerGroup.uncommittedOffsets(),isRunning:()=>this.running,isStale:()=>this.consumerGroup.hasSeekOffset({topic:b,partition:c})})}catch(d){throw g(d)||this.logger.error("Error when calling eachBatch",{topic:b,partition:c,offset:a.firstOffset(),stack:d.stack,error:d}),await this.autoCommitOffsets(),d}this.eachBatchAutoResolve&&this.consumerGroup.resolveOffset({topic:b,partition:c,offset:a.lastOffset()})}async fetch(a){if(!this.running)return this.logger.debug("consumer not running, exiting",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId}),[];let b=Date.now();this.instrumentationEmitter.emit(j,{nodeId:a});let c=await this.consumerGroup.fetch(a);return this.instrumentationEmitter.emit(i,{numberOfBatches:0,duration:Date.now()-b,nodeId:a}),0===c.length&&await this.heartbeat(),c}async handleBatch(a){if(!this.running)return void this.logger.debug("consumer not running, exiting",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId});let b=async a=>{let b=Date.now(),c={topic:a.topic,partition:a.partition,highWatermark:a.highWatermark,offsetLag:a.offsetLag(),offsetLagLow:a.offsetLagLow(),batchSize:a.messages.length,firstOffset:a.firstOffset(),lastOffset:a.lastOffset()};if(a.isEmptyDueToFiltering()){this.instrumentationEmitter.emit(k,c),this.consumerGroup.resolveOffset({topic:a.topic,partition:a.partition,offset:a.lastOffset()}),await this.autoCommitOffsetsIfNecessary(),this.instrumentationEmitter.emit(l,{...c,duration:Date.now()-b}),await this.heartbeat();return}if(a.isEmpty())return void await this.heartbeat();this.instrumentationEmitter.emit(k,c),this.eachMessage?await this.processEachMessage(a):this.eachBatch&&await this.processEachBatch(a),this.instrumentationEmitter.emit(l,{...c,duration:Date.now()-b}),await this.autoCommitOffsets(),await this.heartbeat()};await b(a)}autoCommitOffsets(){if(this.autoCommit)return this.consumerGroup.commitOffsets()}autoCommitOffsetsIfNecessary(){if(this.autoCommit)return this.consumerGroup.commitOffsetsIfNecessary()}commitOffsets(a){return this.running?this.retrier(async(b,c,d)=>{try{await this.consumerGroup.commitOffsets(a)}catch(e){if(!this.running)return void this.logger.debug("consumer not running, exiting",{error:e.message,groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,offsets:a});if("KafkaJSNotImplemented"===e.name)return b(e);throw this.logger.debug("Error while committing offsets, trying again...",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,error:e.message,stack:e.stack,retryCount:c,retryTime:d,offsets:a}),e}}):void this.logger.debug("consumer not running, exiting",{groupId:this.consumerGroup.groupId,memberId:this.consumerGroup.memberId,offsets:a})}}},55524:(a,b,c)=>{let d=c(96268),e=-1,f={0:({replicaId:a=e,topics:b})=>{let d=c(50358),f=c(86004);return{request:d({replicaId:a,topics:b}),response:f}},1:({replicaId:a=e,topics:b})=>{let d=c(10073),f=c(11813);return{request:d({replicaId:a,topics:b}),response:f}},2:({replicaId:a=e,isolationLevel:b=d.READ_COMMITTED,topics:f})=>{let g=c(33440),h=c(63486);return{request:g({replicaId:a,isolationLevel:b,topics:f}),response:h}},3:({replicaId:a=e,isolationLevel:b=d.READ_COMMITTED,topics:f})=>{let g=c(42691),h=c(199);return{request:g({replicaId:a,isolationLevel:b,topics:f}),response:h}}};a.exports={versions:Object.keys(f),protocol:({version:a})=>f[a]}},55631:a=>{var b=new Int32Array([0,0x77073096,0xee0e612c,0x990951ba,0x76dc419,0x706af48f,0xe963a535,0x9e6495a3,0xedb8832,0x79dcb8a4,0xe0d5e91e,0x97d2d988,0x9b64c2b,0x7eb17cbd,0xe7b82d07,0x90bf1d91,0x1db71064,0x6ab020f2,0xf3b97148,0x84be41de,0x1adad47d,0x6ddde4eb,0xf4d4b551,0x83d385c7,0x136c9856,0x646ba8c0,0xfd62f97a,0x8a65c9ec,0x14015c4f,0x63066cd9,0xfa0f3d63,0x8d080df5,0x3b6e20c8,0x4c69105e,0xd56041e4,0xa2677172,0x3c03e4d1,0x4b04d447,0xd20d85fd,0xa50ab56b,0x35b5a8fa,0x42b2986c,0xdbbbc9d6,0xacbcf940,0x32d86ce3,0x45df5c75,0xdcd60dcf,0xabd13d59,0x26d930ac,0x51de003a,0xc8d75180,0xbfd06116,0x21b4f4b5,0x56b3c423,0xcfba9599,0xb8bda50f,0x2802b89e,0x5f058808,0xc60cd9b2,0xb10be924,0x2f6f7c87,0x58684c11,0xc1611dab,0xb6662d3d,0x76dc4190,0x1db7106,0x98d220bc,0xefd5102a,0x71b18589,0x6b6b51f,0x9fbfe4a5,0xe8b8d433,0x7807c9a2,0xf00f934,0x9609a88e,0xe10e9818,0x7f6a0dbb,0x86d3d2d,0x91646c97,0xe6635c01,0x6b6b51f4,0x1c6c6162,0x856530d8,0xf262004e,0x6c0695ed,0x1b01a57b,0x8208f4c1,0xf50fc457,0x65b0d9c6,0x12b7e950,0x8bbeb8ea,0xfcb9887c,0x62dd1ddf,0x15da2d49,0x8cd37cf3,0xfbd44c65,0x4db26158,0x3ab551ce,0xa3bc0074,0xd4bb30e2,0x4adfa541,0x3dd895d7,0xa4d1c46d,0xd3d6f4fb,0x4369e96a,0x346ed9fc,0xad678846,0xda60b8d0,0x44042d73,0x33031de5,0xaa0a4c5f,0xdd0d7cc9,0x5005713c,0x270241aa,0xbe0b1010,0xc90c2086,0x5768b525,0x206f85b3,0xb966d409,0xce61e49f,0x5edef90e,0x29d9c998,0xb0d09822,0xc7d7a8b4,0x59b33d17,0x2eb40d81,0xb7bd5c3b,0xc0ba6cad,0xedb88320,0x9abfb3b6,0x3b6e20c,0x74b1d29a,0xead54739,0x9dd277af,0x4db2615,0x73dc1683,0xe3630b12,0x94643b84,0xd6d6a3e,0x7a6a5aa8,0xe40ecf0b,0x9309ff9d,0xa00ae27,0x7d079eb1,0xf00f9344,0x8708a3d2,0x1e01f268,0x6906c2fe,0xf762575d,0x806567cb,0x196c3671,0x6e6b06e7,0xfed41b76,0x89d32be0,0x10da7a5a,0x67dd4acc,0xf9b9df6f,0x8ebeeff9,0x17b7be43,0x60b08ed5,0xd6d6a3e8,0xa1d1937e,0x38d8c2c4,0x4fdff252,0xd1bb67f1,0xa6bc5767,0x3fb506dd,0x48b2364b,0xd80d2bda,0xaf0a1b4c,0x36034af6,0x41047a60,0xdf60efc3,0xa867df55,0x316e8eef,0x4669be79,0xcb61b38c,0xbc66831a,0x256fd2a0,0x5268e236,0xcc0c7795,0xbb0b4703,0x220216b9,0x5505262f,0xc5ba3bbe,0xb2bd0b28,0x2bb45a92,0x5cb36a04,0xc2d7ffa7,0xb5d0cf31,0x2cd99e8b,0x5bdeae1d,0x9b64c2b0,0xec63f226,0x756aa39c,0x26d930a,0x9c0906a9,0xeb0e363f,0x72076785,0x5005713,0x95bf4a82,0xe2b87a14,0x7bb12bae,0xcb61b38,0x92d28e9b,0xe5d5be0d,0x7cdcefb7,0xbdbdf21,0x86d3d2d4,0xf1d4e242,0x68ddb3f8,0x1fda836e,0x81be16cd,0xf6b9265b,0x6fb077e1,0x18b74777,0x88085ae6,0xff0f6a70,0x66063bca,0x11010b5c,0x8f659eff,0xf862ae69,0x616bffd3,0x166ccf45,0xa00ae278,0xd70dd2ee,0x4e048354,0x3903b3c2,0xa7672661,0xd06016f7,0x4969474d,0x3e6e77db,0xaed16a4a,0xd9d65adc,0x40df0b66,936918e3,0xa9bcae53,0xdebb9ec5,0x47b2cf7f,0x30b5ffe9,0xbdbdf21c,0xcabac28a,0x53b39330,0x24b4a3a6,0xbad03605,0xcdd70693,0x54de5729,0x23d967bf,0xb3667a2e,0xc4614ab8,0x5d681b02,0x2a6f2b94,0xb40bbe37,0xc30c8ea1,0x5a05df1b,0x2d02ef8d]);a.exports=a=>{let{buffer:c}=a,d=c.length,e=-1;for(let a=0;a<d;a++)e=b[(e^c[a])&255]^e>>>8;return -1^e}},56074:(a,b,c)=>{let{request:d}=c(91567),{KafkaJSSASLAuthenticationError:e}=c(16920);a.exports=a=>({host:b,port:c,logger:f,saslAuthenticate:g})=>({authenticate:async()=>{let{oauthBearerProvider:h}=a;if(null==h)throw new e("SASL OAUTHBEARER: Missing OAuth bearer token provider");let i=await h();if(null==i.value)throw new e("SASL OAUTHBEARER: Invalid OAuth bearer token");let j=`${b}:${c}`;try{f.debug("Authenticate with SASL OAUTHBEARER",{broker:j}),await g({request:await d(a,i)}),f.debug("SASL OAUTHBEARER authentication successful",{broker:j})}catch(b){let a=new e(`SASL OAUTHBEARER authentication failed: ${b.message}`);throw f.error(a.message,{broker:j}),a}}})},56756:(a,b,c)=>{let d={0:()=>{let a=c(69478),b=c(49156);return{request:a(),response:b}},1:()=>{let a=c(2505),b=c(24661);return{request:a(),response:b}},2:()=>{let a=c(82448),b=c(75534);return{request:a(),response:b}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},57011:(a,b,c)=>{let d=c(39652),{Fetch:e}=c(81451);a.exports=({replicaId:a,maxWaitTime:b,minBytes:c,maxBytes:g,topics:h})=>({apiKey:e,apiVersion:3,apiName:"Fetch",encode:async()=>new d().writeInt32(a).writeInt32(b).writeInt32(c).writeInt32(g).writeArray(h.map(f))});let f=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(g)),g=({partition:a,fetchOffset:b,maxBytes:c})=>new d().writeInt32(a).writeInt64(b).writeInt32(c)},57142:a=>{a.exports={EARLIEST_OFFSET:-2,LATEST_OFFSET:-1,INT_32_MAX_VALUE:0x7fffffff}},57281:(a,b,c)=>{"use strict";c.r(b),c.d(b,{KafkaClient:()=>f});var d=c(15226),e=c(20967);class f{constructor(a){this.consumer=null,this.consumerPositions=new Map,this.config=a;let b={clientId:a.clientId||"kafka-client",brokers:a.brokers,logLevel:d.logLevel.DEBUG};if("SASL_SSL"===a.securityProtocol||"SSL"===a.securityProtocol?(b.ssl={rejectUnauthorized:!1,ca:a.certificate?[a.certificate]:void 0,checkServerIdentity:()=>void 0},a.truststore&&(a.truststore.certificates&&(b.ssl.ca=[a.truststore.certificates]),""!==a.truststore.algorithm&&a.truststore.algorithm||(b.ssl.rejectUnauthorized=!1))):b.ssl=!1,a.securityProtocol?.startsWith("SASL"))switch(a.authMethod){case"NO_AUTH":b.sasl={mechanism:"plain"};break;case"SASL/PLAIN":b.sasl={mechanism:"plain",username:a.username,password:a.password};break;case"SASL/JAAS":case"Delegation tokens":case"SASL/LDAP":break;case"SASL/GSSAPI":b.sasl={mechanism:"gssapi",kerberosPrincipal:a.kerberosPrincipal,kerberosKeytab:a.kerberosKeytab,kerberosRealm:a.kerberosRealm,kdc:a.kdc,serviceName:a.serviceName,krb5Config:a.krb5Config,useTicketCache:a.useTicketCache,ticketCachePath:a.ticketCachePath};break;case"SASL/OAUTHBEARER":b.sasl={mechanism:"oauthbearer",oauthBearerToken:a.oauthBearerToken};break;case"SASL/SCRAM-256":b.sasl={mechanism:"scram-sha-256",username:a.username,password:a.password};break;case"SASL/SCRAM-512":b.sasl={mechanism:"scram-sha-512",username:a.username,password:a.password};break;case"AWS_MSK_IAM":try{b.sasl=(0,e.S)(a.awsRegion||"eu-central-1",a.awsAccessKey||"",a.awsAccessKeySecret||"")}catch(a){throw console.error("Error setting up AWS_MSK_IAM authentication:",a),a}break;case"mTLS":a.clientCert&&a.clientKey&&(b.ssl={...b.ssl,cert:a.clientCert,key:a.clientKey,passphrase:a.password})}let c=new d.Kafka(b);this.kafka=c}async testConnection(){try{let a=this.kafka.admin();return await a.connect(),await a.listTopics(),await a.disconnect(),!0}catch(a){return console.error("Failed to connect to Kafka:",a),!1}}async listTopics(){try{let a=this.kafka.admin();await a.connect();let b=(await a.fetchTopicMetadata()).topics.map(a=>a.name);return await a.disconnect(),b}catch(a){throw console.error("Error listing Kafka topics:",a),a}}async getTopicDetails(){try{let a=this.kafka.admin();await a.connect();let b=(await a.fetchTopicMetadata()).topics.map(a=>({name:a.name,partitionCount:a.partitions.length}));return await a.disconnect(),b}catch(a){throw console.error("Error fetching topic details:",a),a}}async initializeConsumer(){this.consumer||(this.consumer=this.kafka.consumer({groupId:this.config.groupId||"default-group"}),await this.consumer.connect())}async subscribeToTopics(a){for(let b of(this.consumer||await this.initializeConsumer(),a))await this.consumer.subscribe({topic:b,fromBeginning:!0})}messageToEvent(a,b,c){return{topic:b,partition:c,offset:a.offset,timestamp:a.timestamp,key:a.key?.toString()||null,value:a.value?JSON.parse(a.value.toString()):null,headers:a.headers?Object.fromEntries(Object.entries(a.headers).map(([a,b])=>[a,b?.toString()||""])):void 0}}async consumeEvents(a){if(!this.consumer)throw Error("Consumer not initialized. Call subscribeToTopics first.");await this.consumer.run({eachMessage:async({topic:b,partition:c,message:d})=>{a(this.messageToEvent(d,b,c))}})}async disconnect(){this.consumer&&(await this.consumer.disconnect(),this.consumer=null)}async fetchSampleEvent(a,b="JSON",c=!1,d=null,e){let f=null;try{if(Date.now(),!await this.testConnection())throw console.error("KafkaClient: Failed to connect to Kafka"),Error("Failed to connect to Kafka");let g=this.kafka.admin();await g.connect();let h=e?.partition!==void 0?e.partition:0,i=null;try{let b=await g.fetchTopicMetadata({topics:[a]});if(!b.topics.length||b.topics[0].name!==a)throw console.error(`KafkaClient: Topic ${a} does not exist`),Error(`Topic ${a} does not exist`);if(!b.topics[0].partitions.length)throw console.error(`KafkaClient: Topic ${a} has no partitions`),Error(`Topic ${a} has no partitions`);let f=await g.fetchTopicOffsets(a);if(!f.some(a=>parseInt(a.high,10)>parseInt(a.low,10)))throw console.error(`KafkaClient: Topic ${a} exists but has no messages`),Error(`Topic ${a} exists but has no messages`);if(e?.partition===void 0){let a=f.find(a=>parseInt(a.high,10)>parseInt(a.low,10));a&&(h=a.partition)}if(e?.position==="latest"){let a=f.find(a=>a.partition===h);if(a){let b=parseInt(a.high,10);i=b>0?(b-1).toString():"0"}}else if(e?.position==="earliest"){let a=f.find(a=>a.partition===h);a&&(i=a.low)}else if(c&&null!==d)i=(BigInt(d)+BigInt(1)).toString();else if(e?.direction==="previous"&&null!==d){let a=f.find(a=>a.partition===h);if(a){let b=BigInt(a.low),c=BigInt(d)-BigInt(1);i=c<b?b.toString():c.toString()}}}finally{await g.disconnect()}let j=`${this.config.groupId||"sample"}-${a.replace(/[^a-zA-Z0-9]/g,"-")}`,k=`${j}-${Math.random().toString(36).substring(2,10)}`;f=this.kafka.consumer({groupId:k,sessionTimeout:3e4});let l=Promise.race([f.connect(),new Promise((a,b)=>setTimeout(()=>b(Error("Timeout connecting to Kafka")),5e3))]);await l;let m=Promise.race([f.subscribe({topic:a,fromBeginning:!0}),new Promise((a,b)=>setTimeout(()=>b(Error("Timeout subscribing to topic")),5e3))]);await m;let n=new Promise((c,d)=>{let g=null,j=!1,k=async({topic:a,partition:d,message:f})=>{if(Date.now(),d===h){if(null!==i){let a=BigInt(f.offset),b=BigInt(i);if(e?.position==="earliest"){if(a<b)return}else if(a!==b)return}j=!0,this.consumerPositions&&this.consumerPositions.set(a,{offset:f.offset,partition:d}),g&&clearTimeout(g);try{let e,g=f.value.toString();if("JSON"===b||"json"===b)try{e=JSON.parse(g)}catch(a){console.error("KafkaClient: Error parsing JSON:",a);try{let a=g.replace(/(\s*)(\w+)(\s*):(\s*)/g,'$1"$2"$3:$4');e=JSON.parse(a)}catch(a){console.error("KafkaClient: Failed to fix and parse JSON:",a),e={_raw:g,_error:"Failed to parse as JSON",_note:"The message doesn't contain valid JSON. Property names should be in double quotes."}}}else e={_raw:g};if(e._metadata={topic:a,partition:d,offset:f.offset,timestamp:f.timestamp},f.key)try{delete e.key}catch(a){console.warn("KafkaClient: Error parsing message key:",a),e.key=void 0}c(e)}catch(b){console.error("KafkaClient: Error processing message:",b),c({_raw:f.value.toString(),_error:"Failed to process message",_errorDetails:b instanceof Error?b.message:String(b),_metadata:{topic:a,partition:d,offset:f.offset,timestamp:f.timestamp}})}}};f?.run({eachMessage:k}).then(()=>{console.log("KafkaClient: Consumer run promise resolved")}).catch(a=>{console.error("KafkaClient: Error running consumer:",a),d(a)}),null!==i&&setTimeout(async()=>{try{await f?.seek({topic:a,partition:h,offset:i})}catch(a){console.error("KafkaClient: Error seeking to offset:",a),d(a)}},500);let l=e?.position==="earliest"?3e4:15e3;g=setTimeout(()=>{j||d(Error(`Timeout waiting for message from topic: ${a}`))},l)});return await n}catch(a){throw console.error("KafkaClient: Error in fetchSampleEvent:",a),a}finally{if(f)try{let a=Promise.race([f.disconnect(),new Promise(a=>setTimeout(a,3e3))]);await a}catch(a){console.error("KafkaClient: Error during consumer disconnect (continuing anyway):",a)}}}async fetchSampleEventWithFallback(a,b="JSON"){try{return await this.fetchSampleEvent(a,b)}catch(c){if(console.warn(`Failed to fetch real event from ${a}, using mock data:`,c),"JSON"===b||"json"===b)return{_mock:!0,timestamp:new Date().toISOString(),topic:a,key:"sample-key",value:{id:"12345",name:"Sample Event",description:"This is a mock event because we couldn't fetch a real one",properties:{prop1:"value1",prop2:42,prop3:!0},createdAt:new Date().toISOString()}};if("AVRO"===b||"avro"===b)return{_mock:!0,_note:"Mock AVRO data",data:{id:"12345",name:"Sample AVRO Event"}};if("CSV"===b||"csv"===b)return{_mock:!0,_note:"Mock CSV data",_raw:"id,name,value\n12345,Sample CSV Event,42"};else if("TSV"===b||"tsv"===b)return{_mock:!0,_note:"Mock TSV data",_raw:"id	name	value\n12345	Sample TSV Event	42"};else return{_mock:!0,_raw:"Sample raw data for "+a}}}}},57287:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f,failIfVersionNotSupported:g}=c(88374);a.exports={decode:async a=>{let b=new d(a),c=b.readInt16();return g(c),{errorCode:c,coordinator:{nodeId:b.readInt32(),host:b.readString(),port:b.readInt32()}}},parse:async a=>{if(e(a.errorCode))throw f(a.errorCode);return a}}},57333:(a,b,c)=>{let d=c(45500),{parse:e}=c(63300),f=c(39120),g=async a=>({partition:a.readInt32(),errorCode:a.readInt16(),highWatermark:a.readInt64().toString(),messages:await f(a)}),h=async a=>({topicName:a.readString(),partitions:await a.readArrayAsync(g)});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),responses:await b.readArrayAsync(h)}},parse:e}},57973:(a,b,c)=>{let d=c(26632);a.exports=({groupId:a,topics:b})=>Object.assign(d({groupId:a,topics:b}),{apiVersion:4})},58070:(a,b,c)=>{let d=c(39652),{DescribeConfigs:e}=c(81451);a.exports=({resources:a})=>({apiKey:e,apiVersion:0,apiName:"DescribeConfigs",encode:async()=>new d().writeArray(a.map(f))});let f=({type:a,name:b,configNames:c=[]})=>new d().writeInt8(a).writeString(b).writeNullableArray(c)},58641:(a,b,c)=>{let d={0:({transactionalId:a,producerId:b,producerEpoch:d,topics:e})=>{let f=c(40577),g=c(22077);return{request:f({transactionalId:a,producerId:b,producerEpoch:d,topics:e}),response:g}},1:({transactionalId:a,producerId:b,producerEpoch:d,topics:e})=>{let f=c(83198),g=c(82572);return{request:f({transactionalId:a,producerId:b,producerEpoch:d,topics:e}),response:g}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},59522:(a,b,c)=>{let{parse:d,decode:e}=c(30651);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},60556:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>({topic:a.readString(),partitions:a.readArray(h)}),h=a=>({partition:a.readInt32(),offset:a.readInt64().toString(),metadata:a.readString(),errorCode:a.readInt16()});a.exports={decode:async a=>({responses:new d(a).readArray(g)}),parse:async a=>{let b=a.responses.flatMap(a=>a.partitions.filter(a=>e(a.errorCode)))[0];if(b)throw f(b.errorCode);return a}}},60695:(a,b,c)=>{let d=c(38370),e=c(50998),f=c(67449),g=e("consumer"),h={HEARTBEAT:g("heartbeat"),COMMIT_OFFSETS:g("commit_offsets"),GROUP_JOIN:g("group_join"),FETCH:g("fetch"),FETCH_START:g("fetch_start"),START_BATCH_PROCESS:g("start_batch_process"),END_BATCH_PROCESS:g("end_batch_process"),CONNECT:g("connect"),DISCONNECT:g("disconnect"),STOP:g("stop"),CRASH:g("crash"),REBALANCING:g("rebalancing"),RECEIVED_UNSUBSCRIBED_TOPICS:g("received_unsubscribed_topics"),REQUEST:g(f.NETWORK_REQUEST),REQUEST_TIMEOUT:g(f.NETWORK_REQUEST_TIMEOUT),REQUEST_QUEUE_SIZE:g(f.NETWORK_REQUEST_QUEUE_SIZE)},i={[h.REQUEST]:f.NETWORK_REQUEST,[h.REQUEST_TIMEOUT]:f.NETWORK_REQUEST_TIMEOUT,[h.REQUEST_QUEUE_SIZE]:f.NETWORK_REQUEST_QUEUE_SIZE},j=d(i);a.exports={events:h,wrap:a=>j[a]||a,unwrap:a=>i[a]||a}},61097:(a,b,c)=>{let{KafkaJSNotImplemented:d}=c(16920),e={None:0,GZIP:1,Snappy:2,LZ4:3,ZSTD:4},f={[e.GZIP]:()=>c(39217),[e.Snappy]:()=>{throw new d("Snappy compression not implemented")},[e.LZ4]:()=>{throw new d("LZ4 compression not implemented")},[e.ZSTD]:()=>{throw new d("ZSTD compression not implemented")}};a.exports={Types:e,Codecs:f,lookupCodec:a=>f[a]?f[a]():null,lookupCodecByAttributes:a=>{let b=f[7&a];return b?b():null},COMPRESSION_CODEC_MASK:7}},61211:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>({groupId:a.readString(),errorCode:a.readInt16()});a.exports={decode:async a=>{let b=new d(a),c=b.readInt32(),h=b.readArray(g);for(let a of h)e(a.errorCode)&&(a.error=f(a.errorCode));return{throttleTimeMs:c,results:h}},parse:async a=>a}},61641:(a,b,c)=>{let d=c(45500),{failIfVersionNotSupported:e}=c(88374),{parse:f}=c(36603);a.exports={decode:async a=>{let b=new d(a),c=b.readInt32(),f=b.readInt16();return e(f),{throttleTime:c,errorCode:f,generationId:b.readInt32(),groupProtocol:b.readString(),leaderId:b.readString(),memberId:b.readString(),members:b.readArray(a=>({memberId:a.readString(),memberMetadata:a.readBytes()}))}},parse:f}},61791:(a,b,c)=>{let d=c(39652),{DeleteAcls:e}=c(81451),f=({resourceType:a,resourceName:b,resourcePatternType:c,principal:e,host:f,operation:g,permissionType:h})=>new d().writeInt8(a).writeString(b).writeInt8(c).writeString(e).writeString(f).writeInt8(g).writeInt8(h);a.exports=({filters:a})=>({apiKey:e,apiVersion:1,apiName:"DeleteAcls",encode:async()=>new d().writeArray(a.map(f))})},62239:a=>{a.exports=a=>{let b=Buffer.isBuffer(a)?a:Buffer.from(String(a)),c=b.length,d=0x9747b28c^c,e=c/4;for(let a=0;a<e;a++){let c=4*a,e=(255&b[c+0])+((255&b[c+1])<<8)+((255&b[c+2])<<16)+((255&b[c+3])<<24);e*=0x5bd1e995,e^=e>>>24,e*=0x5bd1e995,d*=0x5bd1e995,d^=e}switch(c%4){case 3:d^=(255&b[(-4&c)+2])<<16;case 2:d^=(255&b[(-4&c)+1])<<8;case 1:d^=255&b[-4&c],d*=0x5bd1e995}return d^=d>>>13,d*=0x5bd1e995,d^=d>>>15}},62413:(a,b,c)=>{let d=c(39652);a.exports=async({correlationId:a,clientId:b,request:{apiKey:c,apiVersion:e,encode:f}})=>{let g=await f(),h=new d().writeInt16(c).writeInt16(e).writeInt32(a).writeString(b).writeEncoder(g);return new d().writeInt32(h.size()).writeEncoder(h)}},62469:(a,b,c)=>{let{parse:d,decode:e}=c(11998);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},63270:(a,b,c)=>{let d=c(39652);a.exports=({finalMessage:a})=>({encode:async()=>new d().writeBytes(a).buffer})},63282:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>({errorCode:a.readInt16(),errorMessage:a.readString(),resourceType:a.readInt8(),resourceName:a.readString(),principal:a.readString(),host:a.readString(),operation:a.readInt8(),permissionType:a.readInt8()}),h=a=>({errorCode:a.readInt16(),errorMessage:a.readString(),matchingAcls:a.readArray(g)}),i=async a=>{let b=new d(a);return{throttleTime:b.readInt32(),filterResponses:b.readArray(h)}};a.exports={decodeMatchingAcls:g,decodeFilterResponse:h,decode:i,parse:async a=>{let b=a.filterResponses.filter(({errorCode:a})=>e(a));if(b.length>0)throw f(b[0].errorCode);for(let b of a.filterResponses){let a=b.matchingAcls.filter(({errorCode:a})=>e(a));if(a.length>0)throw f(a[0].errorCode)}return a}}},63300:(a,b,c)=>{let d=c(45500),{KafkaJSOffsetOutOfRange:e}=c(16920),{failure:f,createErrorFromCode:g,errorCodes:h}=c(88374),i=c(39120),j=async a=>({partition:a.readInt32(),errorCode:a.readInt16(),highWatermark:a.readInt64().toString(),messages:await i(a)}),k=async a=>({topicName:a.readString(),partitions:await a.readArrayAsync(j)}),l=async a=>{let b=new d(a);return{responses:await b.readArrayAsync(k)}},{code:m}=h.find(a=>"OFFSET_OUT_OF_RANGE"===a.type);a.exports={decode:l,parse:async a=>{let b=a.responses.flatMap(({topicName:a,partitions:b})=>b.filter(a=>f(a.errorCode)).map(b=>Object.assign({},b,{topic:a})));if(b.length>0){let{errorCode:a,topic:c,partition:d}=b[0];if(a===m)throw new e(g(a),{topic:c,partition:d});throw g(a)}return a}}},63412:(a,b,c)=>{let d=c(11041),e=c(62413),f=c(45500),{KafkaJSConnectionError:g,KafkaJSConnectionClosedError:h}=c(16920),{INT_32_MAX_VALUE:i}=c(57142),j=c(52056),k=c(98300),{CONNECTION_STATUS:l,CONNECTED_STATUS:m}=c(8462),n=c(81442),o=c(2087),p=c(93456),q=c(81451),r=({apiName:a,apiKey:b,apiVersion:c})=>`${a}(key: ${b}, version: ${c})`,s={SHOULD_REAUTHENTICATE:Symbol("private:Connection:shouldReauthenticate"),AUTHENTICATE:Symbol("private:Connection:authenticate")};a.exports=class{constructor({host:a,port:b,logger:c,socketFactory:d,requestTimeout:e,reauthenticationThreshold:g=1e4,rack:h=null,ssl:i=null,sasl:m=null,clientId:q="kafkajs",connectionTimeout:r,enforceRequestTimeout:t=!0,maxInFlightRequests:u=null,instrumentationEmitter:v=null}){this.host=a,this.port=b,this.rack=h,this.clientId=q,this.broker=`${this.host}:${this.port}`,this.logger=c.namespace("Connection"),this.socketFactory=d,this.ssl=i,this.sasl=m,this.requestTimeout=e,this.connectionTimeout=r,this.reauthenticationThreshold=g,this.bytesBuffered=0,this.bytesNeeded=f.int32Size(),this.chunks=[],this.connectionStatus=l.DISCONNECTED,this.correlationId=0,this.requestQueue=new k({instrumentationEmitter:v,maxInFlightRequests:u,requestTimeout:e,enforceRequestTimeout:t,clientId:q,broker:this.broker,logger:c.namespace("RequestQueue"),isConnected:()=>this.isConnected()}),this.versions=null,this.authHandlers=null,this.authExpectResponse=!1;let w=a=>(b,c={})=>{(0,this.logger[a])(b,{broker:this.broker,clientId:q,...c})};this.logDebug=w("debug"),this.logError=w("error");let x=j();this.shouldLogBuffers="1"===x.KAFKAJS_DEBUG_PROTOCOL_BUFFERS,this.shouldLogFetchBuffer=this.shouldLogBuffers&&"1"===x.KAFKAJS_DEBUG_EXTENDED_PROTOCOL_BUFFERS,this.authenticatedAt=null,this.sessionLifetime=o.ZERO,this.supportAuthenticationProtocol=null,this[s.AUTHENTICATE]=n(async()=>{if(this.sasl&&!this.isAuthenticated()){let a=new p(this,this.logger,this.versions,this.supportAuthenticationProtocol);await a.authenticate(),this.authenticatedAt=process.hrtime(),this.sessionLifetime=o.fromValue(a.sessionLifetime)}})}getSupportAuthenticationProtocol(){return this.supportAuthenticationProtocol}setSupportAuthenticationProtocol(a){this.supportAuthenticationProtocol=a}setVersions(a){this.versions=a}isConnected(){return m.includes(this.connectionStatus)}connect(){return new Promise((a,b)=>{let c;if(this.isConnected())return a(!0);this.authenticatedAt=null;let e=async()=>{clearTimeout(c);let a=this.isConnected();this.authHandlers?this.authHandlers.onError():a&&(this.logDebug("Kafka server has closed connection"),this.rejectRequests(new h("Closed connection",{host:this.host,port:this.port}))),await this.disconnect()},f=async a=>{clearTimeout(c);let d=new g(`Connection error: ${a.message}`,{broker:`${this.host}:${this.port}`,code:a.code});this.logError(d.message,{stack:a.stack}),this.rejectRequests(d),await this.disconnect(),b(d)},i=async()=>{let a=new g("Connection timeout",{broker:`${this.host}:${this.port}`});this.logError(a.message),this.rejectRequests(a),await this.disconnect(),b(a)};this.logDebug("Connecting",{ssl:!!this.ssl,sasl:!!this.sasl});try{c=setTimeout(i,this.connectionTimeout),this.socket=d({socketFactory:this.socketFactory,host:this.host,port:this.port,ssl:this.ssl,onConnect:()=>{clearTimeout(c),this.connectionStatus=l.CONNECTED,this.requestQueue.scheduleRequestTimeoutCheck(),a(!0)},onData:a=>{this.processData(a)},onEnd:e,onError:f,onTimeout:i})}catch(a){clearTimeout(c),b(new g(`Failed to connect: ${a.message}`,{broker:`${this.host}:${this.port}`}))}})}async disconnect(){return this.authenticatedAt=null,this.connectionStatus=l.DISCONNECTING,this.logDebug("disconnecting..."),await this.requestQueue.waitForPendingRequests(),this.requestQueue.destroy(),this.socket&&(this.socket.end(),this.socket.unref()),this.connectionStatus=l.DISCONNECTED,this.logDebug("disconnected"),!0}isAuthenticated(){return null!=this.authenticatedAt&&!this[s.SHOULD_REAUTHENTICATE]()}[s.SHOULD_REAUTHENTICATE](){if(this.sessionLifetime.equals(o.ZERO))return!1;if(null==this.authenticatedAt)return!0;let[a,b]=process.hrtime(this.authenticatedAt);return o.fromValue(a).multiply(1e3).add(o.fromValue(b).divide(1e6)).add(this.reauthenticationThreshold).greaterThanOrEqual(this.sessionLifetime)}async authenticate(){await this[s.AUTHENTICATE]()}sendAuthRequest({request:a,response:b}){return this.authExpectResponse=!!b,new Promise(async(c,d)=>{this.authHandlers={onSuccess:a=>{this.authHandlers=null,this.authExpectResponse=!1,b.decode(a).then(a=>b.parse(a)).then(c).catch(d)},onError:()=>{this.authHandlers=null,this.authExpectResponse=!1,d(new g("Connection closed by the server",{broker:`${this.host}:${this.port}`}))}};try{let b=await a.encode();this.failIfNotConnected(),this.socket.write(b,"binary")}catch(a){d(a)}})}async send({request:a,response:b,requestTimeout:c=null,logResponseError:d=!0}){this.isAuthenticated()||[q.ApiVersions,q.SaslHandshake,q.SaslAuthenticate].includes(a.apiKey)||await this[s.AUTHENTICATE](),this.failIfNotConnected();let f=!a.expectResponse||a.expectResponse(),g=async()=>{let{clientId:b}=this,d=this.nextCorrelationId(),g=await e({request:a,correlationId:d,clientId:b}),{apiKey:h,apiName:i,apiVersion:j}=a;return this.logDebug(`Request ${r(a)}`,{correlationId:d,expectResponse:f,size:Buffer.byteLength(g.buffer)}),new Promise((a,b)=>{try{this.failIfNotConnected(),this.requestQueue.push({entry:{apiKey:h,apiName:i,apiVersion:j,correlationId:d,resolve:a,reject:b},expectResponse:f,requestTimeout:c,sendRequest:()=>{this.socket.write(g.buffer,"binary")}})}catch(a){b(a)}})},{correlationId:h,size:i,entry:j,payload:k}=await g();if(f)try{let a=await b.decode(k);this.requestQueue.maybeThrottle(a.clientSideThrottleTime);let c=await b.parse(a),d="Fetch"===j.apiName;return this.logDebug(`Response ${r(j)}`,{correlationId:h,size:i,data:d&&!this.shouldLogFetchBuffer?"[filtered]":c}),c}catch(b){d&&this.logError(`Response ${r(j)}`,{error:b.message,correlationId:h,size:i});let a=Buffer.isBuffer(k);throw this.logDebug(`Response ${r(j)}`,{error:b.message,correlationId:h,payload:a&&!this.shouldLogBuffers?{type:"Buffer",data:"[filtered]"}:k}),b}}failIfNotConnected(){if(!this.isConnected())throw new g("Not connected",{broker:`${this.host}:${this.port}`})}nextCorrelationId(){return this.correlationId>=i&&(this.correlationId=0),this.correlationId++}processData(a){if(this.authHandlers&&!this.authExpectResponse)return this.authHandlers.onSuccess(a);for(this.chunks.push(a),this.bytesBuffered+=Buffer.byteLength(a);this.bytesNeeded<=this.bytesBuffered;){let a=this.chunks.length>1?Buffer.concat(this.chunks):this.chunks[0],b=new f(a),c=b.readInt32();if(!b.canReadBytes(c)){this.chunks=[a],this.bytesBuffered=Buffer.byteLength(a),this.bytesNeeded=f.int32Size()+c;return}let d=new f(b.readBytes(c)),e=b.readAll();if(this.chunks=[e],this.bytesBuffered=Buffer.byteLength(e),this.bytesNeeded=f.int32Size(),this.authHandlers){let b=f.int32Size()+c,d=a.slice(0,b);return this.authHandlers.onSuccess(d)}let g=d.readInt32(),h=d.readAll();this.requestQueue.fulfillRequest({size:c,correlationId:g,payload:h})}}rejectRequests(a){this.requestQueue.rejectAll(a)}}},63486:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>({topic:a.readString(),partitions:a.readArray(h)}),h=a=>({partition:a.readInt32(),errorCode:a.readInt16(),timestamp:a.readInt64().toString(),offset:a.readInt64().toString()});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),responses:b.readArray(g)}},parse:async a=>{let b=a.responses.flatMap(a=>a.partitions.filter(a=>e(a.errorCode)))[0];if(b)throw f(b.errorCode);return a}}},64471:(a,b,c)=>{let d=c(39652),{OffsetCommit:e}=c(81451);a.exports=({groupId:a,groupGenerationId:b,memberId:c,topics:g})=>({apiKey:e,apiVersion:5,apiName:"OffsetCommit",encode:async()=>new d().writeString(a).writeInt32(b).writeString(c).writeArray(g.map(f))});let f=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(g)),g=({partition:a,offset:b,metadata:c=null})=>new d().writeInt32(a).writeInt64(b).writeString(c)},65467:a=>{a.exports=(a,b)=>{let c=[],d=a.length,e=0;for(;e<d;)-1===b.indexOf(a[e])&&c.push(a[e]),e+=1;return c}},65630:(a,b,c)=>{let d=c(39652),{OffsetFetch:e}=c(81451);a.exports=({groupId:a,topics:b})=>({apiKey:e,apiVersion:1,apiName:"OffsetFetch",encode:async()=>new d().writeString(a).writeArray(b.map(f))});let f=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(g)),g=({partition:a})=>new d().writeInt32(a)},65773:(a,b,c)=>{let d=c(39652),{DescribeAcls:e}=c(81451);a.exports=({resourceType:a,resourceName:b,resourcePatternType:c,principal:f,host:g,operation:h,permissionType:i})=>({apiKey:e,apiVersion:1,apiName:"DescribeAcls",encode:async()=>new d().writeInt8(a).writeString(b).writeInt8(c).writeString(f).writeString(g).writeInt8(h).writeInt8(i)})},65848:(a,b,c)=>{let d=c(39652),{AlterConfigs:e}=c(81451);a.exports=({resources:a,validateOnly:b=!1})=>({apiKey:e,apiVersion:0,apiName:"AlterConfigs",encode:async()=>new d().writeArray(a.map(f)).writeBoolean(b)});let f=({type:a,name:b,configEntries:c})=>new d().writeInt8(a).writeString(b).writeArray(c.map(g)),g=({name:a,value:b})=>new d().writeString(a).writeString(b)},66345:(a,b,c)=>{let d=c(13958);a.exports=({mechanism:a})=>({...d({mechanism:a}),apiVersion:1})},66413:(a,b,c)=>{a.exports={request:c(280),response:c(92742)}},66631:(a,b,c)=>{let d=c(39652),{AlterPartitionReassignments:e}=c(81451);a.exports=({topics:a,timeout:b=5e3})=>({apiKey:e,apiVersion:0,apiName:"AlterPartitionReassignments",encode:async()=>new d().writeUVarIntBytes().writeInt32(b).writeUVarIntArray(a.map(f)).writeUVarIntBytes()});let f=({topic:a,partitionAssignment:b})=>new d().writeUVarIntString(a).writeUVarIntArray(b.map(g)).writeUVarIntBytes(),g=({partition:a,replicas:b})=>new d().writeInt32(a).writeUVarIntArray(b.map(h)).writeUVarIntBytes(),h=a=>new d().writeInt32(a)},66729:a=>{a.exports=({workers:a})=>{let b=[];return{push:async(...c)=>{let d=c.map(a=>new Promise((c,d)=>b.push({batch:a,resolve:c,reject:d})));a.forEach(a=>a.run({next:()=>b.shift()}));let e=(await Promise.allSettled(d)).find(a=>"rejected"===a.status);if(e)throw e.reason},getWorkers:()=>a}}},67323:a=>{a.exports=a=>({key:a.readVarIntString(),value:a.readVarIntBytes()})},67449:(a,b,c)=>{let d=c(50998)("network");a.exports={NETWORK_REQUEST:d("request"),NETWORK_REQUEST_TIMEOUT:d("request_timeout"),NETWORK_REQUEST_QUEUE_SIZE:d("request_queue_size")}},67945:(a,b,c)=>{let d=c(15558);a.exports=({replicaId:a,maxWaitTime:b,minBytes:c,topics:e})=>Object.assign(d({replicaId:a,maxWaitTime:b,minBytes:c,topics:e}),{apiVersion:1})},68081:(a,b,c)=>{let d=c(39652),{SyncGroup:e}=c(81451);a.exports=({groupId:a,generationId:b,memberId:c,groupInstanceId:g=null,groupAssignment:h})=>({apiKey:e,apiVersion:3,apiName:"SyncGroup",encode:async()=>new d().writeString(a).writeInt32(b).writeString(c).writeString(g).writeArray(h.map(f))});let f=({memberId:a,memberAssignment:b})=>new d().writeString(a).writeBytes(b)},68127:(a,b,c)=>{let d=c(39652),e=c(55631),{Types:f,COMPRESSION_CODEC_MASK:g}=c(61097);a.exports=({compression:a=f.None,key:b,value:c})=>{let h=new d().writeInt8(0).writeInt8(a&g).writeBytes(b).writeBytes(c),i=e(h);return new d().writeInt32(i).writeEncoder(h)}},68142:(a,b,c)=>{let d=c(45500),{parse:e}=c(26069),f=(a,b)=>a.topic.localeCompare(b.topic),g=a=>({topic:a.readString(),errorCode:a.readInt16(),errorMessage:a.readString()});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),topicErrors:b.readArray(g).sort(f)}},parse:e}},68229:(a,b,c)=>{let d=c(45500),{parse:e}=c(53940),{DEFAULT_CONFIG:f}=c(52173),g=a=>({configName:a.readString(),configValue:a.readString(),configSource:a.readInt8()}),h=a=>{let b=a.readString(),c=a.readString(),d=a.readBoolean(),e=a.readInt8();return{configName:b,configValue:c,readOnly:d,isDefault:e===f,configSource:e,isSensitive:a.readBoolean(),configSynonyms:a.readArray(g)}},i=a=>({errorCode:a.readInt16(),errorMessage:a.readString(),resourceType:a.readInt8(),resourceName:a.readString(),configEntries:a.readArray(h)});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),resources:b.readArray(i)}},parse:e}},68839:(a,b,c)=>{let{parse:d,decode:e}=c(32126);a.exports={decode:e,parse:d}},69064:(a,b,c)=>{let{parse:d,decode:e}=c(2041);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},69478:(a,b,c)=>{let d=c(39652),{ListGroups:e}=c(81451);a.exports=()=>({apiKey:e,apiVersion:0,apiName:"ListGroups",encode:async()=>new d})},69754:(a,b,c)=>{let{KafkaJSMetadataNotLoaded:d}=c(16920),{staleMetadata:e}=c(88374),f=c(14670),g=c(23505),h=c(38503),{keys:i}=Object;a.exports=({logger:a,cluster:b,partitioner:c,eosManager:j,retrier:k})=>async({acks:l,timeout:m,compression:n,topicMessages:o})=>{let p=new Map,q=async e=>{let k=new Map;for(let{topic:g,messages:h}of(await b.refreshMetadataIfNecessary(),o)){let j=b.findTopicPartitionMetadata(g);if(0===j.length)throw a.debug("Producing to topic without metadata",{topic:g,targetTopics:Array.from(b.targetTopics)}),new d("Producing to topic without metadata");let l=f({topic:g,partitionMetadata:j,messages:h,partitioner:c}),m=i(l),n=b.findLeaderForPartitions(g,m),o=i(n);for(let a of(k.set(g,{partitionsPerLeader:n,messagesPerPartition:l}),o)){let c=await b.findBroker({nodeId:a});e.has(c)||e.set(c,null)}}return Array.from(e.keys()).filter(a=>!e.get(a)).map(async a=>{let b=g(Array.from(k.entries()).filter(([b,{partitionsPerLeader:c}])=>!!c[a.nodeId]).map(([b,{partitionsPerLeader:c,messagesPerPartition:d,sequencePerPartition:e}])=>({topic:b,partitions:c[a.nodeId],messagesPerPartition:d})));await j.acquireBrokerLock(a);try{let c;j.isTransactional()&&await j.addPartitionsToTransaction(b),b.forEach(({topic:a,partitions:b})=>{b.forEach(b=>{b.firstSequence=j.getSequence(a,b.partition),j.updateSequence(a,b.partition,b.messages.length)})});try{c=await a.produce({transactionalId:j.isTransactional()?j.getTransactionalId():void 0,producerId:j.getProducerId(),producerEpoch:j.getProducerEpoch(),acks:l,timeout:m,compression:n,topicData:b})}catch(a){throw b.forEach(({topic:a,partitions:b})=>{b.forEach(b=>{j.updateSequence(a,b.partition,-b.messages.length)})}),a}let d=0!==l?h(c):[];e.set(a,d)}catch(b){throw e.delete(a),b}finally{await j.releaseBrokerLock(a)}})};return k(async(c,d,f)=>{let g=o.map(({topic:a})=>a);await b.addMultipleTargetTopics(g);try{let a=await q(p);return await Promise.all(a),Array.from(p.values()).flat()}catch(g){if("KafkaJSConnectionClosedError"===g.name&&b.removeBroker({host:g.host,port:g.port}),!b.isConnected())throw a.debug(`Cluster has disconnected, reconnecting: ${g.message}`,{retryCount:d,retryTime:f}),await b.connect(),await b.refreshMetadata(),g;if(e(g)||"KafkaJSMetadataNotLoaded"===g.name||"KafkaJSConnectionError"===g.name||"KafkaJSConnectionClosedError"===g.name||"KafkaJSProtocolError"===g.name&&g.retriable)throw a.error(`Failed to send messages: ${g.message}`,{retryCount:d,retryTime:f}),await b.refreshMetadata(),g;if(a.error(`${g.message}`,{retryCount:d,retryTime:f}),g.retriable)throw g;c(g)}})}},69831:(a,b,c)=>{let d=c(39652),{DeleteRecords:e}=c(81451);a.exports=({topics:a,timeout:b=5e3})=>({apiKey:e,apiVersion:0,apiName:"DeleteRecords",encode:async()=>new d().writeArray(a.map(({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(({partition:a,offset:b})=>new d().writeInt32(a).writeInt64(b))))).writeInt32(b)})},70447:(a,b,c)=>{let{parse:d,decode:e}=c(17990);a.exports={decode:e,parse:d}},70528:(a,b,c)=>{let d=c(38370),e=c(67449),f=c(50998)("admin"),g={CONNECT:f("connect"),DISCONNECT:f("disconnect"),REQUEST:f(e.NETWORK_REQUEST),REQUEST_TIMEOUT:f(e.NETWORK_REQUEST_TIMEOUT),REQUEST_QUEUE_SIZE:f(e.NETWORK_REQUEST_QUEUE_SIZE)},h={[g.REQUEST]:e.NETWORK_REQUEST,[g.REQUEST_TIMEOUT]:e.NETWORK_REQUEST_TIMEOUT,[g.REQUEST_QUEUE_SIZE]:e.NETWORK_REQUEST_QUEUE_SIZE},i=d(h);a.exports={events:g,wrap:a=>i[a]||a,unwrap:a=>h[a]||a}},70691:(a,b,c)=>{let d={0:({topics:a,timeout:b})=>{let d=c(83611),e=c(94159);return{request:d({topics:a,timeout:b}),response:e}},1:({topics:a,timeout:b})=>{let d=c(26808),e=c(72998);return{request:d({topics:a,timeout:b}),response:e}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},71205:(a,b,c)=>{let d=c(26826),{KafkaJSTimeout:e}=c(16920);a.exports=(a,{delay:b=50,maxWait:c=1e4,timeoutMessage:f="Timeout",ignoreTimeout:g=!1}={})=>{let h,i=0,j=!1,k=async(c,e)=>{if(i+=b,!j){await d(b);try{let b=await a(i);if(b)return j=!0,clearTimeout(h),c(b);k(c,e)}catch(a){j=!0,clearTimeout(h),e(a)}}};return new Promise((a,b)=>{k(a,b),g||(h=setTimeout(()=>{if(!j)return j=!0,b(new e(f))},c))})}},71731:(a,b,c)=>{let d={0:({resources:a,validateOnly:b})=>{let d=c(65848),e=c(6303);return{request:d({resources:a,validateOnly:b}),response:e}},1:({resources:a,validateOnly:b})=>{let d=c(35528),e=c(26902);return{request:d({resources:a,validateOnly:b}),response:e}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},72718:(a,b,c)=>{let d=c(55511),e=c(14039),{KafkaJSSASLAuthenticationError:f,KafkaJSNonRetriableError:g}=c(16920),h=/=/g,i=/,/g,j=/\+/g,k=/\//g,l=/=+$/,m=a=>Buffer.from(a).toString("base64");class n{static sanitizeString(a){return a.replace(h,"=3D").replace(i,"=2C")}static nonce(){return d.randomBytes(16).toString("base64").replace(j,"-").replace(k,"_").replace(l,"").toString("ascii")}static hi(a,b,c,e){return new Promise((f,g)=>{d.pbkdf2(a,b,c,e.length,e.type,(a,b)=>a?g(a):f(b))})}static xor(a,b){let c=Buffer.from(a),d=Buffer.from(b),e=Buffer.byteLength(c);if(e!==Buffer.byteLength(d))throw new g("Buffers must be of the same length");let f=[];for(let a=0;a<e;a++)f.push(c[a]^d[a]);return Buffer.from(f)}constructor(a,b,c,d,e,f){this.sasl=a,this.host=b,this.port=c,this.logger=d,this.saslAuthenticate=e,this.digestDefinition=f;let g=f.type.toUpperCase();this.PREFIX=`SASL SCRAM ${g} authentication`,this.currentNonce=n.nonce()}async authenticate(){let{PREFIX:a}=this,b=`${this.host}:${this.port}`;if(null==this.sasl.username||null==this.sasl.password)throw new f(`${this.PREFIX}: Invalid username or password`);try{this.logger.debug("Exchanging first client message",{broker:b});let c=await this.sendClientFirstMessage();this.logger.debug("Sending final message",{broker:b});let d=await this.sendClientFinalMessage(c);if(d.e)throw Error(d.e);let e=await this.serverKey(c),f=this.serverSignature(e,c);if(d.v!==f)throw Error("Invalid server signature in server final message");this.logger.debug(`${a} successful`,{broker:b})}catch(d){let c=new f(`${a} failed: ${d.message}`);throw this.logger.error(c.message,{broker:b}),c}}async sendClientFirstMessage(){let a=`n,,${this.firstMessageBare()}`,b=e.firstMessage.request({clientFirstMessage:a}),c=e.firstMessage.response;return this.saslAuthenticate({request:b,response:c})}async sendClientFinalMessage(a){let{PREFIX:b}=this,c=parseInt(a.i,10),{minIterations:d}=this.digestDefinition;if(!a.r.startsWith(this.currentNonce))throw new f(`${b} failed: Invalid server nonce, it does not start with the client nonce`);if(c<d)throw new f(`${b} failed: Requested iterations ${c} is less than the minimum ${d}`);let g=this.finalMessageWithoutProof(a),h=await this.clientProof(a),i=`${g},p=${h}`,j=e.finalMessage.request({finalMessage:i}),k=e.finalMessage.response;return this.saslAuthenticate({request:j,response:k})}async clientProof(a){let b=await this.clientKey(a),c=this.H(b),d=this.clientSignature(c,a);return m(n.xor(b,d))}async clientKey(a){let b=await this.saltPassword(a);return this.HMAC(b,"Client Key")}async serverKey(a){let b=await this.saltPassword(a);return this.HMAC(b,"Server Key")}clientSignature(a,b){return this.HMAC(a,this.authMessage(b))}serverSignature(a,b){return m(this.HMAC(a,this.authMessage(b)))}authMessage(a){return[this.firstMessageBare(),a.original,this.finalMessageWithoutProof(a)].join(",")}async saltPassword(a){let b=Buffer.from(a.s,"base64"),c=parseInt(a.i,10);return n.hi(this.encodedPassword(),b,c,this.digestDefinition)}firstMessageBare(){return`n=${this.encodedUsername()},r=${this.currentNonce}`}finalMessageWithoutProof(a){let b=a.r;return`c=${m("n,,")},r=${b}`}encodedUsername(){let{username:a}=this.sasl;return n.sanitizeString(a).toString("utf-8")}encodedPassword(){let{password:a}=this.sasl;return a.toString("utf-8")}H(a){return d.createHash(this.digestDefinition.type).update(a).digest()}HMAC(a,b){return d.createHmac(this.digestDefinition.type,a).update(b).digest()}}a.exports={DIGESTS:{SHA256:{length:32,type:"sha256",minIterations:4096},SHA512:{length:64,type:"sha512",minIterations:4096}},SCRAM:n}},72998:(a,b,c)=>{let d=c(45500),{parse:e}=c(94159),f=(a,b)=>a.topic.localeCompare(b.topic),g=a=>({topic:a.readString(),errorCode:a.readInt16()});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:0,clientSideThrottleTime:b.readInt32(),topicErrors:b.readArray(g).sort(f)}},parse:e}},74023:(a,b,c)=>{let d=c(9524);a.exports=({transactionalId:a,producerId:b,producerEpoch:c,groupId:e})=>Object.assign(d({transactionalId:a,producerId:b,producerEpoch:c,groupId:e}),{apiVersion:1})},74323:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>({partition:a.readInt32(),errorCode:a.readInt16(),baseOffset:a.readInt64().toString(),logAppendTime:a.readInt64().toString()});a.exports={decode:async a=>{let b=new d(a);return{topics:b.readArray(a=>({topicName:a.readString(),partitions:a.readArray(g)})),throttleTime:b.readInt32()}},parse:async a=>{let b=a.topics.flatMap(a=>a.partitions.filter(a=>e(a.errorCode)));if(b.length>0){let{errorCode:a}=b[0];throw f(a)}return a}}},74765:(a,b,c)=>{let d=c(39652),{Metadata:e}=c(81451);a.exports=({topics:a,allowAutoTopicCreation:b=!0})=>({apiKey:e,apiVersion:4,apiName:"Metadata",encode:async()=>new d().writeNullableArray(a).writeBoolean(b)})},74830:(a,b,c)=>{let d=c(401);a.exports=()=>({...d(),apiVersion:1})},74943:(a,b,c)=>{let d=c(2087),e=c(39652),f=c(28025),{Types:g,lookupCodec:h,COMPRESSION_CODEC_MASK:i}=c(61097),j=async(a,b)=>{let c=h(a),d=new e;return d.writeEncoderArray(b),c.compress(d)};a.exports={RecordBatch:async({compression:a=g.None,firstOffset:b=d.fromInt(0),firstTimestamp:c=Date.now(),maxTimestamp:h=Date.now(),partitionLeaderEpoch:k=0,lastOffsetDelta:l=0,transactional:m=!1,producerId:n=d.fromValue(-1),producerEpoch:o=0,firstSequence:p=0,records:q=[]})=>{let r=a&i,s=new e().writeInt16(0|r|16*!!m).writeInt32(l).writeInt64(c).writeInt64(h).writeInt64(n).writeInt16(o).writeInt32(p);if(a===g.None)q.every(a=>typeof a==typeof q[0])?s.writeArray(q,typeof q[0]):s.writeArray(q);else{let b=await j(a,q);s.writeInt32(q.length).writeBuffer(b)}let t=new e().writeInt32(k).writeInt8(2).writeUInt32(f(s.buffer)).writeEncoder(s);return new e().writeInt64(b).writeBytes(t.buffer)},MAGIC_BYTE:2}},75348:(a,b,c)=>{let d=c(39652),{SaslAuthenticate:e}=c(81451);a.exports=({authBytes:a})=>({apiKey:e,apiVersion:0,apiName:"SaslAuthenticate",encode:async()=>new d().writeBuffer(a)})},75534:(a,b,c)=>{let{parse:d,decode:e}=c(24661);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},76408:(a,b,c)=>{let d=c(2087),e=c(4702),{initialRetryTime:f}=c(97274),g=c(19267),h=c(55480),{events:i,wrap:j,unwrap:k}=c(60695),l=c(9688),{KafkaJSNonRetriableError:m}=c(16920),{roundRobin:n}=c(7752),{EARLIEST_OFFSET:o,LATEST_OFFSET:p}=c(57142),q=c(96268),r=c(81442),{keys:s,values:t}=Object,{CONNECT:u,DISCONNECT:v,STOP:w,CRASH:x}=i,y=t(i),z=s(i).map(a=>`consumer.events.${a}`).join(", "),A=[d.fromValue(o).toString(),d.fromValue(p).toString()];a.exports=({cluster:a,groupId:b,retry:c,logger:o,partitionAssigners:p=[n],sessionTimeout:t=3e4,rebalanceTimeout:B=6e4,heartbeatInterval:C=3e3,maxBytesPerPartition:D=1048576,minBytes:E=1,maxBytes:F=0xa00000,maxWaitTimeInMs:G=5e3,isolationLevel:H=q.READ_COMMITTED,rackId:I="",instrumentationEmitter:J,metadataMaxAge:K})=>{if(!b)throw new m("Consumer groupId must be a non-empty string.");let L=o.namespace("Consumer"),M=J||new l,N=p.map(c=>c({groupId:b,logger:L,cluster:a})),O={},P=null,Q=null,R=null;if(C>=t)throw new m(`Consumer heartbeatInterval (${C}) must be lower than sessionTimeout (${t}). It is recommended to set heartbeatInterval to approximately a third of the sessionTimeout.`);let S=async()=>{await a.connect(),M.emit(u)},T=async()=>{try{await U(),L.debug("consumer has stopped, disconnecting",{groupId:b}),await a.disconnect(),M.emit(v)}catch(a){throw L.error(`Caught error when disconnecting the consumer: ${a.message}`,{stack:a.stack,groupId:b}),a}},U=r(async()=>{try{P&&(await P.stop(),P=null,Q=null,M.emit(w)),clearTimeout(R),L.info("Stopped",{groupId:b})}catch(a){throw L.error(`Caught error when stopping the consumer: ${a.message}`,{stack:a.stack,groupId:b}),a}}),V=async({autoCommit:d=!0,autoCommitInterval:e=null,autoCommitThreshold:i=null,eachBatchAutoResolve:j=!0,partitionsConsumedConcurrently:k=1,eachBatch:l=null,eachMessage:m=null}={})=>{if(Q)return void L.warn("consumer#run was called, but the consumer is already running",{groupId:b});let n=async f=>{L.info("Starting",{groupId:b}),Q=new g({logger:o,topics:s(O),topicConfigurations:O,retry:c,cluster:a,groupId:b,assigners:N,sessionTimeout:t,rebalanceTimeout:B,maxBytesPerPartition:D,minBytes:E,maxBytes:F,maxWaitTimeInMs:G,instrumentationEmitter:M,isolationLevel:H,rackId:I,metadataMaxAge:K,autoCommit:d,autoCommitInterval:e,autoCommitThreshold:i}),P=new h({logger:o,consumerGroup:Q,instrumentationEmitter:M,heartbeatInterval:C,retry:c,autoCommit:d,eachBatchAutoResolve:j,eachBatch:l,eachMessage:m,onCrash:f,concurrency:k}),await P.start()},p=async d=>{L.error(`Crash: ${d.name}: ${d.message}`,{groupId:b,retryCount:d.retryCount,stack:d.stack}),"KafkaJSConnectionClosedError"===d.name&&a.removeBroker({host:d.host,port:d.port}),await T();let e=a=>a.cause?e(a.cause):a,g=("KafkaJSNumberOfRetriesExceeded"===d.name||!0===e(d).retriable)&&(!c||!c.restartOnFailure||await c.restartOnFailure(d).catch(a=>(L.error('Caught error when invoking user-provided "restartOnFailure" callback. Defaulting to restarting.',{error:a.message||a,cause:d.message||d,groupId:b}),!0)));if(M.emit(x,{error:d,groupId:b,restart:g}),g){let a=d.retryTime||c&&c.initialRetryTime||f;L.error(`Restarting the consumer in ${a}ms`,{retryCount:d.retryCount,retryTime:a,groupId:b}),R=setTimeout(()=>n(p),a)}};await n(p)};return{connect:S,disconnect:T,subscribe:async({topic:c,topics:d,fromBeginning:e=!1})=>{if(Q)throw new m("Cannot subscribe to topic while consumer is running");if(!c&&!d)throw new m('Missing required argument "topics"');if(null!=d&&!Array.isArray(d))throw new m('Argument "topics" must be an array');let f=d||[c];for(let a of f)if("string"!=typeof a&&!(a instanceof RegExp))throw new m(`Invalid topic ${a} (${typeof a}), the topic name has to be a String or a RegExp`);let g=f.some(a=>a instanceof RegExp)?await a.metadata():void 0,h=[];for(let a of f)if(a instanceof RegExp){let c=a,d=g.topicMetadata.map(({topic:a})=>a).filter(a=>c.test(a));L.debug("Subscription based on RegExp",{groupId:b,topicRegExp:c.toString(),matchedTopics:d}),h.push(...d)}else h.push(a);for(let a of h)O[a]={fromBeginning:e};await a.addMultipleTargetTopics(h)},stop:U,run:V,commitOffsets:async(a=[])=>{let b=a.reduce((a,{topic:b,partition:c,offset:e,metadata:f=null})=>{let g;if(!b)throw new m(`Invalid topic ${b}`);if(isNaN(c))throw new m(`Invalid partition, expected a number received ${c}`);try{g=d.fromValue(e)}catch(a){throw new m(`Invalid offset, expected a long received ${e}`)}if(g.lessThan(0))throw new m("Offset must not be a negative number");if(null!==f&&"string"!=typeof f)throw new m(`Invalid offset metadata, expected string or null, received ${f}`);let h=a[b]||[];return h.push({partition:c,offset:g,metadata:f}),{...a,[b]:h}},{});if(!Q)throw new m("Consumer group was not initialized, consumer#run must be called first");let c=Object.keys(b);return P.commitOffsets({topics:c.map(a=>({topic:a,partitions:b[a]}))})},seek:({topic:a,partition:b,offset:c})=>{let e;if(!a)throw new m(`Invalid topic ${a}`);if(isNaN(b))throw new m(`Invalid partition, expected a number received ${b}`);try{e=d.fromValue(c)}catch(a){throw new m(`Invalid offset, expected a long received ${c}`)}if(e.lessThan(0)&&!A.includes(e.toString()))throw new m("Offset must not be a negative number");if(!Q)throw new m("Consumer group was not initialized, consumer#run must be called first");Q.seek({topic:a,partition:b,offset:e.toString()})},describeGroup:async()=>{let d=await a.findGroupCoordinator({groupId:b});return e(c)(async()=>{let{groups:a}=await d.describeGroups({groupIds:[b]});return a.find(a=>a.groupId===b)})},pause:(a=[])=>{for(let b of a)if(b&&b.topic){if(void 0!==b.partitions&&(!Array.isArray(b.partitions)||b.partitions.some(isNaN)))throw new m(`Array of valid partitions required to pause specific partitions instead of ${b.partitions}`)}else throw new m(`Invalid topic ${b&&b.topic||b}`);if(!Q)throw new m("Consumer group was not initialized, consumer#run must be called first");Q.pause(a)},paused:()=>Q?Q.paused():[],resume:(a=[])=>{for(let b of a)if(b&&b.topic){if(void 0!==b.partitions&&(!Array.isArray(b.partitions)||b.partitions.some(isNaN)))throw new m(`Array of valid partitions required to resume specific partitions instead of ${b.partitions}`)}else throw new m(`Invalid topic ${b&&b.topic||b}`);if(!Q)throw new m("Consumer group was not initialized, consumer#run must be called first");Q.resume(a)},on:(a,b)=>{if(!y.includes(a))throw new m(`Event name should be one of ${z}`);return M.addListener(k(a),c=>{c.type=j(c.type),Promise.resolve(b(c)).catch(b=>{L.error(`Failed to execute listener: ${b.message}`,{eventName:a,stack:b.stack})})})},events:i,logger:()=>L}}},76600:(a,b,c)=>{let d=c(39652),{SyncGroup:e}=c(81451);a.exports=({groupId:a,generationId:b,memberId:c,groupAssignment:g})=>({apiKey:e,apiVersion:0,apiName:"SyncGroup",encode:async()=>new d().writeString(a).writeInt32(b).writeString(c).writeArray(g.map(f))});let f=({memberId:a,memberAssignment:b})=>new d().writeString(a).writeBytes(b)},76669:(a,b,c)=>{let d=c(2087);a.exports=a=>!a&&0!==a||d.fromValue(a).isNegative()},77107:a=>{a.exports=a=>({attributes:a.readInt8(),key:a.readBytes(),value:a.readBytes()})},77113:(a,b,c)=>{let{parse:d,decode:e}=c(33590);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},77470:(a,b,c)=>{let d=c(80215),e=c(25506),f=c(81442),g=c(4702),h=c(15847),{EARLIEST_OFFSET:i,LATEST_OFFSET:j}=c(57142),{KafkaJSError:k,KafkaJSBrokerNotFound:l,KafkaJSMetadataNotLoaded:m,KafkaJSTopicMetadataNotLoaded:n,KafkaJSGroupCoordinatorNotFound:o}=c(16920),p=c(1857),{keys:q}=Object,r=(a,{topic:b,partitions:c})=>({...a,[b]:[...a[b]||[],...c]}),s={CONNECT:Symbol("private:Cluster:connect"),REFRESH_METADATA:Symbol("private:Cluster:refreshMetadata"),REFRESH_METADATA_IF_NECESSARY:Symbol("private:Cluster:refreshMetadataIfNecessary"),FIND_CONTROLLER_BROKER:Symbol("private:Cluster:findControllerBroker")};a.exports=class{constructor({logger:a,socketFactory:b,brokers:c,ssl:i,sasl:j,clientId:k,connectionTimeout:n,authenticationTimeout:o,reauthenticationThreshold:p,requestTimeout:q=3e4,enforceRequestTimeout:r,metadataMaxAge:t,retry:u,allowAutoTopicCreation:v,maxInFlightRequests:w,isolationLevel:x,instrumentationEmitter:y=null,offsets:z=new Map}){this.rootLogger=a,this.logger=a.namespace("Cluster"),this.retrier=g(u),this.connectionPoolBuilder=h({logger:a,instrumentationEmitter:y,socketFactory:b,brokers:c,ssl:i,sasl:j,clientId:k,connectionTimeout:n,requestTimeout:q,enforceRequestTimeout:r,maxInFlightRequests:w,reauthenticationThreshold:p}),this.targetTopics=new Set,this.mutatingTargetTopics=new e({description:"updating target topics",timeout:q}),this.isolationLevel=x,this.brokerPool=new d({connectionPoolBuilder:this.connectionPoolBuilder,logger:this.rootLogger,retry:u,allowAutoTopicCreation:v,authenticationTimeout:o,metadataMaxAge:t}),this.committedOffsetsByGroup=z,this[s.CONNECT]=f(async()=>await this.brokerPool.connect()),this[s.REFRESH_METADATA]=f(async()=>await this.brokerPool.refreshMetadata(Array.from(this.targetTopics))),this[s.REFRESH_METADATA_IF_NECESSARY]=f(async()=>await this.brokerPool.refreshMetadataIfNecessary(Array.from(this.targetTopics))),this[s.FIND_CONTROLLER_BROKER]=f(async()=>{let{metadata:a}=this.brokerPool;if(!a||null==a.controllerId)throw new m("Topic metadata not loaded");let b=await this.findBroker({nodeId:a.controllerId});if(!b)throw new l(`Controller broker with id ${a.controllerId} not found in the cached metadata`);return b})}isConnected(){return this.brokerPool.hasConnectedBrokers()}async connect(){await this[s.CONNECT]()}async disconnect(){await this.brokerPool.disconnect()}removeBroker({host:a,port:b}){this.brokerPool.removeBroker({host:a,port:b})}async refreshMetadata(){await this[s.REFRESH_METADATA]()}async refreshMetadataIfNecessary(){await this[s.REFRESH_METADATA_IF_NECESSARY]()}async metadata({topics:a=[]}={}){return this.retrier(async(b,c,d)=>{try{return await this.brokerPool.refreshMetadataIfNecessary(a),this.brokerPool.withBroker(async({broker:b})=>b.metadata(a))}catch(a){if("LEADER_NOT_AVAILABLE"===a.type)throw a;b(a)}})}async addTargetTopic(a){return this.addMultipleTargetTopics([a])}async addMultipleTargetTopics(a){await this.mutatingTargetTopics.acquire();try{let b=this.targetTopics.size,c=new Set(this.targetTopics);for(let b of a)this.targetTopics.add(b);if(b!==this.targetTopics.size||!this.brokerPool.metadata)try{await this.refreshMetadata()}catch(a){throw("INVALID_TOPIC_EXCEPTION"===a.type||"UNKNOWN_TOPIC_OR_PARTITION"===a.type||"TOPIC_AUTHORIZATION_FAILED"===a.type)&&(this.targetTopics=c),a}}finally{await this.mutatingTargetTopics.release()}}getNodeIds(){return this.brokerPool.getNodeIds()}async findBroker({nodeId:a}){try{return await this.brokerPool.findBroker({nodeId:a})}catch(a){throw("KafkaJSBrokerNotFound"===a.name||"KafkaJSLockTimeout"===a.name||"KafkaJSConnectionError"===a.name)&&await this.refreshMetadata(),a}}async findControllerBroker(){return await this[s.FIND_CONTROLLER_BROKER]()}findTopicPartitionMetadata(a){let{metadata:b}=this.brokerPool;if(!b||!b.topicMetadata)throw new n("Topic metadata not loaded",{topic:a});let c=b.topicMetadata.find(b=>b.topic===a);return c?c.partitionMetadata:[]}findLeaderForPartitions(a,b){let c=this.findTopicPartitionMetadata(a);return b.reduce((b,d)=>{let e=parseInt(d,10),f=c.find(a=>a.partitionId===e);if(!f)return b;if(null===f.leader||void 0===f.leader)throw new k("Invalid partition metadata",{topic:a,partitionId:e,metadata:f});let{leader:g}=f,h=b[g]||[];return{...b,[g]:[...h,e]}},{})}async findGroupCoordinator({groupId:a,coordinatorType:b=p.GROUP}){return this.retrier(async(c,d,e)=>{try{let{coordinator:c}=await this.findGroupCoordinatorMetadata({groupId:a,coordinatorType:b});return await this.findBroker({nodeId:c.nodeId})}catch(b){if("KafkaJSBrokerNotFound"===b.name||"GROUP_COORDINATOR_NOT_AVAILABLE"===b.type)throw this.logger.debug(`${b.message}, refreshing metadata and trying again...`,{groupId:a,retryCount:d,retryTime:e}),await this.refreshMetadata(),b;if("ECONNREFUSED"===b.code)throw b;c(b)}})}async findGroupCoordinatorMetadata({groupId:a,coordinatorType:b}){let c=await this.brokerPool.withBroker(async({nodeId:c,broker:d})=>await this.retrier(async(e,f,g)=>{try{let c=await d.findGroupCoordinator({groupId:a,coordinatorType:b});return this.logger.debug("Found group coordinator",{broker:c.host,nodeId:c.coordinator.nodeId}),c}catch(b){if(this.logger.debug("Tried to find group coordinator",{nodeId:c,groupId:a,error:b}),"GROUP_COORDINATOR_NOT_AVAILABLE"===b.type)throw this.logger.debug("Group coordinator not available, retrying...",{nodeId:c,retryCount:f,retryTime:g}),b;e(b)}}));if(c)return c;throw new o("Failed to find group coordinator")}defaultOffset({fromBeginning:a}){return a?i:j}async fetchTopicsOffset(a){let b={},c={};for(let d of a){let{topic:a,partitions:e,fromBeginning:f,fromTimestamp:g}=d,h=this.findLeaderForPartitions(a,e.map(a=>a.partition)),i=null!=g?g:this.defaultOffset({fromBeginning:f});c[a]={timestamp:i},q(h).forEach(c=>{b[c]=b[c]||{},b[c][a]=e.filter(a=>h[c].includes(a.partition))})}let d=q(b).map(async a=>{let d=await this.findBroker({nodeId:a}),e=b[a],{responses:f}=await d.listOffsets({isolationLevel:this.isolationLevel,topics:q(e).map(a=>({topic:a,partitions:e[a].map(b=>{let{timestamp:d}=c[a];return{...b,timestamp:d}})}))});return f}),e=(await Promise.all(d)).flat().reduce(r,{});return q(e).map(a=>({topic:a,partitions:e[a].map(({partition:a,offset:b})=>({partition:a,offset:b}))}))}committedOffsets({groupId:a}){return this.committedOffsetsByGroup.has(a)||this.committedOffsetsByGroup.set(a,{}),this.committedOffsetsByGroup.get(a)}markOffsetAsCommitted({groupId:a,topic:b,partition:c,offset:d}){let e=this.committedOffsets({groupId:a});e[b]=e[b]||{},e[b][c]=d}}},78499:a=>{let b=a=>b=>b.charAt(0)===a?b.substring(1):b,c=b("/"),d=b("#");a.exports=(a,b)=>`https://kafka.js.org/${c(a)}${b?"#"+d(b):""}`},78665:a=>{a.exports=a=>{let c=-1;for(let d=0;d<a.length;d++)c=b[(c^a[d])&255]^c>>>8;return(-1^c)>>>0};var b=new Int32Array([0,0xf26b8303,0xe13b70f7,0x1350f3f4,0xc79a971f,0x35f1141c,0x26a1e7e8,0xd4ca64eb,0x8ad958cf,0x78b2dbcc,0x6be22838,0x9989ab3b,0x4d43cfd0,0xbf284cd3,0xac78bf27,0x5e133c24,0x105ec76f,0xe235446c,0xf165b798,0x30e349b,0xd7c45070,0x25afd373,0x36ff2087,0xc494a384,0x9a879fa0,0x68ec1ca3,0x7bbcef57,0x89d76c54,0x5d1d08bf,0xaf768bbc,0xbc267848,0x4e4dfb4b,0x20bd8ede,0xd2d60ddd,0xc186fe29,0x33ed7d2a,0xe72719c1,0x154c9ac2,0x61c6936,0xf477ea35,0xaa64d611,0x580f5512,0x4b5fa6e6,0xb93425e5,0x6dfe410e,0x9f95c20d,0x8cc531f9,0x7eaeb2fa,0x30e349b1,0xc288cab2,0xd1d83946,0x23b3ba45,0xf779deae,0x5125dad,0x1642ae59,0xe4292d5a,0xba3a117e,0x4851927d,0x5b016189,0xa96ae28a,0x7da08661,0x8fcb0562,0x9c9bf696,0x6ef07595,0x417b1dbc,0xb3109ebf,0xa0406d4b,0x522bee48,0x86e18aa3,0x748a09a0,0x67dafa54,0x95b17957,0xcba24573,0x39c9c670,0x2a993584,0xd8f2b687,0xc38d26c,0xfe53516f,0xed03a29b,0x1f682198,0x5125dad3,0xa34e59d0,0xb01eaa24,0x42752927,0x96bf4dcc,0x64d4cecf,0x77843d3b,0x85efbe38,0xdbfc821c,0x2997011f,0x3ac7f2eb,0xc8ac71e8,0x1c661503,0xee0d9600,0xfd5d65f4,0xf36e6f7,0x61c69362,0x93ad1061,0x80fde395,0x72966096,0xa65c047d,0x5437877e,0x4767748a,0xb50cf789,0xeb1fcbad,0x197448ae,0xa24bb5a,0xf84f3859,0x2c855cb2,0xdeeedfb1,0xcdbe2c45,0x3fd5af46,0x7198540d,0x83f3d70e,0x90a324fa,0x62c8a7f9,0xb602c312,0x44694011,0x5739b3e5,0xa55230e6,0xfb410cc2,0x92a8fc1,0x1a7a7c35,0xe811ff36,0x3cdb9bdd,0xceb018de,0xdde0eb2a,0x2f8b6829,0x82f63b78,0x709db87b,0x63cd4b8f,0x91a6c88c,0x456cac67,0xb7072f64,0xa457dc90,0x563c5f93,0x82f63b7,0xfa44e0b4,0xe9141340,0x1b7f9043,0xcfb5f4a8,0x3dde77ab,0x2e8e845f,0xdce5075c,0x92a8fc17,0x60c37f14,0x73938ce0,0x81f80fe3,0x55326b08,0xa759e80b,0xb4091bff,0x466298fc,0x1871a4d8,0xea1a27db,0xf94ad42f,0xb21572c,0xdfeb33c7,0x2d80b0c4,0x3ed04330,0xccbbc033,0xa24bb5a6,0x502036a5,0x4370c551,0xb11b4652,0x65d122b9,0x97baa1ba,0x84ea524e,0x7681d14d,0x2892ed69,0xdaf96e6a,0xc9a99d9e,0x3bc21e9d,0xef087a76,0x1d63f975,0xe330a81,0xfc588982,0xb21572c9,0x407ef1ca,0x532e023e,0xa145813d,0x758fe5d6,0x87e466d5,0x94b49521,0x66df1622,0x38cc2a06,0xcaa7a905,0xd9f75af1,0x2b9cd9f2,0xff56bd19,0xd3d3e1a,0x1e6dcdee,0xec064eed,0xc38d26c4,0x31e6a5c7,0x22b65633,0xd0ddd530,0x417b1db,0xf67c32d8,0xe52cc12c,0x1747422f,0x49547e0b,0xbb3ffd08,0xa86f0efc,0x5a048dff,0x8ecee914,0x7ca56a17,0x6ff599e3,0x9d9e1ae0,0xd3d3e1ab,0x21b862a8,0x32e8915c,0xc083125f,0x144976b4,0xe622f5b7,0xf5720643,0x7198540,0x590ab964,0xab613a67,0xb831c993,0x4a5a4a90,0x9e902e7b,0x6cfbad78,0x7fab5e8c,0x8dc0dd8f,0xe330a81a,0x115b2b19,0x20bd8ed,0xf0605bee,0x24aa3f05,0xd6c1bc06,0xc5914ff2,0x37faccf1,0x69e9f0d5,0x9b8273d6,0x88d28022,0x7ab90321,0xae7367ca,0x5c18e4c9,0x4f48173d,0xbd23943e,0xf36e6f75,0x105ec76,0x12551f82,0xe03e9c81,0x34f4f86a,0xc69f7b69,0xd5cf889d,0x27a40b9e,0x79b737ba,0x8bdcb4b9,0x988c474d,0x6ae7c44e,0xbe2da0a5,0x4c4623a6,0x5f16d052,0xad7d5351])},78908:(a,b,c)=>{let d=c(39652),{JoinGroup:e}=c(81451);a.exports=({groupId:a,sessionTimeout:b,rebalanceTimeout:c,memberId:g,protocolType:h,groupProtocols:i})=>({apiKey:e,apiVersion:1,apiName:"JoinGroup",encode:async()=>new d().writeString(a).writeInt32(b).writeInt32(c).writeString(g).writeString(h).writeArray(i.map(f))});let f=({name:a,metadata:b=Buffer.alloc(0)})=>new d().writeString(a).writeBytes(b)},78960:(a,b,c)=>{let{KafkaJSPartialMessageError:d,KafkaJSUnsupportedMagicByteInMessageSet:e}=c(16920),f=c(77107),g=c(4176);a.exports=(a,b,c)=>{let h=Buffer.byteLength(c.slice(b).buffer);if(h<b)throw new d(`Tried to decode a partial message: remainingBytes(${h}) < messageSize(${b})`);let i=c.readInt32(),j=c.readInt8(),k=((a,b)=>{switch(b){case 0:return f(a);case 1:return g(a);default:throw new e(`Unsupported MessageSet message version, magic byte: ${b}`)}})(c,j);return Object.assign({offset:a,size:b,crc:i,magicByte:j},k)}},79155:(a,b,c)=>{let d=c(45500),{KafkaJSPartialMessageError:e}=c(16920),{lookupCodecByAttributes:f}=c(61097),g=c(38415),h=c(90483);a.exports=async a=>{let b=a.readInt64().toString(),c=a.readInt32(),d=a.slice(c);a.forward(c);let g=Buffer.byteLength(d.buffer);if(g<c)throw new e(`Tried to decode a partial record batch: remainingBytes(${g}) < recordBatchLength(${c})`);let j=d.readInt32(),k=d.readInt8();d.readInt32();let l=d.readInt16(),m=d.readInt32(),n=d.readInt64().toString(),o=d.readInt64().toString(),p=d.readInt64().toString(),q=d.readInt16(),r=d.readInt32(),s=(16&l)>0,t=(32&l)>0,u=(8&l)>0?h.LOG_APPEND_TIME:h.CREATE_TIME,v=f(l),w={firstOffset:b,firstTimestamp:n,partitionLeaderEpoch:j,inTransaction:s,isControlBatch:t,lastOffsetDelta:m,producerId:p,producerEpoch:q,firstSequence:r,maxTimestamp:o,timestampType:u},x=await i(v,d,{...w,magicByte:k});return{...w,records:x}};let i=async(a,b,c)=>{if(!a)return b.readArray(a=>j(a,c));let e=b.readInt32();if(e<=0)return[];let f=b.readAll(),g=new d(await a.decompress(f)),h=Array(e);for(let a=0;a<e;a++)h[a]=j(g,c);return h},j=(a,b)=>g(new d(a.readVarIntBytes()),b)},79315:(a,b,c)=>{let{createLogger:d,LEVELS:{INFO:e}}=c(44361),f=c(9688),g=c(11200),h=c(77470),i=c(82182),j=c(76408),k=c(3323),l=c(96268),m=c(9475),n=c(41596),o=c(78499),p={CREATE_CLUSTER:Symbol("private:Kafka:createCluster"),CLUSTER_RETRY:Symbol("private:Kafka:clusterRetry"),LOGGER:Symbol("private:Kafka:logger"),OFFSETS:Symbol("private:Kafka:offsets")},q=n(a=>{null==process.env.KAFKAJS_NO_PARTITIONER_WARNING&&a.warn(`KafkaJS v2.0.0 switched default partitioner. To retain the same partitioning behavior as in previous versions, create the producer with the option "createPartitioner: Partitioners.LegacyPartitioner". See the migration guide at ${o("docs/migration-guide-v2.0.0","producer-new-default-partitioner")} for details. Silence this warning by setting the environment variable "KAFKAJS_NO_PARTITIONER_WARNING=1"`)});a.exports=class{constructor({brokers:a,ssl:b,sasl:c,clientId:f,connectionTimeout:i=1e3,authenticationTimeout:j,reauthenticationThreshold:k,requestTimeout:l,enforceRequestTimeout:n=!0,retry:o,socketFactory:q=m(),logLevel:r=e,logCreator:s=g}){this[p.OFFSETS]=new Map,this[p.LOGGER]=d({level:r,logCreator:s}),this[p.CLUSTER_RETRY]=o,this[p.CREATE_CLUSTER]=({metadataMaxAge:d,allowAutoTopicCreation:e=!0,maxInFlightRequests:g=null,instrumentationEmitter:m=null,isolationLevel:o})=>new h({logger:this[p.LOGGER],retry:this[p.CLUSTER_RETRY],offsets:this[p.OFFSETS],socketFactory:q,brokers:a,ssl:b,sasl:c,clientId:f,connectionTimeout:i,authenticationTimeout:j,reauthenticationThreshold:k,requestTimeout:l,enforceRequestTimeout:n,metadataMaxAge:d,instrumentationEmitter:m,allowAutoTopicCreation:e,maxInFlightRequests:g,isolationLevel:o})}producer({createPartitioner:a,retry:b,metadataMaxAge:c=3e5,allowAutoTopicCreation:d,idempotent:e,transactionalId:g,transactionTimeout:h,maxInFlightRequests:j}={}){let k=new f,l=this[p.CREATE_CLUSTER]({metadataMaxAge:c,allowAutoTopicCreation:d,maxInFlightRequests:j,instrumentationEmitter:k});return null==a&&q(this[p.LOGGER]),i({retry:{...this[p.CLUSTER_RETRY],...b},logger:this[p.LOGGER],cluster:l,createPartitioner:a,idempotent:e,transactionalId:g,transactionTimeout:h,instrumentationEmitter:k})}consumer({groupId:a,partitionAssigners:b,metadataMaxAge:c=3e5,sessionTimeout:d,rebalanceTimeout:e,heartbeatInterval:g,maxBytesPerPartition:h,minBytes:i,maxBytes:k,maxWaitTimeInMs:m,retry:n={retries:5},allowAutoTopicCreation:o,maxInFlightRequests:q,readUncommitted:r=!1,rackId:s=""}={}){let t=r?l.READ_UNCOMMITTED:l.READ_COMMITTED,u=new f,v=this[p.CREATE_CLUSTER]({metadataMaxAge:c,allowAutoTopicCreation:o,maxInFlightRequests:q,isolationLevel:t,instrumentationEmitter:u});return j({retry:{...this[p.CLUSTER_RETRY],...n},logger:this[p.LOGGER],cluster:v,groupId:a,partitionAssigners:b,sessionTimeout:d,rebalanceTimeout:e,heartbeatInterval:g,maxBytesPerPartition:h,minBytes:i,maxBytes:k,maxWaitTimeInMs:m,isolationLevel:t,instrumentationEmitter:u,rackId:s,metadataMaxAge:c})}admin({retry:a}={}){let b=new f,c=this[p.CREATE_CLUSTER]({allowAutoTopicCreation:!1,instrumentationEmitter:b});return k({retry:{...this[p.CLUSTER_RETRY],...a},logger:this[p.LOGGER],instrumentationEmitter:b,cluster:c})}logger(){return this[p.LOGGER]}}},79683:(a,b,c)=>{let d=c(81451),{KafkaJSServerDoesNotSupportApiKey:e,KafkaJSNotImplemented:f}=c(16920),g={versions:[],protocol:()=>{throw new f}},h={Produce:c(53416),Fetch:c(25172),ListOffsets:c(55524),Metadata:c(22361),LeaderAndIsr:g,StopReplica:g,UpdateMetadata:g,ControlledShutdown:g,OffsetCommit:c(89334),OffsetFetch:c(9265),GroupCoordinator:c(19259),JoinGroup:c(90215),Heartbeat:c(79916),LeaveGroup:c(95749),SyncGroup:c(82238),DescribeGroups:c(36493),ListGroups:c(56756),SaslHandshake:c(9652),ApiVersions:c(98465),CreateTopics:c(43412),DeleteTopics:c(70691),DeleteRecords:c(12079),InitProducerId:c(8909),OffsetForLeaderEpoch:g,AddPartitionsToTxn:c(58641),AddOffsetsToTxn:c(32346),EndTxn:c(21569),WriteTxnMarkers:g,TxnOffsetCommit:c(19028),DescribeAcls:c(2664),CreateAcls:c(14613),DeleteAcls:c(95202),DescribeConfigs:c(25700),AlterConfigs:c(71731),AlterReplicaLogDirs:g,DescribeLogDirs:g,SaslAuthenticate:c(36218),CreatePartitions:c(21127),CreateDelegationToken:g,RenewDelegationToken:g,ExpireDelegationToken:g,DescribeDelegationToken:g,DeleteGroups:c(50183),ElectLeaders:g,IncrementalAlterConfigs:g,AlterPartitionReassignments:c(20207),ListPartitionReassignments:c(13983)},i=Object.keys(d),j=Object.values(d);a.exports={requests:h,lookup:a=>(b,c)=>{let d=a[b],f=Math.max(...c.versions.map(Number));if(!d||null==d.maxVersion)throw new e("The Kafka server does not support the requested API version",{apiKey:b,apiName:i[j.indexOf(b)]});let g=Math.min(f,d.maxVersion);return c.protocol({version:g})}}},79777:(a,b,c)=>{let{parse:d,decode:e}=c(10494);a.exports={parse:d,decode:e}},79905:(a,b,c)=>{let{parse:d}=c(51792),e=c(45500),f=a=>({principal:a.readString(),host:a.readString(),operation:a.readInt8(),permissionType:a.readInt8()}),g=a=>({resourceType:a.readInt8(),resourceName:a.readString(),resourcePatternType:a.readInt8(),acls:a.readArray(f)});a.exports={decode:async a=>{let b=new e(a),c=b.readInt32(),d=b.readInt16();return{throttleTime:0,clientSideThrottleTime:c,errorCode:d,errorMessage:b.readString(),resources:b.readArray(g)}},parse:d}},79916:(a,b,c)=>{let d={0:({groupId:a,groupGenerationId:b,memberId:d})=>{let e=c(85582),f=c(99484);return{request:e({groupId:a,groupGenerationId:b,memberId:d}),response:f}},1:({groupId:a,groupGenerationId:b,memberId:d})=>{let e=c(11153),f=c(16237);return{request:e({groupId:a,groupGenerationId:b,memberId:d}),response:f}},2:({groupId:a,groupGenerationId:b,memberId:d})=>{let e=c(19672),f=c(17990);return{request:e({groupId:a,groupGenerationId:b,memberId:d}),response:f}},3:({groupId:a,groupGenerationId:b,memberId:d,groupInstanceId:e})=>{let f=c(92347),g=c(70447);return{request:f({groupId:a,groupGenerationId:b,memberId:d,groupInstanceId:e}),response:g}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},80215:(a,b,c)=>{let d=c(83861),e=c(4702),f=c(17976),g=c(65467),{KafkaJSBrokerNotFound:h,KafkaJSProtocolError:i}=c(16920),{keys:j,assign:k,values:l}=Object;a.exports=class{constructor({connectionPoolBuilder:a,logger:b,retry:c,allowAutoTopicCreation:f,authenticationTimeout:g,metadataMaxAge:h}){this.rootLogger=b,this.connectionPoolBuilder=a,this.metadataMaxAge=h||0,this.logger=b.namespace("BrokerPool"),this.retrier=e(k({},c)),this.createBroker=a=>new d({allowAutoTopicCreation:f,authenticationTimeout:g,...a}),this.brokers={},this.seedBroker=void 0,this.metadata=null,this.metadataExpireAt=null,this.versions=null}hasConnectedBrokers(){return!!l(this.brokers).find(a=>a.isConnected())||!!this.seedBroker&&this.seedBroker.isConnected()}async createSeedBroker(){this.seedBroker&&await this.seedBroker.disconnect();let a=await this.connectionPoolBuilder.build();this.seedBroker=this.createBroker({connectionPool:a,logger:this.rootLogger})}async connect(){if(!this.hasConnectedBrokers())return this.seedBroker||await this.createSeedBroker(),this.retrier(async(a,b,c)=>{try{await this.seedBroker.connect(),this.versions=this.seedBroker.versions}catch(d){if("KafkaJSConnectionError"===d.name||"ILLEGAL_SASL_STATE"===d.type?(await this.createSeedBroker(),this.logger.error(`Failed to connect to seed broker, trying another broker from the list: ${d.message}`,{retryCount:b,retryTime:c})):this.logger.error(d.message,{retryCount:b,retryTime:c}),d.retriable)throw d;a(d)}})}async disconnect(){this.seedBroker&&await this.seedBroker.disconnect(),await Promise.all(l(this.brokers).map(a=>a.disconnect())),this.brokers={},this.metadata=null,this.versions=null}removeBroker({host:a,port:b}){let c=l(this.brokers).find(c=>c.connectionPool.host===a&&c.connectionPool.port===b);c&&(delete this.brokers[c.nodeId],this.metadataExpireAt=null,this.seedBroker.nodeId===c.nodeId&&(this.seedBroker=f(l(this.brokers))[0]))}async refreshMetadata(a){let b=await this.findConnectedBroker(),{host:c,port:d}=this.seedBroker.connectionPool;return this.retrier(async(e,f,h)=>{try{this.metadata=await b.metadata(a),this.metadataExpireAt=Date.now()+this.metadataMaxAge;let e=[];this.brokers=await this.metadata.brokers.reduce(async(a,{nodeId:b,host:f,port:g,rack:h})=>{let i=await a;if(i[b]){if(!((a,{host:b,port:c,rack:d})=>a.connectionPool.host!==b||a.connectionPool.port!==c||a.connectionPool.rack!==d)(i[b],{host:f,port:g,rack:h}))return i;e.push(i[b])}return f===c&&g===d?(this.seedBroker.nodeId=b,this.seedBroker.connectionPool.rack=h,k(i,{[b]:this.seedBroker})):k(i,{[b]:this.createBroker({logger:this.rootLogger,versions:this.versions,connectionPool:await this.connectionPoolBuilder.build({host:f,port:g,rack:h}),nodeId:b})})},this.brokers);let f=this.metadata.brokers.map(({nodeId:a})=>`${a}`).sort(),h=j(this.brokers).sort(),i=g(h,f).map(a=>this.brokers[a].disconnect().then(()=>{delete this.brokers[a]})),l=e.map(a=>a.disconnect());await Promise.all([...i,...l])}catch(a){if("LEADER_NOT_AVAILABLE"===a.type)throw a;e(a)}})}async refreshMetadataIfNecessary(a){if(null==this.metadata||null==this.metadataExpireAt||Date.now()>this.metadataExpireAt||!a.every(a=>this.metadata.topicMetadata.some(b=>b.topic===a)))return this.refreshMetadata(a)}getNodeIds(){return j(this.brokers)}async findBroker({nodeId:a}){let b=this.brokers[a];if(!b)throw new h(`Broker ${a} not found in the cached metadata`);return await this.connectBroker(b),b}async withBroker(a){let b=f(j(this.brokers));if(0===b.length)throw new h("No brokers in the broker pool");for(let c of b){let b=await this.findBroker({nodeId:c});try{return await a({nodeId:c,broker:b})}catch(a){}}return null}async findConnectedBroker(){let a=f(j(this.brokers)),b=a.find(a=>this.brokers[a].isConnected());if(b)return await this.findBroker({nodeId:b});for(let b of a)try{return await this.findBroker({nodeId:b})}catch(a){}return await this.connect(),this.seedBroker}async connectBroker(a){if(!a.isConnected())return this.retrier(async(b,c,d)=>{try{await a.connect()}catch(e){if(("KafkaJSConnectionError"===e.name||"ILLEGAL_SASL_STATE"===e.type)&&await a.disconnect(),"KafkaJSConnectionError"===e.name)return b(e);if("ILLEGAL_SASL_STATE"===e.type)throw a.connectionPool=await this.connectionPoolBuilder.build({host:a.connectionPool.host,port:a.connectionPool.port,rack:a.connectionPool.rack}),this.logger.error("Failed to connect to broker, reconnecting",{retryCount:c,retryTime:d}),new i(e,{retriable:!0});if(e.retriable)throw e;this.logger.error(e,{retryCount:c,retryTime:d,stack:e.stack}),b(e)}})}}},80453:(a,b,c)=>{let d=c(45500),{parse:e}=c(32126),f=a=>({topic:a.readString(),partitions:a.readArray(g)}),g=a=>({partition:a.readInt32(),errorCode:a.readInt16()});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),responses:b.readArray(f)}},parse:e}},80465:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f,failIfVersionNotSupported:g}=c(88374);a.exports={decode:async a=>{let b=new d(a),c=b.readInt32(),e=b.readInt16();return g(e),{throttleTime:c,errorCode:e,producerId:b.readInt64().toString(),producerEpoch:b.readInt16()}},parse:async a=>{if(e(a.errorCode))throw f(a.errorCode);return a}}},81442:a=>{a.exports=a=>{let b=null;return(...c)=>(null==b&&(b=a(...c).finally(()=>b=null)),b)}},81451:a=>{a.exports={Produce:0,Fetch:1,ListOffsets:2,Metadata:3,LeaderAndIsr:4,StopReplica:5,UpdateMetadata:6,ControlledShutdown:7,OffsetCommit:8,OffsetFetch:9,GroupCoordinator:10,JoinGroup:11,Heartbeat:12,LeaveGroup:13,SyncGroup:14,DescribeGroups:15,ListGroups:16,SaslHandshake:17,ApiVersions:18,CreateTopics:19,DeleteTopics:20,DeleteRecords:21,InitProducerId:22,OffsetForLeaderEpoch:23,AddPartitionsToTxn:24,AddOffsetsToTxn:25,EndTxn:26,WriteTxnMarkers:27,TxnOffsetCommit:28,DescribeAcls:29,CreateAcls:30,DeleteAcls:31,DescribeConfigs:32,AlterConfigs:33,AlterReplicaLogDirs:34,DescribeLogDirs:35,SaslAuthenticate:36,CreatePartitions:37,CreateDelegationToken:38,RenewDelegationToken:39,ExpireDelegationToken:40,DescribeDelegationToken:41,DeleteGroups:42,ElectPreferredLeaders:43,IncrementalAlterConfigs:44,AlterPartitionReassignments:45,ListPartitionReassignments:46}},81595:(a,b,c)=>{let d=c(401);a.exports=()=>({...d(),apiVersion:2})},81635:(a,b,c)=>{let d=c(39652),{OffsetCommit:e}=c(81451);a.exports=({groupId:a,groupGenerationId:b,memberId:c,topics:g})=>({apiKey:e,apiVersion:1,apiName:"OffsetCommit",encode:async()=>new d().writeString(a).writeInt32(b).writeString(c).writeArray(g.map(f))});let f=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(g)),g=({partition:a,offset:b,timestamp:c=Date.now(),metadata:e=null})=>new d().writeInt32(a).writeInt64(b).writeInt64(c).writeString(e)},81878:a=>{a.exports={maxRetryTime:1e3,initialRetryTime:50,factor:.02,multiplier:1.5,retries:15}},82182:(a,b,c)=>{let d=c(4702),{CONNECTION_STATUS:e}=c(8462),{DefaultPartitioner:f}=c(38773),g=c(9688),h=c(83251),i=c(12855),{events:j,wrap:k,unwrap:l}=c(50589),{KafkaJSNonRetriableError:m}=c(16920),{values:n,keys:o}=Object,p=n(j),q=o(j).map(a=>`producer.events.${a}`).join(", "),{CONNECT:r,DISCONNECT:s}=j;a.exports=({cluster:a,logger:b,createPartitioner:c=f,retry:n,idempotent:o=!1,transactionalId:t,transactionTimeout:u,instrumentationEmitter:v})=>{let w,x=e.DISCONNECTED;if(n=n||{retries:o?Number.MAX_SAFE_INTEGER:5},o&&n.retries<1)throw new m("Idempotent producer must allow retries to protect against transient errors");let y=b.namespace("Producer");o&&n.retries<Number.MAX_SAFE_INTEGER&&y.warn("Limiting retries for the idempotent producer may invalidate EoS guarantees");let z=c(),A=d(Object.assign({},a.retry,n)),B=v||new g,C=h({logger:y,cluster:a,transactionTimeout:u,transactional:!1,transactionalId:t}),{send:D,sendBatch:E}=i({logger:y,cluster:a,partitioner:z,eosManager:C,idempotent:o,retrier:A,getConnectionStatus:()=>x});return{connect:async()=>{await a.connect(),x=e.CONNECTED,B.emit(r),o&&!C.isInitialized()&&await C.initProducerId()},disconnect:async()=>{x=e.DISCONNECTING,await a.disconnect(),x=e.DISCONNECTED,B.emit(s)},isIdempotent:()=>o,events:j,on:(a,b)=>{if(!p.includes(a))throw new m(`Event name should be one of ${q}`);return B.addListener(l(a),c=>{c.type=k(c.type),Promise.resolve(b(c)).catch(b=>{y.error(`Failed to execute listener: ${b.message}`,{eventName:a,stack:b.stack})})})},send:D,sendBatch:E,transaction:async()=>{if(!t)throw new m("Must provide transactional id for transactional producer");let b=!1;if((w=w||h({logger:y,cluster:a,transactionTimeout:u,transactional:!0,transactionalId:t})).isInTransaction())throw new m("There is already an ongoing transaction for this producer. Please end the transaction before beginning another.");w.isInitialized()||await w.initProducerId(),w.beginTransaction();let{send:c,sendBatch:d}=i({logger:y,cluster:a,partitioner:z,retrier:A,eosManager:w,idempotent:!0,getConnectionStatus:()=>x}),e=()=>w.isInTransaction()&&!b,f=a=>(...b)=>e()?a(...b):Promise.reject(new m("Cannot continue to use transaction once ended"));return{sendBatch:f(d),send:f(c),abort:f(async()=>{await w.abort(),b=!0}),commit:f(async()=>{await w.commit(),b=!0}),sendOffsets:f(async({consumerGroupId:b,topics:c})=>{for(let d of(await w.sendOffsets({consumerGroupId:b,topics:c}),c)){let{topic:c,partitions:e}=d;for(let{partition:d,offset:f}of e)a.markOffsetAsCommitted({groupId:b,topic:c,partition:d,offset:f})}}),isActive:e}},logger:()=>y}}},82238:(a,b,c)=>{let d={0:({groupId:a,generationId:b,memberId:d,groupAssignment:e})=>{let f=c(76600),g=c(36070);return{request:f({groupId:a,generationId:b,memberId:d,groupAssignment:e}),response:g}},1:({groupId:a,generationId:b,memberId:d,groupAssignment:e})=>{let f=c(49275),g=c(88527);return{request:f({groupId:a,generationId:b,memberId:d,groupAssignment:e}),response:g}},2:({groupId:a,generationId:b,memberId:d,groupAssignment:e})=>{let f=c(42510),g=c(17564);return{request:f({groupId:a,generationId:b,memberId:d,groupAssignment:e}),response:g}},3:({groupId:a,generationId:b,memberId:d,groupInstanceId:e,groupAssignment:f})=>{let g=c(68081),h=c(34317);return{request:g({groupId:a,generationId:b,memberId:d,groupInstanceId:e,groupAssignment:f}),response:h}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},82448:(a,b,c)=>{let d=c(2505);a.exports=()=>Object.assign(d(),{apiVersion:2})},82572:(a,b,c)=>{let{parse:d,decode:e}=c(22077);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},82865:(a,b,c)=>{let d=c(45500),{parse:e}=c(57333),f=c(44285),g=a=>({producerId:a.readInt64().toString(),firstOffset:a.readInt64().toString()}),h=async a=>({partition:a.readInt32(),errorCode:a.readInt16(),highWatermark:a.readInt64().toString(),lastStableOffset:a.readInt64().toString(),lastStartOffset:a.readInt64().toString(),abortedTransactions:a.readArray(g),messages:await f(a)}),i=async a=>({topicName:a.readString(),partitions:await a.readArrayAsync(h)});a.exports={decode:async a=>{let b=new d(a);return{throttleTime:b.readInt32(),responses:await b.readArrayAsync(i)}},parse:e}},82996:(a,b,c)=>{let d=c(39652),e=c(55631),{Types:f,COMPRESSION_CODEC_MASK:g}=c(61097);a.exports=({compression:a=f.None,timestamp:b=Date.now(),key:c,value:h})=>{let i=new d().writeInt8(1).writeInt8(a&g).writeInt64(b).writeBytes(c).writeBytes(h),j=e(i);return new d().writeInt32(j).writeEncoder(i)}},83175:(a,b,c)=>{let d=c(36554);a.exports=({groupIds:a})=>Object.assign(d({groupIds:a}),{apiVersion:2})},83198:(a,b,c)=>{let d=c(40577);a.exports=({transactionalId:a,producerId:b,producerEpoch:c,topics:e})=>Object.assign(d({transactionalId:a,producerId:b,producerEpoch:c,topics:e}),{apiVersion:1})},83251:(a,b,c)=>{let d=c(4702),e=c(25506),{KafkaJSNonRetriableError:f}=c(16920),g=c(1857),h=c(91309),{INT_32_MAX_VALUE:i}=c(57142),j=c(12412),k=c(40897),l=["NOT_COORDINATOR_FOR_GROUP","GROUP_COORDINATOR_NOT_AVAILABLE","GROUP_LOAD_IN_PROGRESS","CONCURRENT_TRANSACTIONS"],m=["UNKNOWN_TOPIC_OR_PARTITION","COORDINATOR_LOAD_IN_PROGRESS"],n=["COORDINATOR_NOT_AVAILABLE","NOT_COORDINATOR"];a.exports=({logger:a,cluster:b,transactionTimeout:c=6e4,transactional:o,transactionalId:p})=>{if(o&&!p)throw new f("Cannot manage transactions without a transactionalId");let q=d(b.retry),r=-1,s=0,t={},u={},v={},w=!1,x=h({logger:a});x.on("transition",({to:a})=>{a===k.READY&&(v={},w=!1)});let y=()=>b.findGroupCoordinator({groupId:p,coordinatorType:g.TRANSACTION}),z=()=>{if(!o)throw new f("Method unavailable if non-transactional")},A=()=>w||Object.entries(v).some(([,a])=>Object.entries(a).some(([,a])=>a)),B=x.createGuarded({getProducerId:()=>r,getProducerEpoch:()=>s,getTransactionalId:()=>p,initProducerId:async()=>q(async(d,e,f)=>{try{await b.refreshMetadataIfNecessary();let d=await (o?y():b.findControllerBroker()),e=await d.initProducerId({transactionalId:o?p:void 0,transactionTimeout:c});x.transitionTo(k.READY),r=e.producerId,s=e.producerEpoch,t={},u={},a.debug("Initialized producer id & epoch",{producerId:r,producerEpoch:s})}catch(b){if(l.includes(b.type))throw"CONCURRENT_TRANSACTIONS"===b.type&&a.debug("There is an ongoing transaction on this transactionId, retrying",{error:b.message,stack:b.stack,transactionalId:p,retryCount:e,retryTime:f}),b;d(b)}}),getSequence:(a,b)=>B.isInitialized()?(t[a]=t[a]||{},t[a][b]=t[a][b]||0,t[a][b]):0,updateSequence(b,c,d){if(!B.isInitialized())return;let e=B.getSequence(b,c)+d;e>=i&&(a.debug(`Sequence for ${b} ${c} exceeds max value (${e}). Rotating to 0.`),e=0),t[b][c]=e},beginTransaction(){z(),x.transitionTo(k.TRANSACTING)},async addPartitionsToTransaction(a){z();let b={};a.forEach(({topic:a,partitions:c})=>{v[a]=v[a]||{},c.forEach(({partition:c})=>{v[a][c]||(b[a]=b[a]||[],b[a].push(c))})});let c=Object.keys(b).map(a=>({topic:a,partitions:b[a]}));if(c.length){let a=await y();await a.addPartitionsToTxn({transactionalId:p,producerId:r,producerEpoch:s,topics:c})}c.forEach(({topic:a,partitions:b})=>{b.forEach(b=>{v[a][b]=!0})})},async commit(){if(z(),x.transitionTo(k.COMMITTING),!A()){a.debug("No partitions or offsets registered, not sending EndTxn"),x.transitionTo(k.READY);return}let b=await y();await b.endTxn({producerId:r,producerEpoch:s,transactionalId:p,transactionResult:!0}),x.transitionTo(k.READY)},async abort(){if(z(),x.transitionTo(k.ABORTING),!A()){a.debug("No partitions or offsets registered, not sending EndTxn"),x.transitionTo(k.READY);return}let b=await y();await b.endTxn({producerId:r,producerEpoch:s,transactionalId:p,transactionResult:!1}),x.transitionTo(k.READY)},isInitialized:()=>-1!==r,isTransactional:()=>o,isInTransaction:()=>x.state()===k.TRANSACTING,async acquireBrokerLock(a){this.isInitialized()&&(u[a.nodeId]=u[a.nodeId]||new e({timeout:65535}),await u[a.nodeId].acquire())},releaseBrokerLock(a){this.isInitialized()&&u[a.nodeId].release()},async sendOffsets({consumerGroupId:c,topics:d}){j(c,"Missing consumerGroupId"),j(d,"Missing offset topics");let e=await y();await e.addOffsetsToTxn({transactionalId:p,producerId:r,producerEpoch:s,groupId:c}),w=!0;let f=await b.findGroupCoordinator({groupId:c,coordinatorType:g.GROUP});return q(async(e,h,i)=>{try{await f.txnOffsetCommit({transactionalId:p,producerId:r,producerEpoch:s,groupId:c,topics:d})}catch(d){if(m.includes(d.type))throw a.debug("Group coordinator is not ready yet, retrying",{error:d.message,stack:d.stack,transactionalId:p,retryCount:h,retryTime:i}),d;if(n.includes(d.type)||"ECONNREFUSED"===d.code)throw a.debug("Invalid group coordinator, finding new group coordinator and retrying",{error:d.message,stack:d.stack,transactionalId:p,retryCount:h,retryTime:i}),f=await b.findGroupCoordinator({groupId:c,coordinatorType:g.GROUP}),d;e(d)}})}},{initProducerId:{legalStates:[k.UNINITIALIZED,k.READY]},beginTransaction:{legalStates:[k.READY],async:!1},addPartitionsToTransaction:{legalStates:[k.TRANSACTING]},sendOffsets:{legalStates:[k.TRANSACTING]},commit:{legalStates:[k.TRANSACTING]},abort:{legalStates:[k.TRANSACTING]}});return B}},83301:(a,b,c)=>{let d=c(78908);a.exports=({groupId:a,sessionTimeout:b,rebalanceTimeout:c,memberId:e,protocolType:f,groupProtocols:g})=>Object.assign(d({groupId:a,sessionTimeout:b,rebalanceTimeout:c,memberId:e,protocolType:f,groupProtocols:g}),{apiVersion:2})},83529:(a,b,c)=>{let d=c(39652),{CreateTopics:e}=c(81451);a.exports=({topics:a,validateOnly:b=!1,timeout:c=5e3})=>({apiKey:e,apiVersion:1,apiName:"CreateTopics",encode:async()=>new d().writeArray(a.map(f)).writeInt32(c).writeBoolean(b)});let f=({topic:a,numPartitions:b=-1,replicationFactor:c=-1,replicaAssignment:e=[],configEntries:f=[]})=>new d().writeString(a).writeInt32(b).writeInt16(c).writeArray(e.map(g)).writeArray(f.map(h)),g=({partition:a,replicas:b})=>new d().writeInt32(a).writeArray(b),h=({name:a,value:b})=>new d().writeString(a).writeString(b)},83611:(a,b,c)=>{let d=c(39652),{DeleteTopics:e}=c(81451);a.exports=({topics:a,timeout:b=5e3})=>({apiKey:e,apiVersion:0,apiName:"DeleteTopics",encode:async()=>new d().writeArray(a).writeInt32(b)})},83669:(a,b,c)=>{let{decode:d,parse:e}=c(93581);a.exports={decode:d,parse:e}},83857:(a,b,c)=>{let d=c(39652),{Fetch:e}=c(81451),f=c(96268);a.exports=({replicaId:a,maxWaitTime:b,minBytes:c,maxBytes:i,topics:j,isolationLevel:k=f.READ_COMMITTED,sessionId:l=0,sessionEpoch:m=-1,forgottenTopics:n=[]})=>({apiKey:e,apiVersion:9,apiName:"Fetch",encode:async()=>new d().writeInt32(a).writeInt32(b).writeInt32(c).writeInt32(i).writeInt8(k).writeInt32(l).writeInt32(m).writeArray(j.map(h)).writeArray(n.map(g))});let g=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b),h=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(i)),i=({partition:a,currentLeaderEpoch:b=-1,fetchOffset:c,logStartOffset:e=-1,maxBytes:f})=>new d().writeInt32(a).writeInt32(b).writeInt64(c).writeInt64(e).writeInt32(f)},83861:(a,b,c)=>{let d=c(25506),{Types:e}=c(61097),{requests:f,lookup:g}=c(79683),{KafkaJSNonRetriableError:h}=c(16920),i=c(81451),j=c(17976),k={SEND_REQUEST:Symbol("private:Broker:sendRequest")},l=()=>{throw Error("Broker not connected")};a.exports=class{constructor({connectionPool:a,logger:b,nodeId:c=null,versions:e=null,authenticationTimeout:f=1e4,allowAutoTopicCreation:g=!0}){this.connectionPool=a,this.nodeId=c,this.rootLogger=b,this.logger=b.namespace("Broker"),this.versions=e,this.authenticationTimeout=f,this.allowAutoTopicCreation=g;let h=2*this.connectionPool.connectionTimeout+this.authenticationTimeout;this.brokerAddress=`${this.connectionPool.host}:${this.connectionPool.port}`,this.lock=new d({timeout:h,description:`connect to broker ${this.brokerAddress}`}),this.lookupRequest=l}isConnected(){return this.connectionPool.sasl?this.connectionPool.isConnected()&&this.connectionPool.isAuthenticated():this.connectionPool.isConnected()}async connect(){await this.lock.acquire();try{if(this.isConnected())return;let a=await this.connectionPool.getConnection();if(this.versions||(this.versions=await this.apiVersions()),this.connectionPool.setVersions(this.versions),this.lookupRequest=g(this.versions),null===a.getSupportAuthenticationProtocol()){let a=!1;try{this.lookupRequest(i.SaslAuthenticate,f.SaslAuthenticate),a=!0}catch(b){a=!1}this.connectionPool.setSupportAuthenticationProtocol(a),this.logger.debug("Verified support for SaslAuthenticate",{broker:this.brokerAddress,supportAuthenticationProtocol:a})}await a.authenticate()}finally{await this.lock.release()}}async disconnect(){await this.connectionPool.destroy()}async apiVersions(){let a;for(let b of f.ApiVersions.versions.map(Number).sort().reverse())try{let c=f.ApiVersions.protocol({version:b});a=await this[k.SEND_REQUEST]({...c(),requestTimeout:this.connectionPool.connectionTimeout});break}catch(a){if("UNSUPPORTED_VERSION"!==a.type)throw a}if(!a)throw new h("API Versions not supported");return a.apiVersions.reduce((a,b)=>Object.assign(a,{[b.apiKey]:{minVersion:b.minVersion,maxVersion:b.maxVersion}}),{})}async metadata(a=[]){let b=this.lookupRequest(i.Metadata,f.Metadata),c=j(a);return await this[k.SEND_REQUEST](b({topics:c,allowAutoTopicCreation:this.allowAutoTopicCreation}))}async produce({topicData:a,transactionalId:b,producerId:c,producerEpoch:d,acks:g=-1,timeout:h=3e4,compression:j=e.None}){let l=this.lookupRequest(i.Produce,f.Produce);return await this[k.SEND_REQUEST](l({acks:g,timeout:h,compression:j,topicData:a,transactionalId:b,producerId:c,producerEpoch:d}))}async fetch({replicaId:a,isolationLevel:b,maxWaitTime:c=5e3,minBytes:d=1,maxBytes:e=0xa00000,topics:g,rackId:h=""}){let l=this.lookupRequest(i.Fetch,f.Fetch),m=j(g.reduce((a,{topic:b,partitions:c})=>(c.forEach(c=>{a.push({topic:b,partition:c})}),a),[])).reduce((a,{topic:b,partition:c})=>{let d=a[a.length-1];return null!=d&&d.topic===b?a[a.length-1].partitions.push(c):a.push({topic:b,partitions:[c]}),a},[]);return await this[k.SEND_REQUEST](l({replicaId:a,isolationLevel:b,maxWaitTime:c,minBytes:d,maxBytes:e,topics:m,rackId:h}))}async heartbeat({groupId:a,groupGenerationId:b,memberId:c}){let d=this.lookupRequest(i.Heartbeat,f.Heartbeat);return await this[k.SEND_REQUEST](d({groupId:a,groupGenerationId:b,memberId:c}))}async findGroupCoordinator({groupId:a,coordinatorType:b}){let c=this.lookupRequest(i.GroupCoordinator,f.GroupCoordinator);return await this[k.SEND_REQUEST](c({groupId:a,coordinatorType:b}))}async joinGroup({groupId:a,sessionTimeout:b,rebalanceTimeout:c,memberId:d="",protocolType:e="consumer",groupProtocols:g}){let h=this.lookupRequest(i.JoinGroup,f.JoinGroup),j=(f=d)=>this[k.SEND_REQUEST](h({groupId:a,sessionTimeout:b,rebalanceTimeout:c,memberId:f,protocolType:e,groupProtocols:g}));try{return await j()}catch(a){if("KafkaJSMemberIdRequired"===a.name)return j(a.memberId);throw a}}async leaveGroup({groupId:a,memberId:b}){let c=this.lookupRequest(i.LeaveGroup,f.LeaveGroup);return await this[k.SEND_REQUEST](c({groupId:a,memberId:b}))}async syncGroup({groupId:a,generationId:b,memberId:c,groupAssignment:d}){let e=this.lookupRequest(i.SyncGroup,f.SyncGroup);return await this[k.SEND_REQUEST](e({groupId:a,generationId:b,memberId:c,groupAssignment:d}))}async listOffsets({replicaId:a,isolationLevel:b,topics:c}){let d=this.lookupRequest(i.ListOffsets,f.ListOffsets),e=await this[k.SEND_REQUEST](d({replicaId:a,isolationLevel:b,topics:c}));for(let a of e.responses)a.partitions=a.partitions.map(({offsets:a,...b})=>a?{...b,offset:a.pop()}:b);return e}async offsetCommit({groupId:a,groupGenerationId:b,memberId:c,retentionTime:d,topics:e}){let g=this.lookupRequest(i.OffsetCommit,f.OffsetCommit);return await this[k.SEND_REQUEST](g({groupId:a,groupGenerationId:b,memberId:c,retentionTime:d,topics:e}))}async offsetFetch({groupId:a,topics:b}){let c=this.lookupRequest(i.OffsetFetch,f.OffsetFetch);return await this[k.SEND_REQUEST](c({groupId:a,topics:b}))}async describeGroups({groupIds:a}){let b=this.lookupRequest(i.DescribeGroups,f.DescribeGroups);return await this[k.SEND_REQUEST](b({groupIds:a}))}async createTopics({topics:a,validateOnly:b=!1,timeout:c=5e3}){let d=this.lookupRequest(i.CreateTopics,f.CreateTopics);return await this[k.SEND_REQUEST](d({topics:a,validateOnly:b,timeout:c}))}async createPartitions({topicPartitions:a,validateOnly:b=!1,timeout:c=5e3}){let d=this.lookupRequest(i.CreatePartitions,f.CreatePartitions);return await this[k.SEND_REQUEST](d({topicPartitions:a,validateOnly:b,timeout:c}))}async deleteTopics({topics:a,timeout:b=5e3}){let c=this.lookupRequest(i.DeleteTopics,f.DeleteTopics);return await this[k.SEND_REQUEST](c({topics:a,timeout:b}))}async describeConfigs({resources:a,includeSynonyms:b=!1}){let c=this.lookupRequest(i.DescribeConfigs,f.DescribeConfigs);return await this[k.SEND_REQUEST](c({resources:a,includeSynonyms:b}))}async alterConfigs({resources:a,validateOnly:b=!1}){let c=this.lookupRequest(i.AlterConfigs,f.AlterConfigs);return await this[k.SEND_REQUEST](c({resources:a,validateOnly:b}))}async initProducerId({transactionalId:a,transactionTimeout:b}){let c=this.lookupRequest(i.InitProducerId,f.InitProducerId);return await this[k.SEND_REQUEST](c({transactionalId:a,transactionTimeout:b}))}async addPartitionsToTxn({transactionalId:a,producerId:b,producerEpoch:c,topics:d}){let e=this.lookupRequest(i.AddPartitionsToTxn,f.AddPartitionsToTxn);return await this[k.SEND_REQUEST](e({transactionalId:a,producerId:b,producerEpoch:c,topics:d}))}async addOffsetsToTxn({transactionalId:a,producerId:b,producerEpoch:c,groupId:d}){let e=this.lookupRequest(i.AddOffsetsToTxn,f.AddOffsetsToTxn);return await this[k.SEND_REQUEST](e({transactionalId:a,producerId:b,producerEpoch:c,groupId:d}))}async txnOffsetCommit({transactionalId:a,groupId:b,producerId:c,producerEpoch:d,topics:e}){let g=this.lookupRequest(i.TxnOffsetCommit,f.TxnOffsetCommit);return await this[k.SEND_REQUEST](g({transactionalId:a,groupId:b,producerId:c,producerEpoch:d,topics:e}))}async endTxn({transactionalId:a,producerId:b,producerEpoch:c,transactionResult:d}){let e=this.lookupRequest(i.EndTxn,f.EndTxn);return await this[k.SEND_REQUEST](e({transactionalId:a,producerId:b,producerEpoch:c,transactionResult:d}))}async listGroups(){let a=this.lookupRequest(i.ListGroups,f.ListGroups);return await this[k.SEND_REQUEST](a())}async deleteGroups(a){let b=this.lookupRequest(i.DeleteGroups,f.DeleteGroups);return await this[k.SEND_REQUEST](b(a))}async deleteRecords({topics:a}){let b=this.lookupRequest(i.DeleteRecords,f.DeleteRecords);return await this[k.SEND_REQUEST](b({topics:a}))}async createAcls({acl:a}){let b=this.lookupRequest(i.CreateAcls,f.CreateAcls);return await this[k.SEND_REQUEST](b({creations:a}))}async describeAcls({resourceType:a,resourceName:b,resourcePatternType:c,principal:d,host:e,operation:g,permissionType:h}){let j=this.lookupRequest(i.DescribeAcls,f.DescribeAcls);return await this[k.SEND_REQUEST](j({resourceType:a,resourceName:b,resourcePatternType:c,principal:d,host:e,operation:g,permissionType:h}))}async deleteAcls({filters:a}){let b=this.lookupRequest(i.DeleteAcls,f.DeleteAcls);return await this[k.SEND_REQUEST](b({filters:a}))}async alterPartitionReassignments({topics:a,timeout:b}){let c=this.lookupRequest(i.AlterPartitionReassignments,f.AlterPartitionReassignments);return await this[k.SEND_REQUEST](c({topics:a,timeout:b}))}async listPartitionReassignments({topics:a=null,timeout:b}){let c=this.lookupRequest(i.ListPartitionReassignments,f.ListPartitionReassignments);return await this[k.SEND_REQUEST](c({topics:a,timeout:b}))}async [k.SEND_REQUEST](a){try{return await this.connectionPool.send(a)}catch(a){throw"KafkaJSConnectionClosedError"===a.name&&await this.disconnect(),a}}}},85582:(a,b,c)=>{let d=c(39652),{Heartbeat:e}=c(81451);a.exports=({groupId:a,groupGenerationId:b,memberId:c})=>({apiKey:e,apiVersion:0,apiName:"Heartbeat",encode:async()=>new d().writeString(a).writeInt32(b).writeString(c)})},86004:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>({topic:a.readString(),partitions:a.readArray(h)}),h=a=>({partition:a.readInt32(),errorCode:a.readInt16(),offsets:a.readArray(i)}),i=a=>a.readInt64().toString();a.exports={decode:async a=>({responses:new d(a).readArray(g)}),parse:async a=>{let b=a.responses.flatMap(a=>a.partitions.filter(a=>e(a.errorCode)))[0];if(b)throw f(b.errorCode);return a}}},86101:(a,b,c)=>{let{parse:d,decode:e}=c(41796);a.exports={decode:async a=>{let b=await e(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:d}},86243:(a,b,c)=>{let d=c(39652),{GroupCoordinator:e}=c(81451);a.exports=({groupId:a})=>({apiKey:e,apiVersion:0,apiName:"GroupCoordinator",encode:async()=>new d().writeString(a)})},86818:(a,b,c)=>{let d=c(39652),{CreateAcls:e}=c(81451),f=({resourceType:a,resourceName:b,resourcePatternType:c,principal:e,host:f,operation:g,permissionType:h})=>new d().writeInt8(a).writeString(b).writeInt8(c).writeString(e).writeString(f).writeInt8(g).writeInt8(h);a.exports=({creations:a})=>({apiKey:e,apiVersion:1,apiName:"CreateAcls",encode:async()=>new d().writeArray(a.map(f))})},86852:(a,b,c)=>{a.exports=c(47374)},86854:a=>{a.exports={UNKNOWN:0,ANY:1,ALL:2,READ:3,WRITE:4,CREATE:5,DELETE:6,ALTER:7,DESCRIBE:8,CLUSTER_ACTION:9,DESCRIBE_CONFIGS:10,ALTER_CONFIGS:11,IDEMPOTENT_WRITE:12}},87600:(a,b,c)=>{let d=c(15558);a.exports=({replicaId:a,maxWaitTime:b,minBytes:c,topics:e})=>Object.assign(d({replicaId:a,maxWaitTime:b,minBytes:c,topics:e}),{apiVersion:2})},87970:(a,b,c)=>{let{parse:d,decode:e}=c(36603);a.exports={decode:e,parse:d}},88374:(a,b,c)=>{let{KafkaJSProtocolError:d}=c(16920),e=c(78499),f=[{type:"UNKNOWN",code:-1,retriable:!1,message:"The server experienced an unexpected error when processing the request"},{type:"OFFSET_OUT_OF_RANGE",code:1,retriable:!1,message:"The requested offset is not within the range of offsets maintained by the server"},{type:"CORRUPT_MESSAGE",code:2,retriable:!0,message:"This message has failed its CRC checksum, exceeds the valid size, or is otherwise corrupt"},{type:"UNKNOWN_TOPIC_OR_PARTITION",code:3,retriable:!0,message:"This server does not host this topic-partition"},{type:"INVALID_FETCH_SIZE",code:4,retriable:!1,message:"The requested fetch size is invalid"},{type:"LEADER_NOT_AVAILABLE",code:5,retriable:!0,message:"There is no leader for this topic-partition as we are in the middle of a leadership election"},{type:"NOT_LEADER_FOR_PARTITION",code:6,retriable:!0,message:"This server is not the leader for that topic-partition"},{type:"REQUEST_TIMED_OUT",code:7,retriable:!0,message:"The request timed out"},{type:"BROKER_NOT_AVAILABLE",code:8,retriable:!1,message:"The broker is not available"},{type:"REPLICA_NOT_AVAILABLE",code:9,retriable:!0,message:"The replica is not available for the requested topic-partition"},{type:"MESSAGE_TOO_LARGE",code:10,retriable:!1,message:"The request included a message larger than the max message size the server will accept"},{type:"STALE_CONTROLLER_EPOCH",code:11,retriable:!1,message:"The controller moved to another broker"},{type:"OFFSET_METADATA_TOO_LARGE",code:12,retriable:!1,message:"The metadata field of the offset request was too large"},{type:"NETWORK_EXCEPTION",code:13,retriable:!0,message:"The server disconnected before a response was received"},{type:"GROUP_LOAD_IN_PROGRESS",code:14,retriable:!0,message:"The coordinator is loading and hence can't process requests for this group"},{type:"GROUP_COORDINATOR_NOT_AVAILABLE",code:15,retriable:!0,message:"The group coordinator is not available"},{type:"NOT_COORDINATOR_FOR_GROUP",code:16,retriable:!0,message:"This is not the correct coordinator for this group"},{type:"INVALID_TOPIC_EXCEPTION",code:17,retriable:!1,message:"The request attempted to perform an operation on an invalid topic"},{type:"RECORD_LIST_TOO_LARGE",code:18,retriable:!1,message:"The request included message batch larger than the configured segment size on the server"},{type:"NOT_ENOUGH_REPLICAS",code:19,retriable:!0,message:"Messages are rejected since there are fewer in-sync replicas than required"},{type:"NOT_ENOUGH_REPLICAS_AFTER_APPEND",code:20,retriable:!0,message:"Messages are written to the log, but to fewer in-sync replicas than required"},{type:"INVALID_REQUIRED_ACKS",code:21,retriable:!1,message:"Produce request specified an invalid value for required acks"},{type:"ILLEGAL_GENERATION",code:22,retriable:!1,message:"Specified group generation id is not valid"},{type:"INCONSISTENT_GROUP_PROTOCOL",code:23,retriable:!1,message:"The group member's supported protocols are incompatible with those of existing members"},{type:"INVALID_GROUP_ID",code:24,retriable:!1,message:"The configured groupId is invalid"},{type:"UNKNOWN_MEMBER_ID",code:25,retriable:!1,message:"The coordinator is not aware of this member"},{type:"INVALID_SESSION_TIMEOUT",code:26,retriable:!1,message:"The session timeout is not within the range allowed by the broker (as configured by group.min.session.timeout.ms and group.max.session.timeout.ms)"},{type:"REBALANCE_IN_PROGRESS",code:27,retriable:!1,message:"The group is rebalancing, so a rejoin is needed",helpUrl:e("docs/faq","what-does-it-mean-to-get-rebalance-in-progress-errors")},{type:"INVALID_COMMIT_OFFSET_SIZE",code:28,retriable:!1,message:"The committing offset data size is not valid"},{type:"TOPIC_AUTHORIZATION_FAILED",code:29,retriable:!1,message:"Not authorized to access topics: [Topic authorization failed]"},{type:"GROUP_AUTHORIZATION_FAILED",code:30,retriable:!1,message:"Not authorized to access group: Group authorization failed"},{type:"CLUSTER_AUTHORIZATION_FAILED",code:31,retriable:!1,message:"Cluster authorization failed"},{type:"INVALID_TIMESTAMP",code:32,retriable:!1,message:"The timestamp of the message is out of acceptable range"},{type:"UNSUPPORTED_SASL_MECHANISM",code:33,retriable:!1,message:"The broker does not support the requested SASL mechanism"},{type:"ILLEGAL_SASL_STATE",code:34,retriable:!1,message:"Request is not valid given the current SASL state"},{type:"UNSUPPORTED_VERSION",code:35,retriable:!1,message:"The version of API is not supported"},{type:"TOPIC_ALREADY_EXISTS",code:36,retriable:!1,message:"Topic with this name already exists"},{type:"INVALID_PARTITIONS",code:37,retriable:!1,message:"Number of partitions is invalid"},{type:"INVALID_REPLICATION_FACTOR",code:38,retriable:!1,message:"Replication-factor is invalid"},{type:"INVALID_REPLICA_ASSIGNMENT",code:39,retriable:!1,message:"Replica assignment is invalid"},{type:"INVALID_CONFIG",code:40,retriable:!1,message:"Configuration is invalid"},{type:"NOT_CONTROLLER",code:41,retriable:!0,message:"This is not the correct controller for this cluster"},{type:"INVALID_REQUEST",code:42,retriable:!1,message:"This most likely occurs because of a request being malformed by the client library or the message was sent to an incompatible broker. See the broker logs for more details"},{type:"UNSUPPORTED_FOR_MESSAGE_FORMAT",code:43,retriable:!1,message:"The message format version on the broker does not support the request"},{type:"POLICY_VIOLATION",code:44,retriable:!1,message:"Request parameters do not satisfy the configured policy"},{type:"OUT_OF_ORDER_SEQUENCE_NUMBER",code:45,retriable:!1,message:"The broker received an out of order sequence number"},{type:"DUPLICATE_SEQUENCE_NUMBER",code:46,retriable:!1,message:"The broker received a duplicate sequence number"},{type:"INVALID_PRODUCER_EPOCH",code:47,retriable:!1,message:"Producer attempted an operation with an old epoch. Either there is a newer producer with the same transactionalId, or the producer's transaction has been expired by the broker"},{type:"INVALID_TXN_STATE",code:48,retriable:!1,message:"The producer attempted a transactional operation in an invalid state"},{type:"INVALID_PRODUCER_ID_MAPPING",code:49,retriable:!1,message:"The producer attempted to use a producer id which is not currently assigned to its transactional id"},{type:"INVALID_TRANSACTION_TIMEOUT",code:50,retriable:!1,message:"The transaction timeout is larger than the maximum value allowed by the broker (as configured by max.transaction.timeout.ms)"},{type:"CONCURRENT_TRANSACTIONS",code:51,retriable:!0,message:"The producer attempted to update a transaction while another concurrent operation on the same transaction was ongoing"},{type:"TRANSACTION_COORDINATOR_FENCED",code:52,retriable:!1,message:"Indicates that the transaction coordinator sending a WriteTxnMarker is no longer the current coordinator for a given producer"},{type:"TRANSACTIONAL_ID_AUTHORIZATION_FAILED",code:53,retriable:!1,message:"Transactional Id authorization failed"},{type:"SECURITY_DISABLED",code:54,retriable:!1,message:"Security features are disabled"},{type:"OPERATION_NOT_ATTEMPTED",code:55,retriable:!1,message:"The broker did not attempt to execute this operation. This may happen for batched RPCs where some operations in the batch failed, causing the broker to respond without trying the rest"},{type:"KAFKA_STORAGE_ERROR",code:56,retriable:!0,message:"Disk error when trying to access log file on the disk"},{type:"LOG_DIR_NOT_FOUND",code:57,retriable:!1,message:"The user-specified log directory is not found in the broker config"},{type:"SASL_AUTHENTICATION_FAILED",code:58,retriable:!1,message:"SASL Authentication failed",helpUrl:e("docs/configuration","sasl")},{type:"UNKNOWN_PRODUCER_ID",code:59,retriable:!1,message:"This exception is raised by the broker if it could not locate the producer metadata associated with the producerId in question. This could happen if, for instance, the producer's records were deleted because their retention time had elapsed. Once the last records of the producerId are removed, the producer's metadata is removed from the broker, and future appends by the producer will return this exception"},{type:"REASSIGNMENT_IN_PROGRESS",code:60,retriable:!1,message:"A partition reassignment is in progress"},{type:"DELEGATION_TOKEN_AUTH_DISABLED",code:61,retriable:!1,message:"Delegation Token feature is not enabled"},{type:"DELEGATION_TOKEN_NOT_FOUND",code:62,retriable:!1,message:"Delegation Token is not found on server"},{type:"DELEGATION_TOKEN_OWNER_MISMATCH",code:63,retriable:!1,message:"Specified Principal is not valid Owner/Renewer"},{type:"DELEGATION_TOKEN_REQUEST_NOT_ALLOWED",code:64,retriable:!1,message:"Delegation Token requests are not allowed on PLAINTEXT/1-way SSL channels and on delegation token authenticated channels"},{type:"DELEGATION_TOKEN_AUTHORIZATION_FAILED",code:65,retriable:!1,message:"Delegation Token authorization failed"},{type:"DELEGATION_TOKEN_EXPIRED",code:66,retriable:!1,message:"Delegation Token is expired"},{type:"INVALID_PRINCIPAL_TYPE",code:67,retriable:!1,message:"Supplied principalType is not supported"},{type:"NON_EMPTY_GROUP",code:68,retriable:!1,message:"The group is not empty"},{type:"GROUP_ID_NOT_FOUND",code:69,retriable:!1,message:"The group id was not found"},{type:"FETCH_SESSION_ID_NOT_FOUND",code:70,retriable:!0,message:"The fetch session ID was not found"},{type:"INVALID_FETCH_SESSION_EPOCH",code:71,retriable:!0,message:"The fetch session epoch is invalid"},{type:"LISTENER_NOT_FOUND",code:72,retriable:!0,message:"There is no listener on the leader broker that matches the listener on which metadata request was processed"},{type:"TOPIC_DELETION_DISABLED",code:73,retriable:!1,message:"Topic deletion is disabled"},{type:"FENCED_LEADER_EPOCH",code:74,retriable:!0,message:"The leader epoch in the request is older than the epoch on the broker"},{type:"UNKNOWN_LEADER_EPOCH",code:75,retriable:!0,message:"The leader epoch in the request is newer than the epoch on the broker"},{type:"UNSUPPORTED_COMPRESSION_TYPE",code:76,retriable:!1,message:"The requesting client does not support the compression type of given partition"},{type:"STALE_BROKER_EPOCH",code:77,retriable:!1,message:"Broker epoch has changed"},{type:"OFFSET_NOT_AVAILABLE",code:78,retriable:!0,message:"The leader high watermark has not caught up from a recent leader election so the offsets cannot be guaranteed to be monotonically increasing"},{type:"MEMBER_ID_REQUIRED",code:79,retriable:!1,message:"The group member needs to have a valid member id before actually entering a consumer group"},{type:"PREFERRED_LEADER_NOT_AVAILABLE",code:80,retriable:!0,message:"The preferred leader was not available"},{type:"GROUP_MAX_SIZE_REACHED",code:81,retriable:!1,message:"The consumer group has reached its max size. It already has the configured maximum number of members"},{type:"FENCED_INSTANCE_ID",code:82,retriable:!1,message:"The broker rejected this static consumer since another consumer with the same group instance id has registered with a different member id"},{type:"ELIGIBLE_LEADERS_NOT_AVAILABLE",code:83,retriable:!0,message:"Eligible topic partition leaders are not available"},{type:"ELECTION_NOT_NEEDED",code:84,retriable:!0,message:"Leader election not needed for topic partition"},{type:"NO_REASSIGNMENT_IN_PROGRESS",code:85,retriable:!1,message:"No partition reassignment is in progress"},{type:"GROUP_SUBSCRIBED_TO_TOPIC",code:86,retriable:!1,message:"Deleting offsets of a topic is forbidden while the consumer group is actively subscribed to it"},{type:"INVALID_RECORD",code:87,retriable:!1,message:"This record has failed the validation on broker and hence be rejected"},{type:"UNSTABLE_OFFSET_COMMIT",code:88,retriable:!0,message:"There are unstable offsets that need to be cleared"}],g=a=>new d(f.find(b=>b.code===a)||{type:"KAFKAJS_UNKNOWN_ERROR_CODE",code:-99,retriable:!1,message:`Unknown error code ${a}`});a.exports={failure:a=>0!==a,errorCodes:f,createErrorFromCode:g,failIfVersionNotSupported:a=>{if(35===a)throw g(35)},staleMetadata:a=>["UNKNOWN_TOPIC_OR_PARTITION","LEADER_NOT_AVAILABLE","NOT_LEADER_FOR_PARTITION"].includes(a.type)}},88527:(a,b,c)=>{let d=c(45500),{failIfVersionNotSupported:e}=c(88374),{parse:f}=c(36070);a.exports={decode:async a=>{let b=new d(a),c=b.readInt32(),f=b.readInt16();return e(f),{throttleTime:c,errorCode:f,memberAssignment:b.readBytes()}},parse:f}},88736:(a,b,c)=>{let d=c(39652),{OffsetCommit:e}=c(81451);a.exports=({groupId:a,topics:b})=>({apiKey:e,apiVersion:0,apiName:"OffsetCommit",encode:async()=>new d().writeString(a).writeArray(b.map(f))});let f=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(g)),g=({partition:a,offset:b,metadata:c=null})=>new d().writeInt32(a).writeInt64(b).writeString(c)},88923:(a,b,c)=>{let{KafkaJSNonRetriableError:d}=c(16920),e=a=>({randomBytes:b=>a.getRandomValues(Buffer.allocUnsafe(b))}),f=null;global&&global.crypto?f=void 0===global.crypto.randomBytes?e(global.crypto):global.crypto:global&&global.msCrypto?f=e(global.msCrypto):global&&!global.crypto&&(f=c(55511)),a.exports=a=>{if(a>65536)throw new d(`Byte length (${a}) exceeds the max number of bytes of entropy available (65536)`);if(!f)throw new d("No available crypto implementation");return f.randomBytes(a)}},89302:(a,b,c)=>{let d=c(39652),{OffsetCommit:e}=c(81451);a.exports=({groupId:a,groupGenerationId:b,memberId:c,retentionTime:g,topics:h})=>({apiKey:e,apiVersion:2,apiName:"OffsetCommit",encode:async()=>new d().writeString(a).writeInt32(b).writeString(c).writeInt64(g).writeArray(h.map(f))});let f=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(g)),g=({partition:a,offset:b,metadata:c=null})=>new d().writeInt32(a).writeInt64(b).writeString(c)},89334:(a,b,c)=>{let d=-1,e={0:({groupId:a,topics:b})=>{let d=c(88736),e=c(32126);return{request:d({groupId:a,topics:b}),response:e}},1:({groupId:a,groupGenerationId:b,memberId:d,topics:e})=>{let f=c(81635),g=c(68839);return{request:f({groupId:a,groupGenerationId:b,memberId:d,topics:e}),response:g}},2:({groupId:a,groupGenerationId:b,memberId:e,retentionTime:f=d,topics:g})=>{let h=c(89302),i=c(38292);return{request:h({groupId:a,groupGenerationId:b,memberId:e,retentionTime:f,topics:g}),response:i}},3:({groupId:a,groupGenerationId:b,memberId:e,retentionTime:f=d,topics:g})=>{let h=c(49017),i=c(80453);return{request:h({groupId:a,groupGenerationId:b,memberId:e,retentionTime:f,topics:g}),response:i}},4:({groupId:a,groupGenerationId:b,memberId:e,retentionTime:f=d,topics:g})=>{let h=c(29476),i=c(42362);return{request:h({groupId:a,groupGenerationId:b,memberId:e,retentionTime:f,topics:g}),response:i}},5:({groupId:a,groupGenerationId:b,memberId:d,topics:e})=>{let f=c(64471),g=c(787);return{request:f({groupId:a,groupGenerationId:b,memberId:d,topics:e}),response:g}}};a.exports={versions:Object.keys(e),protocol:({version:a})=>e[a]}},90215:(a,b,c)=>{let d=({rebalanceTimeout:a,sessionTimeout:b})=>{let c=a||b;return Number.isSafeInteger(c+5e3)?c+5e3:c},e=a=>null!=a&&""!==a,f={0:({groupId:a,sessionTimeout:b,memberId:e,protocolType:f,groupProtocols:g})=>{let h=c(48239),i=c(36603);return{request:h({groupId:a,sessionTimeout:b,memberId:e,protocolType:f,groupProtocols:g}),response:i,requestTimeout:d({rebalanceTimeout:null,sessionTimeout:b})}},1:({groupId:a,sessionTimeout:b,rebalanceTimeout:e,memberId:f,protocolType:g,groupProtocols:h})=>{let i=c(78908),j=c(87970);return{request:i({groupId:a,sessionTimeout:b,rebalanceTimeout:e,memberId:f,protocolType:g,groupProtocols:h}),response:j,requestTimeout:d({rebalanceTimeout:e,sessionTimeout:b})}},2:({groupId:a,sessionTimeout:b,rebalanceTimeout:e,memberId:f,protocolType:g,groupProtocols:h})=>{let i=c(83301),j=c(61641);return{request:i({groupId:a,sessionTimeout:b,rebalanceTimeout:e,memberId:f,protocolType:g,groupProtocols:h}),response:j,requestTimeout:d({rebalanceTimeout:e,sessionTimeout:b})}},3:({groupId:a,sessionTimeout:b,rebalanceTimeout:e,memberId:f,protocolType:g,groupProtocols:h})=>{let i=c(2834),j=c(23704);return{request:i({groupId:a,sessionTimeout:b,rebalanceTimeout:e,memberId:f,protocolType:g,groupProtocols:h}),response:j,requestTimeout:d({rebalanceTimeout:e,sessionTimeout:b})}},4:({groupId:a,sessionTimeout:b,rebalanceTimeout:f,memberId:g,protocolType:h,groupProtocols:i})=>{let j=c(39803),k=c(92047);return{request:j({groupId:a,sessionTimeout:b,rebalanceTimeout:f,memberId:g,protocolType:h,groupProtocols:i}),response:k,requestTimeout:d({rebalanceTimeout:f,sessionTimeout:b}),logResponseError:e(g)}},5:({groupId:a,sessionTimeout:b,rebalanceTimeout:f,memberId:g,groupInstanceId:h,protocolType:i,groupProtocols:j})=>{let k=c(14040),l=c(35558);return{request:k({groupId:a,sessionTimeout:b,rebalanceTimeout:f,memberId:g,groupInstanceId:h,protocolType:i,groupProtocols:j}),response:l,requestTimeout:d({rebalanceTimeout:f,sessionTimeout:b}),logResponseError:e(g)}}};a.exports={versions:Object.keys(f),protocol:({version:a})=>f[a]}},90483:a=>{a.exports={NO_TIMESTAMP:-1,CREATE_TIME:0,LOG_APPEND_TIME:1}},90531:(a,b,c)=>{let d=c(45500),{KafkaJSDeleteTopicRecordsError:e}=c(16920),{failure:f,createErrorFromCode:g}=c(88374),h=(a,b)=>a.topic.localeCompare(b.topic),i=async a=>{let b=new d(a);return{throttleTime:b.readInt32(),topics:b.readArray(a=>({topic:a.readString(),partitions:a.readArray(a=>({partition:a.readInt32(),lowWatermark:a.readInt64(),errorCode:a.readInt16()}))})).sort(h)}};a.exports=({topics:a})=>({decode:i,parse:async b=>{let c=b.topics.map(({partitions:a})=>({partitionsWithErrors:a.filter(({errorCode:a})=>f(a))})).filter(({partitionsWithErrors:a})=>a.length);if(c.length>0){let[{topic:d}]=b.topics,[{partitions:f}]=a,[{partitionsWithErrors:h}]=c;throw new e({topic:d,partitions:h.map(({partition:a,errorCode:b})=>({partition:a,error:g(b),offset:f.find(b=>b.partition===a).offset}))})}return b}})},91309:(a,b,c)=>{let{EventEmitter:d}=c(94735),{KafkaJSNonRetriableError:e}=c(16920),f=c(40897),g={[f.UNINITIALIZED]:[f.READY],[f.READY]:[f.READY,f.TRANSACTING],[f.TRANSACTING]:[f.COMMITTING,f.ABORTING],[f.COMMITTING]:[f.READY],[f.ABORTING]:[f.READY]};a.exports=({logger:a,initialState:b=f.UNINITIALIZED})=>{let c=b,h=Object.assign(new d,{createGuarded(a,b){let d=Object.keys(b).reduce((d,f)=>(d[f]=((a,b,{legalStates:d,async:f=!0})=>{if(!a[b])throw new e(`Cannot add guard on missing method "${b}"`);return(...g)=>{let h=a[b];if(!d.includes(c)){let a=new e(`Transaction state exception: Cannot call "${b}" in state "${c}"`);if(f)return Promise.reject(a);throw a}return h.apply(a,g)}})(a,f,b[f]),d),{});return{...a,...d}},transitionTo(b){if(a.debug(`Transaction state transition ${c} --> ${b}`),!g[c].includes(b))throw new e(`Transaction state exception: Invalid transition ${c} --> ${b}`);h.emit("transition",{to:b,from:c}),c=b},state:()=>c});return h}},91567:(a,b,c)=>{a.exports={request:c(53686),response:c(47028)}},91839:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=a=>({topic:a.readString(),partitions:a.readArray(h)}),h=a=>({partition:a.readInt32(),offset:a.readInt64().toString(),metadata:a.readString(),errorCode:a.readInt16()});a.exports={decode:async a=>{let b=new d(a);return{responses:b.readArray(g),errorCode:b.readInt16()}},parse:async a=>{if(e(a.errorCode))throw f(a.errorCode);let b=a.responses.flatMap(a=>a.partitions.filter(a=>e(a.errorCode)))[0];if(b)throw f(b.errorCode);return a}}},92047:(a,b,c)=>{let{decode:d}=c(23704),{KafkaJSMemberIdRequired:e}=c(16920),{failure:f,createErrorFromCode:g,errorCodes:h}=c(88374),{code:i}=h.find(a=>"MEMBER_ID_REQUIRED"===a.type);a.exports={decode:d,parse:async a=>{if(f(a.errorCode)){if(a.errorCode===i)throw new e(g(a.errorCode),{memberId:a.memberId});throw g(a.errorCode)}return a}}},92074:(a,b,c)=>{let d=c(90531);a.exports=({topics:a})=>{let{parse:b,decode:c}=d({topics:a});return{decode:async a=>{let b=await c(a);return{...b,throttleTime:0,clientSideThrottleTime:b.throttleTime}},parse:b}}},92347:(a,b,c)=>{let d=c(39652),{Heartbeat:e}=c(81451);a.exports=({groupId:a,groupGenerationId:b,memberId:c,groupInstanceId:f})=>({apiKey:e,apiVersion:3,apiName:"Heartbeat",encode:async()=>new d().writeString(a).writeInt32(b).writeString(c).writeString(f)})},92635:(a,b,c)=>{let d=c(39652),e=c(26343);a.exports=({offsetDelta:a=0,timestampDelta:b=0,key:c,value:g,headers:h={}})=>{let i=Object.keys(h).flatMap(a=>Array.isArray(h[a])?h[a].map(b=>({key:a,value:b})):[{key:a,value:h[a]}]),j=1+d.sizeOfVarLong(b)+d.sizeOfVarInt(a)+d.sizeOfVarIntBytes(c)+d.sizeOfVarIntBytes(g)+f(i);return new d().writeVarInt(j).writeInt8(0).writeVarLong(b).writeVarInt(a).writeVarIntBytes(c).writeVarIntBytes(g).writeVarIntArray(i.map(e))};let f=a=>{let b=d.sizeOfVarInt(a.length);for(let c of a){let a=Buffer.byteLength(c.key),e=Buffer.byteLength(c.value);b+=d.sizeOfVarInt(a)+a,null===c.value?b+=d.sizeOfVarInt(-1):b+=d.sizeOfVarInt(e)+e}return b}},92742:a=>{a.exports={decode:async()=>!0,parse:async()=>!0}},92891:(a,b,c)=>{let d=c(95733);a.exports=c(2952)(d)},93456:(a,b,c)=>{let{requests:d,lookup:e}=c(79683),f=c(81451),g=c(45060),h=c(21617),i=c(32420),j=c(27056),k=c(56074),{KafkaJSSASLAuthenticationError:l}=c(16920),m={AWS:j,PLAIN:g,OAUTHBEARER:k,"SCRAM-SHA-256":h,"SCRAM-SHA-512":i};a.exports=class{constructor(a,b,c,g){this.connection=a,this.logger=b,this.sessionLifetime="0";let h=e(c);this.saslHandshake=h(f.SaslHandshake,d.SaslHandshake),this.protocolAuthentication=g?h(f.SaslAuthenticate,d.SaslAuthenticate):null}async authenticate(){let a=this.connection.sasl.mechanism.toUpperCase();if(!(await this.connection.send(this.saslHandshake({mechanism:a}))).enabledMechanisms.includes(a))throw new l(`SASL ${a} mechanism is not supported by the server`);let b=async({request:a,response:b})=>{if(this.protocolAuthentication){let c=await a.encode(),d=await this.connection.send(this.protocolAuthentication({authBytes:c}));if(this.sessionLifetime=d.sessionLifetimeMs||"0",!b)return;let{authBytes:e}=d,f=await b.decode(e);return b.parse(f)}return this.connection.sendAuthRequest({request:a,response:b})};!this.connection.sasl.authenticationProvider&&Object.keys(m).includes(a)&&(this.connection.sasl.authenticationProvider=m[a](this.connection.sasl)),await this.connection.sasl.authenticationProvider({host:this.connection.host,port:this.connection.port,logger:this.logger.namespace(`SaslAuthenticator-${a}`),saslAuthenticate:b}).authenticate()}}},93581:(a,b,c)=>{let{decode:d,parse:e}=c(6460);a.exports={decode:d,parse:e}},94159:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f}=c(88374),g=(a,b)=>a.topic.localeCompare(b.topic),h=a=>({topic:a.readString(),errorCode:a.readInt16()});a.exports={decode:async a=>({topicErrors:new d(a).readArray(h).sort(g)}),parse:async a=>{let b=a.topicErrors.filter(({errorCode:a})=>e(a));if(b.length>0)throw f(b[0].errorCode);return a}}},94695:(a,b,c)=>{let d=c(75348);a.exports=({authBytes:a})=>Object.assign(d({authBytes:a}),{apiVersion:1})},94764:(a,b,c)=>{let d=c(39652),{DeleteAcls:e}=c(81451),f=({resourceType:a,resourceName:b,principal:c,host:e,operation:f,permissionType:g})=>new d().writeInt8(a).writeString(b).writeString(c).writeString(e).writeInt8(f).writeInt8(g);a.exports=({filters:a})=>({apiKey:e,apiVersion:0,apiName:"DeleteAcls",encode:async()=>new d().writeArray(a.map(f))})},94947:(a,b,c)=>{let{KafkaJSAggregateError:d,KafkaJSAlterPartitionReassignmentsError:e}=c(16920),f=c(45500),{failure:g,createErrorFromCode:h}=c(88374),i=a=>{let b={topic:a.readUVarIntString(),partitions:a.readUVarIntArray(j)};return a.readTaggedFields(),b},j=a=>{let b={partition:a.readInt32(),errorCode:a.readInt16()};return a.readUVarIntString(),a.readTaggedFields(),b};a.exports={decode:async a=>{let b=new f(a);b.readTaggedFields();let c=b.readInt32(),d=b.readInt16();return b.readUVarIntString(),{throttleTime:c,errorCode:d,responses:b.readUVarIntArray(i)}},parse:async a=>{if(g(a.errorCode))throw new e(h(a.errorCode));let b=a.responses.flatMap(({partitions:a,topic:b})=>a.filter(a=>g(a.errorCode)).map(a=>({...a,topic:b})));if(b.length>0)throw new d("Errors altering partition reassignments",b.map(({topic:a,partition:b,errorCode:c})=>new e(h(c),a,b)));return a}}},95202:(a,b,c)=>{let d={0:({filters:a})=>{let b=c(94764),d=c(63282);return{request:b({filters:a}),response:d}},1:({filters:a})=>{let b=c(61791),d=c(43467);return{request:b({filters:a}),response:d}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},95238:(a,b,c)=>{let d=c(39652),{Fetch:e}=c(81451),f=c(96268);a.exports=({replicaId:a,maxWaitTime:b,minBytes:c,maxBytes:i,topics:j,rackId:k="",isolationLevel:l=f.READ_COMMITTED,sessionId:m=0,sessionEpoch:n=-1,forgottenTopics:o=[]})=>({apiKey:e,apiVersion:11,apiName:"Fetch",encode:async()=>new d().writeInt32(a).writeInt32(b).writeInt32(c).writeInt32(i).writeInt8(l).writeInt32(m).writeInt32(n).writeArray(j.map(h)).writeArray(o.map(g)).writeString(k)});let g=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b),h=({topic:a,partitions:b})=>new d().writeString(a).writeArray(b.map(i)),i=({partition:a,currentLeaderEpoch:b=-1,fetchOffset:c,logStartOffset:e=-1,maxBytes:f})=>new d().writeInt32(a).writeInt32(b).writeInt64(c).writeInt64(e).writeInt32(f)},95356:(a,b,c)=>{let d=c(39652),{LeaveGroup:e}=c(81451);a.exports=({groupId:a,memberId:b})=>({apiKey:e,apiVersion:0,apiName:"LeaveGroup",encode:async()=>new d().writeString(a).writeString(b)})},95733:(a,b,c)=>{let d=c(2087),e=d.fromValue(0x9747b28c),f=d.fromValue(0x5bd1e995),g=d.fromValue(24);a.exports=a=>{let b=Buffer.isBuffer(a)?a:Buffer.from(String(a)),c=b.length,h=d.fromValue(e.xor(c)),i=Math.floor(c/4);for(let a=0;a<i;a++){let c=4*a,e=(255&b[c+0])+((255&b[c+1])<<8)+((255&b[c+2])<<16)+((255&b[c+3])<<24);e=(e=(e=d.fromValue(e)).multiply(f)).xor(e.toInt()>>>g),e=d.fromValue(e).multiply(f),h=(h=h.multiply(f)).xor(e)}switch(c%4){case 3:h=h.xor((255&b[(-4&c)+2])<<16);case 2:h=h.xor((255&b[(-4&c)+1])<<8);case 1:h=(h=h.xor(255&b[-4&c])).multiply(f)}return(h=(h=(h=h.xor(h.toInt()>>>13)).multiply(f)).xor(h.toInt()>>>15)).toInt()}},95749:(a,b,c)=>{let d={0:({groupId:a,memberId:b})=>{let d=c(95356),e=c(32802);return{request:d({groupId:a,memberId:b}),response:e}},1:({groupId:a,memberId:b})=>{let d=c(1103),e=c(3931);return{request:d({groupId:a,memberId:b}),response:e}},2:({groupId:a,memberId:b})=>{let d=c(55346),e=c(2891);return{request:d({groupId:a,memberId:b}),response:e}},3:({groupId:a,memberId:b,groupInstanceId:d})=>{let e=c(10117),f=c(45673);return{request:e({groupId:a,members:[{memberId:b,groupInstanceId:d}]}),response:f}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},95865:(a,b,c)=>{let d=c(24864);a.exports=({coordinatorKey:a,coordinatorType:b})=>Object.assign(d({coordinatorKey:a,coordinatorType:b}),{apiVersion:2})},96268:a=>{a.exports={READ_UNCOMMITTED:0,READ_COMMITTED:1}},96988:(a,b,c)=>{let d=c(49967);a.exports=a=>Object.assign(d(a),{apiVersion:1})},97274:a=>{a.exports={maxRetryTime:3e4,initialRetryTime:300,factor:.2,multiplier:2,retries:5}},98069:(a,b,c)=>{let{decode:d,parse:e}=c(20388);a.exports={decode:d,parse:e}},98300:(a,b,c)=>{let{EventEmitter:d}=c(94735),e=c(35521),f=c(67449),{KafkaJSInvariantViolation:g}=c(16920),h={EMIT_QUEUE_SIZE_EVENT:Symbol("private:RequestQueue:emitQueueSizeEvent"),EMIT_REQUEST_QUEUE_EMPTY:Symbol("private:RequestQueue:emitQueueEmpty")},i="requestQueueEmpty";a.exports=class extends d{constructor({instrumentationEmitter:a=null,maxInFlightRequests:b,requestTimeout:c,enforceRequestTimeout:d,clientId:e,broker:g,logger:j,isConnected:k=()=>!0}){super(),this.instrumentationEmitter=a,this.maxInFlightRequests=b,this.requestTimeout=c,this.enforceRequestTimeout=d,this.clientId=e,this.broker=g,this.logger=j,this.isConnected=k,this.inflight=new Map,this.pending=[],this.throttledUntil=-1,this.throttleCheckTimeoutId=null,this[h.EMIT_REQUEST_QUEUE_EMPTY]=()=>{0===this.pending.length&&0===this.inflight.size&&this.emit(i)},this[h.EMIT_QUEUE_SIZE_EVENT]=()=>{a&&a.emit(f.NETWORK_REQUEST_QUEUE_SIZE,{broker:this.broker,clientId:this.clientId,queueSize:this.pending.length}),this[h.EMIT_REQUEST_QUEUE_EMPTY]()}}scheduleRequestTimeoutCheck(){this.enforceRequestTimeout&&(this.destroy(),this.requestTimeoutIntervalId=setInterval(()=>{this.inflight.forEach(a=>{Date.now()-a.sentAt>a.requestTimeout&&a.timeoutRequest()}),this.isConnected()||this.destroy()},Math.min(this.requestTimeout,100)))}maybeThrottle(a){if(null!==a&&a>0){this.logger.debug(`Client side throttling in effect for ${a}ms`);let b=Date.now()+a;this.throttledUntil=Math.max(b,this.throttledUntil)}}createSocketRequest(a){let{correlationId:b}=a.entry,c=Math.max(this.requestTimeout,a.requestTimeout||0),d=new e({entry:a.entry,expectResponse:a.expectResponse,broker:this.broker,clientId:this.clientId,instrumentationEmitter:this.instrumentationEmitter,requestTimeout:c,send:()=>{if(this.inflight.has(b))throw new g("Correlation id already exists");this.inflight.set(b,d),a.sendRequest()},timeout:()=>{this.inflight.delete(b),this.checkPendingRequests(),this[h.EMIT_REQUEST_QUEUE_EMPTY]()}});return d}push(a){let{correlationId:b}=a.entry,c=this.createSocketRequest(a);if(this.canSendSocketRequestImmediately())return void this.sendSocketRequest(c);this.pending.push(c),this.scheduleCheckPendingRequests(),this.logger.debug("Request enqueued",{clientId:this.clientId,broker:this.broker,correlationId:b}),this[h.EMIT_QUEUE_SIZE_EVENT]()}sendSocketRequest(a){a.send(),a.expectResponse||(this.logger.debug("Request does not expect a response, resolving immediately",{clientId:this.clientId,broker:this.broker,correlationId:a.correlationId}),this.inflight.delete(a.correlationId),a.completed({size:0,payload:null}))}fulfillRequest({correlationId:a,payload:b,size:c}){let d=this.inflight.get(a);this.inflight.delete(a),this.checkPendingRequests(),d?d.completed({size:c,payload:b}):this.logger.warn("Response without match",{clientId:this.clientId,broker:this.broker,correlationId:a}),this[h.EMIT_REQUEST_QUEUE_EMPTY]()}rejectAll(a){for(let b of[...this.inflight.values(),...this.pending])b.rejected(a),this.inflight.delete(b.correlationId);this.pending=[],this.inflight.clear(),this[h.EMIT_QUEUE_SIZE_EVENT]()}waitForPendingRequests(){return new Promise(a=>{if(0===this.pending.length&&0===this.inflight.size)return a();this.logger.debug("Waiting for pending requests",{clientId:this.clientId,broker:this.broker,currentInflightRequests:this.inflight.size,currentPendingQueueSize:this.pending.length}),this.once(i,()=>a())})}destroy(){clearInterval(this.requestTimeoutIntervalId),clearTimeout(this.throttleCheckTimeoutId),this.throttleCheckTimeoutId=null}canSendSocketRequestImmediately(){return!(null!=this.maxInFlightRequests&&this.inflight.size>=this.maxInFlightRequests||this.throttledUntil>Date.now())}checkPendingRequests(){for(;this.pending.length>0&&this.canSendSocketRequestImmediately();){let a=this.pending.shift();this.sendSocketRequest(a),this.logger.debug("Consumed pending request",{clientId:this.clientId,broker:this.broker,correlationId:a.correlationId,pendingDuration:a.pendingDuration,currentPendingQueueSize:this.pending.length}),this[h.EMIT_QUEUE_SIZE_EVENT]()}this.scheduleCheckPendingRequests()}scheduleCheckPendingRequests(){let a=this.throttledUntil-Date.now();this.throttleCheckTimeoutId||(this.pending.length>0&&(a=a>0?a:10),this.throttleCheckTimeoutId=setTimeout(()=>{this.throttleCheckTimeoutId=null,this.checkPendingRequests()},a))}}},98446:(a,b,c)=>{let d=c(96268),e=c(9127);a.exports=({replicaId:a,maxWaitTime:b,minBytes:c,maxBytes:f,topics:g,isolationLevel:h=d.READ_COMMITTED,sessionId:i=0,sessionEpoch:j=-1,forgottenTopics:k=[]})=>Object.assign(e({replicaId:a,maxWaitTime:b,minBytes:c,maxBytes:f,topics:g,isolationLevel:h,sessionId:i,sessionEpoch:j,forgottenTopics:k}),{apiVersion:8})},98465:(a,b,c)=>{let d={0:()=>{let a=c(401),b=c(49869);return{request:a(),response:b,logResponseError:!0}},1:()=>{let a=c(74830),b=c(33116);return{request:a(),response:b,logResponseError:!1}},2:()=>{let a=c(81595),b=c(4079);return{request:a(),response:b,logResponseError:!1}}};a.exports={versions:Object.keys(d),protocol:({version:a})=>d[a]}},98775:(a,b,c)=>{let d=c(39652),{ListPartitionReassignments:e}=c(81451);a.exports=({topics:a=null,timeout:b=5e3})=>({apiKey:e,apiVersion:0,apiName:"ListPartitionReassignments",encode:async()=>new d().writeUVarIntBytes().writeInt32(b).writeUVarIntArray(null===a?a:a.map(f)).writeUVarIntBytes()});let f=({topic:a,partitions:b})=>new d().writeUVarIntString(a).writeUVarIntArray(b.map(g)).writeUVarIntBytes(),g=a=>new d().writeInt32(a)},99484:(a,b,c)=>{let d=c(45500),{failure:e,createErrorFromCode:f,failIfVersionNotSupported:g}=c(88374);a.exports={decode:async a=>{let b=new d(a).readInt16();return g(b),{errorCode:b}},parse:async a=>{if(e(a.errorCode))throw f(a.errorCode);return a}}},99545:(a,b,c)=>{let d=c(39652),{Metadata:e}=c(81451);a.exports=({topics:a})=>({apiKey:e,apiVersion:0,apiName:"Metadata",encode:async()=>new d().writeArray(a)})}};