"use strict";exports.id=4673,exports.ids=[4673],exports.modules={4673:(a,b,c)=>{c.d(b,{LJ:()=>l,RU:()=>j,Yi:()=>p,_1:()=>g,dm:()=>k,filterUserMappableColumns:()=>h,generateApiConfig:()=>i,ry:()=>o,xR:()=>q});var d=c(11023),e=c(84621);let f=a=>a?Buffer.from(a).toString("base64"):void 0,g=a=>{let b=a.default_type||a.default_kind||"";return!!(a.default_expression||"DEFAULT"===b)},h=a=>a.filter(a=>!(a=>{let b=a.default_type||a.default_kind||"";return"ALIAS"===b||"MATERIALIZED"===b})(a)),i=({pipelineId:a,pipelineName:b,setPipelineId:c,clickhouseConnection:g,clickhouseDestination:h,selectedTopics:i,getMappingType:j,joinStore:k,kafkaStore:l,deduplicationStore:n})=>{try{let o=a;o||(o=(0,d.A)(),c(o));let p=h?.mapping||[],q=i.map((a,b)=>{let c={};a.events&&a.selectedEvent&&a.selectedEvent.event&&(c={...a?.selectedEvent?.event||{}},"object"==typeof c&&null!==c&&"_metadata"in c&&delete c._metadata);let d=n?.getDeduplication?.(b)||null;return{consumer_group_initial_offset:a.initialOffset,name:a.name,id:a.name,replicas:a.replicas,schema:{type:"json",fields:(0,e.B$)(c).map(a=>{let b=j(a,p),d=m(c,a);return{name:a,type:b||d}})},deduplication:d&&d.enabled&&d.key?{enabled:!0,id_field:d.key,id_field_type:d.keyType,time_window:d.window?`${d.window}${d.unit?.charAt(0)||"h"}`:"1h"}:{enabled:!1}}}),r=h?.mapping?h.mapping.filter(a=>a.eventField).filter(a=>!a.eventField.startsWith("_metadata")).map(a=>{let b=a.sourceTopic||i[0]?.name;if(!a.sourceTopic){for(let c of i)if(c.events&&c.selectedEvent&&c.selectedEvent.event){let d=c?.selectedEvent?.event||{};if(a.eventField in d){b=c.name;break}}}if(k.streams&&k.streams.length>0){for(let c of k.streams)if(c.joinKey===a.eventField){b=c.topicName||c.streamId;break}}return{source_id:b,field_name:a.eventField,column_name:a.name,column_type:a.type.replace(/Nullable\((.*)\)/,"$1")}}):[],s=(0,e.y)(),t=s?.NEXT_PUBLIC_IN_DOCKER==="true"||"true"===process.env.NEXT_PUBLIC_IN_DOCKER,u={pipeline_id:o,name:b,source:{type:"kafka",provider:"custom",connection_params:{brokers:(l?.bootstrapServers?.split(",")||[]).map(a=>(a=>{if(!a)return a;let[b,c]=a.split(":");return t&&("localhost"===b||"127.0.0.1"===b||"[::1]"===b)?`host.docker.internal${c?`:${c}`:""}`:a})(a.trim())),protocol:l?.securityProtocol||"PLAINTEXT",skip_auth:l?.skipAuth||!1},topics:q},...q.length>1?{join:{enabled:k.enabled,type:k.type||"temporal",sources:k.streams.length>0?k.streams.map(a=>({source_id:a.topicName,join_key:a.joinKey,time_window:`${a.joinTimeWindowValue}${a.joinTimeWindowUnit.charAt(0)}`,orientation:a.orientation})):q.map((a,b)=>{let c=n?.getDeduplication?.(b)||null,d=c?.key||"";return{source_id:a.name,join_key:d,time_window:"1h",orientation:0===b?"left":"right"}})}}:{},sink:{type:"clickhouse",provider:"custom",...g?.connectionType==="direct"?{host:g.directConnection?.host,port:g.directConnection?.nativePort?.toString()||"9000",http_port:g.directConnection?.httpPort?.toString()||void 0,database:h?.database,username:g.directConnection?.username,password:f(g.directConnection?.password),secure:g.directConnection?.useSSL||!1,skip_certificate_verification:g.directConnection?.skipCertificateVerification||!1,max_batch_size:h?.maxBatchSize||1e3,max_delay_time:(()=>{let a=h?.maxDelayTime||1,b=h?.maxDelayTimeUnit||"m",c=b;return"seconds"===b?c="s":"minutes"===b?c="m":"hours"===b?c="h":"days"===b&&(c="d"),`${a}${c}`})()}:{},table:h?.table,table_mapping:r}};if(l?.securityProtocol==="SASL_PLAINTEXT"||l?.securityProtocol==="SASL_SSL"){let a=l.authMethod?.toLowerCase();if(a?.includes("plain")){if(u.source.connection_params={...u.source.connection_params,mechanism:"PLAIN",username:l.saslPlain?.username,password:l.saslPlain?.password},l?.securityProtocol==="SASL_SSL"||l?.securityProtocol==="SSL"){let a=l.saslPlain?.truststore?.certificates;a&&(u.source.connection_params={...u.source.connection_params,root_ca:f(a)})}}else if(a?.includes("scram")){let b=a.includes("256")?"SCRAM-SHA-256":"SCRAM-SHA-512",c=a.includes("256")?l.saslScram256:l.saslScram512;if(u.source.connection_params={...u.source.connection_params,mechanism:b,username:c?.username,password:c?.password},l?.securityProtocol==="SASL_SSL"||l?.securityProtocol==="SSL"){let a=c?.truststore?.certificates;a&&(u.source.connection_params={...u.source.connection_params,root_ca:f(a)})}}else a?.includes("oauth")&&(u.source.connection_params={...u.source.connection_params,mechanism:"OAUTHBEARER",oauthBearerToken:l.saslOauthbearer?.oauthBearerToken})}if(l?.authMethod==="SASL/GSSAPI"&&(u.source.connection_params={...u.source.connection_params,mechanism:"GSSAPI",principal:l.saslGssapi.kerberosPrincipal,username:l.saslGssapi.kerberosPrincipal,kerberosKeytab:l.saslGssapi.kerberosKeytab,kerberosRealm:l.saslGssapi.kerberosRealm,kdc:l.saslGssapi.kdc,serviceName:l.saslGssapi.serviceName,krb5Config:l.saslGssapi.krb5Config},l?.securityProtocol==="SASL_SSL"||l?.securityProtocol==="SSL")){let a=l.saslGssapi?.truststore?.certificates;a&&(u.source.connection_params={...u.source.connection_params,root_ca:f(a)})}if(l?.authMethod==="NO_AUTH"&&(l?.securityProtocol==="SSL"||l?.securityProtocol==="SASL_SSL")){let a=l.noAuth?.truststore?.certificates;a&&(u.source.connection_params={...u.source.connection_params,root_ca:f(a)})}return u}catch(a){return console.error("Error generating API config:",a),{error:"Failed to generate API configuration"}}};function j(a){if(null===a)return"null";if(void 0===a)return"undefined";let b=typeof a;if("number"===b)if(Number.isInteger(a))if(a>=0)return a<=255?"uint8":a<=65535?"uint16":a<=0xffffffff?"uint32":a<=Number.MAX_SAFE_INTEGER?"uint64":"string";else return a>=-128&&a<=127?"int8":a>=-32768&&a<=32767?"int16":a>=-0x80000000&&a<=0x7fffffff?"int32":a>=Number.MIN_SAFE_INTEGER&&a<=Number.MAX_SAFE_INTEGER?"int64":"string";else{let b=Math.abs(a);return b<34e37&&b>12e-39?"float32":"float64"}return"boolean"===b?"bool":"string"===b?(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(a)||/^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|[+-]\d{2}:\d{2})?)?$/.test(a),"string"):Array.isArray(a)?"array":"object"}let k=(a,b)=>{let c=a=>a.toLowerCase().replace(/[_\.]/g,""),d=c(a),e=b.find(a=>c(a)===d);if(e)return e;let f=b.find(a=>c(a.split(".").pop()||"")===d);return f||b.find(a=>{let b=a.split(".").pop()||"";return c(b).includes(d)||d.includes(c(b))})},l=(a,b)=>{if(!a||!b)return;let c=b.split("."),d=a;for(let a of c){if(null==d||"object"!=typeof d||"object"!=typeof d||null===d)return;d=d[a]}return d},m=(a,b)=>{let c=l(a,b);return null==c?"string":j(c)},n={string:["String","FixedString","DateTime","DateTime64","UUID","Enum8","Enum16","Decimal","Bool","UInt8","UInt16","UInt32","UInt64","UInt128","Date","Date32"],int8:["Int8"],int16:["Int16"],int32:["Int32"],int64:["Int64","DateTime","DateTime64"],float32:["Float32"],float64:["Float64","DateTime","DateTime64"],bool:["Bool"],bytes:["String"],int:["Int8","Int16","Int32","Int64"],float:["Float32","Float64"],uint8:["UInt8"],uint16:["UInt16"],uint32:["UInt32"],uint64:["UInt64"],uint:["UInt8","UInt16","UInt32","UInt64"],number:["Int8","Int16","Int32","Int64","UInt8","UInt16","UInt32","UInt64","Float32","Float64","Decimal","DateTime","DateTime64"],boolean:["Bool"],object:["String"],array:["Array","String"],null:["Nullable"],undefined:["Nullable"]};function o(a,b){if(!a||!b)return!1;if(b.startsWith("Nullable("))return o(a,b.substring(9,b.length-1));if(b.startsWith("Array(")){let c=b.substring(6,b.length-1);return"array"===a||o(a,c)}let c=n[a.toLowerCase()];return!!c&&c.some(a=>b.includes(a))}function p(a){let b=[],c=[],d=[];return a.forEach(a=>{if(a.eventField){if(!a.jsonType)return void d.push({...a,reason:`Missing type: Field ${a.eventField} is mapped to column ${a.name} but has no inferred type`});o(a.jsonType,a.type)?b.push(a):c.push({...a,reason:`Incompatible type: ${a.jsonType} cannot be mapped to ${a.type}`})}}),{validMappings:b,invalidMappings:c,missingTypeMappings:d}}let q=(a,b)=>{let c=b.find(b=>b.eventField===a);return c?c.jsonType:"string"}}};